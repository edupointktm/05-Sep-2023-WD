!function(e,t,n,o){"use strict";n.module("esewaProfileApp",["restangular","ngStorage","esewaMessages","esewaSharedApp","ui.router","ngCookies"]).run(["$rootScope","$state","$localStorage","$http","$timeout","$sce","$location","$templateCache","AUTH_EVENTS",function(e,t,n,o,a,i,s,r,c){}]),n.module("esewaProfileApp").controller("ChangePasswordCtrl",["$scope","$rootScope","$state","AuthService","$timeout","InformationService","INFORMATION","$sce","StateConstant","AUTH_EVENTS","ecmsg","MessageConstant","$stateParams",function(e,t,o,a,i,s,r,c,l,d,u,m,f){e.showloadingBar=!1;var p=r.userChangePassword;t.showInformation=!0,t.clearMessage(),e.isForcefulReset=f.forcefulReset,e.initChangePassword=function(){e.passwordDto=new function(){this.oldPassword="",this.newPassword="",this.confirmNewPassword=""}},e.initChangePassword(),e.isNewPasswordAndOldPasswordSame=function(){return""!==e.passwordDto.oldPassword&&""!==e.passwordDto.newPassword&&e.passwordDto.oldPassword===e.passwordDto.newPassword},e.isNewPasswordandConfirmNewPasswordSame=function(){return!(!e.passwordDto.newPassword||!e.passwordDto.confirmNewPassword)&&e.passwordDto.newPassword===e.passwordDto.confirmNewPassword},e.cancelChangePassword=function(){e.passwordDto=null,o.go(l.HOME_MAIN)},e.isSubmitBtnDisabled=function(t){return t||(e.isNewPasswordAndOldPasswordSame()||!e.isNewPasswordandConfirmNewPasswordSame())},e.changePassword=function(o){e.showloadingBar=!0,a.changePassword(o).then(function(n){e.success=n.plain(),i(function(){t.successMessageForIndex=!0,t.redirectMsg=e.success.message},500),delete t.$storage.changePassword,$modal.open({templateUrl:"/user/static/views/messageView.html",controller:g,size:"signUp",backdrop:"static",keyboard:!1})},function(o){var a;e.showloadingBar=!1,403===o.status?(a=$cookies.getAll(),n.forEach(a,function(e,t){"authesewa"!==t&&"XSRF-TOKEN"!==t||$cookies.remove(t)}),t.cleanStorage(),t.$storage.profile||(t.$storage.profile={esewa_id:""})):o.data?u.error(o.data.error_message):u.error(m.serviceNotAvailable)})};var g=["$scope","$rootScope","$modalInstance",function(e,t,n){t.currentModal=n,e.done=function(){t.logout()}}];t.informationKey=p,t.$broadcast(d.information),e.cancel=function(){o.go(l.HOME_MAIN)}}]),n.module("esewaProfileApp").controller("HomeController",["$rootScope","$scope",function(e,t){e.clearMessage(),e.$$phase||e.$apply(function(){e.showMostUsedServices=!0,e.showAddServices=!0})}]),n.module("esewaProfileApp").controller("InitialRequirementController",["$scope","$rootScope","$modal","$state","$window","AUTH_EVENTS","StateConstant",function(e,t,o,a,i,s,r){var c=t.PropertyConstant;e.initialRequirement=t.initialRequirement,e.initialRequirement&&(n.isDefined(e.initialRequirement.form_url)&&"https://cdn.esewa.com.np/ui/html/NONE.html"!==e.initialRequirement.form_url?e.openConfirmPersonalDetailDialog=function(e){o.open({templateUrl:"/user/authentication/views/initial_requirement_popup.html",controller:l,size:"lg",backdrop:"static",keyboard:!1,resolve:{initialRequirement:function(){return e}}})}:t.goToState("main.landing"));var l=["$rootScope","$scope","initialRequirement","$state","$modalInstance","AUTH_EVENTS","CDNUrl","StateConstant",function(e,t,n,o,a,i,s,r){t.htmlLinkForInitialRequirement=n.url,e.showWelcomePage?(t.forceful=!1,e.showWelcomePage=!1,t.htmlLinkForInitialRequirement=s.welcomeForm):n.type===c.initialForceful&&(t.forceful=n.type),t.cancel=function(){n.type!==c.initialForceful&&(delete e.$storage.initialRequirement,o.go(r.HOME_MAIN),a.dismiss()),e.$broadcast(i.initialRequirement)},e.currentModal=a}];e.initialRequirement&&e.initialRequirement.url?n.isDefined(e.initialRequirement.form_url)&&"https://cdn.esewa.com.np/ui/html/NONE.html"!==e.initialRequirement.form_url?e.openConfirmPersonalDetailDialog(e.initialRequirement):t.goToState("main.landing"):a.go(r.HOME_MAIN)}]),n.module("esewaProfileApp").controller("MpinController",["$state","$rootScope","$scope","MpinService","$modal","ecmsg","InformationService","INFORMATION","$sce","$timeout","StateConstant",function(e,t,o,a,i,s,r,c,l,d,u){var m=this;function f(){m.old_mpin="",m.new_mpin=""}n.isDefined(t.$storage.profile)&&(t.$storage.profile.is_primary||e.go(u.HOME_MAIN)),m.showInformation=!1,t.clearMessage(),m.MPIN=new f,m.initChangePassword=function(){m.MPIN=new f},m.checkNewMPIN=function(){return m.MPIN.new_mpin!==m.confirm_new_mpin},m.isNewPasswordAndOldMPINSame=function(){return m.MPIN.old_mpin===m.MPIN.new_mpin},m.cancelChangeMPIN=function(){m.MPIN=null,m.confirm_new_mpin=null,e.go(u.HOME_MAIN)},m.changeMPIN=function(o){a.changeMPIN(o).then(function(t){console.log(t.plain()),m.MPIN=null,m.confirm_new_mpin=null,d(function(){t.message&&(s.success=t.message)},500),e.go(u.HOME_MAIN)},function(e){t.showInformation=!1,n.isDefined(e)&&(e.data.error_message?t.message.error=e.data.error_message:t.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},m.resetMpin=function(o){a.changeMPIN(o).then(function(){m.MPIN=null,m.confirm_new_mpin=null,e.go(u.HOME_MAIN),t.message="Your MPIN is now reset."},function(e){n.isDefined(e.data.error_message)?t.message=e.data.error_message:t.error="Failed to change MPIN Check your correct MPIN and try again!!!!"})},m.resetMpinForUser=function(e){o.resetAvailable=!0,t.$storage.initialRequirement&&"FORCEFUL"===t.$storage.initialRequirement.type&&(o.resetAvailable=!1),o.resetAvailable&&i.open({templateUrl:"user/authentication/views/rest_mpin.html",controller:p,size:"md",resolve:{esewaId:function(){return e}}})};var p=["$modalInstance","$state","$scope","$rootScope","esewaId",function(e,t,o,i,s){o.close=function(){e.dismiss()},i.currentModal=e,o.resetMpin=function(){a.resetMPIN(s).then(function(e){o.response=e.plain(),m.MPIN=null,m.confirm_new_mpin=null,o.response&&d(function(){i.successMessageForIndex=!0,i.showInformation=!1,i.message.success=o.response.message},100),o.close()},function(e){i.showInformation=!1,n.isDefined(e)&&(e.data.error_message?i.message.error=e.data.error_message:i.message.error="Service is currently unavailable. please, try again later to change your MPIN.")})},o.cancelChangeMPIN=function(){o.close()}}]}]),n.module("esewaProfileApp").service("AuthService",["Restangular",function(e){var t=e.all("auth"),n=e.all("esewa");this.authenticate=function(t){return e.one("authenticate").customPOST("","","",{esewa_id:t.esewaId,password:t.password})},this.registerUserUsingEsewaId=function(e,t){var o={esewa_id:e.esewaId,email:e.email,"g-recaptcha-response":t,terms_and_conditions:e.termsAndCondition};return n.all("reg").post(o)},this.validateToken=function(e){return n.one(e.esewaId+"").one("token").one(e.token+"").one("validate").customGET()},this.validateLastToken=function(e){return n.one(e.esewaId+"").one("token").one(e.token+"").one("validate").customGET()},this.changePassword=function(e){return t.one("change_password").customPOST("","","",{old_password:e.oldPassword,new_password:e.newPassword})},this.setPassword=function(e){var t={token:e.token};return n.one(e.esewaId+"").one("create_password").customPOST(t,"","",{password:e.password})},this.getInitialRequirements=function(){return t.one("initial_requirements").get()},this.getUserProfile=function(){return t.one("profile").customGET()},this.logout=function(t){return e.all("logout").customPOST("","","",{esewa_id:t})}}]),n.module("esewaProfileApp").service("MpinService",["Restangular",function(e){var t=e.all("auth");this.resetMPIN=function(e){return t.one(e).all("reset_mpin").customPUT()}}]),n.module("esewaProfileApp").constant("BankTypeConstant",{LEGACY:"LEGACY",BANK_SMART:"BANK_SMART",NPS_WITH_CHECKOUT_MODEL:"NPS_WITH_CHECKOUT_MODEL",BANK_SMART_WITH_NPS:"BANK_SMART_WITH_NPS",NPS:"NPS",DEFAULT:"DEFAULT"}),n.module("esewaProfileApp").directive("whenScrolled",["$window",function(e){return{restrict:"A",link:function(t,o,a){n.element(e).bind("scroll",function(){e.innerHeight+e.scrollY>=document.body.offsetHeight/1.5&&t.$apply(a.whenScrolled)})}}}]),n.module("esewaProfileApp").controller("PanDocumentController",["$scope","CDNUrl","$modal","$http","$state","StateConstant","ecmsg","$rootScope",function(e,t,o,a,i,s,r,c){function l(){n.element("#panPhoto").attr("src",""),e.formDataDoc=[],e.document={panPhoto:{}},e.documentPath={}}function d(){c.initialRequirement={}}e.showInvalidImageSize=!1,e.validImage=!1,e.document={panPhoto:{}},e.documentPath={},e.panvatInformationMessage="Please note that the size of each document uploaded shall not exceed 1 MB. Please ignore this message if you have already uploaded your PAN document. If you need help in uploading document then please mail your documents to crm@esewa.com.np with your details.",e.getImageSrc=function(e){return e||t.defaultAccountUrl},e.hasNewfileInTemp=function(t){return!!_.find(e.files,t)},e.showImageInPopup=function(e){o.open({templateUrl:"/points/views/model_image.html",size:"md kyc-image-modal",controller:"ImagePopupController",resolve:{image_src:function(){return document.querySelector("#panPhoto").src},doc:function(){return e}}})},e.uploadNewFile=function(t){e.formDataDoc="",$("#"+t+"_in").click()},e.addNewDocument=function(t,o){if(e.validImage=!1,e.showInvalidPanMessage=!1,e.panImageName="",e.formDataDoc=[],!o.files[0].type.match("image")&&!o.files[0].type.match("application/pdf"))return e.showInvalidPanMessage=!0,e.invalidPanMessage="Invalid PAN document file format",e.panImageName="",void l();if(o.files[0].size>1048576)return e.showInvalidPanMessage=!0,e.invalidPanMessage="Invalid PAN document size",e.panImageName="",void l();e.panImageName=o.files[0].name,e.formDataDoc.push(t[0]),e.document.panPhoto=t[0];var a=new FileReader;a.onload=function(t){n.element("#panPhoto").attr("src",t.target.result),o.files[0].type.match("application/pdf")&&n.element("#panPhoto").attr("src","/common/images/pdf_icon.png"),e.documentPath.panPhoto=t.target.result},a.readAsDataURL(o.files[0]),e.hidePhotoUpload=!1,e.validImage=!0,e.$$phase||e.$apply()},e.confirmPanDocuments=function(t){var o=new FormData;o.append("PAN",t.number),o.append(e.document.panPhoto.name,"PAN_VAT"),o.append("files",e.formDataDoc[0]),a({method:"POST",url:"/api/web/user/organization/document/upload",transformRequest:n.identity,headers:{"Content-Type":void 0},data:o}).then(function(e){r.info(e.data.message),d(),i.go(s.ORGANIZATION_HOME)},function(){d()})},e.skipPanRequirement=function(){d(),i.go(s.ORGANIZATION_HOME)}}]),n.module("esewaProfileApp").config(["$stateProvider","CDNUrl",function(e,t){e.state("fcmNotifications",{url:"/fcms",templateUrl:t.url+"/html/templates/fcm_notification/all_fcm_notifications.html",controller:"FcmNotificationController",data:{searchParams:["fcm notification"],displayName:"Notification",icon:"icon-es-notification-ids"}}).state("user",{abstract:!0,templateUrl:t.url+"/html/templates/profile_3.48.1.0.html"}).state("user.detail",{url:"/profile",templateUrl:"user/userkyc/views/kyc_details.html",controller:"AbstractUserController",ncyBreadcrumb:{label:"Profile"}}).state("user.panVat",{url:"/pan-vat",abstract:!0,template:"<div ui-view></div>",controller:"PanDocumentController",data:{accessRole:[1,2]}}).state("user.panVat.upload",{url:"/upload",templateUrl:t.url+"/html/templates/org/add_pan_vat.html",data:{accessRole:[1,2]}}).state("user.detail.one",{url:"/personal_details",templateUrl:"user/userkyc/views/kyc_category_one.html",controller:"UserProfileController",data:{displayName:"Personal Detail"}}).state("user.detail.three",{url:"/identity_details",templateUrl:"user/userkyc/views/kyc_category_three.html",controller:"UserProfileController",data:{displayName:"Identity Detail"}}).state("user.addBankInformation",{abstract:!0,template:"<div ui-view></div>",controller:"UserPersonalInformationController",ncyBreadcrumb:{label:"Profile"},resolve:{fromModal:function(){return!1},selectBank:function(){return!1}}}).state("user.addBankInformation.firstStep",{url:"/my-bank-information",templateUrl:t.url+"/html/templates/bankinformation/add_bank_information_first_step_3.50.0.0.html",data:{searchParams:["add bank account"],displayName:"Add Bank Account",icon:"icon-es-bank-partner"},ncyBreadcrumb:{label:"Bank Accounts",parent:"user.detail"}}).state("user.addBankInformation.secondStep",{url:"/my-bank-information/second-step",templateUrl:t.url+"/html/templates/bankinformation/add_bank_information_second_step_3.38.0.1.html",ncyBreadcrumb:{label:"Add Account",parent:"user.addBankInformation.firstStep"}}).state("user.addBankInformation.confirmation",{url:"/my-bank-information/confirmation",templateUrl:t.url+"/html/templates/bankinformation/add_bank_information_confirmation_page_3.38.0.html",ncyBreadcrumb:{label:"Account Information",parent:"user.addBankInformation.secondStep"}}).state("user.linkedAccount",{url:"/linked-account",abstract:!0,templateUrl:t.url+"/html/linked_account/linked_account_3.38.0.html",controller:"LinkedAccountController",data:{accessRole:[0,1],displayName:"Linked Account"},resolve:{pageTitle:function(){return"Link Bank Account"}}}).state("user.linkedAccount.list",{url:"/list",controller:"LinkedAccountListController",data:{searchParams:["linked account"],displayName:"Linked Account",accessRole:[0,1],icon:"icon-es-contact-account"},resolve:{pageTitle:function(){return"Linked Bank Accounts"}},templateUrl:t.url+"/html/linked_account/list_linked_account_3.48.1.0.html"}).state("user.linkedAccount.bankList",{url:"/bank-list",controller:"BankListController",data:{accessRole:[0,1],displayName:"Linked Account"},resolve:{pageTitle:function(){return"Select Your Bank"}},templateUrl:t.url+"/html/linked_account/bank_list_3.42.0.0.html"}).state("user.linkedAccount.linking",{url:"/linking-account",controller:"IntermediateAccountLinkController",data:{accessRole:[0,1]},templateUrl:t.url+"/html/linked_account/intermediate_account_link.html"}).state("user.linkedAccount.withNPSResponse",{url:"/linking-account-response?status&accountLinkRequestType&transactionId",controller:"NPSAccountLinkResponseController",data:{accessRole:[0,1]},templateUrl:t.url+"/html/linked_account/intermediate_account_link.html"}).state("user.linkedAccount.history",{url:"/linked-history",controller:"AccountLinkHistoryController",templateUrl:t.url+"/html/linked_account/account_link_history_3.38.0.html",data:{searchParams:["linked account history"],displayName:"Linked Bank Account History",icon:"icon-es-contact-account"}}).state("userKyc",{url:"/user-kyc?userId",abstract:!0,templateUrl:t.url+"/html/templates/kyc/kyc_3.37.1.0.html",controller:"UserKycController"}).state("userKyc.personalDetails",{url:"/personal-details",templateUrl:t.url+"/html/templates/kyc/kyc_personal_details_3.45.0.0.html",data:{displayName:"KYC - Add Personal Details"}}).state("userKyc.addressInformation",{url:"/address-information",templateUrl:t.url+"/html/templates/kyc/kyc_address_information_3.37.0.html",data:{displayName:"KYC - Add Address Information"}}).state("userKyc.documentDetails",{url:"/document-details",templateUrl:t.url+"/html/templates/kyc/kyc_document_details_3.50.0.0.html",data:{displayName:"KYC - Add Document Details"}}).state("userKycEdit",{abstract:!0,url:"/user-kyc-edit?userId",controller:"UserKycController",templateUrl:t.url+"/html/templates/kyc/kyc_3.37.1.0.html"}).state("userKycEdit.personalDetails",{url:"/edit-personal-details",templateUrl:t.url+"/html/templates/kyc/kyc_personal_details_3.45.0.0.html",data:{displayName:"KYC - Edit Personal Details"}}).state("userKycEdit.addressInformation",{url:"/edit-address-information",templateUrl:t.url+"/html/templates/kyc/kyc_address_information_3.37.0.html",data:{displayName:"KYC - Edit Address Information"}}).state("userKycEdit.documentDetails",{url:"/edit-document-details",templateUrl:t.url+"/html/templates/kyc/kyc_document_details_3.50.0.0.html",data:{displayName:"KYC - Edit Document Details"}})}]),n.module("esewaProfileApp").controller("FcmNotificationController",["$rootScope","$scope","FcmNotificationService","AUTH_EVENTS","$window",function(e,t,n,o,a){var i=100,s=0,r=!1,c=!1;function l(){n.getFcmNotificationsCount().then(function(e){t.notificationCount=e})}t.notificationLists=[],a.scrollTo({top:0,behavior:"smooth"}),e.$on(o.fcmNotificationCount,function(){l()}),t.goToAllFcmNotification=function(){e.goToState("fcmNotifications")},t.loadFcmNotification=function(){r||c||(r=!0,n.getFcmNotifications(s,i).then(function(e){c=0===e.length,t.notificationCount=0,i+=100,s++,r=!1,t.notificationLists=t.notificationLists.concat(e)},function(e){console.log(e)}))},t.openLink=function(e){e&&a.open(e,"_blank")},e.countFcmNotification=function(){l()}}]),n.module("esewaProfileApp").service("FcmNotificationService",["Restangular","$localStorage",function(e,t){function n(){return _.isEmpty(t.user)?e.all("auth"):e.all("user")}this.getFcmNotifications=function(e,t){return n().one("notification").one("fcm").withHttpConfig({miniLoadingBarId:"all-notification-tab"}).get({page:e,size:t||5})},this.getFcmNotificationsCount=function(){return n().one("notification").one("count_new").withHttpConfig({miniLoadingBarId:"all-notification-tab"}).get()}}]),n.module("esewaProfileApp").filter("bankInfoWithSwiftCode",function(){return function(e,t,n){return n.filter(function(t){if(t.swift_code===e)return t})[0][t]}}),n.module("esewaProfileApp").filter("firstname",function(){return function(e){return e?e.split(" ")[0]:"User"}}),n.module("esewaProfileApp").filter("positiveNumber",function(){return function(e){return Math.abs(e)}}),n.module("esewaProfileApp").controller("KycDeclarationController",["$scope","$rootScope","$modalInstance","callback","content",function(e,t,n,o,a){e.content=a,e.agreeTermsAndConditionsCallback=function(t){e.agreeTermsAndConditions&&(o(t),n.dismiss())},e.closeDialog=function(){n.dismiss()}}]),n.module("esewaProfileApp").controller("UpdateKycController",["$scope","$rootScope","$state","UserKycService","$filter","$window","IdentityConstant","$modal","CDNUrl","AddressService","$http","StateConstant",function(e,t,o,a,i,s,r,c,l,d,u,m){var f=t.$storage.profile;function p(n,o,a,i,s){n(a).then(function(t){o&&(e[o]=t.plain()),"function"==typeof i&&i(t.plain())},function(e){t.showErrorSuccessMessage(e,!0,"",!0),"function"==typeof s&&s(e)})}f.isPrimary&&f.isVerified||t.goToState(m.LOGIN),e.details={},e.details.current_address_details={},e.occupationList=[],p(d.getProvince,"provinces","",function(){p(d.getZones,"zones"),p(a.getKycCdd,"","",function(t){e.details=t})}),p(a.getOccupation,"","",function(t){e.occupationList=t}),e.goBack=(()=>s.history.back()),e.updateKyc=function(){var o=n.copy(e.details);o.current_address=o.current_address_details,delete o.current_address_details,o.current_address.address_id=o.current_address.vdc_municipality_id,delete o.current_address.zone_id,delete o.current_address.district_id,u({method:"POST",url:"/api/web/auth/kyc/cdd",headers:{"Content-Type":void 0},transformRequest:function(){var e=new FormData;return e.append("kyc_cdd_details",new Blob([n.toJson(o)],{type:"application/json"})),e},data:o}).then(function(e){t.initialRequirement={},t.showErrorSuccessMessage(e,!1,"KYC information has been updated.",!0),t.goToState(m.LOGIN)},function(e){t.showErrorSuccessMessage(e,!0,"Error while updating Kyc information",!0)})}}]),n.module("esewaProfileApp").controller("UserKycController",["$rootScope","$scope","UserKycViewFactory","UserKycService","$http","$state","$window","$modal","AddressService","StateConstant","IdentityConstant","$filter","CDNUrl","$stateParams","$localStorage",function(e,t,o,a,i,s,r,c,l,d,u,m,f,p,g){var h,k=[d.KYC_PERSONAL_INFORMATION,d.KYC_ADDRESS_INFOTMATION,d.KYC_DOCUMENT_DETAILS],w=!1;function y(){r.scrollTo({top:0,behavior:"smooth"})}function v(n,o,a,i,s){n(a).then(function(e){o&&(t[o]=e.plain()),"function"==typeof i&&i(e.plain())},function(t){e.showErrorSuccessMessage(t,!0),y(),"function"==typeof s&&s(t)})}function A(){switch(k.indexOf(s.current.name)){case 0:t.personalDetailClass="",t.addressDetailClass="";break;case 1:t.personalDetailClass="active completed",t.addressDetailClass="";break;case 2:t.addressDetailClass=t.personalDetailClass="active completed"}y()}a.setRegisteringMobileNumber(p.userId),t.registeringMobileNumber=p.userId,t.foreignUser=!1,h=new Date,t.currentDate=h.getDate(),t.currentMonth=h.getMonth(),t.currentYear=h.getFullYear(),t.personalDetails={},t.setPermanentAddressSameAsCurrent=function(e){e&&(t.addressInformation.permanent_address||(t.addressInformation.permanent_address={}),Object.assign(t.addressInformation.permanent_address,t.addressInformation.current_address))},t.$watch("addressInformation.current_address",function(e){t.extraScope.sameAsCurrent&&(t.addressInformation.permanent_address=e)},!0),t.getKycDetails=function(n){e.message={},v(a.getAllKycDetails,"","",function(o){t.kycDetails=o,t.remarks=t.kycDetails.remarks?t.kycDetails.remarks.split("&&").reverse():[],t.foreignUser=t.kycDetails.foreign_user,t.personalDetails=t.kycDetails.personal_resource,0===t.personalDetails.occupation_id&&(t.personalDetails.occupation_id=null),t.addressInformation={permanent_address:t.kycDetails.address_resource.permanent_address,current_address:t.kycDetails.address_resource.current_address,foreigner_permanent_address:t.kycDetails.address_resource.foreigner_permanent_address,alternate_contact_number:t.kycDetails.address_resource.alternate_contact_number,employee_information:t.kycDetails.address_resource.employee_information,is_new_address:t.kycDetails.address_resource.is_new_address},n&&"function"==typeof n&&n(),"VERIFYING"!==o.status&&"APPROVED"!==o.status&&"CANCEL_VERIFICATION_REQUEST"!==o.status||(e.isOrg()?e.goToState("organization_customer.customers_list"):e.goToState(d.KYC_PROFILE)),e.isOrg()&&s.current.name===d.KYC_PERSONAL_INFORMATION&&("REJECTED"===t.kycDetails.address_resource.status?(t.isEditingKyc=!0,s.go(d.KYC_ADDRESS_INFOTMATION,s.params)):"REJECTED"===t.kycDetails.identity_resource.status&&(t.isEditingKyc=!0,s.go(d.KYC_DOCUMENT_DETAILS,s.params)))})},t.documentDetails={documents:{},citizenship_number:"",identity_expiry_date:"",place_of_issue:null,identity_issued_date:"",identity_number:"",identity_issued_address_id:"",identity_type:"",identity_document:[]},t.$watch("documentDetails.identity_expiry_date",function(e){if(e){var n=(new Date).getTime(),o=new Date(e).getTime();t.isExpiryDateValid=o>n}else t.isExpiryDateValid=!0}),t.identityList=u,t.countriesList=[],t.occupationList=[],t.extraScope={},t.isEditingKyc=s.includes("userKycEdit"),t.currentState=s.current.name,t.initKycPersonalDetails=function(){var n;A(),t.personalDetailClass="",n=function(){t.personalDetailsContents=o.getPersonalDetailsContents,e.isOrg()||v(a.getPersonalDetails,"personalDetails","",function(e){0===t.personalDetails.occupation_id&&(t.personalDetails.occupation_id=null),t.personalDetails.date_of_birth_ad||t.personalDetails.date_of_birth_bs||(t.modalInstance=c.open({templateUrl:f.url+"/html/templates/kyc/kyc_welcome_modal.html",size:"lg",scope:t}))})},t.occupationList.length?n():v(a.getOccupation,"occupationList","",n)},t.closeModal=function(){t.modalInstance.dismiss("cancel")},t.isActiveState=function(e){return s.current.name===e?"active":""},t.routeTo=function(n,o){var a=k.indexOf(s.current.name);k.indexOf(n)<a&&(t.extraScope["form"+[a]].$dirty?(t.toState=n,t.modalInstance=c.open({templateUrl:f.url+"/html/templates/kyc/confirmation_alert_box.html",size:"sm",scope:t})):e.goToState(n))},t.confirmRoute=function(){var n=t.toState;delete t.toState,e.goToState(n)},t.savePersonalDetails=function(n,o){if("ACCEPTED"!==t.kycDetails.personal_resource.status){var i=_.assign(n),r=_.omit(i,["status","remarks","occupation"]);v(a.saveUserKycPersonalDetails,"",r,function(){var n=t.isEditingKyc?d.KYC_PROFILE:d.KYC_ADDRESS_INFOTMATION;e.isOrg()&&"REJECTED"===t.kycDetails.status?"REJECTED"===t.kycDetails.address_resource.status?s.go(d.KYC_ADDRESS_INFOTMATION,s.params):"REJECTED"===t.kycDetails.identity_resource.status?s.go(d.KYC_DOCUMENT_DETAILS,s.params):e.goToState("organization_customer.customers_list"):e.goToState(n)},function(e){for(var n in feild_message)t.personalDetailError[n]=feild_message[n],o[n].$setValidity("pattern",!1)})}else e.showErrorSuccessMessage("Could not save personal detail, personal detail has already been verified.",!0,"",!0)},t.setFormFieldAsPerCountry=function(e){t.personalDetailsContents=o.getPersonalDetailsContents,t.personalDetails.foreigner="nepal"===e,t.personalDetails.foreigner&&(t.personalDetailsContents.pan_number=!1,t.personalDetailsContents.spouse_name=!1)},t.initKycAddressInformation=function(n){A(),t.addressDetailClass="",t.addressInformation={},v(l.getZones,"zones"),v(l.getProvince,"provinces"),t.addressInformationContent=o.getAddressInformationContent,e.isOrg()?t.getKycDetails(function(){var e=t.kycDetails.address_resource;t.addressInformation={permanent_address:e.permanent_address,current_address:e.current_address,foreigner_permanent_address:e.foreigner_permanent_address,alternate_contact_number:e.alternate_contact_number,employee_information:e.employee_information,is_new_address:e.is_new_address},t.personalDetails.foreigner&&(t.addressInformationContent.mailingAddress=!0,t.addressInformationContent.organizationDetails=!0,t.addressInformationContent.alternateContactDetail=!1)}):(v(a.getAddressDetails,"","",function(e){t.addressInformation={permanent_address:e.permanent_address,current_address:e.current_address,foreigner_permanent_address:e.foreigner_permanent_address,alternate_contact_number:e.alternate_contact_number,employee_information:e.employee_information,is_new_address:e.is_new_address}}),t.personalDetails.foreigner&&(t.addressInformationContent.mailingAddress=!0,t.addressInformationContent.organizationDetails=!0,t.addressInformationContent.alternateContactDetail=!1))},t.saveAddressInformation=function(o){if("ACCEPTED"!==t.kycDetails.address_resource.status){var a=n.copy(o);a.permanent_address.address_id=a.permanent_address.vdc_municipality_id,a.current_address.address_id=a.current_address.vdc_municipality_id,a.permanent_address=_.pick(a.permanent_address,["address_id","ward_number","tole"]),a.current_address=_.pick(a.current_address,["address_id","ward_number","tole"]);var r=_.pick(a,["permanent_address","current_address","foreigner_permanent_address","alternate_contact_number","employee_information"]);i({method:"POST",url:e.isOrg()?"api/web/user/customer/"+p.userId+"/kyc/address_detail":"/api/web/auth/kyc/address_detail/v1",headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return t.append("kyc_address_details",new Blob([n.toJson(e.kycAddressDetails)],{type:"application/json"})),t},data:{kycAddressDetails:r}}).then(function(){var n=t.isEditingKyc?d.KYC_PROFILE:d.KYC_DOCUMENT_DETAILS;e.isOrg()&&"REJECTED"===t.kycDetails.status?"REJECTED"===t.kycDetails.identity_resource.status?s.go(d.KYC_DOCUMENT_DETAILS,s.params):s.go("organization_customer.customers_list"):e.goToState(n)},function(t){e.showErrorSuccessMessage(t,!0,"ERROR_ON_SERVING_REQUEST"),y()})}else e.showErrorSuccessMessage("Could not save address detail, address detail has already been verified.",!0,"",!0)},t.initKycDocumentsDetails=function(){A(),e.isOrg()?t.getKycDetails(function(){var e=function(){var e=t.kycDetails.identity_resource;e.identity_issued_date=m("date")(e.identity_issued_date,"yyyy-MM-dd"),e.identity_expiry_date=m("date")(e.identity_expiry_date,"yyyy-MM-dd"),e.identification_number={},e.identity_document=e.identity_document||[],t.documentDetails=e},n=t.kycDetails.address_resource;null!==n&&null!==n.permanent_address&&(w=n.permanent_address.is_new_address);var o=w?l.getProvince:l.getZones;v(w?l.getAllNewDistricts:l.getAllDistricts,"issuedDistrictList","",function(){v(o,"issuedZoneProvinceList","",e)})}):v(a.getAddressDetails,"","",function(e){v(a.getDocumentDetails,"","",function(n){var o=function(){n.identity_issued_date=m("date")(n.identity_issued_date,"yyyy-MM-dd"),n.identity_expiry_date=m("date")(n.identity_expiry_date,"yyyy-MM-dd"),n.identification_number={},n.identity_document=n.identity_document||[],t.documentDetails=n};null!==e&&null!==e.permanent_address&&(w=e.permanent_address.is_new_address);var a=w?l.getProvince:l.getZones;v(w?l.getAllNewDistricts:l.getAllDistricts,"issuedDistrictList","",function(){v(a,"issuedZoneProvinceList","",o)})})})};var I={},D={};t.$watch("documentDetails.documents.imageFile",function(e){var n=t.documentDetails.identity_document[0]||{};e&&"ACCEPTED"!==n.document_status&&(t.documentDetails.identity_document[0]=t.documentDetails.identity_document[0]||{},t.documentDetails.identity_document[0].document_status="",I.IMAGE=n.identification||null,D.imageFile=t.documentDetails.documents.imageFile)}),t.$watch("documentDetails.documents.frontImageFile",function(e){var n=t.documentDetails.identity_document[1]||{};if(e&&"ACCEPTED"!==n.document_status){t.documentDetails.identity_document[1].document_status="";var o=t.documentDetails.identity_type+"_FRONT";I[o]=n.identification||null,D.frontImageFile=t.documentDetails.documents.frontImageFile}}),t.$watch("documentDetails.documents.backImageFile",function(e){var n=t.documentDetails.identity_document[2]||{};if(e&&"ACCEPTED"!==n.document_status){var o=t.documentDetails.identity_type+"_BACK";t.documentDetails.identity_document[2].document_status="",I[o]=n.identification||null,D.backImageFile=t.documentDetails.documents.backImageFile}}),t.saveDocumentDetails=function(o){if("ACCEPTED"!==t.kycDetails.identity_resource.status){var s=_.omit(t.documentDetails,["documents","identity_document","identity_issued_date_bs","identity_issued_date_bs","is_new_address"]);s.identity_expiry_date=new Date(s.identity_expiry_date).getTime(),s.identity_issued_date=new Date(s.identity_issued_date).getTime(),s.identification_number=I;var r={kyc_identity_details:s};for(var l in D)D.hasOwnProperty(l)&&(r[l]=D[l]);e.showLoadingBar=!0,i({method:"POST",url:e.isOrg()?"api/web/user/customer/"+p.userId+"/kyc/identity_detail":"/api/web/auth/kyc/identity_detail/v1",headers:{"Content-Type":void 0},transformRequest:function(){var e=new FormData;for(var t in e.append("kyc_identity_details",new Blob([n.toJson(s)],{type:"application/json"})),D)e.append(t,D[t]);return e},data:r}).then(function(){e.isOrg()?i({method:"PUT",url:"/api/web/user/customer/"+p.userId+"/kyc/verification"}).then(function(){var n=g.user.isCashIn?"FIRST_CASHIN":"FIRST_SEND_MONEY";a.getFirstLoadCommission(n,p.userId).then(function(e){t.firstLoadCommissionAmount=e,c.open({templateUrl:"/shared/customers/views/first_load_commission_modal.html",controller:"FirstLoadCommissionController",size:"md",backdrop:"static",scope:t})},function(){e.goToState("organization_customer.customers_list")})},function(t){e.showErrorSuccessMessage(t,!0,"ERROR_ON_SERVING_REQUEST"),y()}):e.goToState(d.KYC_PROFILE)},function(t){e.showErrorSuccessMessage(t,!0,"ERROR_ON_SERVING_REQUEST"),y()}).finally(function(){e.showLoadingBar=!1})}else e.showErrorSuccessMessage("Could not save document detail, document detail has already been verified.",!0,"",!0)},t.getDocumentDetail=function(e){if(t.documentDetails.identity_document)return t.documentDetails.identity_document.filter(function(t){return t.document_type===e})[0]},t.isOneOfDocumentAcceptedExceptProfile=function(){var e,n;return t.documentDetails.identity_document[1]&&(e="ACCEPTED"===t.documentDetails.identity_document[1].document_status),t.documentDetails.identity_document[2]&&(n="ACCEPTED"===t.documentDetails.identity_document[2].document_status),e||n},t.resetDocumentDate=function(){t.documentDetails.identity_issued_date=null,t.documentDetails.identity_issued_date_bs=null,t.documentDetails.identity_expiry_date=null,t.documentDetails.identity_expiry_date_bs=null},t.setDocumentDetailsContents=function(e){switch(t.documentDetails.identity_number="",t.documentDetails.identity_issued_address_id=null,t.documentDetailsContents={},delete D.backImageFile,delete D.frontImageFile,t.documentDetails.documents={},t.documentDetails.documents&&(t.documentDetails.documents={},t.documentDetails.documents={}),t.documentDetails.identity_document[2]&&(t.documentDetails.identity_document[2].file_name=""),t.documentDetails.identity_document[1]&&(t.documentDetails.identity_document[1].file_name=""),I=_.pick(I,"IMAGE"),e){case"citizen":t.documentDetailsContents={documentNo:!0,issuedDistricts:!0,dateOfIssues:!0};break;case"voterId":t.documentDetailsContents={documentNo:!0,voterIdNumber:!0,dateOfIssues:!0};break;case"citizen":case"voterId":t.documentDetailsContents={documentNo:!0,issuedDistricts:!0,dateOfIssues:!0};break;default:t.documentDetailsContents={}}},t.isKycDocumentFormValid=function(e){var n,o,a;if(t.documentDetails.identity_document[0]&&(n="REJECTED"===t.documentDetails.identity_document[0].document_status),t.documentDetails.identity_document[1]&&(o="REJECTED"===t.documentDetails.identity_document[1].document_status),t.documentDetails.identity_document[2]&&(a="REJECTED"===t.documentDetails.identity_document[2].document_status),e)return!(n||o||a)&&e.$valid&&t.isExpiryDateValid},t.getPromoCodeProperties=function(){return{amount:0,properties:{date_of_birth_bs:t.personalDetails.date_of_birth_bs||t.kycDetails.personal_resource.date_of_birth_bs,gender:t.personalDetails.gender||t.kycDetails.personal_resource.gender,occupation_id:t.personalDetails.occupation_id||t.kycDetails.personal_resource.occupation_id,identification_issued_address_id:t.documentDetails.identity_issued_address_id||t.kycDetails.identity_resource.identity_issued_address_id,full_name:t.personalDetails.first_name||t.kycDetails.personal_resource.first_name+" "+t.personalDetails.middle_name||t.kycDetails.personal_resource.middle_name?t.personalDetails.middle_name||t.kycDetails.personal_resource.middle_name:""+t.personalDetails.last_name||t.kycDetails.personal_resource.last_name}}}}]),n.module("esewaProfileApp").controller("UserKycDetailController",["$scope","$rootScope","$state","UserKycService","$filter","$window","IdentityConstant","$modal","CDNUrl",function(e,t,n,o,a,i,s,r,c){function l(){i.scrollTo({top:0,behavior:"smooth"})}e.getKycDetails=function(){l(),t.message={},o.getAllKycDetails().then(function(t){e.allKycDetails=t.plain();var n=e.allKycDetails.identity_resource;e.foreignUser=e.allKycDetails.foreign_user,e.allKycDetails.document_details={"Citizenship Number":n.citizenship_number,"Identity Type":s[n.identity_type],"Document Number":n.identity_number,"Identification Number":n.identification_number,"Document Issued Date":n.identity_issued_date?a("date")(n.identity_issued_date):null,"Document Expiry Date":n.identity_expiry_date?a("date")(n.identity_expiry_date):null,"Place of Issue":n.place_of_issue,"Document Issued Address":n.identity_issued_address_name},e.image=n.identity_document[0]||{},e.documentFront=n.identity_document[1]||{},"CTZN"!==n.identity_type&&"PASSPORT"!==n.identity_type||(e.documentBack=n.identity_document[2]||null),e.remarks=e.allKycDetails.remarks?e.allKycDetails.remarks.split("&&").reverse():[]},function(e){t.showErrorSuccessMessage(e,!0)})},e.updateKycSubmitStatus=function(n){var a=function(){o.updateKycSubmitStatus(n).then(function(n){l(),t.showErrorSuccessMessage(n,!1),e.getKycDetails()},function(e){t.showErrorSuccessMessage(e,!0)})};"SUBMIT_VERIFICATION_REQUEST"===n?o.getTermsAndConditions("KYC").then(function(e){"ACTIVE"===e.status?function(e,t){r.open({templateUrl:c.url+"/html/templates/kyc/kyc_declaration.html",controller:"KycDeclarationController",size:"md",backdrop:"static",resolve:{callback:function(){return e},content:function(){return t}}})}(a,e.plain()):a()},function(e){l(),t.showErrorSuccessMessage(e,!1)}):a()},e.showUpdateStatusDiv=function(e){let n=t.$storage.profile||{};return!(n.foreignUser||!n.isPrimary)&&!("ACEEPTED"===e||"VERIFYING"===e)},e.showEditDetailBtn=function(e,n){let o=t.$storage.profile;return!(o.foreignUser||!o.isPrimary)&&("VERIFYING"!==n&&"APPROVED"!==n&&"CANCEL_VERIFICATION_REQUEST"!==n&&"ACCEPTED"!==e)},e.showUpdateDocumentBtn=function(e){return(!t.$storage.profile||!t.$storage.profile.foreignUser)&&!("CANCEL_VERIFICATION_REQUEST"===e||"VERIFYING"===e)}}]),n.module("esewaProfileApp").controller("WebcamModalController",["$scope","$modalInstance","CDNUrl","WebcamService","setValue",function(e,t,n,o,a){function i(t){e.permissionInfo.denied=t,e.$$phase||e.$apply(function(){})}function s(){e.webcam&&!0===e.webcam.isTurnOn&&e.webcam.turnOff()}e.permissionInfo={},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0,audio:!1},function(){i(!1)},function(){i(!0)}),navigator.permissions.query({name:"camera"}).then(function(e){i("denied"===e.state),e.addEventListener("change",function(e){i("denied"===e.target.state)})}),e.showweb=!0,e.webcam=o.webcam,e.webcam.channel={videoWidth:800},e.webcam.success=function(t,n){e.photo=t,e.fotoContentType=n,e.showweb=!1,a(t),s(),e.cancel()},e.cancel=function(){t.dismiss(),s()}}]),n.module("esewaProfileApp").factory("UserKycViewFactory",[function(){return{getPersonalDetailsContents:{country:!0,first_name:!0,middle_name:!0,last_name:!0,gender:!0,dob:!0,father_name:!0,grand_father_name:!0,marital_status:!0,spouse_name:!0,occupation_id:!0,pan_number:!0,optional_email:!0},getAddressInformationContent:{currentAddress:!0,permanentAddress:!0,mailingAddress:!1,organizationDetails:!1,alternateContactDetail:!0},getDocumentsDetailsFormContent:{}}}]),n.module("esewaProfileApp").service("AddressService",["Restangular",function(e){var t=e.all("address");this.getZones=function(){return t.one("zone").withHttpConfig({miniLoadingBarId:"all"}).get()},this.getProvince=function(){return t.one("province").withHttpConfig({miniLoadingBarId:"all"}).get()},this.getDistrict=function(e){return t.one("zone").one(e+"").one("district").withHttpConfig({miniLoadingBarId:"all"}).get()},this.getNewDistrict=function(e){return t.one("province").one(e+"").one("district").withHttpConfig({miniLoadingBarId:"all"}).get()},this.getVdcs=function(e){return t.one("district").one(e+"").one("vdc").withHttpConfig({miniLoadingBarId:"all"}).get()},this.getAllDistricts=function(){return t.one("district").withHttpConfig({miniLoadingBarId:"all"}).getList()},this.getAllNewDistricts=function(){return t.one("province").all("district").withHttpConfig({miniLoadingBarId:"all"}).getList()}}]),n.module("esewaProfileApp").service("UserKycService",["Restangular","$http","$rootScope",function(e,t,o){var a,i=o.isOrg(),s=i?e.all("user"):e.all("auth");this.setRegisteringMobileNumber=function(e){a=e},this.getAllKycDetails=function(){return i?s.all("customer").one(a+"/kyc/v1").get():s.all("kyc").one("v1").get()},this.getPersonalDetails=function(){return i?s.all("customer").one(a+"/kyc/personal_detail").get():s.all("kyc").one("personal_detail/v1").get()},this.getCountries=function(){return s.all("kyc").one("countries").get()},this.getUserKycPersonalDetails=function(){return i?s.all("customer").one(a+"/kyc/personal_detail").get():s.all("kyc").one("personal_detail/v1").get()},this.saveUserKycPersonalDetails=function(e){return i?s.all("customer").one(a+"/kyc/personal_detail").customPOST(e):s.all("kyc").one("personal_detail/v1").customPOST(e)},this.getAddressDetails=function(){return i?s.all("customer").one(a+"/kyc/address_detail").get():s.all("kyc").one("address_detail/v1").get()},this.saveUserKycAddressInformation=function(e){return s.all("kyc").one("countries").withHttpConfig({transformRequest:n.identity}).customPOST(e,void 0,void 0,{"Content-Type":void 0})},this.getDocumentDetails=function(){return i?s.all("customer").one(a+"/kyc/identity_detail").get():s.all("kyc").one("identity_detail/v1").get()},this.saveUserKycDocumentDetails=function(e){return i?s.all("customer").one(a+"/kyc/personal_detail").get():s.all("kyc").one("countries").customPOST(e)},this.getOccupation=function(){return i?s.all("customer").one("getOccupation").get():e.all("occupation").getList()},this.getAllDistricts=function(){return e.one("address/province/district").get()},this.updateKycSubmitStatus=function(e){return s.one("kyc/status/submit/"+e+"?agreed=true").post()},this.getTermsAndConditions=function(t){return e.one("terms_and_conditions/"+t).get()},this.getFirstLoadCommission=function(t,n){return e.all("auth").one("first_load").one("max_commission").get({service_code:t,esewa_id:n})},this.getKycCdd=function(){return e.all("auth").one("kyc/cdd").get()}}]),n.module("esewaProfileApp").controller("AccountLinkHistoryController",["$scope","$rootScope","LinkedAccountService",function(e,t,n){e.accountLinkHistoryList=[],n.getLinkedAccountHistory().then(function(t){e.accountLinkHistoryList=t.plain()},function(e){t.showErrorSuccessMessage(e,!0)})}]),n.module("esewaProfileApp").controller("AddLinkAccountModalController",["$scope","$rootScope","$modalInstance","$filter","selectedBank","selectedBankDetails","LinkedAccountService","SecUserService","UserPersonalInformationService","BankTypeConstant",function(e,o,a,i,s,r,c,l,d,u){function m(t,n){e.message={isSuccess:t,message:n}}e.isValidatingState=!0,e.bankDetails=r||{},e.tokenDetails={},e.bank=s,e.close=function(){a.dismiss(),clearInterval(e.timeoutInterval)},e.APIMSFlow=[u.NPS_WITH_CHECKOUT_MODEL,u.BANK_SMART_WITH_NPS,u.NPS].includes(s.process),e.isAccountNumberRequired=![u.NPS_WITH_CHECKOUT_MODEL].includes(s.process),e.isNPSWithCheckoutModel=s.process===u.NPS_WITH_CHECKOUT_MODEL,e.isAPIMSOTP=[u.NPS].includes(s.process),e.initAddLinkAcForm=function(){d.getAgentBankName().then(function(t){e.userNames=t.plain()},function(e){o.showErrorSuccessMessage(e,!0)})};var f=n.isDefined(o.$storage.user);function p(e){return!isNaN(e)}l.getSecondaryUsers(f).then(function(t){e.loginCredentials=t.plain().filter(function(e){var t=!isNaN(1*e.esewa_id)||!isNaN(1*e.user_name),n="ACTIVE"===e.status||"ACTIVE"===e.login_status;if(t&&n)return e}),e.primaryAccountDetail=e.loginCredentials.find(function(e){if(e.is_primary)return e}),e.primaryAccountDetail&&o.isUser()&&(e.bankDetails.account_name=e.primaryAccountDetail.full_name,e.bankDetails.mobile_number=o.$storage.profile.esewaId,p(e.bankDetails.mobile_number)||(e.linkAccountForm.$setValidity("",!1),m(!1,"eSewa credential should be registered through mobile number to link bank accounts.")))}),e.validateAccount=function(n){switch(n.swift_code=s.swift_code,e.isLoading=!0,m("",""),s.process){case u.NPS_WITH_CHECKOUT_MODEL:!function(t){c.initiateNPSLink(t).then(function(e){!function(e){const t=document.createElement("form");t.method="POST",t.enctype="application/x-www-form-urlencoded",t.action=e.bank_information_details.redirect_url,t.style.display="none";const n=[{name:"TransactionId",path:"unique_id"},{name:"LinkId",path:"nps_linked_id"},{name:"TimeStamp"}];for(let o=0;o<n.length;o++){let a=document.createElement("input");a.name=n[o].name,"TimeStamp"===n[o].name?a.value=i("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sss"):a.value=e.bank_information_details[n[o].path],t.appendChild(a)}document.body.appendChild(t),t.submit()}(e)},function(e){m(!1,e.data.error_message)}).finally(function(){e.isLoading=!1})}(n);break;case u.NPS:!function(t){c.initiateNPSLink(t).then(function(t){e.NPSResponseData=t,e.isValidatingState=!1},function(e){m(!1,e.data.error_message)}).finally(function(){e.isLoading=!1})}(n);break;default:!function(n){c.validateAccount(n,s.in_app).then(function(n){s.in_app?(e.isValidatingState=!1,e.tokenDetails=_.pick(n.bank_information_details,["unique_id","swift_code"])):t.location.href=n.message},function(e){m(!1,e.data.error_message)}).finally(function(){e.isLoading=!1})}(n)}},e.resendToken=function(){e.isResendingToken=!0,e.isAPIMSOTP?function(){const t={unique_id:e.NPSResponseData.bank_information_details.unique_id,swift_code:e.NPSResponseData.bank_information_details.swift_code,nps_linked_id:e.NPSResponseData.bank_information_details.nps_linked_id};c.resendAPIMSToken(t).then(function(t){m(!0,`OTP resent to ${e.bankDetails.mobile_number} !!!`)},function(e){m(!1,e.data.message||e.data.error_message)}).finally(function(){e.isResendingToken=!1})}():c.resendToken(e.tokenDetails).then(function(t){m(!0,"OTP resent to "+e.bankDetails.mobile_number+" !!!")},function(e){m(!1,res.data.message||res.data.error_message)}).finally(function(){e.isResendingToken=!1})},e.verifyToken=function(t){e.isLoading=!0,m("",""),e.isAPIMSOTP?function(t){const n={encrypted_fonepay_load_log_id:e.NPSResponseData.bank_information_details.unique_id,otp:t.token,linkId:e.NPSResponseData.bank_information_details.nps_linked_id,swift_code:e.NPSResponseData.bank_information_details.swift_code,accountLinkRequestType:e.NPSResponseData.bank_information_details.account_link_process};c.completeNPSLink(n).then(function(t){o.showErrorSuccessMessage(t.message,!1,"",!0),e.close(),o.goToState("user.linkedAccount.list")},function(e){m(!1,e.data.error_message)}).finally(function(){e.isLoading=!1})}(t):function(t){c.verifyToken(t).then(function(t){e.close(),o.showErrorSuccessMessage(t.message,!1,"",!0),o.goToState("user.linkedAccount.list")},function(e){m(!1,e.data.error_message)}).finally(function(){e.isLoading=!1})}(t)},e.validateMobileNumber=function(t){p(t)?(e.linkAccountForm.$setValidity("",!0),m("","")):(e.linkAccountForm.$setValidity("",!1),m(!1,"eSewa credential should be registered through mobile number to link bank accounts."))}}]),n.module("esewaProfileApp").controller("BankListController",["$rootScope","$scope","$modal","LinkedAccountService","pageTitle","CDNUrl",function(e,t,n,o,a,i){t.pageTitle=a,o.getAccountLinkBankList().then(function(e){t.bankList=e.plain()},function(t){e.showErrorSuccessMessage(t,!0,"",!0)}),t.openAddAccountModal=function(e){n.open({templateUrl:i.url+"/html/linked_account/add_linked_account_view_v2_3.50.0.0.html",size:"sm fade-in",controller:"AddLinkAccountModalController",resolve:{selectedBank:e,selectedBankDetails:{}}})}}]),n.module("esewaProfileApp").controller("BlockLinkBankAccountModalController",["$rootScope","$scope","$state","$modal","$localStorage","CDNUrl",function(e,t,n,o,a,i){t.userName=e.$storage.profile.username,t.secondary_id=e.$storage.profile.esewaId;e.$storage.profile.isPrimary;t.isPrimaryUser=function(e){n.go(e)},t.closeModal=function(){t.modalInstance.close()}}]),n.module("esewaProfileApp").controller("IntermediateAccountLinkController",["$scope","$rootScope","LinkedAccountService","$interval","$cookies",function(e,t,n,o,a){var i=a.get("requestStr");if(i){a.remove("requestStr");var s=JSON.parse(i);n.validateFonepayResponse(s).then(function(e){t.showErrorSuccessMessage(e.message,!1,"",!0),t.goToState("user.linkedAccount.list")},function(e){t.showErrorSuccessMessage(e,!0,"",!0),t.goToState("user.linkedAccount.list")})}else t.goToState("user.linkedAccount.list")}]),n.module("esewaProfileApp").controller("LinkedAccountController",["$scope","pageTitle","BankService","$rootScope",function(e,t){e.pageTitle=t}]),n.module("esewaProfileApp").controller("LinkedAccountListController",["UserPersonalInformationService","$state","$rootScope","$scope","$modal","StateConstant","LinkedAccountService","$filter","BankService","pageTitle","CDNUrl",function(e,t,n,o,a,i,s,r,c,l,d){o.linkedAccountList=[],o.pageTitle=l,o.getLinkedAccount=function(){c.getBankListForWithdraw().then(function(e){o.bankListWithBankName=e.plain(),s.getLinkedAccount().then(function(e){o.linkedAccountList=e,o.linkedAccountList.forEach(function(e){e.bank_display_name=r("bankInfoWithSwiftCode")(e.swift_code,"bank_display_name",o.bankListWithBankName)})},function(e){n.showErrorSuccessMessage(e,!0)})},function(e){n.showErrorSuccessMessage(e,!0,"",!0)})},o.loadFund=function(e){a.open({templateUrl:d.url+"/html/linked_account/load_fund_form.html",size:"sm",controller:"LoadFundModalController",resolve:{bank:function(){return e},isLinkedAccount:function(){return!0}}})},o.confirmRemoveAccount=function(e){a.open({templateUrl:d.url+"/html/linked_account/unlink_account_3.37.0.html",size:"sm fade-in",controller:"RemoveLinkAccountController",resolve:{accInfo:function(){return e},reloadLinkAccountList:function(){return o.getLinkedAccount}}})}}]),n.module("esewaProfileApp").controller("NPSAccountLinkResponseController",["$scope","$rootScope","$state","LinkedAccountService",function(e,t,n,o){"SUCCESS"===n.params.status?function(){const e={encrypted_account_link_approval_id:n.params.transactionId,accountLinkRequestType:n.params.accountLinkRequestType};o.completeNPSLink(e).then(function(e){t.showErrorSuccessMessage(e.message,!1,"",!0),t.goToState("user.linkedAccount.list")},function(e){t.showErrorSuccessMessage(e,!0,"",!0),t.goToState("user.linkedAccount.list")})}():(t.showErrorSuccessMessage("Link Account Failed.",!0,"",!0),t.goToState("user.linkedAccount.list"))}]),n.module("esewaProfileApp").controller("RemoveLinkAccountController",["$scope","$modalInstance","accInfo","LinkedAccountService","$rootScope","reloadLinkAccountList",function(e,t,n,o,a,i){e.closeModal=function(){t.dismiss()},e.bank=n,e.removeAccount=function(){var t=_.pick(n,["unique_id","swift_code"]);e.isLoading=!0,o.removeLinkedAccount(t).then(function(t){a.showErrorSuccessMessage("Account removed Successfully","",!0),i(),e.closeModal()},function(e){a.showErrorSuccessMessage(e,"ACCOUNT_REMOVED",!0)}).finally(function(){e.isLoading=!1})}}]),n.module("esewaProfileApp").service("LinkedAccountService",["Restangular",function(e){var t=e.all("auth");this.getAccountLinkBankList=function(){return t.one("account_link/banks").get()},this.getLinkedAccount=function(){return t.one("linked/bank_information").get()},this.resendToken=function(e){return t.one("linked/bank_information/resend/token").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(e)},this.inititateApproval=function(e){return t.one("linked/bank_information").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(e)},this.verifyToken=function(e){return t.one("/linked/bank_information/validate").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(e)},this.validateAccount=function(e,n){var o="linked/bank_information";return n||(o+="/fonepay"),t.one(o).withHttpConfig({selfHandleLoadingBar:!0}).customPOST(e)},this.removeLinkedAccount=function(e){return t.one("/linked/bank_information/remove").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(e)},this.validateFonepayResponse=function(e){return t.one("linked/bank_information/validate/fonepay").customPOST(e)},this.getLinkedAccountHistory=function(){return t.one("linked/bank_information/history").get({page:0,size:25})},this.initiateNPSLink=function(e){return t.one("account_link/initiate").customPOST(e)},this.completeNPSLink=function(e){return t.one("account_link/complete").customPOST(e)},this.resendAPIMSToken=function(e){return t.one("linked/bank_information/resend/token").customPOST(e)}}]),n.module("esewaProfileApp").controller("CredentialsController",["$scope","$rootScope","$state","$timeout","MpinService","ecmsg","SecUserService","$modal","AUTH_EVENTS","INFORMATION","$sce","RegexConstant","ActivationService",function(e,t,o,a,i,s,r,c,l,d,u,m,f){var p=t.PropertyConstant;e.loginCredential={token:""},t.message.success="",e.showTokenBox=!1,e.disableSubmit=!1,e.initialRequirementForm=t.initialRequirement.form,e.initialRequirementType=t.initialRequirement.type,e.getCredentials=function(){e.disableSubmit=!1,e.showloadingBar=!0,r.getSecondaryUsers().then(function(t){e.showloadingBar=!1,a(function(){e.$$phase||e.$apply(function(){e.users=t.plain()})},100)},function(){e.showloadingBar=!1})},e.showAddCredentialForm=!1,e.showAddCredentialBlock=!1,e.showSetPassword=!1,e.getCredentials(),t.clearMessage(),t.message.error="",t.showloadingBar=!1,e.clearData=function(){e.passwordDto={newPassword:"",confirmNewPassword:""},e.credential={esewaId:""},e.userInfo={token:"",esewaId:""}},e.clearData(),a(function(){"MOBILE_NUMBER"===e.initialRequirementForm&&(e.showAddUsers=!0,e.showAddCredentialForm=!0,e.showAddCredentialBlock=!0,e.initialRequirementType===p.initialForceful&&(e.mandatory=!0))},500),e.addSecondaryUser=function(){e.clearData(),e.showAddCredentialForm=!0,e.showAddCredentialBlock=!0,e.showSetPassword=!1,e.showValidateUser=!1,e.credential={}},e.cancelTokenValidation=function(){e.showAddUsers=!1};var g=d.secondaryRegistration;t.showInformation=!1,e.getInformationMessage=function(){t.informationKey=g,t.$broadcast(l.information)},e.typeOfMobile=function(e){return m.mobileNo.test(e)},e.resendToken=function(e){e&&f.resendNotification(p.user,e).then(function(e){e.data?s.success(e.data.message):s.success("Notification resent successfully")},function(e){s.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},e.addSecondaryCredentials=function(o){e.showTokenBox=!0,t.message.success="",t.message.error="",e.esewaId=o.esewaId,e.validateMessage=!1,r.addSecondaryUser(o).then(function(i){e.secondaryUserResponse=i.plain(),e.typeOfMobile(o.esewaId)?(e.showAddCredentialBlock=!1,e.showValidateUser=!0,g=d.secondaryRegistrationToken,e.getCredentials(),a(function(){t.message.error="",t.message.success="",e.getInformationMessage()},300)):(e.showSetPassword=!1,e.showValidateUser=!1,e.showAddCredentialBlock=!1,e.showAddCredentialForm=!1,e.token="",n.isDefined(e.response)&&e.response&&a(function(){t.showInformation=!1},100),s.success("Verification link has been sent to "+e.esewaId),e.getCredentials())},function(e){t.showInformation=!1,t.message.success="",n.isDefined(e)&&s.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},e.checkLogedInUsername=function(e){return t.$storage.profile.esewaId===e},e.setPassword=!1,e.makeActiveUser=function(t,n){e.showTokenBox=!0,e.token="",e.clearData(),e.addSecondaryUser(),n&&(e.validateMessage="Validate token for "+t),e.esewaId=t,e.showAddCredentialBlock=!1,e.showSetPassword=!1,e.showValidateUser=!0},e.changeMpin=function(t,n){e.passwordDto={},e.showMpinChange=n,e.showAddCredentialForm=n,n&&(e.validateMessage="ChangeMpin for "+t)},e.setNewMPIN=function(n){t.showloadingBar=!0,r.changeMpin(n).then(function(n){e.showMpinChange=!1,e.showAddCredentialForm=!1,t.message.error="",e.passwordDto=null,t.redirectMsg="MPIN successfully changed.",t.showloadingBar=!1,s.success("MPIN successfully changed.","")},function(e){t.showloadingBar=!1,s.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})};e.cancelChangeMPIN=function(){e.passwordDto=null,o.go(StateConstant.HOME_MAIN)},e.cancelChangeMPIN=function(){e.showMpinChange=!1,e.showAddCredentialForm=!1,e.passwordDto=""},e.resetMpin=function(t,n){e.esewaId=t,c.open({templateUrl:"user/authentication/views/reset_mpin_3.38.0.html",controller:"MpinResetController",size:"md",resolve:{esewaId:function(){return t}}})},e.validateSecUser=function(o){e.disableSubmit=!0,e.showloadingBar=!0,e.userInfo={token:o,esewa_id:e.esewaId},r.validateSecondaryUser(e.userInfo).then(function(n){e.validationInfo=n.plain(),e.token="",e.showSetPassword=!0,e.showValidateUser=!1,e.showAddCredentialBlock=!1,e.showAddCredentialForm=!0,a(function(){t.message.error="",t.message.success="",g=d.secondaryRegistrationPasswordValidation,e.getInformationMessage()},300),e.getCredentials(),e.disableSubmit=!1,e.showloadingBar=!1},function(o){t.showInformation=!1,e.disableSubmit=!1,e.showloadingBar=!1,n.isDefined(o)&&s.error(o.data.error_message,"Service is currently unavailable. please, try again later.")})},e.checkPassword=function(){return e.passwordDto.newPassword===e.passwordDto.confirmNewPassword},e.setSecondaryPassword=function(o){e.disableSubmit=!0,e.showloadingBar=!0,e.tokenDto={token:e.userInfo.token},r.setPasswordForSecondary(e.esewaId,o,e.tokenDto).then(function(n){e.response=n.plain(),e.token="",e.tokenDto={},e.showSetPassword=!1,e.showValidateUser=!1,e.showAddCredentialBlock=!1,e.showAddCredentialForm=!1,e.response.message&&a(function(){t.showInformation=!1,s.success(e.response.message)},100),e.showloadingBar=!1,e.disableSubmit=!1,e.getCredentials()},function(o){e.showloadingBar=!1,e.disableSubmit=!1,n.isDefined(o)&&(t.showInformation=!1,n.isDefined(o)&&s.error(o.data.error_message,"Service is currently unavailable. please, try again later.")),e.getCredentials()})},e.cancelAddUser=function(){e.showAddCredentialForm=!1,e.showAddCredentialBlock=!1,e.showValidateUser=!1,e.credential="",e.userInfo="",e.tokenDto={},e.token="",e.loginCredential={token:""},e.showTokenBox=!1},e.updateCredentials=function(t,n,o){e.openUpdateCredentialsDialog(t,n,o),e.cancelAddUser()},e.openUpdateCredentialsDialog=function(t,n,o){c.open({templateUrl:"user/logincredentials/views/update_confirmation_credentials.html",controller:"UpdateCredentialsController",size:"md",backdrop:"static",resolve:{userId:function(){return t},status:function(){return n},type:function(){return o},getCredentials:function(){return e.getCredentials}}})}}]),n.module("esewaProfileApp").controller("MpinResetController",["$modalInstance","$state","$scope","$rootScope","esewaId","MpinService","$timeout","ecmsg",function(e,t,o,a,i,s,r,c){o.close=function(){e.dismiss()},a.currentModal=e,o.resetMpin=function(){o.disableSubmit=!0,s.resetMPIN(i).then(function(e){o.disableSubmit=!1,o.response=e.plain(),c.success("MPIN reset successful. You have been sent MPIN in your mobile number.",""),o.response&&r(function(){a.successMessageForIndex=!1,a.showInformation=!1,c.success(o.response.message)},100),o.close()},function(e){o.disableSubmit=!1,a.showInformation=!1,c.error("MPIN reset failed",""),n.isDefined(e)&&c.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},o.cancelChangeMPIN=function(){o.close()}}]),n.module("esewaProfileApp").controller("UpdateCredentialsController",["$scope","$modalInstance","userId","status","type","$state","$timeout","$rootScope","SecUserService","getCredentials",function(e,t,o,a,i,s,r,c,l,d){e.credentialDto={status:a,esewaId:o},t.opened.then(function(){c.currentModal=t}),e.closeModal=function(){t.close(),c.currentModal=t},e.cancel=function(){e.closeModal()},e.type=i,e.updateCredentials=function(t){e.dto={status:a,esewa_id:o,remarks:t},"delete"===i?l.deleteCredentials(e.dto).then(function(t){e.response=t.plain(),s.reload(),e.closeModal(),c.showErrorSuccessMessage(t,!1,"",!0),d()},function(t){c.showErrorSuccessMessage(t,!0,"",!0),e.closeModal(),c.showInformation=!1,d()}):l.updateCredentialStatus(e.dto).then(function(t){e.response=t.plain(),s.reload(),e.closeModal(),r(function(){c.showInformation=!1,ecmsg.success(e.response.message)},100),d()},function(t){e.closeModal(),c.showInformation=!1,n.isDefined(t)&&t.data&&ecmsg.error(t.data.error_message,NaN),d()})}}]),n.module("esewaProfileApp").service("SecUserService",["Restangular",function(e){var t=e.all("auth");this.addSecondaryUser=function(e){var n={esewa_id:e.esewaId,name:e.name};return t.all("login_credentials").post(n)},this.validateSecondaryUser=function(e){return t.one(e.esewa_id+"").one("token").one(e.token+"").one("validate_credentials_token").customGET()},this.setPasswordForSecondary=function(e,n,o){return t.one(e+"").one("create_credentials_pwd").customPOST(o,"","",{password:n.newPassword,mpin:n.mpin})},this.getSecondaryUsers=function(n){return n?e.one("user/organization_login").get():t.one("login_credentials").get()},this.deleteCredentials=function(e){return e.status="DELETED",t.all("login_credentials").one("status").customPUT(e)},this.updateCredentialStatus=function(e){return t.all("login_credentials").one("status").customPUT(e)},this.changeMpin=function(e){return t.one("change_mpin").customPOST(e)}}]),n.module("esewaProfileApp").controller("NotificationController",["$scope","$rootScope","$state","$timeout","ecmsg","NotificationService","$modal","AUTH_EVENTS","INFORMATION","$sce","RegexConstant","ActivationService","StateConstant","InformationService",function(e,t,o,a,i,s,r,c,l,d,u,m,f,p){var g=t.PropertyConstant;e.showTokenBox=!1,e.cancelAddNotificationId=function(){e.showTokenBox=!1,e.showAddNotificationForm=!1,e.$$phase||e.$apply(function(){e.clearData()})},e.initialRequirementForm=t.initialRequirement.form,e.initialRequirementType=t.initialRequirement.type,h(),t.clearMessage(),e.showloadingBar=!0,e.clearData=function(){t.trustedHtml="",e.showTokenBox=!1,e.notificationDto={notification_id:""},e.tokenDto={token:""},e.userInfo={token:"",notification_id:""}},e.clearData(),e.users={},e.showAddView=function(){e.notification={},e.clearData(),e.showAddNotificationForm=!0,e.showAddNotificationBlock=!0,e.showAlreadyGotTokenView=!1,e.showValidateUser=!1,t.showInformation=!1},e.cancelTokenValidation=function(){e.showAddUsers=!1},e.initialRequirementForm===g.userNotification&&(e.showAddView(),e.initialRequirementType===g.initialForceful&&(e.mandatory=!0));var _=l.notification;function h(){s.getNotifications().then(function(t){e.showloadingBar=!1,e.notificationIds=t.plain()},function(){e.showloadingBar=!1})}t.showInformation=!1,e.getInformationMessageForNotification=function(){t.informationKey=_,t.$broadcast(c.information)},e.typeOfMobile=function(e){return u.mobileNo.test(e)},e.notification={},e.addNotification=function(o){e.clearData(),e.showTokenBox=!0,e.notificationId=o.notification_id,o.notification_type=g.default,e.validateMessage=!1,s.addNotification(o).then(function(s){t.initialRequirement={},e.secondaryUserResponse=s.plain(),e.showAddNotificationBlock=!1,e.secondaryUserResponse.message!==g.statusActive&&e.typeOfMobile(o.notification_id)?(e.showValidateUser=!0,_=l.secondaryRegistrationToken,h(),a(function(){e.getInformationMessage()},300)):(e.showAddNotificationForm=!1,a(function(){t.showInformation=!0,n.isDefined(s)&&s.message&&("ACTIVE"===s.message?i.success("Notification id has been added successfully."):i.success(s.message))},100),h())},function(e){n.isDefined(e)&&i.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},e.getInformationMessage=function(n){p.getInformation(n).then(function(n){t.information=n.plain(),t.information.information&&(e.showInformation=!0),t.trustedHtml=d.trustAsHtml(t.information.information)})},e.setPassword=!1,e.makeActiveNotification=function(t,n){e.clearData(),e.showTokenBox=!0,e.showAlreadyGotTokenView=!0,n&&(e.validateMessage="Validate token for "+t),e.notificationDto.notificationId=t,e.notificationId=t,e.showAddNotificationForm=!0,e.showAddNotificationBlock=!1,e.showValidateUser=!1},e.validateMobileAndToken=function(o){e.userInfo={token:o.token,notification_id:o.notificationId},s.validateToken(e.userInfo).then(function(t){e.validationInfo=t.plain(),e.showValidateUser=!1,e.showAddNotificationBlock=!1,e.showAddNotificationForm=!1,e.showAlreadyGotTokenView=!1,e.showAddNotificationForm=!0,a(function(){_=l.secondaryRegistrationPasswordValidation,e.getInformationMessage()},300),h()},function(e){t.showInformation=!0,n.isDefined(e)&&i.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},e.resendToken=function(e){e&&m.resendNotification(g.notification,e).then(function(e){i.success("Token resent")},function(e){i.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},e.validateToken=function(o){e.userInfo={token:o,notification_id:e.notificationId},s.validateToken(e.userInfo).then(function(t){e.validationInfo=t.plain(),e.showValidateUser=!1,e.showAddNotificationBlock=!1,e.showAddNotificationForm=!1,e.getInformationMessage(),a(function(){_=l.secondaryRegistrationPasswordValidation,i.success(t.message)},300),e.clearData(),h()},function(e){t.showInformation=!1,n.isDefined(e)&&i.error(e.data.error_message,"Service is currently unavailable. please, try again later.")})},e.cancelAddNotification=function(){e.showTokenBox=!1,e.initialRequirement.form===g.userNotification&&(t.initialRequirement={}),o.current.name===f.NOTIFICATIONS?e.showAddNotificationForm=!1:(e.showAddNotificationForm=!1,e.showAddNotificationBlock=!1,e.showValidateUser=!1,e.notificationDto="",e.userInfo="",o.reload())},e.updateForNotification=function(t,n,o){e.showAddNotificationForm=!1,e.showAddNotificationBlock=!1,e.showValidateUser=!1,e.clearData(),e.openUpdateCredentialsDialog(t,n,o)},e.notificationTypes=["DEFAULT","TRANSACTION"],e.openUpdateCredentialsDialog=function(e,t,n){r.open({templateUrl:"user/notificationids/views/update_confirmation_notification.html",controller:k,size:"md",backdrop:"static",resolve:{userId:function(){return e},status:function(){return t},type:function(){return n}}})};var k=["$scope","$modalInstance","userId","status","type","$state","$timeout","$rootScope","ecmsg",function(e,t,o,a,i,r,c,l,d){e.showAddNotificationForm=!1,e.credentialDto={status:a,notification_id:o},e.close=function(){t.dismiss()},e.cancel=function(){e.close()},e.type=i,l.currentModal=t,e.updateNotification=function(t){e.showTokenBox=!1,e.dto={status:t.status,notification_id:t.notification_id},"delete"===i?s.deleteNotification(t.notification_id).then(function(t){e.response=t.plain(),e.close(),c(function(){l.showInformation=!0,d.success(e.response.message)},100),h()},function(t){e.close(),l.showInformation=!0,n.isDefined(t)&&d.error(t.data.error_message,"Service is currently unavailable. please, try again later.")}):s.updateNotificationStatus(e.dto).then(function(t){e.response=t.plain(),r.reload(),e.close(),c(function(){l.showInformation=!0,d.success(e.response.message)},100),h()},function(t){e.close(),l.showInformation=!0,n.isDefined(t)&&d.error(t.data.error_message,"Service is currently unavailable. please, try again later.")})}}]}]),n.module("esewaProfileApp").service("NotificationService",["Restangular",function(e){var t=e.all("auth").one("notification");this.addNotification=function(e){return t.customPOST(e)},this.validateToken=function(e){var n={token:e.token,notification_id:e.notification_id};return t.one("verify").customPOST(n)},this.getNotifications=function(){return t.getList()},this.deleteNotification=function(e){return t.one(e).one("remove").customPOST("")},this.updateNotificationStatus=function(e){return t.one("verify").customPOST(e)}}]),n.module("esewaProfileApp").controller("ActivationController",["$scope","$rootScope","$state","$stateParams","ActivationService","ecmsg","$sce","INFORMATION","InformationService","$timeout","NotificationService","StateConstant","AUTH_EVENTS",function(e,t,o,a,i,s,r,c,l,d,u,m,f){e.token=a.token,e.currentState=o.current.name;var p="";e.esewaId="",t.message.error="","activate.setPasswordForEmailUser"===e.currentState&&i.getUserTokenActivation(e.token,"USER_ACTIVATION").then(function(t){e.response=t.plain(),e.response&&(e.esewaId=e.response.username,e.showToken=!1),o.go("login")},function(){s.error("Activation link is either invalid or expired !!",""),o.go("login")}),"activate.setPasswordForPrimaryUser"===e.currentState?i.getUserTokenActivation(e.token,"USER_ACTIVATION").then(function(t){e.response=t.plain(),e.response&&(e.esewaId=e.response.username,e.showToken=!0,i.sendPrimaryUserToken(e.esewaId,e.token).then(function(t){e.response=t.plain(),e.token=""},function(){}))},function(){s.error("Activation link is either invalid or expired !!",""),o.go("login")}):"activate.setForgottenPassword"===e.currentState?i.getUserTokenActivation(e.token,"FORGET_PASSWORD").then(function(t){e.response=t.plain(),e.response&&(e.esewaId=e.response.username),p=c.forgotPasswordValidation},function(){s.error("Activation link is either invalid or expired !!",""),o.go("login")}):"activateNotification"===e.currentState&&(t.isAuthenticated()?(e.notificationDto={token:e.token},i.getUserTokenActivation(e.token,"NOTIFICATION_ACTIVATION").then(function(t){e.response=t.plain(),e.response&&(e.esewaId=e.response.username)},function(){s.error("Activation link is either invalid or expired !!",""),o.go("login")})):(s.error("You must be logged in for this operation or open this link from logged in browser!!",""),o.go("login"))),e.password={password:"",confirm_password:""},e.validateToken=function(t,a){e.userInfo={token:t,notificationId:a},u.validateToken(e.userInfo).then(function(t){e.validationInfo=t.plain(),e.showValidateUser=!1,d(function(){s.success("Notification ID is activated",""),o.go(m.NOTIFICATIONS)},300)},function(e){n.isDefined(e)&&(e.data?s.error(e.data.error_message,""):s.error("Service is currently unavailable. please, try again later",""),o.go(m.LOGIN))})},e.setPasswordForEmailUser=function(){(e.esewaId||e.passwordDto.mobileToken||"activate.setPasswordForPrimaryUser"!==e.currentState)&&(e.tokenDto={token:e.token,mobileToken:e.passwordDto.mobileToken},e.passwordDto.newPassword===e.passwordDto.confirmNewPassword?i.setPasswordForEmailUser(e.esewaId,e.tokenDto,e.passwordDto).then(function(n){s.success(n.plain().message,""),e.loginDto={esewaId:e.esewaId,password:e.passwordDto.newPassword},t.login(e.loginDto)},function(){s.error("Invalid Request !!","")}):s.error("Please, Check your password !!",""))},e.setNewForgottenPassword=function(){e.setPasswordDto={token:e.token,password:e.passwordDto.password},i.setNewForgottenPassword(e.esewaId,e.setPasswordDto).then(function(e){s.success(e.plain().message,""),o.go("login")},function(){s.error("Invalid Request !!","")})},e.addNotification=function(){e.validateToken(e.token,e.esewaId)},e.checkPassword=function(){return e.password.password===e.password.confirm_password},e.cancel=function(){o.go("login")},e.showInformation=!1,p&&(t.informationKey=p,t.$broadcast(f.information))}]),n.module("esewaProfileApp").controller("BankInfoController",["$scope","$rootScope","$state","InformationService",function(e,t,o,a){a.getInternetBankingDetails().then(function(t){e.internetBankingDetails=t.plain().bank_list},function(e){n.isDefined(e)?t.message=e.data.error_message:t.message="Error while fetching data."}),a.getMobileBankingDetails().then(function(t){return e.mobileBankingDetails=t.plain().bank_list,e.mobileBankingDetails},function(e){n.isDefined(e)?t.message=e.data.error_message:t.message="Error while fetching data."})}]),n.module("esewaProfileApp").controller("StaticController",["$scope","$state","$rootScope","StateConstant",function(e,t,n,o){e.staticMenus=[{url:o.TOPUP,name:"Direct Topup"},{url:o.AIRLINES_HOME,name:"Airlines"},{url:o.WU,name:"Fund Transfer"}],e.setShowStaticContent=function(o){n.showStaticContent=!0,e.showStaticContent=!0,t.go(o)}}]),n.module("esewaProfileApp").service("ActivationService",["Restangular",function(e){this.getUserTokenActivation=function(t,n){var o=_.merge({activation_type:n},{token:t});return e.one("token").one("validate").get(o)},this.setPasswordForEmailUser=function(t,n,o){var a={token:n.token};return n.mobileToken&&(a.token=n.mobileToken),e.one("esewa").one(t+"").one("create_password").customPOST(a,"","",{password:o.newPassword,username:o.username})},this.setNewForgottenPassword=function(t,n){return e.one(t+"").one("forgot_password").customPUT(n)},this.resendNotification=function(t,n){var o={type:t,notification_id:n};return e.one("auth").one("token").one("resend").customPUT(o)},this.sendPrimaryUserToken=function(t,n){var o={esewa_id:t,token:n};return e.one("auth").one("verify_email").customPOST(o)}}]),n.module("esewaProfileApp").controller("UserActivityController",["$scope","$rootScope","$state","$timeout","UserActivityScrollService","ResponseConstant","UserActivityService",function(e,t,o,a,i,s){function r(e){return e<10?"0"+e:e}t.successResponse={message:""},t.successMessageForIndex=!1,e.userActivities=new i,e.$watch(s.userActivitiesActivities,function(t,o){if(e.userActivities.activities){var a=t;e.data={messages:[]};for(var i=0;i<a.length;i++)e.data.messages.push({activity_date:new Date(a[i].activity_date),activity_time:a[i].activity_date,message:a[i].message,username:a[i].username,channel:a[i].channel});e.data.messages=_.sortBy(e.data.messages,s.activityTime).reverse(),e.filteredData={},n.copy(e.data,e.filteredData),e.filteredData.messages=e.convertToDate(e.filteredData.messages,s.activityDate)}}),e.convertToDate=function(e,t){for(var n={},o=0;o<e.length;o++){var a=e[o][t];e[o][t]=a.getFullYear()+"/"+r(a.getMonth()+1)+"/"+r(a.getDate()),n[e[o][t]]=n[e[o][t]]||[],n[e[o][t]].push(e[o]),n[e[o][t]]=_.sortBy(n[e[o][t]],s.activityTime).reverse()}return n}}]),n.module("esewaProfileApp").controller("UserPersonalInformationController",["$scope","$rootScope","$filter","$state","UserActivityService","$localStorage","UserActivityFactory","$modal","$timeout","fromModal","ecmsg","selectBank","UserPersonalInformationService","$window","CDNUrl",function(e,t,o,a,i,s,r,c,l,d,u,m,f,p,g){function h(){i.getUserSavedBankList().then(function(o){!function(o){if(e.bankAccountList=o.plain(),e.hasPersonalAccount=(s=e.bankAccountList,r=!1,n.forEach(s,function(e,t){n.isDefined(e.is_personal_account)&&e.is_personal_account&&(r=!0)}),r),e.personalBankAccountList=0,e.otherBankAccountList=0,i.getUserBankSaveLimit().then(function(n){e.freeBankSaveLimit=t.isOrg()?n.free_bank_save_limit_org:n.free_bank_save_limit_user,e.totalBankSaveLimit=n.total_bank_limit;for(var a=0;a<o.length;a++)o[a].is_personal_account?e.personalBankAccountList++:e.otherBankAccountList++;e.otherBankAccountLimit=n.total_bank_limit-e.personalBankAccountList}),d&&m){e.fullName=t.$storage.profile.username.trim().replace(/\s+/g," ");var a=[];n.forEach(e.bankAccountList,function(t,n){t.account_name.toUpperCase()===e.fullName.trim().replace(/\s+/g," ").toUpperCase()&&a.push(t)}),e.bankAccountList=a}var s,r}(o)},function(e){w(e)})}function k(){f.getAgentBankName().then(function(t){e.agentFreeAccountNames=t.plain()},function(t){e.showAgentBankName=!0})}function w(e){t.showErrorSuccessMessage(e,!0)}function y(){r.getBankList().length?e.bankList=r.getBankList():i.getbankBankList().then(function(t){e.bankList=t.plain(),r.saveBankList(e.bankList)},function(e){w(e)})}function v(t,o,a){var i=n.copy(t);return o?i.bank_code=i.selectedBank.swift_code:(i.status=n.isDefined(a)?a:"ACTIVE",n.isDefined(i.account_holder_name)&&(i.account_name=i.account_holder_name.replace(/\s+/g," "),delete i.account_holder_name),n.isDefined(i.selectedBank)&&(i.swift_code=i.selectedBank.swift_code),i.is_personal_account=r.getIsPersonalAccountParam()||!e.isFavouritAccount),i.selectedBank&&delete i.selectedBank,i}function A(){r.saveResponseOfBankValidation(),r.saveIsPersonalAccountParam(),r.saveBankInfo()}function I(e,t){return _.pick(e,t)}r.clearResponseOfAddBankInfo(),t.$storage.user&&k(),e.isModal=!1,e.selectBankInModal=!1,d&&(e.isModal=!0,e.bankInfo={},m&&(e.selectBankInModal=!0)),e.disableSelectBankInModal=function(){e.selectBankInModal=!1},e.initFirstStepPageForBankInfo=function(){A(),h(),y()},e.closeModal=function(e){e.$close()},e.loadBanksOnly=function(){y(),e.bankList=r.getBankList(),r.saveBankList(e.bankList),e.isPersonalAccount=!0,e.bankInfo.account_holder_name=o("reverse_camel_case")(s.profile.username.toLocaleLowerCase()),e.bankInfo.account_holder_name=e.bankInfo.account_holder_name.trim().replace(/\s+/g," ")},e.setSelectedBankToPrimary=function(t,n){e.closeModal(n),i.updatePrimaryBank(t).then(function(e){u.success(e.message,""),a.reload()},function(e){w(e)})},e.deleteBankAccount=function(t){c.open({templateUrl:"/user/userbankinformation/views/delete_bank_account_dailog_box.html",backdrop:"static",windowClass:"modal",scope:e,controller:["$scope","$modalInstance","UserActivityService","$filter","$rootScope",function(e,n,o,a,i){var s=t,r=e.getBankName(s.swift_code),c=s.is_personal_account?"your ":a("reverse_camel_case")(s.account_name)+"'s ";e.deleteAccountMsg="Are you sure you want to delete "+c+r+" (A/c no : "+s.account_number+") account from wallet ?",t.status="DELETED",e.deleteAccount=function(){o.deleteBankAccount(t).then(function(n){i.showErrorSuccessMessage(n,!1),p.scrollTo({top:0,behavior:"smooth"});for(var o=0;o<e.$parent.bankAccountList.length;o++)t===e.$parent.bankAccountList[o]&&e.$parent.bankAccountList.splice(o,1);h()},function(e){w(e)}).finally(function(){n.dismiss()})},e.cancel=function(){n.dismiss("cancel")}}]})},e.getBankName=function(t){var o;return n.forEach(e.bankList,function(e,a){n.isUndefined(o)&&e.swift_code===t&&(o=e.bank_display_name)}),o},e.goToSecondStep=function(t){e.bankInfo={selectedBank:{},account_holder_name:null,account_number:null},r.saveIsPersonalAccountParam(t),e.isFavouritAccount=!t,a.go("user.addBankInformation.secondStep")},e.initSecondStepContent=function(){t.$storage.user?k():n.isDefined(r.getIsPersonalAccountParam())?(e.bankInfo=r.getSavedBankInfo()||{},e.isPersonalAccount=r.getIsPersonalAccountParam(),l(function(){e.isPersonalAccount&&(e.bankInfo.account_holder_name=o("reverse_camel_case")(s.profile.username.toLocaleLowerCase()),e.bankInfo.account_holder_name=e.bankInfo.account_holder_name.trim().replace(/\s+/g," "))},1e3),r.saveIsPersonalAccountParam(),y()):a.go("user.addBankInformation.firstStep")},e.resetAndGoToFirstStep=function(){A(),a.go("user.addBankInformation.firstStep")},e.validateBankInfo=function(t){r.saveBankInfo(t);var n=v(t,!0);i.validateBankInfo(n).then(function(t){!function(t){r.saveResponseOfBankValidation(t),r.saveIsPersonalAccountParam(e.isPersonalAccount),a.go("user.addBankInformation.confirmation")}(t.plain())},function(t){var n;n=t,r.saveResponseOfBankValidation(n),r.saveIsPersonalAccountParam(e.isPersonalAccount),a.go("user.addBankInformation.confirmation")})},e.validateModalBankInfo=function(t){r.saveBankInfo(t),e.bankInfo=r.getSavedBankInfo()||{};var n=v(t,!0);i.validateBankInfo(n).then(function(t){r.saveResponseOfBankValidation(t),r.saveIsPersonalAccountParam(!0),e.showModalConfirmationpage=!0},function(t){r.saveResponseOfBankValidation(t),r.saveIsPersonalAccountParam(!0),e.showModalConfirmationpage=!0})},e.initConfirmationPage=function(){var i=r.getBankValidationResponse(),s=e.freeBankSaveLimit;if(n.equals(i,{}))a.go("user.addBankInformation.firstStep");else if(e.isBankInfoVerifed=0===i.code,e.bankvalidationMessage=i.message,r.getIsPersonalAccountParam()&&(e.primaryBankvalidationMessage="You can only add "+s+" personal account for free account withdrawal service. You cannot change the bank detail once updated. Do you want to continue?"),!e.isBankInfoVerifed){var c=r.getSavedBankInfo().selectedBank.bank_display_name,l=r.getSavedBankInfo().account_number,d=r.getIsPersonalAccountParam()?"your ":o("reverse_camel_case")(r.getSavedBankInfo().account_holder_name)+"'s ";-1===i.code?(e.uiValidationFailErrorMsg="Sorry, we couldn't verify "+d+c+" (A/c No: "+l+") account from our system.",r.getIsPersonalAccountParam()&&(e.primaryBankvalidationMessage="You can only add "+s+" personal account for free account withdrawal service. You cannot change the bank detail once updated."),e.serverVerificationFailMsg=i.message,e.proceedWithRisk=!1):(e.proceedWithRisk=!0,e.primaryBankvalidationMessage="You can only add "+s+" personal account for free account withdrawal service. ",e.uiValidationFailErrorMsg="Dear "+o("firstname")(t.$storage.profile.username)+", name validation for the Account no.: "+l+" is not available. Do you want to continue at your own risk? Account once added cannot be modified.",e.serverVerificationFailMsg=i.message,e.bankInfo=r.getSavedBankInfo())}},e.addBankAccount=function(o){var s=v(e.bankInfo);A(),i.addBankInfo(s).then(function(t){if(n.isDefined(t)){if(a.go("user.addBankInformation.firstStep"),d)return;r={swift_code:(o=s).swift_code,account_number:o.account_number,account_name:o.account_name},i.getLinkAccountStatus(r).then(function(t){var n=t.plain();(function(e){if(null!==e.account_details&&null!==e.bank_details){var t=e.account_details||{};return e.bank_details,t.is_personal_account&&!e.account_details.is_linked_account}})(n)&&e.showConfirmation(n)})}var o,r},function(e){u.error(e.data.error_message,""),r.saveResponseOfAddBankInfo(e)}).finally(function(){if(e.closeModal(o),d){if(e.closeModal(o),!n.equals(r.getResponseOfAddBankInfo(),{})){var i=r.getResponseOfAddBankInfo()||{};400===i.status?t.showErrorSuccessMessage(i,!0,"",!0):u.success("Bank Information Added Successfully.",""),a.reload()}}else a.go("user.addBankInformation.firstStep")})},e.openLinkAccountModal=function(e){var t=Object.assign(e.bank_details,e.account_details),n=I(t,["logo","bank_display_name","swift_code","in_app","send_otp","process"]),o=I(t,["swift_code","account_name","account_number","min_amount","max_amount","regex","in_app","send_otp"]);c.open({templateUrl:g.url+"/html/linked_account/add_linked_account_view_v2_3.50.0.0.html",controller:"AddLinkAccountModalController",size:"sm fade-in",backdrop:"static",resolve:{selectedBank:n,selectedBankDetails:o}})};var D=["$scope","$modalInstance","accountInfo",function(e,n,o){t.currentModal=n,e.close=function(){n.dismiss()},e.linkAccountConfirmation=function(){n.dismiss(),e.openLinkAccountModal(o)}}];e.showConfirmation=function(t){c.open({templateUrl:g.url+"/html/templates/bankinformation/account_link_confirmation_3.42.0.0.html",controller:D,size:"md fade-in",backdrop:"static",windowClass:"modal",scope:e,resolve:{accountInfo:function(){return t}}})}}]),n.module("esewaProfileApp").service("UserActivityFactory",[function(){var e,t={},o={},a={},i=[];this.saveBankInfo=function(e){t=n.copy(e)},this.getSavedBankInfo=function(){return t},this.saveBankList=function(e){i=e},this.getBankList=function(){return i},this.saveResponseOfBankValidation=function(e){o=n.copy(e)},this.resetResponseOfBankValidation=function(){o=void 0},this.getBankValidationResponse=function(){return o},this.saveIsPersonalAccountParam=function(t){e=t},this.getIsPersonalAccountParam=function(){return e},this.saveResponseOfAddBankInfo=function(e){a=n.copy(e)},this.getResponseOfAddBankInfo=function(){return a},this.clearResponseOfAddBankInfo=function(){a={}}}]),n.module("esewaProfileApp").service("UserActivityScrollService",["Restangular","PaginationService",function(e,t){var n=function(){this.activities=[],this.busy=!1,this.complete=!1,this.pageNumber=1,this.pageSize=15,this.emptyResult=!1,this.nextPage()};return n.prototype.nextPage=function(){if(!this.busy&&!this.complete){this.busy=!0;var n=this,o=t.getPagination(n.pageNumber-1,n.pageSize),a=null;return(a=e.all("auth").all("activity").getList(o)).then(function(e){n.busy=!1,e.length<n.pageSize&&(n.complete=!0,0===e.length&&0===n.pageNumber&&(n.emptyResult=!0)),e.length>0&&(n.activities=n.activities.concat(e)),n.pageNumber=n.pageNumber+1},function(){n.busy=!1,n.emptyResult=!0,n.complete=!0}),a}},n}]),n.module("esewaProfileApp").service("UserActivityService",["Restangular",function(e){var t=e.all("auth");this.getUserActivities=function(){return t.one("activity").getList()},this.getUserSavedBankList=function(){return t.one("bank_information").get()},this.getUserBankSaveLimit=function(){return t.one("bank_information").one("save").one("limit").get()},this.addBankInfo=function(e){return t.one("bank_information").customPOST(e)},this.validateBankInfo=function(e){return t.one("bank").one("withdraw").one("validate").customPOST(e)},this.updateBankInfo=function(e){return t.one("bank_information/update").post(e)},this.getbankBankList=function(){return t.one("bank").one("withdraw").getList()},this.deleteBankAccount=function(e){return t.one("bank_information").customPUT(e)},this.updatePrimaryBank=function(e){return t.one("bank").one("primary/update").customPOST(e)},this.getLinkAccountStatus=function(e){return t.one("linked").one("bank_information").one("link_details").customPOST(e)}}]),n.module("esewaProfileApp").service("UserPersonalInformationService",["Restangular",function(e){var t=e.all("auth/organization");this.getAgentBankName=function(){return t.one("owners_and_name").get()}}]),n.module("esewaProfileApp").controller("UserDeviceController",["$scope","$timeout","DeviceService","$modal","$rootScope",function(e,t,o,a,i){function s(){o.getDevices().then(function(t){e.devices=t,e.devices?0===e.devices.length&&(e.deviceNotavailableMessage="Currently devices are not available. You can add device using eSewa's mobile App."):e.deviceNotavailableMessage="Currently devices are not available. You can add device using eSewa's mobile App."},function(e){i.message.error="Opps! Something went wrong."})}i.clearMessage(),s(),e.updateDevice=function(t,n,o){e.openUpdateDeviceDialog(t,n,o)},e.openUpdateDeviceDialog=function(e,t,n){a.open({templateUrl:"user/userdevices/views/update_confirmation_device.html",controller:r,size:"md",backdrop:"static",resolve:{id:function(){return e},type:function(){return n},deviceName:function(){return t}}})};var r=["$scope","$modalInstance","id","type","deviceName",function(e,a,r,c,l){e.device={type:c,deviceName:l,id:r},e.close=function(){a.dismiss()},e.cancel=function(){e.close()},i.currentModal=a,e.updateDevice=function(a){"remove"===c?o.deleteDevice(a).then(function(n){e.successResponse=n.plain(),s(),e.close(),t(function(){i.showInformation=!1,i.message.success=e.successResponse.message},500)},function(t){e.close(),i.showInformation=!1,n.isDefined(t)&&(t.data.error_message?i.message.error=t.data.error_message:i.message.error="Service is currently unavailable. please, try again later to remove device.")}):"block"===c?o.updateDeviceStatus(a,"BLOCKED").then(function(n){e.successResponse=n.plain(),s(),e.close(),t(function(){i.showInformation=!1,i.message.error=!1,i.message.success=e.successResponse.message},500)},function(t){e.close(),i.showInformation=!1,n.isDefined(t)&&(t.data.error_message?i.message.error=t.data.error_message:i.message.error="Service is currently unavailable. please, try again later to update device status.")}):o.updateDeviceStatus(a,"ACTIVE").then(function(n){e.successResponse=n.plain(),s(),e.close(),t(function(){i.showInformation=!1,i.message.error=!1,i.message.success=e.successResponse.message},500)},function(t){e.close(),i.showInformation=!1,n.isDefined(t)&&(t.data.error_message?i.message.error=t.data.error_message:i.message.error="Service is currently unavailable. please, try again later to update device status.")})}}]}]),n.module("esewaProfileApp").service("DeviceService",["Restangular",function(e){var t=e.all("auth");this.getDevices=function(){return t.one("device").customGET()},this.deleteDevice=function(e){return t.one("device").one(e+"").one("remove").customPOST()},this.updateDeviceStatus=function(e,n){return t.one("device").one(e+"").one("status").one(n+"").customPUT()}}]),n.module("esewaProfileApp").controller("TransactionVelocityController",["$scope","$rootScope","$state","$stateParams","ecmsg","TransactionVelocityService","ProgressChartDataFormatService","ProgressChartFactory","AUTH_EVENTS",function(e,t,n,o,a,i,s,r,c){e.transactionTypes=[{key:"P2P",title:"Send Money"},{key:"P2P_RECEIVER",title:"Send Money Receiving Limit"}],t.isPoint()?t.isAgent()?(e.transactionTypes.push({key:"AGENT_WITHDRAW",title:" Agent Bank Transfer"}),e.transactionTypes.push({key:"AGENT_WITHDRAW_SELF",title:"Agent Bank Transfer - Primary/Free Account"})):(e.transactionTypes.push({key:"BANK_LOAD",title:"Bank Transfer"}),e.transactionTypes.push({key:"FREE_WITHDRAW",title:"Free Bank Transfer"})):t.$storage.profile.isVerified?(e.transactionTypes.push({key:"BANK_LOAD",title:"Bank Transfer"}),e.transactionTypes.push({key:"FREE_WITHDRAW",title:"Free Bank Transfer"})):e.transactionTypes.push({key:"MERCHANT_TRANSACTION",title:"Merchant Transaction"}),e.txnType=[],e.getTransactionType=function(){i.getTransactionType().then(function(t){e.txnType=t},function(e){})},e.getTransactionType(),e.getWalletBalanceVelocity=function(){t.getUserBalance(function(){i.getWalletVelocity().then(function(n){var o=n.plain();o.remaing_banace_limit=n.max_limit<0?"Unlimited":o.max_limit-t.userBalance.balance,e.walletVelocity=o;var a=s.getFormattedWalletVelocityData(o);r.drawChart("wallet","#walletVelocityChart",a)},function(){})})},e.getVelocityAsPerTxnType=function(t){t.chartData||i.getVelocityAsPerTxnType(t.key).then(function(n){t.data=s.setActualDifference(n.plain()),t.chartData=s.getFormattedVelocityData(t.data),e.showLimit(t,!0)},function(e){})},e.showLimit=function(e,t){var n=t?e.chartData.dailyLimit:e.chartData.monthlyLimit;e.key;r.drawChart("others","figure#"+e.key+"CountChart",n.countLimit),r.drawChart("others","figure#"+e.key+"AmountChart",n.amountLimit),e.isShowingDailyChart=t}}]),n.module("esewaProfileApp").factory("ProgressChartFactory",[function(){var e={red:{angle:245.43,colorStopOne:"rgb(216, 64, 64)",colorStopOnePercent:"23.92%",colorStopTwo:"rgba(226, 37, 37, 0)",colorStopTwoPercent:"249.38%"},green:{angle:180,colorStopOne:"rgb(43, 164, 7)",colorStopOnePercent:"3.5%",colorStopTwo:"rgb(96, 187, 70)",colorStopTwoPercent:"105.6%"},brown:{angle:180,colorStopOne:"rgb(242, 153, 74)",colorStopOnePercent:"3.5%",colorStopTwo:"rgba(242, 153, 74, 0.74)",colorStopTwoPercent:"105.6%"}},t={wallet:{radius:80,border:20,padding:30},others:{radius:45,border:10,padding:10}};return{drawChart:function(n,o,a){var i=a.hasUnlimitedValue?0:a.endPoint,s=e[a.color],r="wallet"===n,c=Math.PI,l=d3.format("percent"===a.format?".0%":"d"),d=2*(t[n].radius+t[n].padding),u=Math.abs((i-0)/.01),m=i<0?-.01:.01,f=d3.arc().startAngle(3*-c/4).innerRadius(t[n].radius).outerRadius(t[n].radius-t[n].border).cornerRadius(10),p=d3.select(o);p.selectAll("svg").remove();var g=p.append("svg").attr("width",d).attr("height",d),_=o+"gradient",h=g.append("defs").append("linearGradient").attr("id",_).attr("gradientTransform","rotate("+s.angle+")");h.append("stop").attr("offset",s.colorStopOnePercent).attr("stop-color",s.colorStopOne),h.append("stop").attr("offset",s.colorStopTwoPercent).attr("stop-color",s.colorStopTwo);var k=g.append("g").attr("transform","translate("+d/2+","+d/2+")").append("g").attr("class","progress-meter");k.append("circle").attr("r",t[n].radius+15).attr("class","background").attr("fill","rgb(255, 255, 255)").attr("fill-opacity",1).attr("stroke","rgb(238,238,238)").attr("stroke-linecap","square").attr("stroke-width",.3).attr("stroke","rgb(204, 204, 204)"),k.append("path").attr("class","background").attr("fill","rgb(204, 204, 204)").attr("fill-opacity",.5).attr("stroke-linecap","square").attr("d",f.endAngle(3*c/4));var w=k.append("path").attr("class","foreground").attr("fill","url(#"+_+")").attr("fill-opacity",.7).attr("stroke","rgb(255, 255, 255)").attr("stroke-linecap","square").attr("stroke-opacity",.9).attr("d",f.startAngle(0)),y=k.append("path").attr("class","foreground").attr("fill","url(#"+_+")").attr("fill-opacity",1).attr("stroke","rgb(255, 255, 255)").attr("stroke-opacity",.9).attr("d",f.startAngle(0)),v=k.append("text").attr("fill","rgb(0, 0, 0)").attr("text-anchor","middle").attr("class",r?"chart-progress-text_wallet":"chart-progress-text_others").attr("dy",".35em");if(a.textWithFormat)k.append("text").attr("fill","rgba(60, 68, 77, 0.54)").attr("text-anchor","middle").attr("class","chart-other-text").attr("dy","1.7em").text(a.textWithFormat);var A=k.append("text").attr("fill","rgb(196, 196, 196)").attr("text-anchor","middle").attr("class",r?"chart-caption-balance-title":"chart-caption-other-title").attr("dy",r?"4.4em":"5.5em").text(a.textInChart.key),I=k.append("text").attr("fill",r?"rgb(0,0,0)":s.colorStopOne).attr("text-anchor","middle").attr("font-weight","bold").attr("class",r?"chart-caption-balance":"chart-caption-other-limit").attr("dy",r?"4.7em":"6.8em").text(a.textInChart.value);var D=0;!function e(){!function(e){e>=1&&(e=1,A.attr("fill","rgba(216, 64, 64, 0.62)"),I.attr("fill","rgba(216, 64, 64, 0.62)"),v.attr("fill","rgba(216, 64, 64, 0.62)")),w.attr("d",f.endAngle(1.5*c*e)),w.attr("transform","rotate(-135)"),y.attr("d",f.endAngle(1.5*c*e)),y.attr("transform","rotate(-135)"),v.text(function(){var t=e;return"count"===a.format?(t=e*a.baseValue,l(t||a.baseValue)):l(t)})}(D),u>0&&(u--,D+=m,setTimeout(e,10))}()}}}]),n.module("esewaProfileApp").service("ProgressChartDataFormatService",["$rootScope",function(e){function t(e,t){var n=t?e.differenceCountPerDay:e.differenceAmountPerDay,o=t?e.walletVelocities.count_per_day:e.walletVelocities.total_amount_per_day,a=o<0?0:1-n/o;return{color:a>=.8?"red":t?"brown":"green",format:t?"count":"percent",hasUnlimitedValue:!1,endPoint:a,baseValue:t?e.walletTransactionRecords.countPerDay:e.walletTransactionRecords.totalAmountPerDay,textWithFormat:t?"Times":null,textInChart:{key:t?"Used":"Used Amount",value:t?e.walletTransactionRecords.countPerDay+" Times":"NPR. "+e.walletTransactionRecords.totalAmountPerDay}}}function n(e,t){var n=t?e.differenceCountPerMonth:e.differenceAmountPerMonth,o=t?e.walletVelocities.count_per_month:e.walletVelocities.total_amount_per_month,a=o<0?0:1-n/o;return{color:a>=.8?"red":t?"brown":"green",format:t?"count":"percent",hasUnlimitedValue:!1,endPoint:a,textWithFormat:t?"Times":"",baseValue:t?e.walletTransactionRecords.countPerMonth:e.walletTransactionRecords.totalAmountPerMonth,textInChart:{key:t?"Used":"Used Amount",value:t?e.walletTransactionRecords.countPerMonth+" Times":"NPR. "+e.walletTransactionRecords.totalAmountPerMonth}}}this.getFormattedWalletVelocityData=function(t){return{color:1*e.userBalance.balance/t.max_limit>=.8?"red":"green",format:"percent",hasUnlimitedValue:t.max_limit<=0,endPoint:Math.abs(1*e.userBalance.balance/t.max_limit),textInChart:{key:"Your Balance",value:"NPR. "+e.userBalance.balance}}},this.setActualDifference=function(e){return e.differenceCountPerDay=e.walletVelocities.count_per_day-e.walletTransactionRecords.countPerDay,e.differenceCountPerMonth=e.walletVelocities.count_per_month-e.walletTransactionRecords.countPerMonth,e.differenceAmountPerDay=e.walletVelocities.total_amount_per_day-e.walletTransactionRecords.totalAmountPerDay,e.differenceAmountPerMonth=e.walletVelocities.total_amount_per_month-e.walletTransactionRecords.totalAmountPerMonth,e},this.getFormattedVelocityData=function(e){return{dailyLimit:{countLimit:t(e,!0),amountLimit:t(e,!1)},monthlyLimit:{countLimit:n(e,!0),amountLimit:n(e,!1)}}}}]),n.module("esewaProfileApp").service("TransactionVelocityService",["Restangular",function(e){var t=e.all("auth").one("user");this.getWalletVelocity=function(){return t.one("balance/velocity/limit","").get()},this.getTransactionType=function(){return t.one("velocity/transaction/types","").get()},this.getVelocityAsPerTxnType=function(e){var n="P2P_RECEIVER"===e?"P2P/velocity/receiver":e+"/velocity";return t.one(n).withHttpConfig({selfHandleLoadingBar:!0}).get()}}])}(window.jQuery,window,window.angular);