/*! 
 * ec-payment-menu v3.51.0
 * https://dev.esewa.com.np
 * Version: 3.51.0
+; * Copyright (c) 2023 eSewa Developers <developers@esewa.com.np>
 * License: eSewa
 */

angular.module("esewaPaymentMenuApp",["restangular","ngStorage","esewaMessages","esewaSharedApp","ui.router","infinite-scroll"]).run(["$rootScope","$state","$localStorage","$http","$timeout","$sce","$location","$templateCache",function(e,t,o,a,n,r,c,s){}]),angular.module("esewaPaymentMenuApp").controller("ProductListController",["$scope","$stateParams","PaymentMenuService","$rootScope",function(e,t,o,a){a.setDocumentTitle(t.productCategory+" Product Listing");const n=t=>{o.getPaymentMenuProductsAsPerId(t).then(t=>e.products=t,e=>a.showErrorSuccessMessage(e,!0,"",!0))};n(t.id),e.switchCategory=function(e){n(e.id)},a.productMenus||o.getPaymentMenu().then(e=>a.productMenus=e,e=>a.showErrorSuccessMessage(e,!0,"",!0))}]),angular.module("esewaPaymentMenuApp").directive("copyToClipboard",function(){return{restrict:"A",link:function(e,t,o){t.click(function(){if(o.copyToClipboard){var e=$("<input>");$("body").append(e),e.val(o.copyToClipboard).select(),document.execCommand("copy"),e.remove()}})}}}),angular.module("esewaPaymentMenuApp").factory("PaymentMenuFactory",[function(){var e=[];return{setPaymentMenus:function(t){e=t},getPaymentMenu:function(){return e}}}]),angular.module("esewaPaymentMenuApp").factory("ShowcaseFactory",[function(){var e=[],t=[];return{setShowcaseData:function(t){e=t},getShowCaseData:function(){return e},setSameCatagoryShowcase:function(e){t=e},getSameCatagoryShowcase:function(){return t}}}]),angular.module("esewaPaymentMenuApp").controller("OfferDetailController",["$scope","$stateParams","CDNUrl","$rootScope","$localStorage","OfferService","$window","RedeemPromocodeService","$state","$modal",function(e,t,o,a,n,r,c,s,i,l){r.getOffer({page:0,size:25}).then(function(t){e.offerList=t.plain()}),e.availablePromocode=[],e.showPromocodeDetail=function(t){e.detail=t,e.$modalInstance=l.open({templateUrl:o.url+"/html/templates/promocode/promocode_detail_3.39.0.html",scope:e})},e.close=function(){e.$modalInstance.dismiss("cancel")},e.goToPromotionPage=function(){e.showDd=!1,i.go("redeemPromo.eligible")},e.goToOfferPage=function(e){c.open(e,"_blank")}}]),angular.module("esewaPaymentMenuApp").service("OfferService",["Restangular",function(e){var t=e.all("auth");this.getOffer=function(e){return t.one("offers").get(e)}}]),angular.module("esewaPaymentMenuApp").controller("PaymentMenuController",["$state","$scope","$rootScope","StateConstant","$timeout","$location","PaymentMenuService",function(e,t,o,a,n,r,c){function s(){(e.current.name===a.HOME_MAIN||e.current.name===a.LOGIN||e.current.name.startsWith("merchant"))&&(o.showPaymentMenu=!0),o.bannerLoader=!0,t.productMenus=o.productMenus,_.each(t.productMenus,function(e,o){t.showChildMenus[o]=!1}),i()}function i(){o.$$phase||o.$apply()}t.showChildMenus=[],t.menu={product:{}},e.current.name!==a.LOGIN&&e.current.name!==a.HOME_MAIN&&"organization.home"!==e.current.name||(o.showAddServices=!0),angular.isUndefined(o.productMenus)?c.getPaymentMenu().then(function(e){!function(e){angular.isDefined(e)&&(o.productMenus=e.plain(),o.bannerLoader=!!o.productMenus,s())}(e)},function(){o.productMenus=[],i()}):s(),t.getThePaymentClass=function(e){return temp=4*e,"col-lg-"+temp},t.getThePaymentInnerClass=function(e){return colVal=12/e,"col-lg-"+colVal},t.showChildMenu=function(e,a){o.globalclick=!1,"School & College"!==a.name?n(function(){"AGGREGATE"!==a.menuType?_.each(t.showChildMenus,function(o,a){t.showChildMenus[a]=a===e&&!t.showChildMenus[a]}):r.path(a.aggregateUrl)},0):o.goToState("schoolAndCollege")},t.closeAllMenus=function(){o.globalclick=!0},t.getDetails=function(t,n,c){o.isAuthenticated()?"AGGREGATE"===c.menuType?r.path(c.aggregateUrl):e.go(a.MAKE_PAYMENT,{product_code:t,product_name:n},{reload:!0}):o.openLoginDialog("/#/make_payment/"+t+"/"+n)};var l=["auth","authentication","user","activateNotification","activate","merchant.airlines","static","home.main.initialRequirement","fundFrom"],u=["user.statements","static","fundFrom"];o.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0,o.currentModal&&!e.current.name.startsWith(a.MAKE_PAYMENT)&&o.currentModal.dismiss(),o.showMostUsedServices=!1,o.showAddServices=!1,o.showPaymentMenu=!0,e.current.name===a.LOGIN||e.current.name===a.HOME_MAIN?(o.showMostUsedServices=!0,o.showAddServices=!0,o.message.error=""):e.current.name.startsWith("static")&&(o.message.error=""),o.showBreadCumb=!0,_.each(l,function(t){_.startsWith(e.current.name,t)&&(o.showPaymentMenu=!1,o.showBreadCumb=!1)}),_.each(u,function(t){(_.startsWith(e.current.name,t)||"login"===e.current.name||"main.landing"===e.current.name)&&(o.showBreadCumb=!1)})})}]).directive("paymentMenulist",[function(){return{restrict:"A",transclude:!1,link:function(e,t){e.$last&&$(".paymentMenu-parent").mouseenter(function(){var e=$(this),t=setTimeout(function(){e.addClass("hasBeen500ms")},500);e.mouseleave(function(){clearTimeout(t),e.removeClass("hasBeen500ms")})})}}}]).directive("onOutsideElementClick",["$document",function(e){return{restrict:"A",link:function(t,o,a){o.on("click",function(e){e.stopPropagation()});var n=function(){t.$$phase||t.$apply(function(){t.$eval(a.onOutsideElementClick)})};e.on("click",n),t.$on("$destroy",function(){e.off("click",n)})}}}]),angular.module("esewaPaymentMenuApp").service("PaymentMenuService",["Restangular",function(e){this.getProductForPayment=function(t){return e.all("payments").all("products").one(t).get()},this.getPaymentMenu=function(){return e.one("payment_menus/parents").customGET()},this.getPaymentMenuProductsAsPerId=function(t){return e.one(`payment_menus/${t}/products`).customGET()}}]),angular.module("esewaPaymentMenuApp").controller("ProductSearchController",["$scope","$filter","$window","$rootScope","$http","$location","$state","StateConstant","CDNUrl","ProductSearchService","$localStorage","AUTH_EVENTS",function(e,t,o,a,n,r,c,s,i,l,u,d){e.searching=!1,e.product="",e.productSearchMap=[],e.toBeDeletedSearchListItem=null,angular.isDefined(u.recentSearchList)||(u.recentSearchList=[]);var m={},h={};e.infoSectionObj={};function p(t){angular.isDefined(t)&&n.get(t).success(function(t){angular.isDefined(t)&&(e.infoSectionObj=t)})}e.getInfoSectionDataUrl=function(){switch(a.isAuthenticated()?"Authorized":"Unauthorized"){case"Authorized":switch(h?h&&"POINT"===h.organizationType?"Point":m&&angular.isDefined(m.isVerified)?"User":"Zone":"Zone"){case"User":var t=m&&m.isVerified?"Verified":"Unverified";p("Verified"==t?i.url+"/data/product-search/authorizedAndVerifiedUser.json":i.url+"/data/product-search/authorizedAndUnverifiedUser.json");break;case"Point":p(i.url+"/data/product-search/authorizedPoint.json");break;default:e.infoSectionObj={}}break;case"Unauthorized":p(i.url+"/data/product-search/unauthorizedUser.json")}},a.$on(d.socket,function(){m=a.$storage.profile||{},h=a.$storage.user||{},e.getInfoSectionDataUrl()}),a.isAuthenticated()||e.getInfoSectionDataUrl(),e.handleInfoSectionAction=function(){if(e.infoSectionObj.buttonAction.isRedirect){var n=t("UrlCode")(null!==e.infoSectionObj.buttonAction.url||""!==e.infoSectionObj.buttonAction.url?e.infoSectionObj.buttonAction.url:e.infoSectionObj.buttonAction.name);o.open(n,"_blank")}else if(a.isAuthenticated())a.goToState(e.infoSectionObj.buttonAction.name);else{var r="#"+e.infoSectionObj.buttonAction.url;a.openLoginDialog(r)}},e.showRecentSearchList=a.$storage.recentSearchList.length;var f=[],g=a.$storage.user?i.url+"/data/orgProductSearch.json":i.url+"/data/userProductSearch.json";n.get(g).success(function(e){angular.isDefined(e.data)&&(f=e.data)});var S=[],w=(a.$storage.user,i.url+"/data/userServiceSearch.json");n.get(w).success(function(e){angular.isDefined(e.data)&&(S=e.data)});var P=c.get();function v(e,t){return t.filter(function(t){return t.section===e}).length>0}function y(e,t){return{displayName:e.name,name:e.name,isDiffrentMerchant:t,code:e.code,image:e.logo,icon:e.icon,url:e.url,redirect:e.redirectExternal,section:"product"}}function M(e,t){return{displayName:e.displayName,name:e.name,image:e.logo||"/common/images/esewa-icon-large.png",isDifferentMerchant:t,state:e.state,url:e.url,redirect:e.redirectExternal,section:"service"}}P=P.filter(function(e){if(angular.isDefined(e.data)&&angular.isDefined(e.data.searchParams))return e}),e.search=function(t){e.searching=!0,e.product=t,e.productSearchMap=[],e.toBeDeletedSearchListItem=null;var a=[],n=[];if(o.trackLogEvent&&t.length>=3&&o.trackLogEvent({eventTitle:t,eventType:"search"}),f.forEach(function(o){o.params.toLowerCase().includes(t.toLowerCase())&&e.productSearchMap.push(y(o,!0))}),S.forEach(function(o){t.trim().length?o.params.toLowerCase().includes(t.toLowerCase())&&e.productSearchMap.push(M(o,!1)):e.productSearchMap.push(M(o,!1))}),P.forEach(function(o){var a;angular.isDefined(o.data)&&o.data.hasOwnProperty("searchParams")&&(_.filter(o.data.searchParams,function(e){return e.toLowerCase().includes(t.toLowerCase())}).length>0&&e.productSearchMap.push({displayName:(a=o).data.displayName||"Not Available",name:a.name,image:a.data.logo,icon:a.data.icon,url:a.url,redirect:!1,section:"feature"}))}),t.trim().length>2){var r={q:t};return l.getSearchResults(r).then(function(o){if(!o)return e.showService=v("service",e.productSearchMap),e.productSearchMap;if(e.searching=!1,0===o.length)0===e.productSearchMap.length&&e.productSearchMap.push({name:"Product not available."});else{for(var r=0;r<o.length;r++)o[r].redirectExternal?a.push(y(o[r])):n.push(y(o[r]));n.length&&n.push({saperatorLine:!0}),e.productSearchMap=e.productSearchMap.concat(n,a)}return t.trim().length&&(e.showFeature=v("feature",e.productSearchMap),e.showProduct=v("product",e.productSearchMap)),e.showService=v("service",e.productSearchMap),e.productSearchMap},function(t){return e.productSearchMap})}return e.searching=!1,e.showFeature=!1,e.showProduct=!1,e.showService=v("service",e.productSearchMap),e.productSearchMap},e.clearRecentSearchList=function(){u.recentSearchList=[]},e.clearSelectedRecentSearchList=function(e){a.$storage.recentSearchList=a.$storage.recentSearchList.filter(function(t){return t!==e})},e.setSearchTerm=function(t){e.product=t},e.clearSearchTerm=function(){e.product=""},e.onItemSelection=function(n,r){if(n)switch(function(t){var o=function(e,t){return t.filter(function(t){return t.name.name===e.name}).length>0}(t,a.$storage.recentSearchList);if(a.$storage.recentSearchList.length>0&&(e.productSearchMap=angular.copy(a.$storage.recentSearchList)),!o){var n={name:t,isEmpty:!1,section:"recentSearchItem"};a.$storage.recentSearchList.unshift(n),a.$storage.recentSearchList.length>5&&(e.toBeDeletedSearchListItem=a.$storage.recentSearchList[0],a.$storage.recentSearchList.splice(5,5),e.productSearchMap=e.productSearchMap.filter(function(t){return t.name!=e.toBeDeletedSearchListItem.name&&"recentSearchItem"===t.section})),a.$$phase||a.$apply(),e.productSearchMap.push(n)}}(n),o.trackLogEvent&&o.trackLogEvent({eventTitle:n.name,eventType:"select_content"}),n.section){case"recentSearchItem":e.setSearchTerm(n.name);break;case"feature":a.isAuthenticated()?a.goToState(n.name):(url="#"+n.url,a.openLoginDialog(url));break;case"product":if(n.isDiffrentMerchant)a.goToState(n.code);else if(n.redirect){if(n.redirect){var i=t("UrlCode")(null!==n.url||""!==n.url?n.url:n.code);o.open(i,"_blank")}}else a.isAuthenticated()?c.go(s.MAKE_PAYMENT,{product_code:n.code,product_name:n.name}):a.openLoginDialog("/#/make_payment/"+n.code+"/"+n.name);break;case"service":if(n.redirect){if(n.redirect){var l=t("UrlCode")(null!==n.url||""!==n.url?n.url:n.code);o.open(l,"_blank")}}else a.isAuthenticated()?c.go(s.MAKE_PAYMENT,{product_code:n.code,product_name:n.name}):a.openLoginDialog("/#/make_payment/"+n.code+"/"+n.name)}}}]),angular.module("esewaPaymentMenuApp").service("ProductSearchService",["Restangular",function(e){this.getSearchResults=function(t){return e.all("payments").all("products").withHttpConfig({selfHandleLoadingBar:!0}).customGET("",t)}}]),angular.module("esewaPaymentMenuApp").controller("RedeemPromocodeController",["$scope","$rootScope","RedeemPromocodeService","CDNUrl","$modal",function(e,t,o,a,n){e.message={error:"",success:""},e.page=1,e.size=8,e.usedPromocode="",e.elligiblePromocodeList=[],e.availablePromocodeList=[],e.promocodeInitialView="available",e.btnLabel="Apply",o.getAvailablePromocode().then(function(t){e.elligiblePromocodeList=t.plain()}),o.getAllAvailablePromocode().then(function(t){e.availablePromocodeList=t.plain()}),e.showPromocodeDetail=function(t){e.detail=t,e.$modalInstance=n.open({templateUrl:a.url+"/html/templates/promocode/promocode_detail_3.39.0.html",scope:e})},e.clearAppliedPromocode=function(){e.searchedPromocode=void 0,e.btnLabel="Apply",e.message.success="",e.message.error=""},e.close=function(){e.$modalInstance.dismiss("cancel")},e.fetchPromocodeValue=function(t){e.message.success="",e.message.error="",o.getPromocodeDetail(t).then(function(t){e.searchedPromocode=t.plain(),e.btnLabel="Applied"},function(t){e.message.error=t.data.error_message})},e.closeMsg=function(){e.message.success="",e.message.error=""},e.applyPromocode=function(a){e.message={error:"",success:""};var n={promo_code:a,product_id:0,product_type:null,module_id:t.isUser()?3:4,amount:0};o.redeemPromocode(n).then(function(t){e.usedPromocode="",e.searchedPromocode=void 0,e.btnLabel="Apply",e.message.success="Successfully Redeemed."},function(o){t.showErrorSuccessMessage(o,!0,"ERROR_ON_SERVING_REQUEST"),e.message.error=o.data.error_message})}}]),angular.module("esewaPaymentMenuApp").service("RedeemPromocodeService",["Restangular",function(e){this.getAvailablePromocode=function(){return e.all("auth/promocode").one("offer").getList()},this.getAllAvailablePromocode=function(){return e.all("auth/promocode").one("offer/list").getList()},this.getPromocodeDetail=function(t){return e.all("auth/promocode/offer/"+t).one("details").get()},this.redeemPromocode=function(t){return e.all("auth/promocode/redeem").customPOST(t)}}]),angular.module("esewaPaymentMenuApp").controller("SchoolCollegeController",["$scope","CDNUrl","$rootScope","PaymentMenuService","$http",function(e,t,o,a,n){n.get(t.url+"/data/schoolBanner.json").then(function(t){e.contents=t.data}),a.getPaymentMenu().then(function(t){e.schoolCollege=t.plain().filter(function(e){return"School & College"===e.name})[0]})}]),angular.module("esewaPaymentMenuApp").directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(e,t){e.$last&&e.initCarousel(t.parent())}}}]).directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(e){e.initCarousel=function(t){var o={},a=e.$eval($(t).attr("data-options"));for(var n in a)o[n]=a[n];$(t).owlCarousel(o).owlCarousel({loop:!0,nav:!0,margin:10,responsive:{0:{items:1},600:{items:3},960:{items:5},1200:{items:6}}})}}}}),angular.module("esewaPaymentMenuApp").controller("ShowcaseController",["$scope","$rootScope","$state","ShowcaseFactory","ShowcaseService","$modal","$window","$sce","CDNUrl",function(e,t,o,a,n,r,c,s,i){e.data={showcases:[]},e.showcaseFactory=a,e.getShowCaseDataFromServer=function(){e.showcaseFactory.getShowCaseData().length?e.data.showcases=e.showcaseFactory.getShowCaseData():n.getShowcase().then(function(o){for(var a=[],n=o.plain(),r=0;r<n.length;r++)a.push({name:n[r].name,badge:n[r].badge,detail:n[r].detail,logo:n[r].image_url,offer:n[r].offer,order:n[r].position,code:n[r].code,showcased:n[r].showcase,value:n[r].value,displayName:n[r].displayName});Object.assign(e.data.showcases,a),e.showcaseFactory.setShowcaseData(e.data.showcases),t.showcaseLoader=!!e.data.showcases},function(){return[]})},e.getProductShowcaseDetail=function(a,n){if(a.detail&&n)angular.isObject(a.detail)||(a.detail=s.trustAsHtml(a.detail)),e.openShowcaseDetailDialog(a);else{if(angular.isDefined(t.isAuthenticated)&&!t.isAuthenticated())return void t.openLoginDialog("/#/make_payment/"+a.code+"/"+a.displayName);o.go("merchant.makePayment",{product_code:a.code,product_name:a.name},{reload:!0})}},e.redirectToExternalUrl=function(e){c.open(e,"_blank")},e.openShowcaseDetailDialog=function(e){r.open({templateUrl:i.url+"/html/showcase/modal_showcase_detail.html",controller:l,size:"lg ShowcaseDetails",resolve:{showcase:function(){return e}}})},e.showcaseViewAll=function(t){n.getShowcaseByLevel(t).then(function(t){e.allShowcase=t.plain(),e.showcaseFactory.setSameCatagoryShowcase(t.plain()),o.go("allShowcase")},function(e){})};var l=["$rootScope","$scope","showcase","$modalInstance",function(e,t,o,a){t.showcase=o,t.cancel=function(){a.dismiss()},e.currentModal=a}]}]),angular.module("esewaPaymentMenuApp").factory("ShowcaseFactory",[function(){var e=[],t=[];return{setShowcaseData:function(t){e=t},getShowCaseData:function(){return e},setSameCatagoryShowcase:function(e){t=e},getSameCatagoryShowcase:function(){return t}}}]),angular.module("esewaPaymentMenuApp").service("ShowcaseService",["Restangular","PaginationService",function(e){this.getShowcase=function(){return e.all("products").all("showcase").getList()},this.getShowcaseByLevel=function(t){return e.all("products").all("showcase/"+t).customGET()}}]),angular.module("esewaPaymentMenuApp").config(["$stateProvider","$urlRouterProvider","CDNUrl",function(e,t,o){function a(e){return o.url+e}e.state("allShowcase",{templateUrl:a("/html/templates/v1/all_showcase.html"),data:{displayName:"All Showcase"}}).state("schoolAndCollege",{url:"/school-college",controller:"SchoolCollegeController",templateUrl:a("/html/templates/school_college.html"),data:{searchParams:["school","college"],displayName:"School and College",icon:"icon-es-school"}}).state("redeemPromo",{url:"/redeem-promocode",controller:"RedeemPromocodeController",templateUrl:a("/html/templates/promocode/redeem_promocode_3.39.0.html"),data:{searchParams:["redeem promocode"],displayName:"Redeem Promocode",icon:"icon-es-promocode"}}).state("redeemPromo.available",{url:"/available",templateUrl:a("/html/templates/promocode/available_promocode.html"),data:{displayName:"Available Promocode"}}).state("redeemPromo.eligible",{url:"/eligible",templateUrl:a("/html/templates/promocode/eligible_promocode.html"),data:{displayName:"Eligible Promocode"}}).state("productList",{url:"/products/:productCategory/:id",controller:"ProductListController",templateUrl:a("/html/templates/all_products_list_3.51.0.0.html")})}]);