!function(e,t,a,n){"use strict";a.module("esewaPaymentApp",["restangular","ngStorage","ngTable","esewaMessages","esewaSharedApp","ui.router","ui.select"]).run(["$rootScope","DefaultMessageConstant","ecmsg","AUTH_EVENTS","BalanceService","RewardService","$timeout","CommonService","$modal","CDNUrl",function(e,t,a,n,i,o,r,s,c,l){function u(t){i.getBalance().then(function(a){a?r(function(){e.$$phase||e.$apply(function(){e.userBalance={balance:a.balance,lienBalance:a.lien_balance,lastTransactionDate:a.last_transaction_date},"function"==typeof t&&t()})},500):e.$$phase||e.$apply(function(){e.userBalance={balance:"N/A"}})},function(){e.$$phase||e.$apply(function(){e.userBalance={balance:"N/A"}})})}e.showErrorSuccessMessage=function(n,i,o,r){var s=(n||{}).data?n.data:n,c=_.isObject(s)?s.error_message||s.errorMessage||s.message:n;if(c="string"==typeof c?c:t[o]){var l=i?"error":"success";_.isUndefined(r)?e.message[l]=c:a[l](c)}},e.userBalance={balance:"0"},e.UserRewardPoint={reward_point:"0"},e.getUserBalance=function(e){u(e)},e.$on(n.getBalanceAndRewards,function(){e.isAuthenticated()&&(u(),o.getRewardPoints().then(function(t){r(function(){e.$$phase||e.$apply(function(){e.UserRewardPoint=t?t.plain():{reward_point:"N/A"}})},500)},function(){e.$$phase||e.$apply(function(){e.UserRewardPoint={reward_point:"N/A"}})}))})}]),a.module("esewaPaymentApp").constant("AirlineActionConstant",{reschedule:"NP-ES-RES",nameCorrection:"NP-ES-NAME-CORR",contactChange:"NP-ES-CONTACT",cancellation:"NP-ES-CANCEL",refund:"NP-ES-RR"}),a.module("esewaPaymentApp").constant("AirlinePlasmaCodeConstant",["U4","S1","SHA"]),a.module("esewaPaymentApp").constant("AirlineTicketStatusConstant",{COMPLETE:"COMPLETE",PROCESSING:"PROCESSING",CANCELLED:"CANCELLED",RESCHEDULED:"RESCHEDULED"}),a.module("esewaPaymentApp").constant("FlightStatusAirlinesConstant",[{label:"All",value:["U4","S1","YT","SHA"]},{label:"Buddha Airlines",value:"U4"},{label:"Yeti Airlines",value:"YT"},{label:"Saurya Airlines",value:"S1"},{label:"Shree Airlines",value:"SHA"}]),a.module("esewaPaymentApp").constant("FlightStatusConstant",{LANDED:"LANDED",DEPARTURED:"DEPARTURED",ONTIME:"ONTIME",DELAY:"DELAY",CHECKIN:"CHECKIN",BOARDING:"BOARDING",CANCELLED:"CANCELLED"}),a.module("esewaPaymentApp").constant("MyFlightActionFormStatusConstant",{newForm:"NEW_FORM",oldForm:"OLD_FORM"}),a.module("esewaPaymentApp").constant("MyFlightConstant",{UPCOMING_FLIGHT:"upcoming flights",PAST_FLIGHT:"past flights"}),a.module("esewaPaymentApp").constant("MyFlightNationalityConstant",{NP:"Nepali",IND:"Indian"}),a.module("esewaPaymentApp").constant("PassengerTypeConstant",{ADULT:"ADL",CHILD:"CHD"}),a.module("esewaPaymentApp").controller("AirlinePdfAndNotificationController",["$http","$scope","FileSaverFactory","$modal","$rootScope","$timeout","$window","ecmsg","CDNUrl",function(e,t,n,i,o,r,s,c,l){new Date;o.$on("GetPdf",function(){r(function(){t.getPdf(o.ticketDetails.transaction_code)},100)}),t.sendNotification=function(e,a,n,i){t.openSendNotificationDialog(e,a,n,i)},t.openSendNotificationDialog=function(e,t,a,n){i.open({templateUrl:l.url+"/html/templates/airline/send_notification_panel.html",controller:u,size:"sm",backdrop:"static",resolve:{notificationId:function(){return t},type:function(){return e},txnCode:function(){return a},buyerName:function(){return n}}})};var u=["$scope","$rootScope","$modalInstance","notificationId","type","AirlinesService","txnCode","ValidationService","ecmsg","buyerName",function(e,t,n,i,o,r,s,c,l,u){e.notificationId=i,e.type=o,e.txnCode=s,e.buyerName=u,e.cancel=function(){n.dismiss()},t.currentModal=n,e.sendNotification=function(i,o,s,u){if("SMS"===i){if(!c.checkMobileValid(o))return!1;e.notificationSmsDto={mobile_number:o,txn_code:s,buyer_name:u},r.sendNotificationToSms(e.notificationSmsDto).then(function(t){e.notificationResponse=t,l.success("SMS proceeded","")},function(n){e.showModificationPanel=!1,t.showInformation=!1,a.isDefined(n)&&(n.data.error_message?t.message.error=n.data.error_message:t.message.error="Unable to fetch user profile.")})}else{if(!c.checkEmailValid(o))return!1;e.notificationEmailDto={email_id:o,txn_code:s,buyer_name:u},r.sendNotificationToEmail(e.notificationEmailDto).then(function(t){e.notificationResponse=t,l.success("Email proceeded","")},function(n){e.showModificationPanel=!1,t.showInformation=!1,a.isDefined(n)&&(n.data.error_message?t.message.error=n.data.error_message:t.message.error="Unable to fetch user profile.")})}n.dismiss()}}];t.showTicketSendOption=function(e){e=e.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3");var t=new Date(e);return new Date<=t}}]),a.module("esewaPaymentApp").controller("AirlineServiceController",["$scope","$rootScope","$modalInstance","airlines",function(e,t,a,n){e.airlinesServices=n,t.currentModal=a,e.cancel=function(){a.dismiss()},t.currentModal=a}]),a.module("esewaPaymentApp").controller("AirLinesController",["$scope","$rootScope","$state","AirlinesService","DateFormatter","$timeout","StateConstant","AirlineCalculator","$modal","$location","$window","$http","FileSaverFactory","AirlinePassengerDetailService","StatementService","ecmsg","CDNUrl",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g,y,S,D){i.clearMessage();var R=i.PropertyConstant;e.nationality=["Nepalese","Indian"],e.tripTypes=[{key:"O",value:"One Way"},{key:"R",value:"Two Way"}],e.selectedAirlineList=[],e.outboundFlightId="",e.inboundFlightId="",e.pnrResponse="",i.message={};var b="";e.CheckDate=function(){e.searchRequest.dateRange.arrivalDate<e.searchRequest.dateRange.departureDate&&(e.searchRequest.dateRange.arrivalDate=e.searchRequest.dateRange.departureDate)},e.goToState=function(e){"airlines"===e&&o.go("merchant.airlines.search")},e.initAirlinesDetialListPage=function(){e.searchRequest.origin.name||i.goToState(l.AIRLINES_SEARCH)};var A=new Date;e.title=["Mr","Ms","Mrs"],e.airlineMaps=[],e.airlineMapsCopy=[],e.showSameMessage=!1,e.showloadingBar=!1,e.datePicker={startDate:A},e.searchRequest={selectedAirlineList:[{code:""}],origin:{id:"",name:""},destination:{id:"",name:""},arrivalDate:"",departureDate:"",dateRange:new function(){this.departureDate=new Date,this.arrivalDate=new Date},tripType:{key:"O",value:"One Way"},noOfAdult:1,noOfChild:0,noOfInfant:""},o.current.name===l.AIRLINES_TICKET&&y.getTxnDetails(o.params.txnId,o.params.moduleId).then(function(t){e.ticketDetails=t.plain(),e.setAirTicket(e.ticketDetails)},function(e){a.isDefined(e)?i.message.error=e.data.error_message:i.message.error="Error while fetching data."}),e.getSectors=function(){e.sectors||r.getSector().then(function(t){e.sectors=[],a.isDefined(t.plain)&&_.forEach(t.plain(),function(t,a){e.sectors.push({id:a,name:t})}),e.sectors=_.sortBy(e.sectors,"name")},function(e){i.showInformation=!1,a.isDefined(e)&&(e.data.error_message?i.message.error=e.data.error_message:i.message.error="Service is currently unavailable. please, try again later.")})},e.getAirlinesList=function(){0===e.airlineMaps.length&&r.getAirlines().then(function(t){e.airlines=t.plain(),a.isDefined(t.plain())&&(_.forEach(e.airlines,function(t,a){e.airlineMaps.push({code:t.code,icon:t.logo,name:t.name,maker:a})}),e.airlineMapsCopy=a.copy(e.airlineMaps))},function(e){i.showInformation=!1,a.isDefined(e)&&(e.data.error_message?i.message.error=e.data.error_message:i.message.error="Service is currently unavailable. please, try again later.")})},e.checkTripType=function(t){"R"===t&&(e.searchRequest.dateRange.arrivalDate=e.searchRequest.dateRange.departureDate)},e.checkSame=function(e,t){if(a.isDefined(e)&&a.isDefined(t)&&(""!==e||""!==t)){var n="KTM"===e.id&&"KTM"===t.id;return n?!n:e.id===t.id}return!1},c(function(){e.getSectors(),e.getAirlinesList()},100),e.getAirlinesAvailability=function(){r.getAirlinesAvailabilities(e.searchAirDto).then(function(t){e.availableAirlines=t.plain(),e.showReturnFlightList=!1,e.showDepartureFlightList=!0,e.showloadingBar=!1,e.searchedAirlines=e.availableAirlines.outbound_flight_details,e.searchedAirlinesForFilter=e.availableAirlines.outbound_flight_details,e.priceArray=[];for(var n=0;n<e.searchedAirlines.length;n++)e.priceArray.push(e.searchedAirlines[n].total_amount);if(e.minAirlineSearchedPrice=Math.min.apply(null,e.priceArray),e.maxAirlineSearchedPrice=Math.max.apply(null,e.priceArray),a.isDefined(e.availableAirlines.inbound_flight_details)&&a.isDefined(e.availableAirlines.outbound_flight_details)&&!e.availableAirlines.inbound_flight_details&&!e.availableAirlines.outbound_flight_details)return i.showInformation=!1,i.successResponse.message=!1,void(i.message.error="No flight available on this searched criteria. Please, select other options");e.searchedAirlines.tripType="O",e.searchedAirlinesArrival=e.availableAirlines.inbound_flight_details,e.searchedAirlinesArrival&&(e.searchedAirlinesArrival.tripType="R"),null!==e.searchedAirlines||e.searchedAirlines&&0!==e.searchedAirlines.length?(e.totalFlightCount=e.searchedAirlines.length,o.go(l.AIRLINES_LIST)):(i.showInformation=!1,i.message.error="No flight available on this searched criteria. Please, select other options")},function(t){e.showloadingBar=!1,e.showMessage="No data available",i.showInformation=!1,a.isDefined(t)&&(t.data.error_message?i.message.error=t.data.error_message:i.message.error="Flights are not available with provided search parameters.")})},e.findFlightsFromServer=function(){if(!e.searchRequest.destination||!e.searchRequest.origin||!e.searchRequest.dateRange.departureDate)return e.showloadingBar=!1,!1;if(e.searchRequest.noOfAdult<0)return e.showloadingBar=!1,!1;if(e.searchRequest.destination===e.searchRequest.origin)return e.showloadingBar=!1,!1;if(e.searchRequest.dateRange.departureDate>e.searchRequest.dateRange.arrivalDate&&"R"===e.searchRequest.tripType.key)e.showErrorMessage="Please select correct departure and arrival date.";else{var t=0;for(var a in e.searchRequest.selectedAirlineList)e.searchRequest.selectedAirlineList.hasOwnProperty(a)&&t++;e.searchAirDto={airline_code:1===t?e.searchRequest.selectedAirlineList[0].code:"",flight_date:s.formatDate(e.searchRequest.dateRange.departureDate),return_date:s.formatDate(e.searchRequest.dateRange.arrivalDate),origin:e.searchRequest.origin.id,destination:e.searchRequest.destination.id,no_of_adult:"Select"===e.searchRequest.noOfAdult?0:e.searchRequest.noOfAdult,no_of_child:"Select"===e.searchRequest.noOfChild?0:e.searchRequest.noOfChild,trip_type:e.searchRequest.tripType},e.flightDetailTripType=e.searchRequest.tripType.value,e.selectedTripTypeId=e.searchRequest.tripType,e.searchedAirlines=[],e.searchedAirlinesArrival=[],i.isLoggedIn()&&(""!==e.searchAirDto.destination&&e.searchAirDto.origin?e.getAirlinesAvailability():e.showloadingBar=!1)}e.adultDtos=[]},e.findFlights=function(){i.clearMessage(),e.resetLeftPanel(),e.showloadingBar=!0,i.isAuthenticated()||(e.showloadingBar=!1,i.openLoginDialog(m.absUrl())),e.findFlightsFromServer(),e.showModificationPanel=!1},e.formattedDate=s,e.slider_visible_bar={value:1e4,options:{showSelectionBar:!0}},e.minSlider={value:10},e.filterAirlines=[],e.reverseSort=!1,e.getAirlinesFlightPrice=function(t){e.priceFilteredAirlines=[],e.priceFilteredAirlines=t,e.searchedAirlines=u.getFilteredAirlinesByPrice(e.priceFilteredAirlines,e.searchedAirlines)},e.getAirlinesFlightArrival=function(t){e.arrivalFilteredAirlines=[],e.arrivalFilteredAirlines=t},e.filterAirlines=[],e.initialIsChecked=!1,e.getFilteredDate=function(t,a){!0===a?(e.filterAirlines.push(t),e.searchedAirlines=u.getFilteredDate(e.filterAirlines,e.availableAirlines.outbound_flight_details,null)):(e.filterAirlines.splice(e.filterAirlines.indexOf(t),1),0===e.filterAirlines.length?e.getAllAirlinesNotSelected():e.searchedAirlines=u.getFilteredDate(e.filterAirlines,e.availableAirlines.outbound_flight_details,null)),e.totalFlightCount=e.searchedAirlines.length},e.searchByPrice=function(t){e.searchedAirlines=u.getFilteredDateByPrice(t,e.availableAirlines.outbound_flight_details,null),e.totalFlightCount=e.searchedAirlines.length},e.disabledFlights=!1,e.getAllAirlines=function(){e.disabledFlights=!e.disabledFlights,e.selectedAirlines=[],e.searchedAirlines=e.availableAirlines.outbound_flight_details},e.getAllAirlinesNotSelected=function(){e.selectedAirlines=[],e.searchedAirlines=e.availableAirlines.outbound_flight_details},e.showDetails=function(t){e.flightID=t;for(var a=0,n=e.searchedAirlines.length;a<n;a++)e.searchedAirlines[a].flight_id===t&&(e.individualFlightDetail=e.searchedAirlines[a],e.totalPassenger=1*e.individualFlightDetail.no_of_adult+1*e.individualFlightDetail.no_of_child+1*e.individualFlightDetail.no_of_infant,e.totalPayingAmount=u.getTotalPayingAmount(e.individualFlightDetail.total_amount,e.individualFlightDetail.cashback));e.openFlightDetailDialog(e.individualFlightDetail,e.totalPassenger,e.totalPayingAmount)},e.openFlightDetailDialog=function(e,t,a){d.open({templateUrl:D.url+"/html/templates/airline/flight_detail_panel.html",controller:"FlightDetailsController",size:"lg",backdrop:"static",resolve:{individualFlightDetail:function(){return e},totalPassenger:function(){return t},totalPayingAmount:function(){return a}}})},e.modifySearch=function(){e.showModificationPanel=!e.showModificationPanel},e.checkTripType=function(t){"R"===t&&(e.searchRequest.arrivalDate=e.searchRequest.departureDate)},e.cancelModifySearch=function(){e.showModificationPanel=!1,e.findFlightsFromServer()},e.showFilters=!0,e.selectFlightForBooking=function(t,a){e.openReloadPageDialog(t,a)},e.resetLeftPanel=function(){e.departureResource="",e.arrivalResource="",e.showReturnFlightList=!1},e.openReloadPageDialog=function(t,a){d.open({templateUrl:D.url+"/html/templates/airline/airline_reload.html",controller:"AirLineReloadController",size:"md",backdrop:"static",resolve:{airLine:function(){return t},tripType:function(){return a},confirmFlight:function(){return e.confirmFlight}}})},e.confirmFlight=function(t,a){i.showFilters=!1,"R"===t?(e.inboundFlightId=a.flight_id,function(t){e.filterAirlines=[{code:t.airline_code}],e.searchedAirlinesArrival=u.getFilteredDate(e.filterAirlines,e.searchedAirlinesArrival,t),e.departureResource=t}(a),e.showReturnFlightList=!0,e.showDepartureFlightList=!1):(e.OutboundFlightId=a.flight_id,function(t){e.arrivalResource=t}(a),e.showDepartureFlightList=!1,e.showReturnFlightList=!1)},e.bookOneWayFlight=function(t){e.outboundFlightId=t.flight_id,e.calculatePassengers(e.searchRequest),e.departureResource=t,e.totalPayingAmount=u.getTotalPayingAmount(e.departureResource.total_amount,e.departureResource.cashback),e.totalPassenger=1*t.no_of_adult+1*t.no_of_child+1*t.no_of_infant,e.reserveFlight(e.departureResource.flight_id,"",e.selectedTripTypeId,e.totalPayingAmount)},e.bookRoundTripFLights=function(t,a){e.calculatePassengers(e.searchRequest),e.departureResource=t,e.arrivalResource=a,e.totalPayingAmount=u.getTotalPayingAmount(e.departureResource.total_amount,e.departureResource.cashback),e.totalPayableAmountRoundWay=u.getTotalPayingAmount(e.arrivalResource.total_amount,e.arrivalResource.cashback),e.totalPassenger=1*t.no_of_adult+1*t.no_of_child+1*t.no_of_infant,e.totalRoundTripAmount=1*e.totalPayingAmount+1*e.totalPayableAmountRoundWay,e.reserveFlight(e.departureResource.flight_id,e.arrivalResource.flight_id,e.selectedTripTypeId,e.totalPayableAmountRoundWay)},e.reserveFlight=function(n,s,c,u){var d;e.airlineReservationDto={flight_id:n,return_flight_id:s,trip_type:c.key},d=i.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now(),b=i.$storage.profile.esewaId+"_"+d,e.showloadingBar=!0,r.reserveFlight(e.airlineReservationDto).then(function(t){if(e.showloadingBar=!1,a.isDefined(t)){e.pnrResponse=t.plain();var n={};_.forEach(e.pnrResponse,function(t,a){n=e.pnrResponse[a]}),_.forEach(n,function(t,a){var i=n[a];i.flight_id===e.airlineReservationDto.flight_id?e.departureResource.pnrNo=i.pnr_no:i.flight_id===e.airlineReservationDto.return_flight_id&&(e.arrivalResource.pnrNo=i.pnr_no)}),e.checkBalance(u),o.go(l.AIRLINES_PASSANGER),p.scrollTo({top:0,behavior:"smooth"})}},function(t){i.showInformation=!1,e.showloadingBar=!1,t.data.error_message?S.error(t.data.error_message,""):""!==t.data.message&&t.data.message?S.error(t.data.message,""):S.error("Service is currently unavailable. please, try again later."),o.go("merchant.airlines.search")},function(){e.showloadingBar=!1,S.error("Service is currently unavailable. please, try again later.",""),o.go("merchant.airlines.search")})},e.calculatePassengers=function(t){var a;for(e.numberOfAdults=[],e.numberOfChilds=[],e.numberOfInfants=[],a=0;a<t.noOfAdult;a++)e.numberOfAdults.push(a);for(a=0;a<t.noOfChild;a++)e.numberOfChilds.push(a);for(a=0;a<t.noOfInfant;a++)e.numberOfInfants.push(a)},e.adultDtos=[],e.childDtos=[],e.infantDtos=[],e.getFirstName=function(t,n,i){a.isDefined(i)?e.adultDtos[t].firstName=n+" "+i:e.adultDtos[t].firstName=n},e.getFirstNameChild=function(t,n,i){a.isDefined(i)?e.childDtos[t].firstName=n+" "+i:e.childDtos[t].firstName=n},e.submitPassengerForm=function(t){e.adultDetails=u.getPassengerList(e.adultDtos,"ADULT"),e.childDetails=u.getPassengerList(e.childDtos,"CHILD"),e.infantDetails=u.getPassengerList(e.infantDtos,"INFANT"),e.passengerDetails=e.adultDetails.concat(e.childDetails,e.infantDetails),a.isDefined(e.arrivalResource)&&null!==e.arrivalResource?(e.returenFlightId=e.arrivalResource.flight_id,e.returnFlightDetail=e.arrivalResource,e.returnFlighTotalPaybleAmount=e.totalPayableAmountRoundWay):(e.returenFlightId="",e.returnFlightDetail="",e.returnFlighTotalPaybleAmount=""),e.airlineTicketIssueDto={flight_id:e.departureResource.flight_id,return_flight_id:e.returenFlightId,contact_name:t.name,contact_email:t.email,contact_mobile:t.phoneNumber,passengers:e.passengerDetails,inbound_pnr_no:e.returnFlightDetail.pnrNo,outbound_pnr_no:e.departureResource.pnrNo,outboundChildCommission:e.departureResource.child_commission_amt,inboundChildCommission:e.returnFlightDetail.child_commission_amt,outboundAdultCommission:e.departureResource.agency_commission,inboundAdultCommission:e.returnFlightDetail.agency_commission,unique_id:b},i.showloadingBar=!0,e.openConfirmFlightBookingDialog(e.airlineTicketIssueDto,e.departureResource,e.returnFlightDetail,e.returnFlighTotalPaybleAmount,e.totalPayingAmount,e.totalPassenger)},e.openConfirmFlightBookingDialog=function(a,n,o,r,s,c){var l=i.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now();a.unique_id=i.$storage.profile.esewaId+"_"+l,d.open({templateUrl:D.url+"/html/templates/airline/continue_booking_confirmation.html",controller:"ConfirmContinueBookingController",size:"lg",resolve:{airlineTicketIssueDto:function(){return a},departureResource:function(){return n},returnFlightDetail:function(){return o},returnFlightTotalPayableAmount:function(){return r},totalPayableAmountOneWay:function(){return s},passengers:function(){return c},setAirTicket:function(){return e.setAirTicket}}})},e.setAirTicket=function(t){e.ticketDetails=t,e.mobileNumber=t.properties.buyerPhoneNumber,e.email=t.properties.buyerEmail,e.passengerDto=g.getAirlinePassengerDetail(t.properties),e.returnPassengerDto=g.getAirlineReturnPassengerDetail(e.ticketDetails.properties)},e.getLeadPassengerInformation=function(t){t&&(e.showloadingBar=!0,r.getLeadPassengerDetail().then(function(t){c(function(){e.showloadingBar=!1},1e3),e.leadPassengerDetail=t.plain(),e.leadPassenger={name:e.leadPassengerDetail.name,email:e.leadPassengerDetail.email,phoneNumber:e.leadPassengerDetail.mobile_number,address:e.leadPassengerDetail.address};var a=e.leadPassenger.name;a&&(a=a.split(" "));var i=[];if(a){for(var o=0;o<a.length;o++)i.push(a[o]),o!==a.length-1&&i.push(" ");e.adultDtos[0].firstName=a[0],e.fname=a[0],e.adultDtos[0].lastName=a[2]!==n?a[1].concat(" ",a[2]):a[1],e.adultDtos[0].nationality=e.nationality[0]}},function(t){e.showModificationPanel=!1,e.showloadingBar=!1,i.showInformation=!1,a.isDefined(t)&&(t.data.error_message?i.message.error=t.data.error_message:i.message.error="Unable to fetch user profile.")}))},e.checkBalance=function(t){e.showInsufficientBalance=!1,a.isDefined(t)&&a.isDefined(i.$storage.balance)&&t>i.$storage.balance.balance&&(e.showInsufficientBalance=!0)},e.getServiceDetail=function(t){e.openServiceDialogs(t)},e.openServiceDialogs=function(e){d.open({templateUrl:D.url+"/html/templates/airline_service.html",controller:"AirlineServiceController",size:"sm",resolve:{airlines:function(){return e}}})},e.getRescheduleForm=function(){o.go(l.MAKE_PAYMENT,{product_code:R.AIRLINE_RESCHEDULE,product_name:"Airlines Date/Name Change"})},e.iconObj={},e.orderByField="",e.toogleSortIcon=function(t,a){e.orderByField=t,e.reverseSort=!e.reverseSort,e.iconObj={},e.iconObj[a]=!0},e.priceRangeFilter=function(t){e.priceFilteredFromSliderAirline=[];for(var a=0;a<e.searchedAirlinesForFilter.length;a++)e.searchedAirlinesForFilter[a].total_amount<=t&&e.priceFilteredFromSliderAirline.push(e.searchedAirlinesForFilter[a]);e.searchedAirlines=e.priceFilteredFromSliderAirline},e.resetPriceFilter=function(){e.filterAirlines.length?e.searchedAirlines=u.getFilteredDate(e.filterAirlines,e.availableAirlines.outbound_flight_details,null):e.searchedAirlines=e.searchedAirlinesForFilter,e.airlineMaps=a.copy(e.airlineMapsCopy)}}]),a.module("esewaPaymentApp").controller("AirLineReloadController",["$scope","$rootScope","$modalInstance","airLine","tripType","confirmFlight",function(e,t,a,n,i,o){e.information=n,e.tripType=i,e.cancel=function(){a.dismiss()},e.confirmFlight=function(){o(e.tripType,e.information),a.dismiss()},t.currentModal=a}]),a.module("esewaPaymentApp").controller("ConfirmContinueBookingController",["$scope","$rootScope","$modalInstance","airlineTicketIssueDto","departureResource","returnFlightDetail","AirlinesService","returnFlightTotalPayableAmount","totalPayableAmountOneWay","passengers","$timeout","ecmsg","$state","AirlinePassengerDetailService","StateConstant","setAirTicket",function(e,t,n,i,o,r,s,c,l,u,d,m,p,f,h,g){t.load=!0,e.departureFlightDetail=o,e.returnFlightDetail=r,e.airlineTicketIssueDto=i,e.passengers=u,e.totalPayableAmountOneWay=l,e.returnFlightTotalPayableAmount=c,a.isDefined(e.returnFlightTotalPayableAmount)?e.grandTotalAmount=1*e.totalPayableAmountOneWay+1*e.returnFlightTotalPayableAmount:e.grandTotalAmount=1*e.totalPayableAmountOneWay,t.currentModal=n,e.cancel=function(){t.load=!1,n.dismiss()},e.continueBooking=function(){t.load=!0,d(function(){s.makeFlightPayment(i).then(function(a){t.load=!1,e.ticketDetails=a.plain(),g(e.ticketDetails),n.dismiss(),t.$emit("GeneratePdf",e.ticketDetails.transaction_code),p.go(h.AIRLINES_TICKET,{txnId:e.ticketDetails.transaction_code,moduleId:e.ticketDetails.module_id}),d(function(){e.$emit("GetPdf",{txnId:e.ticketDetails.transaction_code,moduleId:e.ticketDetails.module_id})},500),t.clearMessage()},function(n){e.showInformation=!1,t.load=!1,a.isDefined(n)&&(n.data.error_message?m.error(n.data.error_message,""):""!==n.data.message&&n.data.message?m.error(n.data.message,""):m.error("Service is currently unavailable. please, try again later.")),p.go("merchant.airlines.search")})},1e3)},t.load=!1}]),a.module("esewaPaymentApp").controller("FlightDetailsController",["$scope","$rootScope","$modalInstance","individualFlightDetail","totalPassenger","totalPayingAmount",function(e,t,a,n,i,o){e.individualFlightDetail=n,e.totalPassenger=i,e.totalPayingAmount=o,e.closeFlightDetailPanel=function(){a.dismiss()},t.currentModal=a}]),a.module("esewaPaymentApp").controller("PassengerDetailController",["$scope",function(e){e.title=["MR","MS"]}]),a.module("esewaPaymentApp").controller("SingleDateRangeController",["$scope",function(e){e.today=new Date;var t=new Date,a=function(e){e.preventDefault(),e.stopPropagation()};e.openDepartureDate=function(t){a(t),e.departureDateOpened=!0,e.arrivalDateOpened=!1},e.openArrivalDate=function(t){a(t),e.arrivalDateOpened=!0,e.departureDateOpened=!1},e.openCheckInDate=function(t){a(t),e.checkInDateOpened=!0,e.checkOutDateOpened=!1},e.openCheckOutDate=function(t){a(t),e.checkOutDateOpened=!0,e.checkInDateOpened=!1},e.maxDateRange=t.setMonth(t.getFullYear()+1)}]),a.module("esewaPaymentApp").controller("ARConfirmationController",["$scope","$rootScope","$state","ARService","ARDataFactory",function(e,a,n,i,o){o.getChangedAirlineDetail()?(a.reschedularTimerShow=!0,e.airlineDetailFromFactory=o.getAirlineFlightDetail(),e.changedAirlineDetail=o.getChangedAirlineDetail(),e.reservationDetail=o.getAirlineReservationDetail(),e.passengerDetail=o.getAirlinePassengerDetail(),e.confirm=function(){var t={destination_unique_id:e.changedAirlineDetail.flight_unique_id,flight_class:e.changedAirlineDetail.flight_class};i.confirmReschedule(t).then(function(e){console.log("Response of confirm Reschedule : ",e)},function(e){a.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}):t.history.back()}]),a.module("esewaPaymentApp").controller("ARSearchController",["$scope","$rootScope","ARService","ARDataFactory",function(e,t,a,n){function i(t){return e.sectors[t]}console.log("Airline Reschedule Controller initialize successfully"),e.reschedule={},e.showResult=!1,e.airline_reservation={},e.airline_flight_detail={},e.airline_passenger_detail={},e.airline_id="",t.reschedularTimerShow=!1,a.getSector().then(function(t){e.sectors=t.plain()}),e.searchPnr=function(o){var r=o.pnr_no,s={airline_code:o.airline_code,last_name:o.last_name};a.searchBookedTicket(r,s).then(function(t){e.showResult=!0;var a,o=t.plain();a=o,e.airline_reservation={pnr_number:a.airline_reservation.pnr_number,contact_name:a.airline_reservation.contact_name,contact_number:a.airline_reservation.contact_number,contact_email:a.airline_reservation.contact_email},e.airline_flight_detail={flight_no:a.airline_flight_detail.flights[0].flight_no,flight_date:a.airline_flight_detail.flights[0].flight_date,flight_time:a.airline_flight_detail.flights[0].flight_time,flight_class:a.airline_flight_detail.flights[0].flight_class,sectors:a.airline_flight_detail.flights[0].sector,departure:i(a.airline_flight_detail.flights[0].sector.split("-")[0]),arrival:i(a.airline_flight_detail.flights[0].sector.split("-")[1])},e.airline_passenger_detail={passengers:a.airline_passenger_detail.passengers},e.airline_id=a.airline_id,n.setAirlineFlightDetail(e.airline_flight_detail),n.setAirlinePassengerDetail(e.airline_passenger_detail),n.setAirlineReservationDetail(e.airline_reservation),n.setAirlineId(e.airline_id)},function(a){e.showResult=!1,t.showErrorSuccessMessage(a,!0,"ERROR_ON_SERVING_REQUEST")})}}]),a.module("esewaPaymentApp").controller("ARSearchResultController",["$scope","$rootScope","$state","ARDataFactory","ARService","$filter",function(e,a,n,i,o,r){i.getAirlineId()?(a.reschedularTimerShow=!1,e.availableAirlines={},e.initialDate={},e.minDate=moment(),e.showPassengerInfo=!0,e.initialDate.dateVariable=moment(),e.airline_reservation=i.getAirlineReservationDetail(),e.airline_flight_detail=i.getAirlineFlightDetail(),e.airline_passenger_detail=i.getAirlinePassengerDetail(),e.airline_id=i.getAirlineId(),e.searchedDate="",e.findFlight=function(){e.searchedDate=r("date")(e.initialDate.dateVariable.toDate(),"yyyy-MM-dd");var t={revised_flight_date:e.searchedDate};o.rescheduleBooking(t).then(function(t){e.availableAirlines=t.plain(),e.showPassengerInfo=!1},function(t){e.showPassengerInfo=!1,a.showErrorSuccessMessage(errorResponse,!0,"ERROR_ON_SERVING_REQUEST")})},e.bookFlight=function(e){i.setChangedAirlineDetail(e),a.goToState("airline_reschedule_confirm")}):t.history.back()}]),a.module("esewaPaymentApp").controller("AbstractRescheduleController",["$scope","ARService",function(e,t){e.airlineProductList=[],t.getAirlineList().then(function(t){e.airlineProductList=t.plain()},function(e){})}]),a.module("esewaPaymentApp").service("ARService",["Restangular",function(e){var t=e.all("auth/airlines/manage_booking");this.getAirlineList=function(){return e.all("airlines/products").customGET()},this.getSector=function(){return e.all("airlines").one("sector").get()},this.searchBookedTicket=function(e,a){return t.one(""+e).one("search_booking").customGET("",a)},this.rescheduleBooking=function(e){return t.one("reschedule_booking").customPOST("","",e)},this.confirmReschedule=function(e){return t.one("confirm_reschedule").customPOST("","",e)}}]),a.module("esewaPaymentApp").factory("ARDataFactory",[function(){var e={},t={},a={},n="",i="";return{getAirlineReservationDetail:function(){return e},setAirlineReservationDetail:function(t){e=t},getAirlineFlightDetail:function(){return t},setAirlineFlightDetail:function(e){t=e},getAirlinePassengerDetail:function(){return a},setAirlinePassengerDetail:function(e){a=e},getAirlineId:function(){return n},setAirlineId:function(e){n=e},getChangedAirlineDetail:function(){return i},setChangedAirlineDetail:function(e){i=e}}}]),a.module("esewaPaymentApp").factory("AirlineBookingInfoFactory",[function(){var e="",t={},a={},n={},i={},o=[];return{getBookingId:function(){return e},setBookingId:function(t){e=t},setSearchParamsInfo:function(e){t=e},getSearchParamsInfo:function(){return t},setOutboundFlightDetail:function(e){a=e},getOutboundFlightDetail:function(){return a},setInboundFlightDetail:function(e){n=e},getInboundFlightDetail:function(){return n},setPaymentSuccessResponse:function(e){i=e},getPaymentSuccessResponse:function(){return i},setPassengerIdList:function(e){o=e||[]},getPessengerIdList:function(){return o}}}]),a.module("esewaPaymentApp").service("AirlineUtilService",[function(){this.airSearchParams={origin:"",destination:"",no_of_adult:1,no_of_child:0,flight_date:"",return_date:"",trip_type:"O"}}]),a.module("esewaPaymentApp").controller("AbstractAirlineController",["$scope","$rootScope","AirlineService",function(e,t,a){e.airlineInitialValue={sectors:[]},a.getSector().then(function(t){e.airlineInitialValue.sectors=function(e){var t=[];for(var a in e){var n={key:"",value:""};n.key=a,n.value=e[n.key],t.push(n)}return t.sort(function(e,t){return e.value>t.value?1:t.value>e.value?-1:0}),t}(t.plain()),e.sectorsLoading=!!e.airlineInitialValue.sectors},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}]),a.module("esewaPaymentApp").controller("AbstractAirlineMyFlightsController",["$scope","$rootScope",function(e,t){}]),a.module("esewaPaymentApp").controller("AirlineBookingController",["$scope","$rootScope","AirlineBookingInfoFactory","AirlineService","$window","$interval","$modal","CDNUrl","AUTH_EVENTS","MerchantPaymentService","PropertyConstant","$filter","DirectDebitService","StateConstant","$state","ecmsg","PaymentConstant",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g,_,y,S){var D;e.isConfirmationPage=!1,e.defaultPaymentLabelText=S.WALLET_LABEL,e.otherPaymentLabelText=S.OTHER_PAYMENT_LABEL,e.miscScope={promoCodeRewards:"",resetPromoCode:"",confirmButtonText:e.defaultPaymentLabelText,selectedBankAccountDetails:{},totalPayableAmount:"",product:"Airline"},o.getBookingId()||t.history.back(),e.outboundFlightDetail=o.getOutboundFlightDetail(),e.inboundFlightDetail=o.getInboundFlightDetail(),e.noOfAdult=o.getSearchParamsInfo().no_of_adult,e.noOfChild=o.getSearchParamsInfo().no_of_child,e.adultPassengerInfoObj=[],e.childPassengerInfoObj=[],e.airlineBooking={remainingTime:600},e.totalAdultFare=e.inboundFlightDetail.adult_fare?1*e.outboundFlightDetail.adult_fare+1*e.outboundFlightDetail.fuel_surcharge+1*e.inboundFlightDetail.adult_fare+1*e.inboundFlightDetail.fuel_surcharge:1*e.outboundFlightDetail.adult_fare+1*e.outboundFlightDetail.fuel_surcharge,e.totalChildFare=e.inboundFlightDetail.child_fare?1*e.outboundFlightDetail.child_fare+1*e.outboundFlightDetail.fuel_surcharge+1*e.inboundFlightDetail.child_fare+1*e.inboundFlightDetail.fuel_surcharge:1*e.outboundFlightDetail.child_fare+1*e.outboundFlightDetail.fuel_surcharge,e.totalTax=e.inboundFlightDetail.tax?1*e.inboundFlightDetail.tax+1*e.outboundFlightDetail.tax:1*e.outboundFlightDetail.tax,e.totalCashBack=e.inboundFlightDetail.cashback?1*e.inboundFlightDetail.cashback+1*e.outboundFlightDetail.cashback:1*e.outboundFlightDetail.cashback,e.totalPayableAmount=e.inboundFlightDetail.total_amount?1*e.inboundFlightDetail.total_amount+1*e.outboundFlightDetail.total_amount:1*e.outboundFlightDetail.total_amount,e.totalRewardPoint=e.inboundFlightDetail.reward_point?1*e.inboundFlightDetail.reward_point+1*e.outboundFlightDetail.reward_point:1*e.outboundFlightDetail.reward_point,e.flightDetails={outboundSector:e.outboundFlightDetail.departure_place+"-"+e.outboundFlightDetail.arrival_place,outboundFlightClass:e.outboundFlightDetail.flight_class_code,totalPax:parseInt(e.noOfAdult,10)+parseInt(e.noOfChild,10)},a.isDefined(e.inboundFlightDetail.flight_id)&&(e.flightDetails.inboundSector=e.inboundFlightDetail.departure_place+"-"+e.inboundFlightDetail.arrival_place,e.flightDetails.inboundFlightClass=e.inboundFlightDetail.flight_class_code,e.flightDetails.inbound="true"),e.changeFlight=function(){t.history.back()},e.getFlightDetail=function(t,a,n){e.showDoubleInfo=a,e.modalSecondRowData={},e.modalFirstRowData=t,a&&(e.modalSecondRowData=n),e.$modalInstance=l.open({templateUrl:u.url+"/html/airline/airline_detail_modal.html",scope:e})},e.close=function(){e.$modalInstance.dismiss("cancel")};for(var R=0;R<e.noOfAdult;R++){e.adultPassengerInfoObj.push({passenger_type:"ADULT",title:"",gender:"",full_name:"",nationality:"",passenger_remarks:"",passenger_id:""})}for(var b=0;b<e.noOfChild;b++){e.childPassengerInfoObj.push({passenger_type:"CHILD",title:"",gender:"",full_name:"",nationality:"",passenger_remarks:"",passenger_id:""})}function A(){s.scrollTo({top:0,behavior:"smooth"})}function T(t,a,n){e.$modalInstance=l.open({templateUrl:u.url+"/html/airline/withdraw_confirmation_modal_3.48.0.0.html",controller:"WithdrawConfirmationModalController",size:"lg",backdrop:"static",keyboard:!1,scope:e,resolve:{booking_id:function(){return t},isDirectLoadSuccess:function(){return a},errorResponse:function(){return n},stateToReturnOnWithdrawFail:function(){return{state:g.AIRLINES_NEWSEARCH}}}})}e.getSelfInfo=function(t){t&&r.getLoggedInUserInfo().then(function(t){e.airlinePaymentPayload.contact_name=t.name,e.airlinePaymentPayload.contact_email=t.email,e.airlinePaymentPayload.contact_mobile=t.mobile_number,e.adultPassengerInfoObj[0]={passenger_type:"ADULT",title:"M"==t.gender?"Mr.":"Mrs.",gender:t.gender,full_name:t.name,nationality:"Nepal"}})},e.airlinePaymentPayload={booking_uuid:o.getBookingId(),contact_name:"",contact_email:"",contact_mobile:"",passengers:[]},e.stop=function(){c.cancel(D)},e.stop(),D=c(function(){if(0===e.airlineBooking.remainingTime)return c.cancel(D),void t.history.back();e.airlineBooking.remainingTime--},1e3),e.$on("$destroy",function(){e.stop()}),e.showConfirmationPage=function(){for(var t=0;t<e.adultPassengerInfoObj.length;t++)e.checkDuplicate=f("filter")(e.airlinePaymentPayload.passengers,{$$hashKey:e.adultPassengerInfoObj[t].$$hashKey},!0),a.isDefined(e.checkDuplicate)&&0===e.checkDuplicate.length&&(e.adultObj={$$hashKey:e.adultPassengerInfoObj[t].$$hashKey,first_name:e.adultPassengerInfoObj[t].full_name.split(" ")[0],last_name:e.adultPassengerInfoObj[t].full_name.split(" ")[2]!==n?e.adultPassengerInfoObj[t].full_name.split(" ")[1].concat(" "+e.adultPassengerInfoObj[t].full_name.split(" ")[2]):e.adultPassengerInfoObj[t].full_name.split(" ")[1],gender:e.adultPassengerInfoObj[t].gender,nationality:e.adultPassengerInfoObj[t].nationality,passenger_type:e.adultPassengerInfoObj[t].passenger_type,title:e.adultPassengerInfoObj[t].title},e.airlinePaymentPayload.passengers.push(e.adultObj));for(var o=0;o<e.childPassengerInfoObj.length;o++)e.checkDuplicate=f("filter")(e.airlinePaymentPayload.passengers,{$$hashKey:e.childPassengerInfoObj[o].$$hashKey},!0),a.isDefined(e.checkDuplicate)&&0===e.checkDuplicate.length&&(e.childObj={$$hashKey:e.childPassengerInfoObj[o].$$hashKey,first_name:e.childPassengerInfoObj[o].full_name.split(" ")[0],last_name:e.childPassengerInfoObj[o].full_name.split(" ")[2]!==n?e.childPassengerInfoObj[o].full_name.split(" ")[1].concat(" "+e.childPassengerInfoObj[o].full_name.split(" ")[2]):e.childPassengerInfoObj[o].full_name.split(" ")[1],gender:e.childPassengerInfoObj[o].gender,nationality:e.childPassengerInfoObj[o].nationality,passenger_type:e.childPassengerInfoObj[o].passenger_type,title:e.childPassengerInfoObj[o].title},e.airlinePaymentPayload.passengers.push(e.childObj));e.isConfirmationPage=!0,A(),i.flightDetailsLoading=!0,e.miscScope.totalPayableAmount=e.totalPayableAmount,e.miscScope.productCode=e.outboundFlightDetail.airline_code,e.isDirectDebitEnabled=!1,e.miscScope.confirmButtonText=e.defaultPaymentLabelText;var r={product_code:e.miscScope.productCode,amount:e.miscScope.totalPayableAmount};h.getProductPaymentOptions(r).then(function(t){var a=t.plain();e.miscScope.paymentOptionsResponse=a,Array.isArray(a)&&(e.isDirectDebitEnabled=a[1].enabled)}).finally(function(){i.flightDetailsLoading=!1})},e.goBack=function(){e.isConfirmationPage=!1,e.miscScope.totalPayableAmount>i.userBalance.balance-i.userBalance.lienBalance?e.miscScope.confirmButtonText=e.otherPaymentLabelText:e.miscScope.confirmButtonText=e.defaultPaymentLabelText},e.showPaymentBreakdown=function(){e.$modalInstance=l.open({templateUrl:u.url+"/html/airline/payment_breakdown_modal.html",scope:e})},e.mpinVerification=function(t){t&&(e.mpinFn=t)},e.credentialInput="",e.$on("onConfirmation",function(t,o){A(),e.paymentFailureMessage=[{id:1,isSelected:!1,labelText:"Keep in my eSewa Wallet"},{id:2,isSelected:!1,labelText:"Withdraw back to my bank account"}],e.credentialInput=o;var r=e.miscScope.selectedBankAccountDetails,s={product_code:e.miscScope.productCode,source_bank_swift_code:r.swift_code,amount:e.miscScope.totalPayableAmount,unique_id:r.unique_id};i.flightDetailsLoading=!0,h.performDirectLoad(s,e.credentialInput).then(function(t){var a=t.plain();i.flightDetailsLoading=!1,e.credentialInput="",0===t.code?(e.airlinePaymentPayload.hasOwnProperty("properties")?e.airlinePaymentPayload.properties.directDebitBookingId=a.booking_id:e.airlinePaymentPayload.properties={directDebitBookingId:a.booking_id},i.$broadcast(d.getBalanceAndRewards),e.makePayment(t.load_transaction_id)):T(n,!1,a)},function(e){i.flightDetailsLoading=!1,a.isDefined(e.data.error_message)?i.showErrorSuccessMessage(e,!0,"INVALID"):T(n,!1,e)})}),e.makePayment=function(t){for(var n=o.getPessengerIdList(),s=0;s<e.airlinePaymentPayload.passengers.length;s++)e.airlinePaymentPayload.passengers[s].passenger_id=n[s]?n[s]:"";a.isDefined(e.miscScope.promoCodeRewards.cashback||e.miscScope.promoCodeRewards.reward_point)&&(e.airlinePaymentPayload.hasOwnProperty("properties")?(e.airlinePaymentPayload.properties.promo_code=e.flightDetails.promo_code||"",e.airlinePaymentPayload.properties.booking_uuid=e.flightDetails.booking_uuid||""):e.airlinePaymentPayload.properties={promo_code:e.flightDetails.promo_code||"",booking_uuid:e.flightDetails.booking_uuid||""}),i.flightDetailsLoading=!0,r.makeAirlinePayment(e.airlinePaymentPayload).then(function(e){i.flightDetailsLoading=!1,i.$broadcast(d.getBalanceAndRewards),o.setPaymentSuccessResponse(e.plain()),i.goToState("airline.transactionDetail",{txnCode:e.plain().airline_flights[0].transaction_code})},function(n){i.flightDetailsLoading=!1,601===n.code||a.isDefined(n.data)&&601==n.data.code?(e.miscScope.transaction_code=t,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(n.data)&&(n=n.data),T(e.airlinePaymentPayload.properties.directDebitBookingId,!0,n)):i.showErrorSuccessMessage(n,!0,"TICKET_BOOKING_FAILED")})},e.isBankSelected=function(){return!(!a.isDefined(e.miscScope.selectedBankAccountDetails)||!a.isDefined(e.miscScope.selectedBankAccountDetails.swift_code))}}]),a.module("esewaPaymentApp").controller("NewAirlineController",["$scope",function(e){}]),a.module("esewaPaymentApp").controller("AirlineFlightStatusController",["$scope","$rootScope","AirlineService","FlightStatusAirlinesConstant","FlightStatusConstant",function(e,t,n,i,o){function r(){e.airlineFlightListLoading=!0,e.airlineFlightList=[],n.getFlightStatus(e.airlineSearchParams).then(function(t){e.airlineFlightList=e.airlineSearchParams.flightNo?t.filter(t=>t.flight_no.toLowerCase().includes(e.airlineSearchParams.flightNo.toLowerCase())):t},function(e){t.showErrorSuccessMessage(e,!0,"ERROR",!0)}).finally(function(){e.airlineFlightListLoading=!1})}e.isFlightSearched=!1,e.airlineFlightListLoading=!1,e.flightSearchForm={},e.airlineSearchParams={},e.airlineFilterList=i,e.airlineSearchParams.selectedAirLine=e.airlineFilterList[0].value,e.airlineFlightList=[],e.flightStatus=o,e.searchFlights=function(){e.isFlightSearched=!0,r()},e.updateSelectedAirline=function(t){e.airlineSearchParams.selectedAirLine=t,r()},e.openOriginSelect=function(e){e.stopPropagation(),setTimeout(()=>{a.element("#originSelect").find("a").trigger("click")},0)},e.openDestinationSelect=function(e){e.stopPropagation(),setTimeout(()=>{a.element("#destinationSelect").find("a").trigger("click")},0)}}]),a.module("esewaPaymentApp").controller("AirlineListController",["$scope","$rootScope","$stateParams","AirlineService","AirlineBookingInfoFactory","$filter","$window","$modal","CDNUrl","DirectDebitService","PropertyConstant",function(e,t,n,i,o,r,s,c,l,u,d){function m(e){for(var t=e,a=0;a<e.length;a++)t[a].isSelected=!1,t[a].date=(new Date).getTime();return t}function p(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].total_amount);return t}function f(){t.clearMessage(),e.flighBookingPayload.flight_resources=[];(new Date).getTime();o.setSearchParamsInfo(e.airlineSearchParams),i.getAvailableAirlines(e.airlineSearchParams).then(function(t){e.airlineInit.isOneWay="M"==e.airlineSearchParams.trip_type?"O":e.airlineSearchParams.trip_type,"KTM"==e.airlineSearchParams.origin&&"MTN"==e.airlineSearchParams.destination&&(e.airlineSearchParams.trip_type="M",e.oneWayLoader=!!e.airlineSearchParams.trip_type),e.selectedOutboundFlight={},e.selectedInboundFlight={};var n=t.plain();if(a.isDefined(n.message))e.searchedOutboundFlight=[],e.searchedInboundFlight=[];else{var i=[],o=[];e.flighBookingPayload.booking_uuid=n.booking_uuid;for(var r=0;r<n.flight_schedule_resources.length;r++)n.flight_schedule_resources[r].inbound?(e.searchedInboundFlight=m(n.flight_schedule_resources[r].flight_schedules),o=p(e.searchedInboundFlight),e.oneWayLoader=!0,e.twoWayLoader=!!e.searchedInboundFlight):(e.searchedOutboundFlight=m(n.flight_schedule_resources[r].flight_schedules),i=p(e.searchedOutboundFlight),e.twoWayLoader=!0,e.oneWayLoader=!!e.searchedOutboundFlight);e.maxOutboundPrice=Math.max.apply(null,i),e.minOutboundPrice=Math.min.apply(null,i),o.length&&(e.minInboundPrice=Math.min.apply(null,o),e.maxInboundPrice=Math.max.apply(null,o))}},function(a){e.airlineInit.isOneWay="M"==e.airlineSearchParams.trip_type?"O":e.airlineSearchParams.trip_type,e.searchedInboundFlight=[],e.searchedOutboundFlight=[],"KTM"==e.airlineSearchParams.origin&&"MTN"==e.airlineSearchParams.destination&&(e.airlineSearchParams.trip_type="M",e.twoWayLoader=!0,e.oneWayLoader=!!e.airlineSearchParams.trip_type),t.showErrorSuccessMessage(a,!0,"ERROR_ON_SERVING_REQUEST"),e.oneWayLoader=!0,e.twoWayLoader=!0})}function h(t,a){t?o.setInboundFlightDetail(a):o.setOutboundFlightDetail(a);for(var n=0;n<e.flighBookingPayload.flight_resources.length;n++)e.flighBookingPayload.flight_resources[n].inbound==t&&e.flighBookingPayload.flight_resources.splice(n,1);e.loadbtn=!0,e.flighBookingPayload.flight_resources.push({inbound:t,flight_id:a.flight_id})}e.airlineSearchParams=n,e.airMinDate=moment(),e.searchedInboundFlight=[],e.searchedOutboundFlight=[],e.airlineTemplateVariable={},e.airlineTemplateVariable.btnName="Modify Search",e.flighBookingPayload={booking_uuid:"",flight_resources:[],check_balance:!0},e.isList=!0,e.airlineInit={},e.setInitials=function(){o.setSearchParamsInfo(e.airlineSearchParams),e.airlineInit.isSingleDatePicker="R"!=e.airlineSearchParams.trip_type,e.airlineInit.isSingleDatePicker?e.airlineInit.dateVariable=moment(e.airlineSearchParams.flight_date):e.airlineInit.dateVariable={startDate:n.flight_date?n.flight_date:moment(),endDate:n.return_date?n.return_date:moment(n.flight_date).add(1,"days")}},e.datePickerSetup=function(){switch(e.airlineSearchParams.trip_type){case"O":e.airlineSearchParams.origin="",e.airlineSearchParams.destination="",e.airlineSearchParams.trip_type="O",o.setSearchParamsInfo(e.airlineSearchParams);break;case"R":e.airlineSearchParams.origin="",e.airlineSearchParams.destination="",e.airlineSearchParams.trip_type="R",o.setSearchParamsInfo(e.airlineSearchParams);break;case"M":e.airlineSearchParams.origin="KTM",e.airlineSearchParams.destination="MTN",e.airlineSearchParams.trip_type="M",o.setSearchParamsInfo(e.airlineSearchParams)}e.airlineInit.isSingleDatePicker="R"!=e.airlineSearchParams.trip_type,e.airlineInit.isSingleDatePicker?e.airlineInit.dateVariable=moment(e.airlineSearchParams.flight_date):e.airlineInit.dateVariable={startDate:n.flight_date?n.flight_date:moment(),endDate:n.return_date?n.return_date:moment(n.flight_date).add(1,"days")}},e.setInitials(),e.setAdultNo=function(t){e.airlineSearchParams.no_of_adult!=t?e.airlineSearchParams.no_of_adult=t:e.airlineSearchParams.no_of_adult=0},e.setChildNo=function(t){e.airlineSearchParams.no_of_child!=t?e.airlineSearchParams.no_of_child=t:e.airlineSearchParams.no_of_child=0},e.searchFlight=function(){"R"==e.airlineSearchParams.trip_type?(e.twoWayLoader=!e.airlineSearchParams.flight_date,e.oneWayLoader=!1,e.airlineSearchParams.flight_date=r("date")(new Date(e.airlineInit.dateVariable.startDate),"yyyy-MM-dd"),e.airlineSearchParams.return_date=r("date")(new Date(e.airlineInit.dateVariable.endDate),"yyyy-MM-dd")):(e.airlineSearchParams.flight_date=r("date")(e.airlineInit.dateVariable.toDate(),"yyyy-MM-dd"),e.airlineSearchParams.return_date="",e.oneWayLoader=!e.airlineSearchParams.flight_date,e.twoWayLoader=!1),f()},e.searchedOutBoundMinMaxPrice={},e.addSubSearchedDate=function(){e.airlineInit.dateVariable.startDate=moment(e.airlineInit.dateVariable.startDate).add(1,"days").format("YYYY-MM-DD"),e.searchFlightList()},f(),e.toggleSortViewName="",e.toggleDropDown=function(t){e.toggleSortViewName=e.toggleSortViewName==t?"":t},e.sortByFactor=function(t,a){e.toggleSortViewName="",t?e.outboundSortFactor=a:e.inboundSortFactor=a},e.showFlightDetail=function(t,a){e.showDoubleInfo=a,e.modalFirstRowData=t,e.$modalInstance=c.open({templateUrl:l.url+"/html/airline/airline_detail_modal.html",scope:e})},e.close=function(){e.$modalInstance.dismiss("cancel")},e.selectedFlightIndex="",e.selectedOutboundFlight={},e.selectedInboundFlight={},e.selectFlight=function(t,a,n,i){i?(e.selectedInboundFlight=a,e.searchedInboundFlight=m(e.searchedInboundFlight),e.searchedInboundFlight[n].isSelected=!0):(e.selectedOutboundFlight=a,e.searchedOutboundFlight=m(e.searchedOutboundFlight),e.searchedOutboundFlight[n].isSelected=!0),s.scrollTo({top:0,behavior:"smooth"}),h(t,a)},e.triggerReturnFlight=function(){a.element(".returnFlight").trigger("click")},e.triggerDepatureFlight=function(){a.element(".depatureFlight").trigger("click")},e.swapSector=function(){var t=e.airlineSearchParams.origin;e.airlineSearchParams.origin=e.airlineSearchParams.destination,e.airlineSearchParams.destination=t},e.bookFlight=function(a,n,r,s){var d=r?r.total_amount:e.selectedOutboundFlight.total_amount+e.selectedInboundFlight.total_amount,m=r?r.airline_code:e.selectedOutboundFlight.airline_code;t.handleMiniLoadingBar(s,!0),t.disableSubmit=!0,u.validateBalance(m,d).then(function(u){var d=u.plain();0===d.code?(a&&(o.setInboundFlightDetail({}),h(n,r)),e.flighBookingPayload.check_balance=!0,i.bookFlight(e.flighBookingPayload,"direct_debit_confirmation_button").then(function(e){t.handleMiniLoadingBar(s,!1),o.setBookingId(e.booking_uuid),o.setPassengerIdList(e.passenger_ids),t.goToState("airline.booking")},function(e){t.handleMiniLoadingBar(s,!1),t.showErrorSuccessMessage(e,!0,"INSUFFICIENT_BALANCE",!0)})):(t.handleMiniLoadingBar(s,!1),e.$modalInstance=c.open({templateUrl:l.url+"/html/airline/confirmation_modal_3.38.0.0.html",controller:g,size:"md",scope:e,resolve:{isOneWay:function(){return a},inboundStatus:function(){return n},flightDetail:function(){return r},message:function(){return d.message}}}))},function(e){t.showErrorSuccessMessage(e,!0,"INSUFFICIENT_BALANCE"),t.handleMiniLoadingBar(s,!1)})};var g=["$scope","$rootScope","$modalInstance","isOneWay","inboundStatus","flightDetail","message",function(e,t,a,n,r,s,c){e.isOneWay=n,e.inboundStatus=r,e.flightDetail=s,e.message=c,e.cancelConfirmation=function(){a.dismiss()},t.currentModal=a,e.bookFlightWithDirectDebit=function(n,r,s,c){c?(n&&(o.setInboundFlightDetail({}),h(r,s)),e.flighBookingPayload.check_balance=!1,e.disableButton=!0,i.bookFlight(e.flighBookingPayload).then(function(e){a.dismiss(),o.setBookingId(e.booking_uuid),o.setPassengerIdList(e.passenger_ids),t.goToState("airline.booking")},function(e){a.dismiss(),t.showErrorSuccessMessage(e,!0,"INSUFFICIENT_BALANCE",!0)}).finally(function(){e.disableButton=!1})):e.cancelConfirmation()}}]}]),a.module("esewaPaymentApp").controller("AirlineMyFlightRescheduleController",["$scope","$rootScope","$state","$stateParams","$filter","$modal","AirlineBookingInfoFactory","AirlineService","DirectDebitService","MyFlightConstant","PassengerTypeConstant","CDNUrl","AirlineActionConstant",function(e,t,a,n,i,o,r,s,c,l,u,d,m){e.productCodes=m,e.airlineSearchParams={},e.rescheduleSearchLoading=!1,e.no_of_adult=0,e.no_of_child=0,e.initialize=function(){n.ticketDetails?(e.ticketDetails=n.ticketDetails,e.selectedPassengers=n.selectedPassengers,e.airlineFilter={dateVariable:moment().add(1,"days")},e.airlineSearchParams.origin=e.ticketDetails.flight_detail.origin_sector.code,e.airlineSearchParams.destination=e.ticketDetails.flight_detail.destination_sector.code,e.today=moment(),e.isFlightSearched=!1,e.rescheduleFlights=[]):n.flightStatus===l.PAST_FLIGHT?t.goToState("airline.myFlights.pastFlights"):t.goToState("airline.myFlights.upcomingFlights")},e.searchFlight=function(){e.isFlightSearched=!0,e.rescheduleSearchLoading=!0;const a={ticket_numbers:e.selectedPassengers.map(e=>e.ticket_no),revised_flight_date:i("date")(e.airlineFilter.dateVariable.toDate(),"yyyy-MM-dd"),pnr_number:e.ticketDetails.flight_detail.pnr_number,airline_id:e.ticketDetails.flight_detail.airline_id,confirmed_flight_id:e.ticketDetails.confirmed_flight_id};s.getRescheduleBookings(a).then(function(t){e.rescheduleData=t,e.rescheduleFlights=t.reschedulable_flights.flight_details||[],e.rescheduleFlights.forEach(e=>{e.charge_total=1*e.charge_total,e.charge_per_pax=1*e.charge_per_pax});let a=e.rescheduleFlights.map(e=>e.charge_total);e.maxPrice=Math.max.apply(null,a),e.minPrice=Math.min.apply(null,a),e.no_of_adult=0,e.no_of_child=0,e.rescheduleData.tickets_selected.tickets.forEach(t=>{let a=e.rescheduleData.booking_detail.passenger_detail.passengers.find(e=>e.ticket_no===t);a&&a.pax_type===u.ADULT?e.no_of_adult++:a&&a.pax_type===u.CHILD&&e.no_of_child++})},function(a){401!==a.status||403!==a.status?o.open({templateUrl:d.url+"/html/airline/my-flights/airline_offline_reschedule_modal.html",controller:"AirlineOfflineRescheduleModalController",backdrop:"static",size:"md",resolve:{productCode:function(){return e.productCodes.reschedule},airlineName:function(){return e.ticketDetails.flight_detail.airline_name},message:function(){return"We regret to inform you that there are currently no flight options available for rescheduling. Please fill in the form provided for further assistance."}}}):t.showErrorSuccessMessage(a,!0,"ERROR",!0)}).finally(function(){e.rescheduleSearchLoading=!1})},e.rescheduleFight=function(a,i){const r=a.charge_total,l=a.product_code;t.handleMiniLoadingBar(i,!0),t.disableSubmit=!0,c.validateBalance(l,r).then(function(r){const c=r.plain();if(0===c.code){const o={destination_unique_id:a.new_unid,flight_class:a.new_class_code};s.bookRescheduleFlight(o).then(function(){t.handleMiniLoadingBar(i,!1),t.goToState("airline.rescheduleConfirmation",{rescheduleData:e.rescheduleData,selectedFlight:a,ticketDetails:e.ticketDetails,flightStatus:n.flightStatus})},function(e){t.handleMiniLoadingBar(i,!1),t.showErrorSuccessMessage(e,!0,"INSUFFICIENT_BALANCE",!0)})}else t.handleMiniLoadingBar(i,!1),function(t,a){e.$modalInstance=o.open({templateUrl:d.url+"/html/airline/confirmation_modal_3.38.0.0.html",controller:p,size:"md",scope:e,resolve:{rescheduleData:function(){return e.rescheduleData},ticketDetails:function(){return e.ticketDetails},flightStatus:function(){return n.flightStatus},flightDetail:function(){return t},message:function(){return a.message}}})}(a,c)},function(e){t.showErrorSuccessMessage(e,!0,"INSUFFICIENT_BALANCE"),t.handleMiniLoadingBar(i,!1)})},e.toggleSortViewName="",e.toggleDropDown=function(t){e.toggleSortViewName=e.toggleSortViewName==t?"":t},e.sortByFactor=function(t){e.toggleSortViewName="",e.sortFactor=t},e.showFlightDetail=function(t){e.modalFirstRowData=Object.assign(t,{reschedule_ticket:!0,flight_class_code:t.new_class_code,flight_number:t.flight_no,departure_place:t.departure,arrival_place:t.arrival,no_of_adult:e.no_of_adult,no_of_child:e.no_of_child}),e.$modalInstance=o.open({templateUrl:d.url+"/html/airline/airline_detail_modal.html",scope:e})},e.close=function(){e.$modalInstance.dismiss("cancel")};const p=["$scope","$rootScope","$modalInstance","rescheduleData","ticketDetails","flightStatus","flightDetail","message",function(e,t,a,i,o,r,c,l){e.rescheduleData=i,e.ticketDetails=o,e.flightStatus=r,e.flightDetail=c,e.message=l,e.isOneWay=!0,e.inboundStatus=!1,e.cancelConfirmation=function(){a.dismiss()},t.currentModal=a,e.bookFlightWithDirectDebit=function(i,o,r,c){if(c){e.disableButton=!0;const i={destination_unique_id:r.new_unid,flight_class:r.new_class_code};s.bookRescheduleFlight(i).then(function(){a.dismiss(),t.goToState("airline.rescheduleConfirmation",{rescheduleData:e.rescheduleData,selectedFlight:r,ticketDetails:e.ticketDetails,flightStatus:n.flightStatus})},function(e){a.dismiss(),t.showErrorSuccessMessage(e,!0,"INSUFFICIENT_BALANCE",!0)}).finally(function(){e.disableButton=!1})}else e.cancelConfirmation()}}]}]),a.module("esewaPaymentApp").controller("AirlineMyTicketController",["$scope","$rootScope","$state","$filter","$modal","CDNUrl","MyFlightConstant","MyFlightActionFormStatusConstant","AirlineActionConstant","AirlineTicketStatusConstant","AirlinePlasmaCodeConstant",function(e,t,a,n,i,o,r,s,c,l,u){function d(){e.ticketDetails.flight_detail.passengers.forEach(e=>{delete e.isSelected}),e.selected.isAllSelected=!1}function m(){e.selected.selectedTicketNos=e.ticketDetails.flight_detail.passengers.filter(e=>e.isSelected).map(e=>e.ticket_no)}e.ticketDetails=e.ticketData,e.flightStatus=e.myFlightType,e.selected={isAllSelected:!1,selectedTicketNos:[]},e.myFlightTypes=r,e.productCodes=c,e.airlineTicketStatus=l,function(){const t=e.ticketDetails.flight_detail.passengers.filter(e=>e.ticket_status===l.COMPLETE);e.hasReschedulableTicket=t.length>0}(),e.changeContact=function(){a.go("merchant.makePayment",{product_code:e.productCodes.contactChange,product_name:e.ticketDetails.flight_detail.airline_name},{reload:!0})},e.nameCorrection=function(){a.go("merchant.makePayment",{product_code:e.productCodes.nameCorrection,product_name:e.ticketDetails.flight_detail.airline_name},{reload:!0})},e.cancel=function(){a.go("merchant.makePayment",{product_code:e.productCodes.cancellation,product_name:e.ticketDetails.flight_detail.airline_name},{reload:!0})},e.claimForRefund=function(){a.go("merchant.makePayment",{product_code:e.productCodes.refund,product_name:e.ticketDetails.flight_detail.airline_name},{reload:!0})},e.reschedule=function(){u.includes(e.ticketDetails.flight_detail.airline_id)&&e.flightStatus===r.UPCOMING_FLIGHT?e.ticketDetails.reschedule_preference===s.newForm?e.$modalInstance=i.open({templateUrl:o.url+"/html/airline/my-flights/reschedule_ticket_modal.html",scope:e}):i.open({templateUrl:o.url+"/html/airline/my-flights/airline_offline_reschedule_modal.html",controller:"AirlineOfflineRescheduleModalController",backdrop:"static",size:"md",resolve:{productCode:function(){return e.productCodes.reschedule},airlineName:function(){return e.ticketDetails.flight_detail.airline_name},message:function(){return'We deeply regret to inform you that flight booking is currently unavailable with less than 2 hours remaining until takeoff. For eSewa support, kindly click the "Ok" button to proceed with the support form.'}}}):a.go("merchant.makePayment",{product_code:e.productCodes.reschedule,product_name:e.ticketDetails.flight_detail.airline_name},{reload:!0})},e.close=function(){d(),e.selected.selectedTicketNos=[],e.$modalInstance.dismiss("cancel")},e.rescheduleConfirm=function(){const a=e.ticketDetails.flight_detail.passengers.filter(t=>e.selected.selectedTicketNos.includes(t.ticket_no));d(),t.goToState("airline.myTicketReschedule",{ticketDetails:e.ticketDetails,selectedPassengers:a,flightStatus:e.flightStatus})},e.toggleAllSelect=function(t){e.ticketDetails.flight_detail.passengers.forEach(e=>{e.ticket_status===l.COMPLETE&&(e.isSelected=t)}),m()},e.togglePassenger=function(){e.selected.isAllSelected=e.ticketDetails.flight_detail.passengers.every(e=>e.ticket_status!==l.COMPLETE||e.isSelected),m()}}]),a.module("esewaPaymentApp").controller("AirlineOfflineRescheduleModalController",["$scope","$state","$modalInstance","productCode","airlineName","message",function(e,t,a,n,i,o){e.message=o,e.closeDialog=function(){a.dismiss()},e.redirect=function(){t.go("merchant.makePayment",{product_code:n,product_name:i},{reload:!0}),e.closeDialog()}}]),a.module("esewaPaymentApp").controller("AirlinePastFlightsController",["$scope","$rootScope","$window","AirlineService","MyFlightConstant",function(e,t,a,n,i){function o(){let a={to_date:moment().format("YYYY-MM-DD"),page:e.page-1,size:e.size,sort:"flight_date,DESC",pnr_number:e.airlineTicketSearchText};e.flightListLoading=!0,n.getMyFlights(a).then(function(t){e.tickets=t},function(e){t.showErrorSuccessMessage(e,!0,"ERROR",!0)}).finally(function(){e.flightListLoading=!1})}e.flightListLoading=!1,e.page=1,e.size=10,e.myFlightType=i.PAST_FLIGHT,e.tickets=[],e.openedTicketIndex=0,e.search=function(){e.page=1,o()},o(),e.nextPage=function(t){e.page=t?e.page+1:e.page-1,o(),a.scrollTo({top:0,behavior:"smooth"})},e.toggleDetailView=function(t){e.openedTicketIndex=e.openedTicketIndex===t?-1:t}}]),a.module("esewaPaymentApp").controller("AirlineRescheduleConfirmationController",["$scope","$rootScope","$modal","$stateParams","$interval","$window","DirectDebitService","AirlineService","PaymentConstant","PassengerTypeConstant","AUTH_EVENTS","CDNUrl","MyFlightNationalityConstant","StateConstant",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g){if(r.rescheduleData&&r.selectedFlight){var _;e.flightDetail=r.selectedFlight,e.paymentData=r.rescheduleData.booking_detail.reservation,e.ticketDetails=r.ticketDetails,e.flightStatus=r.flightStatus,e.booking_uuid=r.booking_uuid,e.nationalityMap=h,e.selectedPassengers=[],r.rescheduleData.tickets_selected.tickets.forEach(t=>{let a=r.rescheduleData.booking_detail.passenger_detail.passengers.find(e=>e.ticket_no===t);a&&e.selectedPassengers.push(a)}),e.adultPassengers=e.selectedPassengers.filter(e=>e.pax_type===m.ADULT),e.childPassengers=e.selectedPassengers.filter(e=>e.pax_type===m.CHILD),e.defaultPaymentLabelText=d.WALLET_LABEL,e.otherPaymentLabelText=d.OTHER_PAYMENT_LABEL,e.miscScope={promoCodeRewards:"",resetPromoCode:"",confirmButtonText:e.defaultPaymentLabelText,selectedBankAccountDetails:{},totalPayableAmount:"",product:"Airline"},e.airlineBooking={remainingTime:600},i.flightDetailsLoading=!0,e.miscScope.productCode=e.flightDetail.product_code,e.miscScope.totalPayableAmount=e.flightDetail.charge_total,e.isDirectDebitEnabled=!1;var y={product_code:e.miscScope.productCode,amount:e.miscScope.totalPayableAmount};l.getProductPaymentOptions(y).then(function(t){var a=t.plain();e.miscScope.paymentOptionsResponse=a,Array.isArray(a)&&(e.isDirectDebitEnabled=a[1].enabled)}).finally(function(){i.flightDetailsLoading=!1}),e.stop=function(){s.cancel(_)},e.stop(),_=s(function(){if(0===e.airlineBooking.remainingTime)return s.cancel(_),void t.history.back();e.airlineBooking.remainingTime--},1e3),e.$on("$destroy",function(){e.stop()}),e.mpinVerification=function(t){t&&(e.mpinFn=t)},e.goBack=function(){i.goToState("airline.myTicketReschedule",{ticketDetails:e.ticketDetails,selectedPassengers:e.selectedPassengers,flightStatus:e.flightStatus})},e.showPaymentBreakdown=function(){e.$modalInstance=o.open({templateUrl:f.url+"/html/airline/my-flights/reschedule_payment_breakdown_modal.html",scope:e})},e.close=function(){e.$modalInstance.dismiss("cancel")},e.makePayment=function(t,n){const o={destination_unique_id:e.flightDetail.new_unid,flight_class:e.flightDetail.new_class_code,directDebitBookingId:n};i.flightDetailsLoading=!0,u.makeRescheduleAirlinePayment(o).then(function(e){i.flightDetailsLoading=!1,i.$broadcast(p.getBalanceAndRewards),i.goToState("airline.transactionDetail",{txnCode:e.plain().airline_flights[0].transaction_code})},function(n){i.flightDetailsLoading=!1,601===n.code||a.isDefined(n.data)&&601===n.data.code?(e.miscScope.transaction_code=t,e.miscScope.module_id=2,e.miscScope.transaction_version="v3",a.isDefined(n.data)&&(n=n.data),S(directdebitBookingId,!0,n)):i.showErrorSuccessMessage(n,!0,"TICKET_BOOKING_FAILED")})},e.isBankSelected=function(){return!(!a.isDefined(e.miscScope.selectedBankAccountDetails)||!a.isDefined(e.miscScope.selectedBankAccountDetails.swift_code))},e.credentialInput="",e.$on("onConfirmation",function(t,o){c.scrollTo({top:0,behavior:"smooth"}),e.paymentFailureMessage=[{id:1,isSelected:!1,labelText:"Keep in my eSewa Wallet"},{id:2,isSelected:!1,labelText:"Withdraw back to my bank account"}],e.credentialInput=o;const r=e.miscScope.selectedBankAccountDetails,s={product_code:e.miscScope.productCode,source_bank_swift_code:r.swift_code,amount:e.miscScope.totalPayableAmount,unique_id:r.unique_id};i.flightDetailsLoading=!0,l.performDirectLoad(s,e.credentialInput).then(function(t){const a=t.plain();if(i.flightDetailsLoading=!1,e.credentialInput="",0===t.code){let n=a.booking_id;i.$broadcast(p.getBalanceAndRewards),e.makePayment(t.load_transaction_id,n)}else S(n,!1,a)},function(e){i.flightDetailsLoading=!1,a.isDefined(e.data.error_message)?i.showErrorSuccessMessage(e,!0,"INVALID"):S(n,!1,e)})})}else i.goToState("airline.myFlights.upcomingFlights");function S(t,a,n){e.$modalInstance=o.open({templateUrl:f.url+"/html/airline/withdraw_confirmation_modal_3.48.0.0.html",controller:"WithdrawConfirmationModalController",size:"lg",backdrop:"static",keyboard:!1,scope:e,resolve:{booking_id:function(){return t},isDirectLoadSuccess:function(){return a},errorResponse:function(){return n},stateToReturnOnWithdrawFail:function(){return{state:g.AIRLINES_MY_FLIGHTS}}}})}}]),a.module("esewaPaymentApp").controller("AirlineSearchController",["$scope","$rootScope","AirlineUtilService","$filter","$stateParams","AirlineBookingInfoFactory","$http","CDNUrl","$timeout","AirlineService","$modal",function(e,t,n,i,o,r,s,c,l,u,d){e.airlineSearchParams=n.airSearchParams,e.airMinDate=moment(),e.airlineInit={},e.airlineInit.dateVariable=moment(),e.airlineTemplateVariable={},e.airlineTemplateVariable.btnName="Find Flight",e.swapSector=function(){var t=e.airlineSearchParams.origin;e.airlineSearchParams.origin=e.airlineSearchParams.destination,e.airlineSearchParams.destination=t},e.offer_img="https://cdn.esewa.com.np/ui/images/slider/4CmOqJ0VmzVD1ZAwdq9Pairlines-slider-min.png",e.isList=!1,s.get(c.url+"/data/airlineOffer.json").then(function(t){e.airlineOffer=t.data,e.airlineBannerLoader=!!e.airlineOffer},function(t){e.airlineOffer={},e.airlineBannerLoader=!1}),u.getOffers().then(function(t){e.superOffers=t.plain(),e.updateOfferList(e.superOffers),e.superOffersLoader=!!e.superOffers},function(t){e.superOffers=[],e.superOffersLoader=!1}),e.updateOfferList=function(e){e.length>0&&a.forEach(e,function(e,t){e.id=t})},e.datePickerSetup=function(){switch(e.airlineSearchParams.trip_type){case"O":e.airlineSearchParams=n.airSearchParams,e.airlineSearchParams.origin="",e.airlineSearchParams.destination="",e.airlineSearchParams.trip_type="O",r.setSearchParamsInfo(e.airlineSearchParams);break;case"R":e.airlineSearchParams=n.airSearchParams,e.airlineSearchParams.origin="",e.airlineSearchParams.destination="",e.airlineSearchParams.trip_type="R",r.setSearchParamsInfo(e.airlineSearchParams);break;case"M":e.airlineSearchParams=n.airSearchParams,e.airlineSearchParams.origin="KTM",e.airlineSearchParams.destination="MTN",e.airlineSearchParams.trip_type="M",r.setSearchParamsInfo(e.airlineSearchParams)}e.airlineInit.isSingleDatePicker="R"!=e.airlineSearchParams.trip_type,e.airlineInit.isSingleDatePicker?e.airlineInit.dateVariable=moment(o.flight_date):e.airlineInit.dateVariable={startDate:o.flight_date?o.flight_date:moment(),endDate:o.return_date?o.return_date:moment(o.flight_date).add(1,"days")}},e.copyToClipboard=function(t){e.superOffers.forEach(function(e){e.show=!1}),e.selectedItem=i("filter")(e.superOffers,{id:t})[0],e.selectedItem.show=!0,l(function(){e.selectedItem.show=!1},500)},e.openTermsAndCondition=function(t){e.$modalInstance=d.open({templateUrl:c.url+"/html/airline/airline_offers_terms_and_conditions_3.36.0.html",controller:m,size:"sm",backdrop:"static",resolve:{terms_conditions:function(){return t.terms_conditions}}})},e.$watch("$scope.airlineInit.dateVariable",function(){e.datePickerSetup()}),e.datePickerSetup(),e.noOfAdultSelected=1,e.setAdultNo=function(t){e.airlineSearchParams.no_of_adult!=t?e.airlineSearchParams.no_of_adult=t:e.airlineSearchParams.no_of_adult=0},e.setChildNo=function(t){e.airlineSearchParams.no_of_child!=t?e.airlineSearchParams.no_of_child=t:e.airlineSearchParams.no_of_child=0},e.searchFlight=function(){e.airlineInit.isSingleDatePicker?e.airlineSearchParams.flight_date=i("date")(e.airlineInit.dateVariable.toDate(),"yyyy-MM-dd"):(e.airlineSearchParams.flight_date=i("date")(e.airlineInit.dateVariable.startDate.toDate(),"yyyy-MM-dd"),e.airlineSearchParams.return_date=i("date")(e.airlineInit.dateVariable.endDate.toDate(),"yyyy-MM-dd")),t.goToState("airline.airline_list",e.airlineSearchParams)};var m=["$scope","$rootScope","$modalInstance","terms_conditions",function(e,t,a,n){e.terms_conditions=n||"",e.cancel=function(){a.dismiss()},t.currentModal=a}]}]),a.module("esewaPaymentApp").controller("AirlineTransactionDetailController",["$scope","$rootScope","AirlineService","$window","$stateParams","$http","CDNUrl","$modal","ecmsg",function(e,t,a,n,i,o,r,s,c){e.airlinePaymentDetail={};var l=i.txnCode;e.transactionCode=i.txnCode;var u=[];e.outboundTicketDetail={},e.inboundTicketDetail={},e.outboundPassengerList=[],e.inboundPassengerList=[],a.getTransactionDetail(l).then(function(t){e.airlinePaymentDetail=t,u=e.airlinePaymentDetail.airline_flights;for(var a=0;a<u.length;a++)u[a].inbound?(e.inboundTicketDetail=u[a],e.inboundPassengerList=u[a].passengers):(e.outboundTicketDetail=u[a],e.outboundPassengerList=u[a].passengers)},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST",!0)}),e.downloadAirTicket=function(e){o({url:"api/web/auth/transactions/"+e+"/pdf/airline/v2",method:"GET",responseType:"text",data:"",headers:{"Content-type":"text/plain"}}).success(function(e){e&&n.open(e,"_blank")}).error(function(e){t.showErrorSuccessMessage(errorResponse,!0,"ERROR_ON_SERVING_REQUEST",!0)})},e.sendNotification=function(t,a,n,i){e.openSendNotificationDialog(t,a,n,i)},e.openSendNotificationDialog=function(e,t,a,n){s.open({templateUrl:r.url+"/html/airline/send_notification_panel_3.36.0.html",controller:d,size:"md",backdrop:"static",resolve:{notificationId:function(){return t},type:function(){return e},txnCode:function(){return a},buyerName:function(){return n}}})};var d=["$scope","$rootScope","$modalInstance","notificationId","type","AirlineService","txnCode","ValidationService","ecmsg","buyerName",function(e,t,a,n,i,o,r,s,c,l){e.notificationId=n,e.type=i,e.txnCode=r,e.buyerName=l,e.cancel=function(){a.dismiss()},t.currentModal=a,e.setNotificationId=function(t){e.notificationId=t},e.sendNotification=function(n,i,r,l){if("SMS"===n){if(!s.checkMobileValid(i))return!1;e.notificationSmsDto={mobile_number:i,txn_code:r,buyer_name:l},o.sendNotificationToSms(e.notificationSmsDto).then(function(t){e.notificationResponse=t,c.success("SMS proceeded","")},function(e){t.showErrorSuccessMessage(e,!0)})}else{if(!s.checkEmailValid(i))return!1;e.notificationEmailDto={email_id:i,txn_code:r,buyer_name:l},o.sendNotificationToEmail(e.notificationEmailDto).then(function(t){e.notificationResponse=t,c.success("Email proceeded","")},function(a){e.showModificationPanel=!1,t.showErrorSuccessMessage(a,!0)})}a.dismiss()}}]}]),a.module("esewaPaymentApp").controller("AirlineUpcomingFlightsController",["$scope","$rootScope","$window","AirlineService","MyFlightConstant",function(e,t,a,n,i){function o(){const a={from_date:moment().format("YYYY-MM-DD"),page:e.page-1,size:e.size,sort:"flight_date,ASC",pnr_number:e.airlineTicketSearchText};e.flightListLoading=!0,n.getMyFlights(a).then(function(t){e.tickets=t},function(e){t.showErrorSuccessMessage(e,!0,"ERROR",!0)}).finally(function(){e.flightListLoading=!1})}e.flightListLoading=!0,e.page=1,e.size=10,e.tickets=[],e.myFlightType=i.UPCOMING_FLIGHT,e.openedTicketIndex=0,e.search=function(){e.page=1,o()},o(),e.nextPage=function(t){e.page=t?e.page+1:e.page-1,o(),a.scrollTo({top:0,behavior:"smooth"})},e.toggleDetailView=function(t){e.openedTicketIndex=e.openedTicketIndex===t?-1:t}}]),a.module("esewaSharedApp").directive("ecMyAirlineTicket",["CDNUrl","$rootScope",function(e,t){return{restrict:"E",transclude:!0,scope:{ticketData:"=ticketDetails",myFlightType:"=",index:"=",openDetailValue:"=openDetail",toggleDetail:"&onToggleDetail"},controller:"AirlineMyTicketController",templateUrl:e.url+"/html/airline/my-flights/airline_my_ticket.html"}}]),a.module("esewaPaymentApp").service("AirlineService",["Restangular",function(e){var t=e.all("/auth/airlines");this.getSector=function(){return e.all("airlines").one("sector").get()},this.getAvailableAirlines=function(e){var a=Object.assign({},e);return"M"==a.trip_type&&(a.trip_type="O"),t.one("availabilities/v2").customGET("",a)},this.bookFlight=function(e,a){return t.one("reserve/v2").withHttpConfig({selfHandleLoadingBar:a}).customPOST(e)},this.makeAirlinePayment=function(t){return e.all("auth/make_payment/airline/v2").customPOST(t)},this.getLoggedInUserInfo=function(){return e.one("auth").one("detail").get()},this.getTransactionDetail=function(t){return e.one("auth/transactions").one(""+t).one("airline/v2").customGET()},this.sendNotificationToSms=function(t){return e.one("auth").one("airlines").one("ticket").one("notification").one("sms/v2").customPOST(t)},this.sendNotificationToEmail=function(t){return e.one("auth").one("airlines").one("ticket").one("notification").one("email/v2").customPOST(t)},this.getOffers=function(){return e.one("auth/promocode/offer").customGET("",{product_type:"AIRLINE_TICKETING",event_type:"TRANSACTION"})},this.getFlightStatus=function(t){return e.all("esewa").one("airlines").customGET("flight_status",{origin:t.origin,destination:t.destination,flight_no:t.flightNo,airline_id:t.selectedAirLine})},this.getMyFlights=function(t){return e.one("auth").one("airlines").one("manage_booking").customGET("my_flights",t)},this.getRescheduleBookings=function(t){return e.one("auth").one("airlines").one("manage_booking").one("reschedule_booking").customPOST(t)},this.makeRescheduleAirlinePayment=function(t){return e.all("auth/airlines/manage_booking/confirm_reschedule").customPOST("","",t)},this.bookRescheduleFlight=function(t){return e.all("auth/airlines/manage_booking/reserve_reschedule").customPOST("","",t)}}]),a.module("esewaPaymentApp").service("AirlineCalculator",function(){this.getTotalPayingAmount=function(e,t){return 1*e-1*t},this.getPassengerList=function(e,t){var a=[];return e&&_.forEach(e,function(e,n){a[n]={passenger_type:t,title:e.tlt?e.tlt:"MR",gender:"Mr"===e.tlt?"MALE":"FEMALE",first_name:e.firstName,last_name:e.lastName,nationality:e.nationality?e.nationality:"NEPAL",passenger_remarks:"remarks"}}),a},this.getBaseFare=function(e,t,a,n){return 1*e*(1*t+1*a+1*n)},this.getFuelSurchargeFare=function(e,t,a,n){return 1*e*(1*t+1*a+1*n)},this.getFilteredDate=function(e,t,a){var n=[];if(t)for(var i=0;i<t.length;i++)for(var o=0;o<e.length;o++)t[i].airline_code===e[o].code&&(a?new Date(t[i].flight_date+" "+t[i].arrival_time)>=new Date(a.flight_date+" "+a.arrival_time)&&n.push(t[i]):n.push(t[i]));return n.sort(function(e,t){return e-t})},this.getFilteredDateByPrice=function(e,t){var a=[];if(t)for(var n=0;n<t.length;n++)t[n].total_amount<e&&a.push(t[n]);return a},this.getFilteredAirlinesByPrice=function(e,t){for(var a=[],n=0;n<t.length;n++)for(var i=0;i<e.length;i++)if(t[n].total_amount>=e[i].total_amount){a.unshift(t[n]);break}return a},this.getReturnFlightList=function(e,t){var a=[];if(t)for(var n=0;n<t.length;n++)e===t[n].airline_name&&a.push(t[n]);return a}}),a.module("esewaPaymentApp").service("AirlinePassengerDetailService",[function(){this.getAirlinePassengerDetail=function(e){var t,a,n=[];for(a=0;a<e.totalPax;a++)(t={}).name=e["passengerName_"+a],t.ticketNumber=e["outboundTicketNo_"+a],t.sector=e.outboundSector,t.passsengerType=e["passengerType_"+a],t.gender=e["passengerGender_"+a],t.passengerNationality=e["passengerNationality_"+a],n.push(t);return n},this.getAirlineReturnPassengerDetail=function(e){var t,a,n=[];for(a=0;a<e.totalPax;a++)(t={}).name=e["passengerName_"+a],t.ticketNumber=e["inboundTicketNo_"+a],t.sector=e.inboundSector,t.passsengerType=e["passengerType_"+a],t.gender=e["passengerGender_"+a],t.passengerNationality=e["passengerNationality_"+a],n.push(t);return n}}]),a.module("esewaPaymentApp").service("AirlinesService",["Restangular",function(e){this.getSector=function(){return e.all("airlines").one("sector").get()},this.getAirlines=function(){return e.one("airlines").get()},this.getAirlinesAvailabilities=function(t){var a=t.origin,n=t.destination,i=t.trip_type.key;return e.one("auth").all("airlines").one("availabilities").get({airline_code:t.airline_code,destination:n,origin:a,flight_date:t.flight_date,no_of_adult:t.no_of_adult,no_of_child:t.no_of_child,return_date:t.return_date,trip_type:i})},this.makeFlightPayment=function(t){return e.one("auth").one("make_payment").one("airline").customPOST(t)},this.getLeadPassengerDetail=function(){return e.one("auth").one("detail").get()},this.reserveFlight=function(t){return e.one("auth").one("airlines").one("reserve/cancel").customPOST(t)},this.sendNotificationToSms=function(t){return e.one("auth").one("airlines").one("ticket").one("notification").one("sms/v2").customPOST(t)},this.sendNotificationToEmail=function(t){return e.one("auth").one("airlines").one("ticket").one("notification").one("email/v2").customPOST(t)}}]),a.module("esewaPaymentApp").service("DateFormatter",function(){this.formatDate=function(e){e&&a.isDefined(e.replace)&&(e=e.replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3"));var t=new Date(e),n=""+(t.getMonth()+1),i=""+t.getDate(),o=t.getFullYear();return n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),[o,n,i].join("-")}}),a.module("esewaPaymentApp").service("SingleDateService",function(){this.getFormattedDate=function(e){new Date;return{today:e.toISOString()}}}),a.module("esewaPaymentApp").controller("BusSewaController",["$scope","$rootScope","$state","$stateParams","BussewaService","CommonService","StateConstant","CDNUrl","$filter","$interval","ecmsg","$window","DefaultMessageConstant","DirectDebitService","$modal","AUTH_EVENTS","PaymentConstant",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g,y,S,D){function R(e){var t;return e.selectedSeats=[],e.totalSeats=0,e.unavailableSeats=0,(t=e).seatLayout.forEach(function(e){e.seatStatus="No"===e.bookingStatus?"Available":"Booked","na"!==e.displayName&&t.totalSeats++,"Yes"===e.bookingStatus&&t.unavailableSeats++}),(e=t).renderReadySeatLayout=function(e){var t=e.seatLayout,a=e.noOfColumn,n=[],i=[];for(var o in t)(1*o+1)%a!=0?i.unshift(t[o]):(i.unshift(t[o]),n.push(i),i=[]);return n}(e),e.availableSeatsInPercent=e.unavailableSeats/e.totalSeats*100+"%",e}function b(t){0!==e.selectedBusDetail.remainingTime?t():p.error(h.TIME_EXCEED)}function A(e){var t,n=a.copy(e);return n.passengerTypeDetail&&(n.passengerTypeDetail=(t=n.passengerTypeDetail,_.forEach(t,function(e){_.forEach(e.passengerDetail,function(t){var a=t.title;delete t.title,t.detail=e[a],delete e[a]})}),t)),Object.assign(n,T())}function T(){return{id:e.selectedBusDetail.id,ticketSrlNo:e.bookSeatRes.ticketSrlNo}}function v(t,a,n){e.$modalInstance=y.open({templateUrl:u.url+"/html/airline/withdraw_confirmation_modal_3.48.0.0.html",controller:"WithdrawConfirmationModalController",size:"lg",backdrop:"static",keyboard:!1,scope:e,resolve:{booking_id:function(){return t},isDirectLoadSuccess:function(){return a},errorResponse:function(){return n},stateToReturnOnWithdrawFail:function(){return{state:l.BUSSEWA_INQUIRY}}}})}function w(){f.scrollTo({top:0,behavior:"smooth"})}e.busRoutesDetails=[],e.selectedBusDetail={},e.busSearchReqest={from:"Kathmandu",to:"",date:new Date},e.isWithdrawToBank=!1,e.defaultPaymentLabelText=D.WALLET_LABEL,e.otherPaymentLabelText=D.OTHER_PAYMENT_LABEL,e.miscScope={confirmButtonText:e.defaultPaymentLabelText,selectedBankAccountDetails:{},totalPayableAmount:"",product:"BusSewa"},e.swapDepatatureDestination=function(){var t={from:e.busSearchReqest.to,to:e.busSearchReqest.from};e.busSearchReqest=Object.assign(e.busSearchReqest,t)},e.inquiryDetailTemplateUrl="html/bussewa/bussewa_top_destination.html",e.getBusRoutes=function(){s.getBusRoutes().then(function(t){e.busRoutes=t.plain()},function(e){i.showErrorSuccessMessage(e,!0,"ERROR_FETCHING_ROUTE")})},e.searchBusRoutes=function(t,n){if(i.message={},a.isDefined(n)){var o=n?1:-1,r=t.date;t.date=new Date(r.setDate(r.getDate()+o)),e.busSearchReqest.date=t.date}var c=a.copy(t);c.date=d("dateToString")(c.date),s.getBusRoutesDetails(t).then(function(t){for(var a in e.busRoutesDetails=t.trips,e.busRoutesDetails)e.busRoutesDetails[a]=R(e.busRoutesDetails[a])},function(e){i.showErrorSuccessMessage(e,!0,"ERROR_FETCHING_ROUTE")}).finally(function(){e.inquiryDetailTemplateUrl=e.busRoutesDetails.length?"html/bussewa/bussewa_bus_details_3.37.0.html":"html/bussewa/bussewa_no_bus_found.html"})},e.refreshBusDetail=function(e,t){s.getRefreshedBusSewaTrip(e[t].id).then(function(a){e[t].noOfColumn=a.noOfColumn,e[t].seatLayout=a.seatLayout,e[t]=R(e[t]),e[t].showSeatLayout=!0},function(e){i.showErrorSuccessMessage(e,!0,"REFRESH_FAILED",!0)})},e.proceedBookingTicket=function(t){e.selectedBusDetail=t,function(){i.showloadingBar=!0,e.miscScope.totalPayableAmount=e.selectedBusDetail.selectedSeats.length*e.selectedBusDetail.ticketPrice,e.miscScope.productCode=e.selectedBusDetail.serviceCode,e.isDirectDebitEnabled=!1,e.miscScope.confirmButtonText=e.defaultPaymentLabelText;var t={product_code:e.miscScope.productCode,amount:e.miscScope.totalPayableAmount};g.getProductPaymentOptions(t).then(function(t){var a=t.plain();e.miscScope.paymentOptionsResponse=a,Array.isArray(a)&&(e.isDirectDebitEnabled=a[1].enabled)}).finally(function(){i.showloadingBar=!1})}();var a={id:t.id,seat:t.selectedSeats};s.bookBussewaTickets(a).then(function(a){var n;e.bookSeatRes=a.plain(),e.selectedBusDetail.remainingTime=1*a.timeOut,e.passengerDetail={},t.passengerDetail.length&&function(e,t){var a=[];for(var n in e.selectedSeats)for(var i in a.push({seat:e.selectedSeats[n]}),a[n].passengerDetail=[],e.passengerDetail)a[n].passengerDetail.push({id:e.passengerDetail[i].id,detail:"",title:e.passengerDetail[i].detail});t.passengerTypeDetail=a}(t,e.passengerDetail),n=m(function(){0!==e.selectedBusDetail.remainingTime?e.selectedBusDetail.remainingTime--:m.cancel(n)},1e3),o.go("busSewa.passengerDetail")},function(e){i.showErrorSuccessMessage(e,!0,"TICKET_BOOKING_FAILED",!0)})},e.bookSeat=function(e,t){(6!==t.selectedSeats.length||e.isSelected)&&"No"===e.bookingStatus&&(e.isSelected=!e.isSelected,e.isSelected?t.selectedSeats.push(e.displayName):t.selectedSeats.splice(t.selectedSeats.indexOf(e.displayName),1),e.seatStatus=e.isSelected?"Selected":"Available")},e.checkPassengerDetail=function(){w(),_.isEmpty(e.selectedBusDetail)&&o.go("busSewa.inquiry")},e.postPassengerInfo=function(e,t){b(function(){if(t.$valid){var a=A(e);s.postPassengerInfo(a).then(function(e){e.status&&o.go("busSewa.confirmation")},function(e){i.showErrorSuccessMessage(e,!0)})}})},e.cancelTicketBooking=function(){i.message={},e.miscScope.confirmButtonText=e.defaultPaymentLabelText,s.cancelTicketBooking(T()).then(function(){delete e.selectedBusDetail.remainingTime,o.go("busSewa.inquiry")},function(e){i.showErrorSuccessMessage(e,!0)})},e.mpinVerification=function(t){t&&(e.mpinFn=t)},e.credentialInput="",e.$on("onConfirmation",function(t,o){w(),e.paymentFailureMessage=[{id:1,isSelected:!1,labelText:"Keep in my eSewa Wallet"},{id:2,isSelected:!1,labelText:"Withdraw back to my bank account"}],e.credentialInput=o;var r=e.miscScope.selectedBankAccountDetails,s={product_code:e.selectedBusDetail.serviceCode,source_bank_swift_code:r.swift_code,amount:e.selectedBusDetail.selectedSeats.length*e.selectedBusDetail.ticketPrice,unique_id:r.unique_id};i.showloadingBar=!0,g.performDirectLoad(s,e.credentialInput).then(function(t){i.message={};var a=t.plain();e.credentialInput="",0===a.code?(i.$broadcast(S.getBalanceAndRewards),e.confirmPayment(e.passengerDetail,a.booking_id,t.load_transaction_id)):v(n,!1,a),i.showloadingBar=!1},function(e){i.showloadingBar=!1,a.isDefined(e.data.error_message)?i.showErrorSuccessMessage(e,!0,"INVALID"):v(n,!1,e)})}),e.confirmPayment=function(n,r,c){i.message={};b(function(){var u=function(a){var n={amount:e.selectedBusDetail.selectedSeats.length*e.selectedBusDetail.ticketPrice,product_code:e.selectedBusDetail.serviceCode,unique_id:i.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now()},o={tripDate:e.selectedBusDetail.dateEn,operator:e.selectedBusDetail.operator};return(o=Object.assign(o,A(a),e.busSearchReqest)).busId=o.id,delete o.id,o.ticketSerialNo=o.ticketSrlNo,delete o.ticketSrlNo,delete o.date,delete o.passengerTypeDetail,n.properties=o,n}(n);a.isDefined(r)&&(u.hasOwnProperty("properties")?u.properties.directDebitBookingId=r:u.properties={directDebitBookingId:r},e.miscScope.booking_id=r),i.showloadingBar=!0,s.confirmPayment(u).then(function(t){i.showloadingBar=!1,e.selectedBusDetail={},o.go(l.TRANSACTIONS,{txnId:t.transaction_code,moduleId:t.module_id})},function(t){i.showloadingBar=!1,601===t.code||a.isDefined(t.data)&&601==t.data.code?(e.miscScope.transaction_code=c,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(t.data)&&(t=t.data),v(r,!0,t)):i.showErrorSuccessMessage(t,!0,"PAYMENT_FAILED",!0)})})},e.isBankSelected=function(){return!(!a.isDefined(e.miscScope.selectedBankAccountDetails)||!a.isDefined(e.miscScope.selectedBankAccountDetails.swift_code))}}]),a.module("esewaPaymentApp").service("BussewaService",["Restangular",function(e){var t=e.all("auth");this.getBusRoutes=function(){return e.one("bussewa").one("routes").get()},this.bookBussewaTickets=function(e){return t.one("bussewa").one("book").customPOST(e)},this.cancelTicketBooking=function(e){return t.one("bussewa").one("cancel_queue").customPOST(e)},this.postPassengerInfo=function(e){return t.one("bussewa").one("passenger_info").customPOST(e)},this.getRefreshedBusSewaTrip=function(e){return t.one("bussewa").one("trip_refresh").one(e).get()},this.getBusRoutesDetails=function(e){return t.one("bussewa").one("trips").customPOST(e)},this.confirmPayment=function(e){return t.one("make_payment").customPOST(e)}}]),a.module("esewaPaymentApp").controller("CableCarController",["$scope","$rootScope","$state","$stateParams","CommonService","StateConstant","CDNUrl","$filter","MerchantPaymentService","EsewaCommissionCalculationFactory","NewTransactionDetail","AUTH_EVENTS","ecmsg","StatementService","DirectDebitService","PropertyConstant","$modal","$window","PaymentConstant",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g,y,S,D,R,b){e.transaction_code=o.params["transaction-code"],e.isWithdrawToBank=!1,e.transaction_code||o.go(c.CABLE_CAR_DETAIL);const A=()=>{e.paymentRequest={product_code:null,amount:0,channel:"WEB_USER",narration:null,properties:{mobile_number:"",ticket_issue_date:e.date.issueDate,email:"",full_name:"",separate_integration:!0}}};function T(t,a,n,o,r){t(n).then(function(t){a&&(e[a]=t),"function"==typeof o&&o(t)},function(e){i.showErrorSuccessMessage(e,!0),"function"==typeof r&&r(e)})}function v(t){t&&d.getProductDetails(t).then(function(t){e.cableCarProductDetail=t.plain()},function(e){h.error(function(e,t,n){var o=e&&a.isDefined(e.data.error_message||e.data.message||e.data.errorMessage)?e.data.error_message||e.data.message||e.data.errorMessage:getDefaultConstantErrMsg(t);if(n)return o;i.message.error=o}(e,"ERROR_FETCHING_DATA",!0))})}function w(t,a,n){e.$modalInstance=D.open({templateUrl:l.url+"/html/airline/withdraw_confirmation_modal_3.48.0.0.html",controller:"WithdrawConfirmationModalController",size:"lg",backdrop:"static",keyboard:!1,scope:e,resolve:{booking_id:function(){return t},isDirectLoadSuccess:function(){return a},errorResponse:function(){return n},stateToReturnOnWithdrawFail:function(){return{state:c.CABLE_CAR_DETAIL}}}})}function P(t){for(var a=0;a<t.total_travellers;a++){e.ticketDetailList.push({price:"",passengerType:"",tripType:"",ticketNumber:""})}_.forEach(t,function(t,a,n){if(a.startsWith("price_")){var i=a.split("_");e.ticketDetailList[i[1]].price=t}else if(a.startsWith("passengerType_")){var o=a.split("_");e.ticketDetailList[o[1]].passengerType=t}else if(a.startsWith("tripType_")){var r=a.split("_");e.ticketDetailList[r[1]].tripType=t}else if(a.startsWith("ticketNumber_")){var s=a.split("_");e.ticketDetailList[s[1]].ticketNumber=t}})}e.defaultPaymentLabelText=b.WALLET_LABEL,e.otherPaymentLabelText=b.OTHER_PAYMENT_LABEL,e.miscScope={confirmButtonText:e.defaultPaymentLabelText,selectedBankAccountDetails:{},product:"CableCar",booking_id:""},e.ticketType={},e.cableCarProductDetail={},e.ticketDetails={},e.cableCarProductCode={manakamanaOneWay:"MANAKAMANA-CC-ONE-WAY",manakamanaTwoWay:"MANAKAMANA-CC-ROUND",annapurnaOneWay:"NP-ES-ANNAPURNA-CC-ONE-WAY",annapurnaTwoWay:"NP-ES-ANNAPURNA-CC-ROUND"},e.cableCarProductName={},e.cableCarProductName[e.cableCarProductCode.manakamanaOneWay]="Manakamana Cable Car",e.cableCarProductName[e.cableCarProductCode.manakamanaTwoWay]="Manakamana Cable Car",e.cableCarProductName[e.cableCarProductCode.annapurnaOneWay]="Annapurna Cable Car",e.cableCarProductName[e.cableCarProductCode.annapurnaTwoWay]="Annapurna Cable Car",e.cableCarlist=[{label:"Manakamana Cable Car",code:"manakamana"},{label:"Annapurna Cable Car",code:"annapurna"}],e.date={issueDate:u("date")(new Date,"M/d/yyyy | h:mm:ss a"),expiryDate:u("date")((new Date).setDate((new Date).getDate()+3),"M/d/yyyy")},e.noOfTravellers=0,A(),e.initializeTicket=function(){e.isOneWayTicket=!1,e.getCableCarTicketType()},e.setTotalAmount=function(){var t=0,a=0;for(var n in e.ticketTypeData)t+=e.ticketTypeData[n].price*e.ticketTypeData[n].numberOfTraveller,a+=e.ticketTypeData[n].numberOfTraveller,e.ticketTypeData[n].numberOfTraveller&&(e.ticketTypeData[n].passenger_count=e.ticketTypeData[n].numberOfTraveller);e.paymentRequest.amount=t,e.paymentRequest.properties.total_travellers=a,e.noOfTravellers=a},v(e.paymentRequest.product_code),e.setTicketTypeData=function(t){e.isOneWayTicket=t,e.ticketTypeData=t?e.oneWayTicketTypes:e.twoWayTicketTypes,e.paymentRequest.product_code=function(t){var a="";switch(e.selectedCableCar&&e.selectedCableCar.code){case e.cableCarlist[0].code:a=t?e.cableCarProductCode.manakamanaOneWay:e.cableCarProductCode.manakamanaTwoWay;break;case e.cableCarlist[1].code:a=t?e.cableCarProductCode.annapurnaOneWay:e.cableCarProductCode.annapurnaTwoWay}return a}(t),e.noOfTravellers=0,e.paymentRequest.amount=0,_.forEach(e.ticketTypeData,function(e){e.numberOfTraveller=0,e.ticket_count=0,e.passenger_count=0}),v(e.paymentRequest.product_code)},e.initCableCarConfirmation=function(){e.paymentRequest.amount||i.goToState(c.CABLE_CAR_DETAIL)},e.changeCableCar=function(t){e.selectedCableCar=t,e.ticketTypeData=n,e.getCableCarTicketType()},e.getCableCarTicketType=function(){if(!a.isDefined(e.ticketTypeData)&&e.selectedCableCar){var t={url:"/cablecar/ticket/types/"+e.selectedCableCar.code,requestType:"GET",data:{},scriptPath:"",urlParams:{}};T(d.dynamicMerchantService,"",t,function(t){e.oneWayTicketTypes=_.forEach(t.oneWayTicketTypes,function(e){e.numberOfTraveller=0,e.ticket_count=0,e.passenger_count=0}),e.twoWayTicketTypes=_.forEach(t.twoWayTicketTypes,function(e){e.numberOfTraveller=0,e.ticket_count=0,e.passenger_count=0}),e.setTicketTypeData(e.isOneWayTicket)})}},e.commissionDetailService=m,e.bookCableCar=function(){!function(){i.showloadingBar=!0,e.miscScope.totalPayableAmount=e.paymentRequest.amount,e.miscScope.productCode=e.paymentRequest.product_code,e.isDirectDebitEnabled=!1,e.miscScope.confirmButtonText=e.defaultPaymentLabelText;var t={product_code:e.miscScope.productCode,amount:e.miscScope.totalPayableAmount};y.getProductPaymentOptions(t).then(function(t){var a=t.plain();e.miscScope.paymentOptionsResponse=a,Array.isArray(a)&&(e.isDirectDebitEnabled=a[1].enabled)}).finally(function(){i.showloadingBar=!1})}(),o.go(c.CABLE_CAR_CONFIRMATION),d.getProductCommission(e.paymentRequest.product_code).then(function(a){var n,r;a.cashBack=a.cashback?a.cashback:0,e.commissionDetailService.setCashBackCharge(1*a.cashback,a.commissionResources),e.commissionDetailService.calculateForAmount(1*e.paymentRequest.amount),e.commissionDetailService.setRewardPointResource(a.rewardPointResource),a.hasReward&&e.commissionDetailService.calculateRewardPoint(e.paymentRequest.amount),n=(e.selectedCableCar.code||"").toUpperCase()+"-CABLE-CAR",r=i.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now(),e.uniqueId=i.$storage.profile.esewaId+"_"+r,e.paymentRequest.unique_id=n+"#"+r,o.go(c.CABLE_CAR_CONFIRMATION)})},e.mpinVerification=function(t){t&&(e.mpinFn=t)},e.credentialInput="",e.$on("onConfirmation",function(t,o){R.scrollTo({top:0,behavior:"smooth"}),e.paymentFailureMessage=[{id:1,isSelected:!1,labelText:"Keep in my eSewa Wallet"},{id:2,isSelected:!1,labelText:"Withdraw back to my bank account"}],e.credentialInput=o;var r=e.miscScope.selectedBankAccountDetails,s={product_code:e.paymentRequest.product_code,source_bank_swift_code:r.swift_code,amount:e.paymentRequest.amount,unique_id:r.unique_id};i.showloadingBar=!0,y.performDirectLoad(s,e.credentialInput).then(function(t){i.message={};var a=t.plain();e.credentialInput="",0===a.code?(i.$broadcast(f.getBalanceAndRewards),e.makePayment(a.booking_id,a.load_transaction_id)):w(n,!1,a),i.showloadingBar=!1},function(e){i.showloadingBar=!1,a.isDefined(e.data.error_message)?i.showErrorSuccessMessage(e,!0,"INVALID"):w(n,!1,e)})}),e.ticketDetailList=[],e.makePayment=function(t,n){i.message={};var r={ticket_count:0},s=0;_.forEach(e.ticketTypeData,function(n){n.numberOfTraveller&&(r["tripType_"+s]=n.tripType,r["passengerType_"+s]=n.passengerType,r["passengerCount_"+s]=n.passenger_count,a.isDefined(t)&&(r.directDebitBookingId=t,e.miscScope.booking_id=t),r.ticket_count++,s++)}),Object.assign(e.paymentRequest.properties,r),i.showloadingBar=!0,T(d.makePayment,"",e.paymentRequest,function(t){var a,n;i.showloadingBar=!1,i.$broadcast(f.getBalanceAndRewards),e.ticketDetails=t.plain(),a=t,p.amount=a.amount,p.properties=a.properties,p.narration=a.narration,p.request_unique_id=a.request_unique_id,p.channel=a.channel,p.transaction_status=a.transaction_status,p.created=a.created,p.product_logo_url=a.product_logo_url,p.product_name=a.product_name,p.processed_by=a.processed_by,p.transaction_code=a.transaction_code,p.module_id=a.module_id,p.hiddenStatDetailProps=n,P(t.plain().properties),A(),o.go(c.CABLE_CAR_MY_TICKET,{"transaction-code":t.plain().transaction_code})},function(o){i.showloadingBar=!1,601==o.code||a.isDefined(o.data)&&601==o.data.code?(e.miscScope.transaction_code=n,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(o.data)&&(o=o.data),w(t,!0,o)):i.showErrorSuccessMessage(o,!0,"TICKET_BOOKING_FAILED")})},e.getTransactionDetail=function(t){e.ticketDetailList=[],g.getTxnDetails(t,1).then(function(t){e.ticketDetails=t.plain(),P(t.plain().properties)})},e.isBankSelected=function(){return!(!a.isDefined(e.miscScope.selectedBankAccountDetails)||!a.isDefined(e.miscScope.selectedBankAccountDetails.swift_code))}}]),a.module("esewaPaymentApp").controller("EsewaRemitController",["$scope","$rootScope","RemittanceService","EsewaCommissionCalculationFactory","MerchantPaymentService","$state","AUTH_EVENTS","StateConstant","$window",function(e,t,n,i,o,r,s,c,l){e.commissionDetailService=i,e.paymentRequest={},e.minimumDob=new Date("1890-01-01"),e.minIssuedDate=new Date("1890-01-01");var u=new Date;function d(a,n){e.commissionDetailService.setCashBackCharge(0,0),t.clearMessage(),o.getProductCommission(a).then(function(t){e.showComissionView=!0,t.cashBack=t.cashback?t.cashback:0,function(t,a){e.commissionDetailService.setCashBackCharge(1*t.cashback,t.commissionResources),e.commissionDetailService.calculateForAmount(1*a),t.rewardPointResource&&(e.commissionDetailService.setRewardPointResource(t.rewardPointResource),e.commissionDetailService.calculateRewardPoint(1*a))}(t.plain(),n)},function(a){e.showComissionView=!1,t.showErrorSuccessMessage(a,!0,"ERROR_ON_SERVING_REQUEST")})}function m(){l.scrollTo({top:0,behavior:"smooth"})}e.maxDobForRemittance=new Date(u-504911232e3),e.remittanceSenderInfo={},e.showPaymentInfo=!0,e.showSenderInfo=!1,e.showReceiverInfo=!1,e.showConfirmationView=!1,e.isSenderVisited=!1,e.isReceiverInfoVisited=!1,e.isConfirmationPageVisited=!1,e.isEsewaUser=!1,e.esewaUserInfo={},e.enterSenderInfo=!1,e.isManualSenderInput=!1,e.isManualReceiverInput=!1,n.getDistrict().then(function(t){e.districtList=t.plain()}),e.processCommissionForSelectedDetail=function(t,a){var n=-1!==["Bhaktapur","Kathmandu","Lalitpur"].indexOf(a)?"NP-ES-EMTIV":"NP-ES-EMTOV";e.paymentRequest.selected_district=a,d(n,t)},e.processPickUp=function(t){e.remittancePaymentInfo=a.copy(t),e.showPaymentInfo=!1,e.showSenderInfo=!0,e.isSenderVisited=!0},e.esewaRemitIdentificationType=[{key:"01",value:"Citizenship"},{key:"02",value:"Driving License"},{key:"03",value:"Passport"},{key:"04",value:"National ID"},{key:"05",value:"Voters Card"},{key:"06",value:"Residence Permit"},{key:"07",value:"Work Permit"}],e.esewaRemitSourceOfFund=[{key:"1",value:"Advance from director/shareholder"},{key:"2",value:"Business Income"},{key:"3",value:"Claims/Compensation"},{key:"4",value:"Donation/Gift"},{key:"5",value:"Financial Support from Children"},{key:"6",value:"Financial Support from Parents"},{key:"7",value:"Financial Support from Spouse"},{key:"8",value:"Freelance income"},{key:"9",value:"Gambling"},{key:"10",value:"Insurance"},{key:"11",value:"Interest/ Dividend income"},{key:"12",value:"Issue of Bond/Debenture"},{key:"13",value:"Issue of Share"},{key:"14",value:"Loans"},{key:"15",value:"Property Investment"},{key:"16",value:"Rental/ leasing income"},{key:"17",value:"Retirement funds"},{key:"18",value:"Salary/Saving"},{key:"19",value:"Sales of Assets"},{key:"20",value:"Share Investment"},{key:"21",value:"Tax Refund"},{key:"22",value:"Venture Capital"}],e.esewaRemitRelationship=[{key:"3",value:"Business Partner"},{key:"5",value:"Colleague"},{key:"7",value:"Customer"},{key:"15",value:"Friend"},{key:"20",value:"Parents"},{key:"21",value:"Relatives"},{key:"22",value:"Self"},{key:"23",value:"Sibling/Brother/Sister"},{key:"24",value:"Spouse"},{key:"28",value:"Family"}],e.esewaRemitPurpose=[{key:"5",value:"Educational expenses"},{key:"6",value:"Family maintenance / saving"},{key:"8",value:"Gift"},{key:"16",value:"Medical expenses"},{key:"17",value:"Personal Services"},{key:"19",value:"Payment for goods and services"},{key:"20",value:"Personal travel and tour"},{key:"22",value:"Lend/borrow"},{key:"26",value:"Fines and Penalties"}],e.getNameOfKey=function(e,t){return t.filter(function(t){return t.key===e})[0]},e.getIdFromValue=function(e,t){if(e)return t.filter(function(t){return t.value.toLowerCase()===e.toLowerCase()})[0]},e.processSenderManualInfo=function(){e.showPaymentInfo=!1,e.showSenderInfo=!1,e.showReceiverInfo=!0,e.showConfirmationView=!1,e.isReceiverInfoVisited=!0},e.processReceiverManualInfo=function(t){e.showPaymentInfo=!1,e.showSenderInfo=!1,e.showReceiverInfo=!1,e.showConfirmationView=!0,e.isConfirmationPageVisited=!0},e.cancelPayment=function(){r.reload()},e.searchUserInfoFromesewaId=function(a,i){t.clearMessage();var o=function(e,t,a){return{username:e,amount:t,customer_type:a?"SENDER":"RECEIVER"}}(a,e.paymentRequest.sent_amount,i);n.getUserDetail(o).then(function(t){var n,o;i?(e.esewaUserInfo={sender_name:(o=t.plain()).sender_name,sender_mobile:o.mobile_number,sender_id_type:o.identification_type?e.getIdFromValue(o.identification_type,e.esewaRemitIdentificationType).key:null,sender_id_number:o.identification_number},e.remittanceSenderInfo=e.esewaUserInfo,e.paymentRequest.sender_esewa_id=a,e.isEsewaUser=!0):(e.remittanceReceiverInfo={receiver_name:(n=t.plain()).sender_name,receiver_mobile:n.mobile_number,receiver_id_type:n.identification_type?n.identification_type:"",receiver_id_number:n.identification_number?n.identification_number:""},e.isReceiverInfo=!0)},function(a){i?(e.isEsewaUser=!1,e.esewaUserInfo={}):(e.remittanceReceiverInfo={},e.isReceiverInfo=!1),m(),t.showErrorSuccessMessage(a,!0,"ERROR_ON_SERVING_REQUEST")})};var p={channel:"WEB_USER",client_code:"ESEWAREMIT"};e.makePayment=function(){var a,i=Object.assign(p,e.paymentRequest,e.remittanceSenderInfo,e.remittanceReceiverInfo);i.source_of_income="23",i.sender_address="NEPAL",i.receiver_address="NEPAL",t.clearMessage(),e.paymentRequest.sent_amount<1e4&&((a=i).sender_id_type="08",a.sender_id_number=e.remittanceSenderInfo.sender_mobile),n.postPaymentDetail(i,"ESEWAREMIT").then(function(e){var a;a=e,t.$broadcast(s.getBalanceAndRewards),r.go(c.TRANSACTIONS,{txnId:a.transaction_code,moduleId:a.module_id})},function(e){m(),t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}}]),a.module("esewaPaymentApp").controller("RemittanceAbstractController",["$scope","$rootScope","$http","CDNUrl",function(e,t,a,n){e.remittanceListUrl=t.$storage.user?n.url+"/data/orgRemittancePaymentList_3.38.0.1.json":n.url+"/data/remittancePaymentList.json",e.remittanceList=[],e.getRemittanceList=function(){a({method:"GET",url:e.remittanceListUrl}).then(function(t){e.remittanceList=t.data})},e.getRemittanceList()}]),a.module("esewaPaymentApp").controller("RemittancePaymentController",["$scope","$rootScope","$state","$stateParams","RemittanceService","CommonService","NewTransactionDetail","StateConstant","AUTH_EVENTS","MerchantPaymentService","EsewaCommissionCalculationFactory",function(e,t,i,o,r,s,c,l,u,d,m){e.remittanceStateParams={client_code:i.params.clientCode,clientName:i.params.clientName,clientLogoName:i.params.clientLogoName};var p="eSewa Remit Send Money"===i.params.clientName?"eSewa Money Transfer":i.params.clientName;t.setDocumentTitle(p),e.paymentRequest={},e.remittance={},e.remittanceFinalObj={},e.remitttanceCommission={},e.showPayoutLocation=!1,e.showComissionView=!1,e.showExpireDate=!1,e.showIssuedDate=!0,e.isAddressRequired=!0,e.getDistrict=function(){r.getDistrict().then(function(t){e.districtList=t.plain()})},e.getDistrict(),e.getPayoutLocation=function(t){e.paymentRequest.payout_location_id="",r.getPayoutLocation(t,e.remittanceStateParams.client_code).then(function(t){e.showPayoutLocation=!0,e.payoutLocationList=t.plain()})},e.esewaRemitIdentificationType=[{key:"01",value:"Citizenship"},{key:"02",value:"Driving License"},{key:"03",value:"Passport"},{key:"04",value:"National ID"},{key:"05",value:"Voters Card"},{key:"06",value:"Residence Permit"},{key:"07",value:"Work Permit"}],e.esewaRemitSourceOfFund=[{key:"1",value:"Advance from director/shareholder"},{key:"2",value:"Business Income"},{key:"3",value:"Claims/Compensation"},{key:"4",value:"Donation/Gift"},{key:"5",value:"Financial Support from Children"},{key:"6",value:"Financial Support from Parents"},{key:"7",value:"Financial Support from Spouse"},{key:"8",value:"Freelance income"},{key:"9",value:"Gambling"},{key:"10",value:"Insurance"},{key:"11",value:"Interest/ Dividend income"},{key:"12",value:"Issue of Bond/Debenture"},{key:"13",value:"Issue of Share"},{key:"14",value:"Loans"},{key:"15",value:"Property Investment"},{key:"16",value:"Rental/ leasing income"},{key:"17",value:"Retirement funds"},{key:"18",value:"Salary/Saving"},{key:"19",value:"Sales of Assets"},{key:"20",value:"Share Investment"},{key:"21",value:"Tax Refund"},{key:"22",value:"Venture Capital"}],e.esewaRemitRelationship=[{key:"1",value:"Boyfriend"},{key:"2",value:"Branch/Representative office"},{key:"3",value:"Business Partner"},{key:"4",value:"Children"},{key:"5",value:"Colleague"},{key:"6",value:"Creditor"},{key:"7",value:"Customer"},{key:"8",value:"Debtors"},{key:"9",value:"Director"},{key:"10",value:"Employee"},{key:"11",value:"Ex-spouse"},{key:"12",value:"Fiance"},{key:"13",value:"Fiancees"},{key:"14",value:"Franchisee/Franchisor"},{key:"15",value:"Friend"},{key:"16",value:"Girlfriend"},{key:"17",value:"Grand Parents"},{key:"18",value:"Holding company"},{key:"19",value:"Others"},{key:"20",value:"Parents"},{key:"21",value:"Relative/uncle/auntie/cousin"},{key:"22",value:"Self"},{key:"23",value:"Sibling/brother/sister"},{key:"24",value:"Spouse"},{key:"25",value:"Subsidiary company"},{key:"26",value:"Supplier"}],e.esewaRemitPurpose=[{key:"1",value:"Accounting services"},{key:"2",value:"Business profits"},{key:"3",value:"Business travel"},{key:"4",value:"Donation"},{key:"5",value:"Educational expenses"},{key:"6",value:"Family maintenance / saving"},{key:"7",value:"Financial lease"},{key:"8",value:"Gift"},{key:"9",value:"Hotel expenses"},{key:"10",value:"Insurance premium"},{key:"11",value:"Interest on loans"},{key:"12",value:"Investment in real estate"},{key:"13",value:"Investment in securities"},{key:"14",value:"Investment in shares"},{key:"15",value:"Legal services"},{key:"16",value:"Medical expenses"},{key:"17",value:"Other Personal Services"},{key:"18",value:"Others"},{key:"19",value:"Payment for goods and services"},{key:"20",value:"Personal travel and tour"},{key:"21",value:"Pilgrimage/Religious-Related"},{key:"22",value:"Repayment of loan"},{key:"23",value:"Research and development services"},{key:"24",value:"Tax payment"},{key:"25",value:"Telecommunication service"},{key:"26",value:"Fines and Penalties"},{key:"27",value:"Administrative Expenses"}],e.idTypeList=["CITIZENSHIP","PASSPORT","LICENSE","VOTER ID"],e.sourceOfIncomeList=["Business Transaction","Saving","Sales of assets","Salary","Lend/Borrow","Other"],e.occupationList=["Salaried","Business","Self employed","Government","Other"],e.relationshipList=["Spouse","Mother","Father","Brother","Friends","Relatives"],e.purposeList=["Business","Lend/Repay","Family Expenses","Health","Education","Other"],e.senderReceiverLabel="Sender Name",e.minimumDob=new Date("1890-01-01"),e.minIssuedDate=new Date("1890-01-01");var f=new Date;function h(a,n){e.commissionDetailService.setCashBackCharge(0,0),d.getProductCommission(a).then(function(t){e.showComissionView=!0,e.disableSubmitButton=!1,t.cashBack=t.cashback?t.cashback:0,function(t,a){e.commissionDetailService.setCashBackCharge(1*t.cashback,t.commissionResources),e.commissionDetailService.calculateForAmount(1*a),t.rewardPointResource&&(e.commissionDetailService.setRewardPointResource(t.rewardPointResource),e.commissionDetailService.calculateRewardPoint(1*a))}(t,n)},function(a){e.showComissionView=!1,e.disableSubmitButton=!0,t.message.error=a.data.error_message})}function g(n,i){var o={payout_amount:n.toString(),selected_district:i};r.getServiceCharge(o,e.remittanceStateParams.client_code).then(function(t){e.showComissionView=!0,e.disableSubmitButton=!1;var n={payout_amount:t.payout_amount,service_charge_amount:t.service_charge_amount,total_amount:t.total_amount};e.remittanceCommission.total_amount=a.copy(n,e.remittanceCommission)},function(a){e.showComissionView=!1,e.disableSubmitButton=!0,t.message.error=a.data.error_message}),e.$$phase||e.$apply()}function _(e,t){var a={};for(var n in e)e.hasOwnProperty(n)&&("source_of_income"==n||"occupation"==n||"purpose_of_remit"==n||"relation_ship"==n?a[n]=e[n]:a[t+n]=e[n]);return a}e.maxDobForRemittance=new Date(f-504911232e3),e.isExpireDateRequired=!0,e.remittanceApiUserData={},e.remittanceSenderData={},e.showError=!1,e.commissionDetailService=m,e.paymentRequest.sent_amount,e.paymentRequest.selected_district&&g(e.paymentRequest.sent_amount,e.paymentRequest.selected_district),e.processAmount=function(a,n){if("ESEWAREMIT"!=e.remittanceStateParams.client_code)g(a,n);else{t.isUser()?h("NP-ES-EMFU",a):h(-1!==["Bhaktapur","Kathmandu","Lalitpur"].indexOf(n)?"NP-ES-EMTIV":"NP-ES-EMTOV",a)}},e.remittancePaymentInfo={},e.processPickUp=function(n){e.senderReceiverLabel="Sender Name",e.remittancePaymentInfo=a.copy(n),t.goToState("remittance.customer")},e.ceDocTypeChange=function(t){e.remittance.id_issued_date=n,e.remittance.id_expiry_date=n,console.log("show expre : ",t),"PASSPORT"==t?(e.showExpireDate=!0,e.showIssuedDate=!0):"LICENSE"==t?(e.showExpireDate=!0,e.showIssuedDate=!0):"VOTERID"==t?(e.showExpireDate=!1,e.showIssuedDate=!1):(e.showExpireDate=!1,e.showIssuedDate=!0)},t.$storage.profile&&r.getUserProfile().then(function(t){"ESEWAREMIT"!=e.remittanceStateParams.client_code&&("CTZN"==t.identification_type?t.identification_type="CITIZENSHIP":"VOTERID"==t.identification_type?(t.identification_type="VOTER ID",e.showIssuedDate=!1):"PASSPORT"==t.identification_type?t.identification_type="PASSPORT":"LISCENSE"==identification_type?t.identification_type="LISCENSE":t.identification_type=null);var i={name:t.sender_name.trim().replace(/\s+/g," "),address:t.address,email:t.email,mobile:t.mobile_number,date_of_birth:new Date(t.date_of_birth_ad),id_number:t.identification_number,id_type:t.identification_type,id_issued_date:new Date(t.document_issued_date),source_of_income:t.income_source,occupation:t.occupation};"ESEWAREMIT"==e.remittanceStateParams.client_code&&("CTZN"==t.identification_type?(i.id_type="01",e.showExpireDate=!1):"VOTERID"==t.identification_type?(i.id_type="05",e.showExpireDate=!1,e.showIssuedDate=!1):"PASSPORT"==t.identification_type?(i.id_type="03",e.showExpireDate=!0):"LICENSE"==identification_type?(i.id_type="02",e.showExpireDate=!0):(e.showExpireDate=!1,t.identification_type=null),i.occupation=n),e.remittanceApiUserData=a.copy(i,e.remittanceApiUserData),e.ceSenderData=a.copy(i,e.remittanceApiUserData),e.remittance=a.copy(i,e.remittance),"LICENSE"==e.remittance.id_type||"PASSPORT"==e.remittance.id_type?e.showExpireDate=!0:e.showExpireDate=!1,e.$$phase||e.$apply()}),e.resetUserEnteredValue=function(){e.remittance={},e.remittance=a.copy(e.remittanceApiUserData,e.remittance)},e.remittanceSenderInfo={},e.proccedToReceiver=function(i){e.senderReceiverLabel="Receiver Name",e.remittanceApiUserData={},e.isExpireDateRequired=!1,e.showExpireDate=!1,e.isAddressRequired=!1,e.remittanceSenderInfo=a.copy(i),e.remittance.date_of_birth=n,e.remittance.id_issued_date=n,t.goToState("remittance.receiver")},e.initializeReceiverForm=function(){e.remittance={}},e.goToSender=function(){e.senderReceiverLabel="Sender Name",e.remittance=e.remittanceSenderInfo,e.isAddressRequired=!0,e.remittanceApiUserData=a.copy(e.ceSenderData,e.remittanceApiUserData),t.goToState("remittance.customer")},e.setOccupation=function(t){e.remittance.occupation="Other"===t?"":t},e.setSourceOfIncome=function(t){e.remittance.source_of_income="Other"===t?"":t},e.setRemitPurpose=function(t){e.remittance.purpose_of_remit="Other"===t?"":t},e.remittanceReceiverInfo={},e.proccedToConfirmationPage=function(n){if(e.remittanceReceiverInfo=a.copy(n),e.remittanceFinalObj=Object.assign({},e.remittancePaymentInfo,_(e.remittanceSenderInfo,"sender_"),_(e.remittanceReceiverInfo,"receiver_")),e.remittanceFinalObj.client_code=e.remittanceStateParams.client_code,e.remittanceReceiverInfo.relationship=e.remittanceReceiverInfo.relation_ship,delete e.remittanceReceiverInfo.relation_ship,"ESEWAREMIT"==e.remittanceFinalObj.client_code&&(e.remittanceFinalObj.receiver_id_issued_date=" ",e.remittanceFinalObj.receiver_id_type=" ",e.remittanceFinalObj.receiver_id_number=" "),"ESEWAREMIT"==e.remittanceFinalObj.client_code){var i;i=e.esewaRemitIdentificationType.find(function(t){if(t.key==e.remittanceSenderInfo.id_type)return t.value}),e.remittanceSenderInfo.id_type=i.value;var o;o=e.esewaRemitSourceOfFund.find(function(t){if(t.key==e.remittanceSenderInfo.source_of_income)return t.value}),e.remittanceSenderInfo.source_of_income=o.value;var r;r=e.esewaRemitRelationship.find(function(t){if(t.key==e.remittanceReceiverInfo.relationship)return t.value}),e.remittanceReceiverInfo.relationship=r.value;var s;s=e.esewaRemitPurpose.find(function(t){if(t.key==e.remittanceReceiverInfo.purpose_of_remit)return t.value}),e.remittanceReceiverInfo.purpose_of_remit=s.value}e.remittanceFinalObj.channel="WEB_USER",t.goToState("remittance.confirmation")},e.cancelPayment=function(){e.showError=!1,e.remittance=a.copy(e.ceSenderData,e.remittance),e.remittanceApiUserData=a.copy(e.ceSenderData,e.remittanceApiUserData),t.goToState("remittance.withdraw")};var y=function(e,t){c.amount=e.amount,c.properties=e.properties,c.narration=e.narration,c.request_unique_id=e.request_unique_id,c.channel=e.channel,c.transaction_status=e.transaction_status,c.created=e.created,c.product_logo_url=e.product_logo_url,c.product_name=e.product_name,c.processed_by=e.processed_by,c.transaction_code=e.transaction_code,c.module_id=e.module_id,c.hiddenStatDetailProps=t};e.makePayment=function(){r.postPaymentDetail(e.remittanceFinalObj,e.remittanceStateParams.client_code).then(function(e){var a;t.$broadcast(u.getBalanceAndRewards),a=e,s.getHiddenStatDetailProps().success(function(e){y(a,e),i.go(l.TRANSACTIONS,{txnId:a.transactionCode,moduleId:a.moduleId})})},function(t){e.showError=!0,e.ceErrorMessage=t.data.error_message})}}]),a.module("esewaPaymentApp").service("RemittanceService",["Restangular",function(e){var t=e.all("/auth/client/withdraw");this.getDistrict=function(){return e.all("address").one("district").get()},this.getPayoutLocation=function(e,a){return t.one(a).one("locations").one(""+e).get()},this.getServiceCharge=function(e,a){return t.one(a).one("service_charge").customPOST(e)},this.getUserProfile=function(){return t.one("user_info").get()},this.postPaymentDetail=function(e,a){return t.all(a).one("make_payment").customPOST(e)},this.getUserInfo=function(t){return e.all("auth/customer").one(t).one("details").customPOST()},this.getUserDetail=function(t){return e.all("auth/customer/details/v1").customPOST(t)},this.sendOtp=function(e){return t.one("ESEWAREMIT/send_otp").customPOST(e)},this.verifyOtp=function(e){return t.one("ESEWAREMIT/verify_otp").customPOST(e)},this.getProductCode=function(t){return e.all("auth/remittance/product_code").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.getAmountLimit=function(){return e.one("auth/remittance/amount/filter").get()},this.validateTocken=function(t){return e.one("auth/remittance/validate/pickup/"+t.token+"?client_code="+t.client_code).get()},this.remitPayment=function(t,a,n){return e.one("/auth/remittance/confirm_transaction/"+a+"/"+n).customPOST(t)},this.getCommonTransactionDetail=function(t){return e.one("auth/report/remittance/transaction/details").get(t)},this.getRemitTransactionDetails=function(t){return e.one("auth/report/remittance/transaction/summary").get(t)},this.getPDFTransactionDetail=function(t,a){return e.one("auth/transactions/"+t+"/pdf").get(a)},this.getBeneficiaryDetail=function(t){return e.one("auth/remittance/beneficiary/details/"+t).get()},this.getUnlockMTCN=function(t){return e.one("auth/remittance/unlock_payment/"+t).customPOST()}}]),a.module("esewaPaymentApp").config(["$stateProvider","CDNUrl",function(e,t){function a(e){return t.url+e}e.state("remittanceList",{url:"/remittance-list/remittance-bill",templateUrl:a("/html/remittance_service_list_3.41.0.html"),controller:"RemittanceAbstractController",data:{searchParams:["remittance"],displayName:"Remittance Services",icon:"icon-es-remit"}}).state("remittance",{url:"/remittance/:clientCode/:clientName/:clientLogoName",abstract:!0,template:"<div  ui-view/>",controller:"RemittancePaymentController"}).state("remittance.withdraw",{url:"/withdraw",templateUrl:a("/html/remittance/v2/ce_main_3.41.0.html")}).state("esewaRemitOld",{url:"/esewa-remit-old",templateUrl:a("/html/remittance/v2/esewa_remit_3.40.0.html"),controller:"EsewaRemitController",data:{displayName:"eSewa Remit"}}).state("esewaRemit",{templateUrl:a("/html/remittance/esewa-remit/esewa_remit_3.40.0.html"),controller:"EsewaRemitControllerV1",data:{displayName:"eSewa Remit"}}).state("esewaRemitDashboard",{url:"/my-dashboard",templateUrl:a("/html/remittance/esewa-remit/receiver/esewa_remit_dashboard.html"),controller:"EsewaRemitDashboardController",data:{searchParams:["remittance dashboard","my dashboard","money transfer"],displayName:"eSewa Money Transfer Dashboard",icon:"icon-es-remit"}}).state("esewaRemitReceiver",{url:"/remittance-payment",abstract:!0,templateUrl:a("/html/remittance/esewa-remit/receiver/receiver_main.html"),controller:"EsewaRemitReceiverController",data:{displayName:"eSewa Remit Receive Money"}}).state("esewaRemitReceiver.mtcn",{url:"/mtcn",templateUrl:a("/html/remittance/esewa-remit/receiver/receiver_mtcn.html")}).state("esewaRemitReceiver.transactionDetail",{url:"/transaction-detail",templateUrl:a("/html/remittance/esewa-remit/receiver/receiver_transaction_details.html"),data:{displayName:"eSewa Remit Transaction Details"}}).state("esewaRemitReceiver.receiverDetail",{url:"/receiver-detail",templateUrl:a("/html/remittance/esewa-remit/receiver/receiver_detail.html")}).state("esewaRemitReceiver.confirmationDetail",{url:"/confirmation-detail",templateUrl:a("/html/remittance/esewa-remit/receiver/receiver_confirmation_detail.html")}).state("totalRemittancePayment",{url:"/total-remittance-payment?from_date&to_date&amount",templateUrl:a("/html/remittance/esewa-remit/receiver/total_remittance_payment_transaction.html"),controller:"EsewaRemitDashboardController"}).state("totalSendMoney",{url:"/total-send-money?from_date&to_date&amount",templateUrl:a("/html/remittance/esewa-remit/receiver/total_send_money_transaction.html"),controller:"EsewaRemitDashboardController"}).state("totalCommissionEarned",{url:"/total-commission-earned?from_date&to_date&amount",templateUrl:a("/html/remittance/esewa-remit/receiver/total_commission_earned.html"),controller:"EsewaRemitDashboardController"}).state("uploadReceiverInfo",{url:"/upload-receiver-info/:mtcn/:transaction_date/:transaction_code",templateUrl:a("/html/remittance/esewa-remit/receiver/upload_receiver_information.html"),controller:"EsewaRemitUploadController"}).state("esewaRemit.transactionDetails",{url:"/esewa-remit/transaction-detail",templateUrl:a("/html/remittance/esewa-remit/transaction_details_3.45.0.html"),data:{searchParams:["esewa remit"],displayName:"eSewa Send Money Transaction Details",icon:"icon-es-transfer-info"}}).state("esewaRemit.senderDetails",{url:"/esewa-remit/sender-detail",templateUrl:a("/html/remittance/esewa-remit/sender_details_3.45.0.html"),data:{displayName:"eSewa Send Money Sender Details"}}).state("esewaRemit.receiverDetails",{url:"/esewa-remit/receiver-detail",templateUrl:a("/html/remittance/esewa-remit/receiver_details_3.45.0.html"),data:{displayName:"eSewa Send Money Receiver Details"}}).state("esewaRemit.confirmationDetails",{url:"/esewa-remit/confirmation-details",templateUrl:a("/html/remittance/esewa-remit/confirmation_details_3.45.0.html"),data:{displayName:"eSewa Send Money Confirmation Details"}}).state("remittance.customer",{url:"/customer",templateUrl:a("/html/remittance/ce_customer_3.47.1.0.html")}).state("remittance.receiver",{url:"/receiver",templateUrl:a("/html/remittance/ce_receiver_3.47.1.0.html")}).state("remittance.confirmation",{url:"/confirmation",templateUrl:a("/html/remittance/v2/ce_confirmation.html")}).state("remittancePickup",{abstract:!0,templateUrl:a("/html/remittancePickup/remittance_pickup_3.41.0.html"),controller:"RemittancePickupController",data:{displayName:"eSewa Remittance Pickup"}}).state("remittancePickup.inquiry",{url:"/remittance-pickup/:remittancePickupClientCode/:remittancePickUpName/inquiry",templateUrl:a("/html/remittancePickup/v1/remittance_pickup_inquiry_3.41.0.html")}).state("remittancePickup.remittanceDetail",{url:"/remittance-pickup/:remittancePickupClientCode/:remittancePickUpName/remittance-pickup-detail",templateUrl:a("/html/remittancePickup/remittance_pickup_detail.html")}).state("remittancePickup.confirmation",{url:"/remittance-pickup/:remittancePickupClientCode/:remittancePickUpName/remittance-pickup-confirmation",templateUrl:a("/html/remittancePickup/remittance_pickup_confirmation.html")}).state("remittancereport",{abstract:!0,template:"<div  ui-view/>",controller:"RemittanceWithdrawReportContoller",data:{displayName:"eSewa Remit Reports"}}).state("remittancereport.report",{url:"/remittance-report/:clientCode",templateUrl:a("/html/remittanceReport/remittance_report.html")}).state("busSewa",{abstract:!0,templateUrl:a("/html/bussewa/bussewa_landing_page.html"),controller:"BusSewaController"}).state("busSewa.inquiry",{url:"/bussewa/inquiry",templateUrl:a("/html/bussewa/bussewa_inquiry_3.37.0.html"),data:{searchParams:["bus","bussewa","ticket","bus ticket"],displayName:"Bus Ticket",icon:"icon-es-bus"}}).state("busSewa.passengerDetail",{url:"/bussewa/passenger-detail",templateUrl:a("/html/bussewa/bussewa_passenger_detail_3.37.0.html"),data:{displayName:"Bus Ticket Passenger Detail"}}).state("busSewa.confirmation",{url:"/bussewa/confirmation",templateUrl:a("/html/bussewa/bussewa_confirmation_3.38.0.0.html"),data:{displayName:"Bus Ticket Confirmation"}}).state("cableCar",{abstract:!0,url:"/cable-car",templateUrl:a("/html/templates/cableCar/cable_car_3.37.0.html"),controller:"CableCarController"}).state("cableCar.detail",{url:"/details",templateUrl:a("/html/templates/cableCar/cable_car_detail_3.47.1.0.html"),data:{searchParams:["cable car","cable car ticket"],displayName:"Cable Car",icon:"icon-es-cable-car"}}).state("cableCar.confirmation",{url:"/confirmations",templateUrl:a("/html/templates/cableCar/cable_car_confirmation_3.47.1.0.html"),data:{displayName:"Cable Car Confirmation"}}).state("cableCar.tickets",{url:"/tickets?:transaction-code",templateUrl:a("/html/templates/cableCar/cable_car_tickets_3.47.1.0.html"),data:{displayName:"Cable Car Transaction Details"}}).state("redeemReward",{url:"/rewardpoint",abstract:!0,templateUrl:a("/html/rewardpoint/redeemRewardLandingPage.html"),controller:"RedeemRewardAbstractController"}).state("redeemReward.scheme",{url:"/scheme",templateUrl:a("/html/rewardpoint/redeemRewardScheme.html"),controller:"RedeemRewardSchemeController",data:{searchParams:["reward point scheme"],displayName:"Reward Scheme",icon:"icon-es-reward-sceema"}}).state("redeemReward.showcase",{url:"/showcase",templateUrl:a("/html/rewardpoint/redeemRewardShowcase.html"),controller:"RedeemRewardShowcaseController",data:{searchParams:["redeem showcase"],displayName:"Redeem Showcase",icon:"icon-es-reward-sceema"}}).state("redeemReward.statement",{url:"/statement",templateUrl:a("/html/rewardpoint/redeemRewardStatement.html"),controller:"RedeemRewardStatementController",data:{searchParams:["reward point statement"],displayName:"Reward Point Statement",icon:"icon-es-reward-statement"}}).state("redeemReward.history",{url:"/history",templateUrl:a("/html/rewardpoint/redeemRewardHistory.html"),controller:"RedeemRewardHistoryController",data:{searchParams:["reward point history"],displayName:"Reward Point History",icon:"icon-es-reward-history"}}).state("shoppingMall",{url:"/shopload",template:'<div class="loading-gif" ng-if="showLoadingBarNibl"></div>\n',controller:"ShoppingMallResponseController"}).state("airline",{url:"/airline",abstract:!0,templateUrl:a("/html/airline/airline_base_3.51.0.0.html"),controller:"AbstractAirlineController"}).state("airline.new_search",{url:"/newsearch",templateUrl:a("/html/airline/air_search_template_3.40.0.html"),controller:"AirlineSearchController",data:{searchParams:["ticket","air ticket"],displayName:"Airline Ticket",icon:"icon-es-flight",showSubMenu:!0}}).state("airline.airline_list",{url:"/newList?origin&destination&no_of_adult&no_of_child&flight_date&trip_type&return_date",templateUrl:a("/html/airline/airline_search_result_3.51.0.0.html"),controller:"AirlineListController",data:{displayName:"Airline Ticket Listing",showSubMenu:!0}}).state("airline.booking",{url:"/booking",templateUrl:a("/html/airline/airline_booking_3.40.0.0.html"),controller:"AirlineBookingController",data:{displayName:"Airline Ticket Booking"}}).state("airline.transactionDetail",{url:"/transaction-detail/:txnCode",templateUrl:a("/html/airline/airline_tickets_3.51.0.0.html"),controller:"AirlineTransactionDetailController",data:{displayName:"Airline Ticket Transaction Details"}}).state("airline.myFlights",{url:"/my-flights",abstract:!0,templateUrl:a("/html/airline/my-flights/airline_my_flights_base.html"),controller:"AbstractAirlineMyFlightsController",data:{showSubMenu:!0}}).state("airline.myFlights.pastFlights",{url:"/past-flights",templateUrl:a("/html/airline/my-flights/airline_past_flights.html"),controller:"AirlinePastFlightsController",data:{displayName:"Past Flights",showSubMenu:!0}}).state("airline.myFlights.upcomingFlights",{url:"/upcoming-flights",templateUrl:a("/html/airline/my-flights/airline_upcoming_flights.html"),controller:"AirlineUpcomingFlightsController",data:{displayName:"Upcoming Flights",showSubMenu:!0}}).state("airline.rescheduleConfirmation",{url:"/reschedule-confirmation",templateUrl:a("/html/airline/my-flights/airline_reschedule_confirmation.html"),controller:"AirlineRescheduleConfirmationController",params:{rescheduleData:null,selectedFlight:null,ticketDetails:null,flightStatus:null,booking_uuid:null},data:{displayName:"Reschedule Confirmation"}}).state("airline.flightStatus",{url:"/flight-status",templateUrl:a("/html/airline/flight-status/airline_flight_status.html"),controller:"AirlineFlightStatusController",data:{displayName:"Flight Status",showSubMenu:!0}}).state("airline.myTicketReschedule",{url:"/airline-reschedule",templateUrl:a("/html/airline/my-flights/reschedule.html"),controller:"AirlineMyFlightRescheduleController",params:{ticketDetails:null,selectedPassengers:[],flightStatus:null},data:{displayName:"Reschedule Flight",showSubMenu:!0}}).state("airline.airlineCancellationPolicy",{url:"/airline-cancellation-policy",templateUrl:a("/html/airline/airline-cancellation-policy.html"),controller:"AirlineCancellationPolicyController",data:{displayName:"Airline Cancellation Policy"}}).state("airline_reschedule",{url:"/airline-reschedule",templateUrl:a("/html/airline/reschedule_home.html"),controller:"AbstractRescheduleController",data:{displayName:"Airline Ticket Reschedule"}}).state("airline_reschedule.search",{url:"/search",templateUrl:a("/html/airline/reschedule_search.html"),controller:"ARSearchController"}).state("airline_reschedule.search_result",{url:"/search-result",templateUrl:a("/html/airline/reschedule_date.html"),controller:"ARSearchResultController"}).state("airline_reschedule_confirm",{url:"/reschedule/confirmation",templateUrl:a("/html/airline/reschedule_confirmation.html"),controller:"ARConfirmationController"}).state("managed_fund_transfer",{url:"/managed_fund_transfer",templateUrl:a("/html/escrow/managed_fund_transfer_base_template.html"),controller:"EscrowController",data:{searchParams:["secured tarnsfer history","history"],displayName:"Secured Transfer History",icon:"icon-es-secure"}}).state("merchant.makePayment.intermediateStep",{url:"/moreDetails",templateUrl:a("/html/payment/intermediate_step.html")}).state("merchant.makePayment.secondIntermediateStep",{url:"/morePaymentDetails",templateUrl:a("/html/payment/second_intermediate_step.html")}).state("main.loadfund",{url:"/loadfund?unique_product_number&unique_trace_id&initiator_bank_id&requested_amount&merchant_code&paid_amount&data_validation&payment_status&swift_code&response_code&data",template:"<div></div>",controller:"LoadFundIntermediateController"}).state("cardFund",{url:"/cardLoad?xmlmsg",template:'<div class="loading-gif" ng-if="showLoadingBarNabil"></div>\n',controller:"CancelLoadCardController"}).state("loadfund",{abstract:!0,url:"/loadfund?unique_product_number&unique_trace_id&initiator_bank_id&requested_amount&merchant_code&paid_amount&data_validation&payment_status&swift_code&response_code&data",templateUrl:a("/html/templates/loadfund/fone_pay_form_3.45.0.0.html"),controller:"LoadFundController",data:{displayName:"Load Fund"}}).state("loadfund.linkedAccount",{url:"/linked-account",templateUrl:a("/html/templates/loadfund/fone_pay_linked_account_tab_3.50.0.0.html"),data:{displayName:"Load Fund Via Linked Account"}}).state("loadfund.mobileBanking",{url:"/mobile-banking",templateUrl:a("/html/templates/loadfund/fone_pay_mobile_banking_tab_3.40.0.html"),data:{displayName:"Load Fund Via Mobile Banking"}}).state("loadfund.eBanking",{url:"/e-banking",templateUrl:a("/html/templates/loadfund/fone_pay_internet_banking_tab_3.40.0.html"),data:{displayName:"Load Fund Via e-banking"}}).state("loadfund.card",{url:"/card",templateUrl:a("/html/templates/loadfund/fone_pay_card_load_dashboard.html"),controller:"FonePayCardLoadController",data:{displayName:"Load Fund Via Cardload"}}).state("loadCardSuccess",{url:"/loadfund/card/success",controller:"FonePaySuccessLoadCardController"}).state("loadCardCancel",{url:"/loadfund/card/cancel",controller:"CancelLoadCardController"}).state("cardLoad",{abstract:!0,url:"/:cardTitle",templateUrl:a("/html/templates/loadfund/fone_pay_card_load_3.48.0.0.html"),controller:"FonePayCreditCardController"}).state("cardLoad.domesticCard",{url:"/load1",templateUrl:a("/html/templates/loadfund/fone_pay_card_load_domestic_form_3.47.1.2.html"),data:{displayName:"Load Fund Via Domestic Card Load"}}).state("cardLoad.internationalCard",{url:"/load2",templateUrl:a("/html/templates/loadfund/fone_pay_card_load_international_form_3.47.1.2.html"),data:{displayName:"Load Fund Via Domestic International Load"}}).state("loadfund.cashPoint",{url:"/cash-point",templateUrl:a("/html/templates/loadfund/fone_pay_cash_point_tab.html"),data:{displayName:"Load Fund Via Cashpoint"}}).state("loadfund.counterDeposit",{url:"/counter-deposit",templateUrl:a("/html/templates/loadfund/fone_pay_counter_deposit_tab_3.38.0.html"),data:{displayName:"Load Fund Via Counter Deposit"}}).state("withdraw.sahakari",{url:"/sahakari-withdraw",templateUrl:a("/html/sahakari/sahakari_withdraw_form_3.40.0.html"),controller:"SahakariWithdrawController",data:{searchParams:["sahakari","withdraw"],displayName:"Sahakari Withdraw",pageTitle:"Sahakari Withdraw",icon:"icon-es-sahakari"}})}]),a.module("esewaPaymentApp").controller("EsewaRemitControllerV1",["$scope","$rootScope","StateConstant","MerchantPaymentService","$state","RemittanceService","EsewaCommissionCalculationFactory","CommonService","AUTH_EVENTS","$timeout",function(e,t,a,n,i,o,r,s,c,l){Object.keys(a),Object.values(a);e.paymentRequest={sent_amount:0,client_code:"ESEWAREMIT",channel:"WEB_USER",receiver_address:"NEPAL",source_of_income:"23",sender_address:"NEPAL"},e.miscScope={transactionDetails:{},senderDetails:{},receiverDetails:{},commission:{}};var u=new Date;function d(t,a){s.getJsonDataFromCdn("esewa-remit/"+t).then(function(n){e[t]=n.data,a&&"function"==typeof a&&a()})}function m(){e.buttonContent.showBackBtn=!1,e.buttonContent.nextState=a.ESEWA_REMIT_SENDER_DETAIL,e.miscScope.pageTitle={title:e.breadCrumbItems[0].name,index:1},d("purpose"),o.getDistrict().then(function(t){e.districtList=t.plain()}),o.getAmountLimit().then(function(t){e.miscScope.amountLimit=t.amount_filter_limit})}function p(t){var a=t?"AD"===t:"AD"===e.paymentRequest.sender_id_issued_date_format,n=e.miscScope.senderDetails.issueDate_ad,i=e.miscScope.senderDetails.issueDate_bs;e.paymentRequest.sender_id_issued_date=a?n:i}e.miscScope.maxDate={adYear:u.getFullYear(),bsYear:this.adYear+57},e.breadCrumbItems=[{name:"Transaction Details",state:a.ESEWA_REMIT_TRANSACTION_DETAIL,isDisabled:!1,isActiveState:!0},{name:"Sender Details",state:a.ESEWA_REMIT_SENDER_DETAIL,isDisabled:!0,isActiveState:!1},{name:"Receiver Details",state:a.ESEWA_REMIT_RECEIVER_DETAIL,isDisabled:!0,isActiveState:!1},{name:"Confirmation Details",state:a.ESEEW_REMIT_CONFIRMATION,isDisabled:!0,isActiveState:!1}],e.currentState=i.current.name,e.buttonContent={showBackBtn:"",backBtnText:"",backBtnClick:"",backBtnDisabled:"",proceedBtnText:"",proceedBtnClick:"",proceedBtnDisable:""},e.getProductCode=function(a,n){a&&o.getProductCode({district_id:n.id,district_name:n.value,amount:a}).then(function(t){e.paymentRequest.product_code=t.product_code},function(){t.showErrorSuccessMessage(errorResponse,!0,"ERROR_ON_SERVING_REQUEST")})},e.setButtonContent=function(){switch(i.current.name){case a.ESEWA_REMIT_TRANSACTION_DETAIL:m();break;case a.ESEWA_REMIT_SENDER_DETAIL:e.buttonContent.showBackBtn=!0,e.buttonContent.previousState=a.ESEWA_REMIT_TRANSACTION_DETAIL,e.buttonContent.nextState=a.ESEWA_REMIT_RECEIVER_DETAIL,e.miscScope.pageTitle={title:e.breadCrumbItems[1].name,index:2},d("relationship"),d("identificationType");break;case a.ESEWA_REMIT_RECEIVER_DETAIL:p(),e.buttonContent.showBackBtn=!0,e.buttonContent.previousState=a.ESEWA_REMIT_SENDER_DETAIL,e.buttonContent.nextState=a.ESEEW_REMIT_CONFIRMATION,e.miscScope.pageTitle={title:e.breadCrumbItems[2].name,index:3};break;case a.ESEEW_REMIT_CONFIRMATION:e.buttonContent.showBackBtn=!0,e.buttonContent.proceedBtnText="Confirm & Proceed",e.buttonContent.previousState=a.ESEWA_REMIT_RECEIVER_DETAIL,e.buttonContent.nextState="",e.miscScope.pageTitle={title:e.breadCrumbItems[3].name,index:4},d("disclaimerMessage");break;default:e.buttonContent.nextState=""}},e.handleBtnClick=function(n,r){n?(r&&e.breadCrumbItems.forEach(function(e,t){n===e.state&&(e.isDisabled=!1)}),t.goToState(n)):o.postPaymentDetail(e.paymentRequest,"ESEWAREMIT").then(function(e){var n;n=e,t.$broadcast(c.getBalanceAndRewards),i.go(a.TRANSACTIONS,{txnId:n.transaction_code,moduleId:n.module_id})},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})},e.remitDetails={transctionDetails:{},senderDetails:{},reveiverDetails:{},confirmationDetails:{}},e.getComissionDetails=function(){},e.getSenderDetails=function(a){if(a&&a.length>=10){var n={username:a,amount:e.paymentRequest.sent_amount,customer_type:"SENDER"};o.getUserDetail(n).then(function(t){e.miscScope.showSenderDetailsForm=!0,e.miscScope.senderKycStatus=t.status,e.paymentRequest.sender_esewa_id=a,e.paymentRequest.sender_name=t.sender_name,e.paymentRequest.sender_mobile=t.mobile_number?t.mobile_number:a,t.identification_type&&e.identificationType.forEach(function(a){t.identification_type===a.value&&(e.miscScope.senderDetails.identity=a)})},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}},e.changeIdentityType=function(t){e.paymentRequest.sender_id_type=t,e.paymentRequest.sender_id_number=""},e.getIdFromValue=function(e,t){if(e)return t.filter(function(t){return t.value.toLowerCase()===e.toLowerCase()})[0]},e.getReceiverDetails=function(a){if(a&&a.length>=10){var n={username:a,amount:e.paymentRequest.sent_amount,customer_type:"RECEIVER"};o.getUserDetail(n).then(function(t){e.miscScope.showReceiverDetailsForm=!0,e.miscScope.receiverKycStatus=t.status,e.paymentRequest.receiver_name=t.sender_name},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}},e.initEsewaRemit=function(){t.isPoint()?i.go(a.ESEWA_REMIT_TRANSACTION_DETAIL):i.go("main.landing")},e.$watch("paymentRequest.sender_id_issued_date_format",function(e){p(e)})}]),a.module("esewaPaymentApp").controller("EsewaRemitDashboardController",["$scope","StateConstant","$rootScope","RemittanceService","$window","DateFormatter","$state","$stateParams",function(e,t,a,n,i,o,r,s){function c(t){e.searchRequestParams.dateRange={startDate:e.totalTransactionSearchParams.remitFromDate,endDate:e.totalTransactionSearchParams.remitToDate};var a={from_date:o.formatDate(e.totalTransactionSearchParams.remitFromDate),to_date:o.formatDate(e.totalTransactionSearchParams.remitToDate),page:e.pageNumber-1,size:e.pageCount,type:t};e.isDefaultDateset=!0,u(a)}function l(t,a){var n={from_date:o.formatDate(e.searchRequestParams.dateRange.fromDate||e.searchRequestParams.dateRange.startDate),to_date:o.formatDate(e.searchRequestParams.dateRange.toDate||e.searchRequestParams.dateRange.endDate),type:a,page:e.pageNumber-1,size:e.pageCount,prop_value:t};e.isDefaultDateset=!1,u(n)}function u(t){a.message={},n.getCommonTransactionDetail(t).then(function(t){e.commonTransactionDetails=t,e.enableNextButton=e.commonTransactionDetails.length===e.pageCount},function(t){e.errorMessage=t,a.showErrorSuccessMessage(t,!0)})}var d;e.dateRange={},e.searchRequestParams={},e.searchRequestParams.dateRange={},e.pageCount=25,e.pageNumber=1,e.enableNextButton=!1,e.initDate=function(){e.dateRange.fromDate=i.moment().subtract(2,"days"),e.dateRange.toDate=i.moment()},e.initDate(),e.fetchFromToTransactionDetail=function(t){var a={from_date:o.formatDate(e.searchRequestParams.dateRange.startDate||e.searchRequestParams.dateRange.fromDate||t.fromDate),to_date:o.formatDate(e.searchRequestParams.dateRange.endDate||e.searchRequestParams.dateRange.toDate||t.toDate)};n.getRemitTransactionDetails(a).then(function(t){e.remitTransactionDetails=t})},e.increaseDecreasePageNumber=function(a){e.pageNumber=a?e.pageNumber+1:e.pageNumber-1,r.current.name===t.ESEWA_REMIT_TOTAL_COMMISSION_EARNED&&(e.isDefaultDateset?c("COMMISSION"):e.filterCommission(e.searchRequestParams)),r.current.name===t.ESEWA_REMIT_TOTAL_REMITTANCE_PAYMENT&&(e.isDefaultDateset?c("RECEIVER"):e.filterReceiver(e.searchRequestParams)),r.current.name===t.ESEWA_REMIT_TOTAL_SEND_MONEY&&(e.isDefaultDateset?c("SENDER"):e.filterSender(e.searchRequestParams))},e.goToTotalTransactionDetail=function(n,i){t.ESEWA_REMIT_TOTAL_COMMISSION_EARNED===n&&(a.transaction_amount=e.remitTransactionDetails.total_commission_amount),t.ESEWA_REMIT_TOTAL_REMITTANCE_PAYMENT===n&&(a.transaction_amount=e.remitTransactionDetails.total_receive_amount),t.ESEWA_REMIT_TOTAL_SEND_MONEY===n&&(a.transaction_amount=e.remitTransactionDetails.total_send_amount),r.go(n,{from_date:i.dateRange.fromDate,to_date:i.dateRange.toDate,amount:a.transaction_amount})},e.totalTransactionSearchParams={remitFromDate:s.from_date?s.from_date:e.dateRange.fromDate,remitToDate:s.to_date?s.to_date:e.dateRange.toDate,totalTransactionAmount:s.amount?s.amount:a.transaction_amount},e.previousState=a.fromState,r.current.name!==t.ESEWA_REMIT_DASHBOARD&&e.previousState!==t.ESEWA_REMIT_UPLOAD_RECEIVER_INFO||(d={from_date:o.formatDate(e.dateRange.fromDate),to_date:o.formatDate(e.dateRange.toDate)},n.getRemitTransactionDetails(d).then(function(t){e.remitTransactionDetails=t})),r.current.name===t.ESEWA_REMIT_TOTAL_COMMISSION_EARNED&&c("COMMISSION"),r.current.name===t.ESEWA_REMIT_TOTAL_REMITTANCE_PAYMENT&&c("RECEIVER"),r.current.name===t.ESEWA_REMIT_TOTAL_SEND_MONEY&&c("SENDER"),e.filterSender=function(t){l(t.id,"SENDER"),e.fetchFromToTransactionDetail(t.dateRange)},e.filterReceiver=function(t){l(t.id,"RECEIVER"),e.fetchFromToTransactionDetail(t.dateRange)},e.filterCommission=function(t){l(t.id,"COMMISSION"),e.fetchFromToTransactionDetail(t.dateRange)},e.uploadReceiverDocument=function(e){r.go(t.ESEWA_REMIT_UPLOAD_RECEIVER_INFO,{mtcn:e.mtcn,transaction_date:e.transactionDate,transaction_code:e.transactionCode})},e.downloadTransactionDetail=function(e){a.message={};n.getPDFTransactionDetail(e.transactionCode,{module_id:1}).then(function(e){i.open(e,"_blank")},function(e){a.showErrorSuccessMessage(e,!0)})}}]),a.module("esewaPaymentApp").controller("EsewaRemitReceiverController",["$scope","StateConstant","$state","$rootScope","RemittanceService","CommonService","DateFormatter","$window","$http","$stateParams","AUTH_EVENTS","$filter","CDNUrl",function(e,i,o,r,s,c,l,u,d,m,p,f,h){var g;function _(){e.buttonContent.showBackBtn=!0,e.buttonContent.proceedBtnText="Confirm",e.buttonContent.previousState=i.ESEWA_REMIT_RECEIVER_RECEIVER_DETAIL,e.buttonContent.nextState="",e.miscScope.pageTitle={title:e.breadCrumbItems[3].name,index:4,desc:"*Please confirm the detail below"},function(){if("BS"===e.miscScope.dob_type)return e.date_of_birth=e.paymentRequest.receiverDetails.date_of_birth_bs,e.date_of_birth;if("AD"===e.miscScope.dob_type)e.date_of_birth=e.paymentRequest.receiverDetails.date_of_birth_ad,e.date_of_birth}()}e.showloadingBar=!1,e.miscScope={dob_type:""},e.paymentRequest={receiverDetails:{},paymentDetails:{},senderDetails:{}},e.isCheque=!1,e.client_code="ESEWAREMIT",g="identificationType",c.getJsonDataFromCdn("esewa-remit/"+g).then(function(t){e[g]=t.data}),s.getDistrict().then(function(t){e.districtList=t.plain()}),e.checkMode=function(t){e.isCheque="Cheque"===t},e.validateOrgMtcnToken=function(t){r.message={};var a={token:t,client_code:e.client_code};s.validateTocken(a).then(function(t){e.transactionDetails=t,e.paymentRequest.senderDetails.sender_name=t.sender_name,e.paymentRequest.senderDetails.sender_address=t.sender_address,e.paymentRequest.senderDetails.sender_mobile=t.sender_mobile,e.paymentRequest.senderDetails.sender_city=t.sender_city,e.paymentRequest.senderDetails.sender_country=t.sender_country,e.paymentRequest.receiverDetails.receiver_name=t.receiver_name,e.paymentRequest.receiverDetails.receiver_address=t.receiver_address,e.paymentRequest.receiverDetails.receiver_phone=t.receiver_phone,e.paymentRequest.receiverDetails.receiver_city=t.receiver_city,e.paymentRequest.receiverDetails.receiver_country=t.receiver_country,e.paymentRequest.paymentDetails.payout_amount=t.payout_amount,e.paymentRequest.paymentDetails.txn_date=Date.parse(t.txn_date),e.paymentRequest.paymentDetails.payout_token_id=t.payout_token_id,o.go(i.ESEWA_REMIT_RECEIVER_TRANSACTION_DETAIL),e.breadCrumbItems[1].isDisabled=!1,e.breadCrumbItems[0].isDisabled=!0},function(t){e.errorMessage=t,r.showErrorSuccessMessage(t,!0)})},e.reset=function(e){e.$invalid=!0,r.message={}},e.breadCrumbItems=[{name:"Enter MTCN",state:i.ESEWA_REMIT_RECEIVER_MTCN,isDisabled:!1,isActiveState:!0},{name:"Transaction Details",state:i.ESEWA_REMIT_RECEIVER_TRANSACTION_DETAIL,isDisabled:!0,isActiveState:!1},{name:"Receiver Details",state:i.ESEWA_REMIT_RECEIVER_RECEIVER_DETAIL,isDisabled:!0,isActiveState:!1},{name:"Confirmation",state:i.ESEWA_REMIT_RECEIVER_CONFIRMATION_DETAIL,isDisabled:!0,isActiveState:!1}],e.currentState=o.current.name,e.buttonContent={showBackBtn:"",backBtnText:"",backBtnClick:"",backBtnDisabled:"",proceedBtnText:"Continue",proceedBtnClick:"",proceedBtnDisable:""},e.initReceiverMain=function(){r.isPoint()?o.go(i.ESEWA_REMIT_RECEIVER_MTCN):o.go("main.landing")},e.setButtonContent=function(){switch(o.current.name){case i.ESEWA_REMIT_RECEIVER_MTCN:e.buttonContent.showBackBtn=!1,e.buttonContent.nextState=i.ESEWA_REMIT_RECEIVER_TRANSACTION_DETAIL,e.miscScope.pageTitle={title:e.breadCrumbItems[0].name,index:1,desc:"*Please fill the MTCN below"};break;case i.ESEWA_REMIT_RECEIVER_TRANSACTION_DETAIL:e.buttonContent.showBackBtn=!0,e.buttonContent.proceedBtnText="Continue",e.buttonContent.previousState=i.ESEWA_REMIT_RECEIVER_MTCN,e.buttonContent.nextState=i.ESEWA_REMIT_RECEIVER_RECEIVER_DETAIL,e.miscScope.pageTitle={title:e.breadCrumbItems[1].name,index:2,desc:"*Please confirm the detail below"};break;case i.ESEWA_REMIT_RECEIVER_RECEIVER_DETAIL:e.buttonContent.showBackBtn=!0,e.buttonContent.proceedBtnText="Continue",e.buttonContent.previousState=i.ESEWA_REMIT_RECEIVER_TRANSACTION_DETAIL,e.buttonContent.nextState=i.ESEWA_REMIT_RECEIVER_CONFIRMATION_DETAIL,e.miscScope.pageTitle={title:e.breadCrumbItems[2].name,index:3,desc:"*Please fill the detail below"};break;case i.ESEWA_REMIT_RECEIVER_CONFIRMATION_DETAIL:_();break;default:e.buttonContent.nextState=""}},e.handleBtnClick=function(s,c){s?(c&&e.breadCrumbItems.forEach(function(e,t){s===e.state&&(e.isDisabled=!1)}),r.goToState(s)):function(){r.message={},s=r.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now(),e.uniqueId=r.$storage.profile.esewaId+"_"+s,e.paymentRequest.unique_id=e.client_code+"#"+s,r.showLoadingBar=!0,e.paymentDetails={beneficiary_id_type:e.paymentRequest.receiverDetails.id_type.value,beneficiary_id_number:e.paymentRequest.receiverDetails.id_number,beneficiary_mobile_no:[e.paymentRequest.receiverDetails.mobile_number],beneficiary_date_of_birth:e.date_of_birth,beneficiary_id_issue_by:e.paymentRequest.receiverDetails.id_issue_district?e.paymentRequest.receiverDetails.id_issue_district.value:"",payment_type:e.paymentRequest.receiverDetails.payment_mode,cheque_number:e.paymentRequest.receiverDetails.cheque_number,bank_name:e.paymentRequest.receiverDetails.bank_name,mtcn:e.paymentRequest.mtcn,amount:e.paymentRequest.paymentDetails.payout_amount,unique_id:e.paymentRequest.unique_id};var s;var c={back_image:e.paymentRequest.receiverDetails.back_image||null,front_image:e.paymentRequest.receiverDetails.front_image||null},l=e.paymentRequest.paymentDetails.payout_token_id;d({method:"POST",url:"/api/web/auth/remittance/confirm_transaction/"+e.client_code+"/"+l,headers:{"Content-Type":n},transformRequest:function(){var t=new FormData;return t.append("pick_up_request",new Blob([a.toJson(e.paymentDetails)],{type:"application/json"})),c.front_image&&t.append("front_image_file",new Blob([c.front_image],{type:"image"})),c.front_image&&t.append("back_image_file",new Blob([c.back_image],{type:"image"})),t},data:function(){var t={pick_up_request:e.paymentDetails};c.front_image&&(t.front_image_file=c.front_image);c.back_image&&(t.back_image_file=c.back_image);return t}()}).then(function(e){var t;t=e.data,r.$broadcast(p.getBalanceAndRewards),o.go(i.TRANSACTIONS,{txnId:t.transaction_code,moduleId:t.module_id})},function(e){r.showErrorSuccessMessage(e,!0),e&&$(function(){$(t).scrollTop(0)})}).finally(function(){r.showLoadingBar=!1})}()},e.unlockMTCN=function(){var t=e.paymentRequest.paymentDetails.payout_token_id;o.current.name===i.ESEWA_REMIT_RECEIVER_TRANSACTION_DETAIL&&(s.getUnlockMTCN(t).then(function(e){}),$(function(){$("#remitBtn").click(function(){location.reload()})}))}}]),a.module("esewaPaymentApp").controller("EsewaRemitUploadController",["$scope","$rootScope","$stateParams","$http","RemittanceService","$state","ecmsg",function(e,a,i,o,r,s,c){var l={mtcn:i.mtcn,transactionDate:i.transaction_date,transactionCode:i.transaction_code};e.previousState=a.fromState,a.message={},r.getBeneficiaryDetail(l.transactionCode).then(function(t){e.beneficiaryDetail=t},function(t){e.errorMessage=t.data,a.showErrorSuccessMessage(t,!0)}),e.uploadDocument=function(i){a.message={};var r,u=i.front_image||null,d=i.back_image||null;o({method:"POST",url:"/api/web/auth/remittance/upload/"+l.mtcn+"/document?transaction_date="+l.transactionDate,headers:{"Content-Type":n},transformRequest:function(){var e=new FormData;return u&&e.append("front_image_file",new Blob([i.front_image],{type:"image"})),d&&e.append("back_image_file",new Blob([i.back_image],{type:"image"})),e},data:(r={},u&&(r.front_image_file=u),d&&(r.back_image_file=d),r)}).then(function(t){c.success("Document uploaded Successfully."),s.go(e.previousState)},function(e){a.showErrorSuccessMessage(e,!0),e&&$(function(){$(t).scrollTop(0)})})},e.gotoBackState=function(){s.go(e.previousState)}}]),a.module("esewaPaymentApp").controller("HotelServiceController",["$scope","$rootScope","$modalInstance","airlines",function(e,t,a,n){e.airlinesServices=n,t.currentModal=a,e.cancel=function(){a.dismiss()},t.currentModal=a}]),a.module("esewaPaymentApp").controller("HotelsController",["$scope","$rootScope","$state","$stateParams","HotelService","DateFormatter","$timeout","StateConstant","$modal","$location","AUTH_EVENTS","$http","FileSaverFactory","StatementService","ecmsg","EsewaCommissionCalculationFactory","MerchantPaymentService","DefaultMessageConstant","CDNUrl",function(e,n,i,o,r,s,c,l,u,d,m,p,f,h,g,_,y,S,D){n.clearMessage(),e.nationality=["Nepalese","Indian"],e.selectedHotelList=[],n.message={},e.maxAdult=20,e.adults=[],e.openChildAge=!0,e.rooms=[],e.selectedHotel=null,e.minNoOfRooms=1,e.BookingDetails={},e.guest=[],e.noOfNights=1,e.childsAge={},e.noOfnonInfant=0,e.noOfInfant=0,e.searchRequest={};e.getCites=function(){p.get(D.url+"/data/oyoCities.json").then(function(t){e.cities=t})},e.commissionDetailService=_,e.getHotelCashBack=function(t){return e.calculateHotelCommission(t),e.commissionDetailService.getCashBack()},e.calculateHotelCommission=function(t){e.commissionDetailService.setCashBackCharge(1*e.commissionDetail.cashBack,e.commissionDetail.commissionResources),e.commissionDetailService.calculateForAmount(1*t)},null===e.selectedHotel&&i.go(l.HOTEL_LIST),e.noOfAdultChange=function(){e.maxChild=3*e.searchRequest.numberOfAdults,e.searchRequest.childs=[],e.searchRequest.noOfChild=0,e.searchRequest.noOfAdult=e.searchRequest.numberOfAdults;for(var t=0;t<e.maxChild;t++)e.searchRequest.childs.push({id:t,age:0});e.DefineRooms()},e.populateAdult=function(){e.minNoOfRooms=1,e.searchRequest.childs=[],e.rooms=[];for(var t=1;t<=e.maxAdult;t++)e.adults.push({id:t}),t<=4&&e.searchRequest.childs.push({id:t-1,age:0});e.rooms.push({id:1})},e.closeChildAge=function(){e.openChildAge=!1,e.DefineRooms()},e.reopenChildAge=function(){e.openChildAge=!0},e.calculateInfant=function(){e.noOfnonInfant=0;for(var t=1;t<=e.searchRequest.noOfChild;t++)e.childsAge[t]<5?e.noOfInfant++:e.childsAge[t]>=5&&e.noOfnonInfant++;e.DefineRooms()},e.DefineRooms=function(){0===e.searchRequest.noOfChild&&(e.noOfnonInfant=0),e.noOfnonInfant>0?(e.noOfTAdults=e.searchRequest.numberOfAdults+e.noOfnonInfant,e.minNoOfRooms=Math.floor(e.noOfTAdults/3),e.maxNoOfRooms=e.noOfTAdults):(e.noOfTAdults=e.searchRequest.numberOfAdults,e.minNoOfRooms=Math.floor(e.searchRequest.numberOfAdults/3),e.maxNoOfRooms=e.searchRequest.noOfAdult),e.noOfTAdults%3>0&&e.minNoOfRooms++,e.searchRequest.noOfRooms=e.minNoOfRooms,e.rooms=[];for(var t=e.minNoOfRooms;t<=e.maxNoOfRooms;t++)e.rooms.push({id:t})},e.closeThis=function(){e.openChildAge=!1},e.childAgeChange=function(){},e.noOfChildChange=function(){e.childsAge={},e.searchRequest.childs=[];for(var t=0;t<=e.searchRequest.noOfChild;t++)e.searchRequest.childs.push({id:t,age:0});e.searchRequest.noOfChild>=1&&(e.openChildAge=!0)},e.CheckDate=function(){if(e.searchRequest.dateRange.checkOutDate<=e.searchRequest.dateRange.checkInDate){var t=Date.parse(e.searchRequest.dateRange.checkInDate)+864e5;e.searchRequest.dateRange.checkOutDate=new Date(t)}},e.cancelHotelBooking=function(){i.go(l.HOTEL_LIST)};var R=new Date;e.title=["Mr","Ms","Mrs"],e.showSameMessage=!1,e.showloadingBar=!1,e.datePicker={startDate:R},e.searchRequest={checkOutDate:"",checkInDate:"",dateRange:new function(){this.checkInDate=new Date,this.checkOutDate=new Date,this.checkInDate.setDate(this.checkInDate.getDate()+1),this.checkOutDate.setDate(this.checkOutDate.getDate()+2)},noOfAdult:1,noOfChild:0,noOfInfant:"",childAge:{}},e.getHotelsAvailability=function(){r.getHotelsAvailabilities(e.searchHotelDto).then(function(t){n.message.error=null,e.availableHotels=t.plain(),e.searchedHotels=e.availableHotels.Hotels.Hotel,e.totalHotelCount=e.availableHotels.Hotels.Hotel.length,e.showloadingBar=!1,e.searchedHotels&&0!==e.totalHotelCount?e.totalHotelCount=e.availableHotels.Hotels.Hotel.length:(n.showInformation=!1,n.message.error="No Hotels available on this searched criteria. Please, select other options")},function(t){e.showloadingBar=!1,e.showMessage="No data available",n.showInformation=!1,a.isDefined(t)&&(t.data.error_message?n.message.error=t.data.error_message:n.message.error="Hotels are not available with provided search parameters.")})},e.findHotels=function(){e.commissionDetail={cashBack:0,charge:0,commissionResources:{}},e.showloadingBar=!0,e.searchRequest.ChildAge={};for(var t=1;t<=e.searchRequest.noOfChild;t++){var a="child_"+t+"_age";e.searchRequest.ChildAge[a]=e.childsAge[t]}var n,i=e.searchRequest.noOfChild;e.searchRequest.noOfChildRequest=e.searchRequest.noOfChild;for(var o=1;o<=i;o++)e.childsAge[o]>5&&(e.searchRequest.noOfAdult++,e.searchRequest.noOfChildRequest--);e.findHotelsFromServer(),(n=e.searchRequest.selectedCity.productCode)&&y.getProductCommission(n).then(function(t){t&&(e.commissionDetail=t.plain())}),e.searchedHotels=[]},e.findHotelsFromServer=function(){e.searchHotelDto={checkInDate:s.formatDate(e.searchRequest.dateRange.checkInDate),checkOutDate:s.formatDate(e.searchRequest.dateRange.checkOutDate),adults:e.searchRequest.noOfAdult,rooms:e.searchRequest.noOfRooms,noOfChild:e.searchRequest.noOfChildRequest,mobileNumber:e.searchRequest.mobileNumber,cancellationPolicy:!0,city:e.searchRequest.selectedCity.city,childAge:e.searchRequest.ChildAge},e.getHotelsAvailability()},e.getHotelDetails=function(t,a){e.guest=[],a&&(e.selectedHotelCashBack=a),e.noOfNights=Math.round((e.searchRequest.dateRange.checkOutDate-e.searchRequest.dateRange.checkInDate)/1e3/60/60/24),i.go(l.HOTEL_DETAILS,{hotel_id:t}),r.getHotelDeals(t).then(function(a){if(null===a)i.go(l.HOTEL_LIST),n.message.error="Hotel details cannot be obtained at the moment. Please, Try again later.";else{for(var o in e.selectedHotel=a[0],e.HotelDetails=function(e,t,a){for(var n=0;n<e.length;n++)if(e[n][t]===a)return e[n];return null}(e.searchedHotels,"id",t),e.selectedHotelImages=[],e.selectedHotel.images)e.selectedHotelImages.push(e.selectedHotel.images[o]);e.totalImage=e.selectedHotelImages.length}},function(e){console.log(e)})},e.confirmHotelBooking=function(){e.showloadingBar=!0;var o=n.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now();if(e.uniqueId=n.$storage.profile.esewaId+"_"+o,!a.isDefined(e.selectedHotel)||null===e.selectedHotel)return e.showloadingBar=!1,void(n.message.error=S.SERVICE_NA);e.BookingDTO={firstName:e.guest.firstname.trim(),lastName:a.isDefined(e.guest.middlename)?(e.guest.middlename+" "+e.guest.lastname).trim():e.guest.lastname.trim(),phone:e.guest.phone,email:e.guest.email,countryCode:"+977",checkin:e.searchHotelDto.checkInDate,checkout:e.searchHotelDto.checkOutDate,hotelId:e.selectedHotel.id,requestUniqueId:e.uniqueId,singleRoom:1,doubleRoom:0,extraRoom:0,totalGuest:e.searchRequest.noOfAdult,totalRoom:e.searchRequest.noOfRooms},e.BookingDetails={},r.makeHotelBooking(e.BookingDTO).then(function(t){e.showloadingBar=!1,e.BookingDetails=t.plain(),e.selectedHotelCashBack=e.getHotelCashBack(e.BookingDetails.final_amount)},function(t){e.showloadingBar=!1,i.go(l.HOTEL_LIST),n.message.error=t.data.error_message,e.showMessage="No data available"}),i.go(l.HOTEL_BOOKING)},e.confirmHotelBookingPayment=function(){e.showloadingBar=!0,e.PaymentDTO={amount:e.BookingDetails.final_amount,product_code:e.searchRequest.selectedCity.productCode,unique_id:e.BookingDetails.external_reference_id,properties:{id:e.BookingDetails.id,invoice:e.BookingDetails.invoice,checkin:e.BookingDTO.checkin,checkout:e.BookingDTO.checkout,roomCount:e.BookingDTO.noOfRooms,status:"Saved",no_of_guest:e.BookingDTO.noOfAdult+e.BookingDTO.noOfChild,final_amount:e.BookingDetails.final_amount,guest_name:e.BookingDTO.firstName+" "+e.BookingDTO.lastName,country_name:"Nepal",external_reference_id:e.BookingDetails.external_reference_id,currency_symbol:"",email:e.BookingDTO.email,phone:e.BookingDTO.phone,hotelName:e.selectedHotel.name,numberOfAdult:e.searchRequest.noOfAdult,numberOfChild:0===e.searchRequest.noOfChild?"N/A":e.searchRequest.noOfChild}},e.PaymentDetails={},r.makeHotelPayment(e.PaymentDTO).then(function(t){e.PaymentDetails=t.plain(),e.showloadingBar=!1,i.go(l.TRANSACTIONS,{txnId:t.transaction_code,moduleId:t.module_id}),n.$broadcast(m.getBalanceAndRewards)},function(t){i.go(l.HOTEL_LIST),e.showloadingBar=!1,e.showMessage="No data available"}),i.go(l.HOTEL_BOOKING)},e.getIcon=function(e){return"Complimentary Breakfast"===e?"fa-coffee":"Amazon Prime"===e?"fa-amazon":"Swimming Pool"===e?"fa-life-ring":"AC"===e||"Mini Fridge"===e?"fa-snowflake-o":"Living Room"===e||"Spa"===e||"Wellness Centre"===e?"fa-bed":"Free Wifi"===e?"fa-wifi":"Kitchen"===e||"Banquet Hall"===e||"Dining Area"===e||"Complimentary Veg Breakfast"===e||"Complimentary Breakfast"===e||"In-house Restaurant"===e?"fa-cutlery":"HDTV"===e||"TV"===e||"Netflix"===e?"fa-television":"Electricity Charges Included"===e||"Power backup"===e?"fa-plug":"Geyser"===e?"fa-sun-o":"Room Heater"===e?"fa-thumbs-up":"Bath Tub"===e?"fa-bath":"Parking Facility"===e?"fa-car":"Card Payment"===e?"fa-credit-card":"Lift/Elevator"===e?"fa-arrows-v":"Conference Room"===e?"fa-users":"Wheelchair Accessible"===e?"fa-wheelchair":"Laundry"===e?"fa-tint":"Bar"===e?"fa-glass":"Kindle"===e?"fa-tablet":"Pet Friendly"===e?"fa-paw":"CCTV Cameras"===e?"fa-video-camera":"fa-thumbs-up"}}]),a.module("esewaPaymentApp").service("HotelService",["Restangular",function(e){this.getHotelDeals=function(t){return e.one("auth").all("hotel").one("oyo").one(t).get()},this.getHotelsAvailabilities=function(t){return e.one("auth").all("hotel").one("oyo").one("availabilities").customPOST(t)},this.makeHotelBooking=function(t){return e.one("auth").all("hotel").one("oyo").one("booking").customPOST(t)},this.makeHotelPayment=function(t){return e.all("auth").one("make_payment").customPOST(t)}}]),a.module("esewaPaymentApp").controller("CancelLoadCardController",["$scope","$rootScope","$state","$cookies","LoadFundService","CDNUrl","$modal",function(e,t,a,n,i,o,r){var s=n.get("requestStr"),c=JSON.parse(s);if(n.remove("requestStr"),s)c.reference_number?i.getCSDLLoadFundDoPayment(s).then(function(e){l("/html/modal/load-fund/card_load_success.html","md","Fund Loaded Successfully.",e.plain())},function(e){l("/html/modal/load-fund/card_load_cancel.html","md","Load Rejected !",e)}):i.loadFromCardStatus(s).then(function(e){l("/html/modal/load-fund/card_load_success.html","md","Fund Loaded Successfully. ",e.plain())},function(e){l("/html/modal/load-fund/card_load_cancel.html","md","Load Rejected !",e)});else{!function(e,t,n,i){a.go("loadfund.card"),r.open({templateUrl:o.url+e,controller:"CreditCardModalController",size:t,resolve:{statusMessage:function(){return n},transactionDetails:function(){return i}}})}("/html/modal/load-fund/card_load_cancel.html","md","Load Cancelled !","Fund Load has been cancelled.")}function l(e,t,n,i){a.go("loadfund.card"),r.open({templateUrl:o.url+e,controller:"CreditCardModalController",size:t,resolve:{statusMessage:function(){return n},transactionDetails:function(){return i}}})}}]),a.module("esewaPaymentApp").controller("CreditCardModalController",["$scope","$rootScope","$modalInstance","statusMessage","transactionDetails","$state","StateConstant","AUTH_EVENTS",function(e,t,a,n,i,o,r,s){e.statusMessage=n,e.transactionDetails=i,e.close=function(){a.dismiss(),o.go("loadfund.card")},e.viewTransactionDetails=function(){t.$broadcast(s.getBalanceAndRewards),a.dismiss(),o.go(r.TRANSACTIONS,{txnId:e.transactionDetails.transaction_code,moduleId:e.transactionDetails.module_id})}}]),a.module("esewaPaymentApp").controller("FonePayCardLoadController",["$scope","$rootScope","$state",function(e,t,a){e.onCardLoadSelected=function(n){!0===n?(e.cardTitle="Domestic Card",a.go("cardLoad.domesticCard",{cardTitle:e.cardTitle})):(t.cardTitle="International Card",a.go("cardLoad.internationalCard",{cardTitle:e.cardTitle}))}}]),a.module("esewaPaymentApp").controller("FonePayCreditCardController",["$scope","$rootScope","$http","CDNUrl","LoadFundService","$sce","$modal","$state","$stateParams","$localStorage",function(e,t,n,i,o,r,s,c,l,u){e.cardLoadTitle=l.cardTitle,e.doPaymentRequestParam={},e.proceedButtonDisabled=!1,e.proceedButtonText="Proceed",n.get(i.url+"/data/cardloadPurposeAmount.json").then(function(t){e.purposeList=t.data.purpose_list,e.amountList=t.data.amount_list,e.minimumAmount=t.data.minimumAmount,e.maximumAmount=t.data.maximumAmount}),e.cardSessionObject={SessionID:"",OrderID:"",paymentUrl:""},e.credit={amount:0},e.addAmount=function(t){e.credit.amount||(e.credit.amount=0),e.credit.amount=e.credit.amount+t,e.fetchServiceChargeableAmount()},e.checkForRemarks=function(t){e.cardLoadRequestParam.purpose=e.credit.purpose||t,e.showRemarks="Other Utilities"==t},e.cancelCardLoad=function(){e.domesticCardLoad={},e.credit={},e.credit.amount=100},e.cardSessionObject.paymentUrl="";e.proceedLoadFund=function(a){t.message={},e.proceedButtonText="Processing",t.handleMiniLoadingBar("cardLoadingId",!0),u.bank_service_code=e.service_code,u.card_loading_bank=e.bank_name,"CSL"===e.service_code||"CSLI"===e.service_code?e.CLSCardLoadMethod(a):"CSLD_OFF_US"!==e.service_code&&"CSLD_ON_US"!==e.service_code||e.CSLDCardLoadMethod()},e.domesticCardLoad={},e.cardLoadRequestParam={},e.formDataRequestParam={},e.domesticLoadBankList=function(){t.message={},o.getBankListToDomesticCardLoad().then(function(t){e.domesticBankList=t},function(e){t.message.error=e.data.error_message})},e.setServiceChargeAsPerBankSelection=function(t){e.credit.amount=0,e.service_code=t.service_code,e.bank_name=t.bank_name,e.cardLoadRequestParam.swift_code=t.swift_code,e.fetchServiceChargeableAmount()},e.fetchServiceChargeableAmount=function(){e.cardLoadRequestParam.amount=e.credit.amount,e.credit.amount&&e.service_code&&o.getFreeLoadAmount(e.credit.amount,e.service_code).then(function(t){var a=t.plain();e.chargeableAmount=a.chargeable_amount,e.max_amount=a.max_amount,e.min_amount=a.min_amount,e.isServiceChargeApplied=t.plain().is_service_charge,e.fetchCommission()},function(e){t.message.error=e.data.error_message})},e.fetchCommission=function(){t.message={},o.loadFromCardCommission(e.service_code).then(function(t){var a=t.plain();e.percentageValue=a.commissionResources[0].value/100,e.calculateCommission(e.percentageValue)},function(e){t.message.error=e.data.error_message})},e.calculateCommission=function(t){e.isServiceChargeApplied?e.cardLoadRequestParam.service_charge=e.chargeableAmount*t:e.cardLoadRequestParam.service_charge=0},e.initInternationalCardLoad=function(){e.service_code="CSLI",e.fetchCommission()},e.CLSCardLoadMethod=function(n){t.message={},e.proceedButtonDisabled=!0,o.loadFromCard(n).then(function(n){e.cardSessionObject.SessionID=n.sessionID,e.cardSessionObject.OrderID=n.orderID,e.cardSessionObject.paymentUrl=n.url,e.$$phase||e.apply();var i=document.createElement("form");i.setAttribute("method","POST"),i.setAttribute("name","formpost"),i.setAttribute("id","nabil-form-post"),i.setAttribute("action",e.cardSessionObject.paymentUrl);var o=document.createElement("input");o.setAttribute("value",e.cardSessionObject.SessionID),o.setAttribute("name","SessionID"),i.appendChild(o);var r=document.createElement("input");r.setAttribute("value",e.cardSessionObject.OrderID),r.setAttribute("name","OrderID"),i.appendChild(r);var s=document.createElement("button");s.setAttribute("type","submit"),s.setAttribute("id","cardSessionSubmit"),i.appendChild(s),a.element(document.querySelector("#nabil-form-post")).append(i),setTimeout(function(){a.element(document.querySelector("#nabil-form-post #cardSessionSubmit")).click()},100),t.handleMiniLoadingBar("cardLoadingId",!1)},function(a){e.proceedButtonDisabled=!1,e.proceedButtonText="Proceed",t.handleMiniLoadingBar("cardLoadingId",!1),e.showError=!0,t.message.error=a.data.error_message})},e.paymentDetailsData={},e.CSLDCardLoadMethod=function(){t.message={},e.proceedButtonDisabled=!0,o.getCSLDCardLoadMethod(e.service_code,e.cardLoadRequestParam).then(function(n){e.paymentDetailsData=n,e.$$phase||e.apply();var i=document.createElement("form");i.setAttribute("method","POST"),i.setAttribute("name","formpost"),i.setAttribute("id","csld-form-post"),i.setAttribute("action",e.paymentDetailsData.url),_.forEach(e.paymentDetailsData.sign_data_resource,function(e,t){var a=t;(a=document.createElement("input")).setAttribute("value",e),a.setAttribute("name",t),a.classList.add("hidden"),i.appendChild(a)});var o=document.createElement("button");o.setAttribute("type","submit"),o.setAttribute("id","cardSubmit"),o.classList.add("hidden"),i.appendChild(o),a.element(document.querySelector("#csld-form-post")).append(i),setTimeout(function(){a.element(document.querySelector("#csld-form-post #cardSubmit")).click(),t.handleMiniLoadingBar("cardLoadingId",!1)},0)},function(a){e.proceedButtonDisabled=!1,e.proceedButtonText="Proceed",t.handleMiniLoadingBar("cardLoadingId",!1),e.showError=!0,t.message.error=a.data.error_message})}}]),a.module("esewaPaymentApp").controller("FonePaySuccessLoadCardController",["$scope","$rootScope","$state","$cookies","LoadFundService","CDNUrl","$modal",function(e,t,a,n,i,o,r){var s=n.get("requestStr"),c=JSON.parse(s);function l(e,t,n,i){a.go("loadfund.card"),r.open({templateUrl:o.url+e,controller:"CreditCardModalController",size:t,resolve:{statusMessage:function(){return n},transactionDetails:function(){return i}}})}n.remove("requestStr"),s&&(c.reference_number?i.getCSDLLoadFundDoPayment(s).then(function(e){l("/html/modal/load-fund/card_load_success.html","md","Fund Loaded Successfully.",e.plain())},function(e){l("/html/modal/load-fund/card_load_cancel.html","md","Load Rejected !",e)}):i.loadFromCardStatus(s).then(function(e){l("/html/modal/load-fund/card_load_success.html","md","Fund Loaded Successfully. ",e.plain())},function(e){l("/html/modal/load-fund/card_load_cancel.html","md","Load Rejected !",e)}))}]),a.module("esewaPaymentApp").controller("LoadFromShoppingMallController",["$scope","bankInfo","$http","CDNUrl","$modalInstance","LoadFundService","$rootScope","$window",function(e,t,n,i,o,r,s,c){e.bankInfo=t,e.shoppingMall={swift_code:t.swift_code},n.get(i.url+"/js/fonepay_amount_and_purpose_list.json").then(function(t){e.primary_remarksList=t.data.purpose_list,e.amountList=t.data.amount_list}),e.addAmount=function(t){e.shoppingMall.amount=(e.shoppingMall.amount||0)+t},e.close=function(){o.dismiss()},e.proceedShoppingMallLoad=function(t){r.shoppingMallInitialRequest(t).then(function(t){e.shoppingMallRequestObj={AMT:t.AMT,AppType:t.AppType,BankId:t.BankId,CG:t.CG,CRN:t.CRN,ITC:t.ITC,MD:t.MD,PID:t.PID,PRN:t.PRN,RU:t.RU,USER_LANG_ID:t.USER_LANG_ID,UserType:t.UserType},setTimeout(function(){a.element(document.querySelector("#shopping-mall-form form")).attr("action",t.request_url),a.element(document.querySelector("#shopping-mall-form #submitShoppingMallSession")).click()},0)},function(t){s.message.error=t.data.error_message,e.close()})}}]),a.module("esewaPaymentApp").controller("LoadFundController",["$scope","$modal","$rootScope","$location","$localStorage","BankService","LoadFundService","$stateParams","$state","$window","CDNUrl","LinkedAccountService","$filter","$cookies",function(e,t,n,i,o,r,s,c,l,u,d,m,p,f){n.clearMessage(),n.isLoggedIn()||l.go("login");f.get("requestStr");if(e.loadFund={},e.counterDepositBanks=[],e.linkedAccounts=[],e.loadFundSkeletonLoading=!0,e.loadFundTitle=l.current.name.substring(9),e.changeLoadFundTitle=function(t){e.loadFundTitle=t},r.getBankListForWithdraw().then(function(t){var a;a=t.plain(),m.getLinkedAccount().then(function(t){e.linkedAccounts=t.plain(),e.loadFundSkeletonLoading=!1,e.linkedAccounts.forEach(function(e){e.bank_display_name=p("bankInfoWithSwiftCode")(e.swift_code,"bank_display_name",a)})},function(t){n.showErrorSuccessMessage(t,!0),e.loadFundSkeletonLoading=!1})},function(e){n.showErrorSuccessMessage(res,!1)}),e.getCounterDepositBanks=function(){s.getCounterDepositBanks().then(function(t){e.counterDepositBanks=t.plain()})},a.isDefined(c.data)||a.isDefined(c.unique_product_number)){history.pushState(null,"","/#/loadfund");var h=c;s.verifyLoadFundRequest(h).then(function(e){t.open({templateUrl:g("/html/fonepay/fone_pay_success_modal_40.0.0.html"),size:"md",controller:"LoadFundSuccessModalController",resolve:{statement:function(){return e}}})},function(e){var a;a=e.data,t.open({templateUrl:g("/html/fonepay/fone_pay_failure_modal_40.0.0.html"),size:"md",controller:"LoadFundFailureModalController",resolve:{message:function(){return a}}})})}function g(e){return d.url+e}function _(t){e.showloadingBar=t}e.getBankList=function(){_(!0),s.getFonePayBankList().then(function(t){e.bankList=t.plain(),e.fonePayMobileBanking=e.bankList.fonepay_mobile_banking;var a=e.fonePayMobileBanking.indirect_banking_list;a.forEach(function(e,t){a[t].return_url=function(e){try{JSON.parse(e)}catch(t){return e}return JSON.parse(e)}(e.return_url)}),e.fonePayMobileBanking.indirect_banking_list=a,e.fonePayInternetBanking=e.bankList.fonepay_internet_banking}).finally(function(){_(!1)})},e.openTabs=function(e){"object"==typeof e?(u.open(e.android,"_blank"),u.open(e.ios,"_blank")):u.open(e)},e.isShoppingMall=function(e){e.is_shopping_mall?function(e){t.open({templateUrl:g("/html/load-fund//shopping_mall_modal.html"),size:"md",controller:"LoadFromShoppingMallController",resolve:{bankInfo:function(){return e}}})}(e):u.open(e.return_url,"_blank")},e.showBankModal=function(e,a,n=!1){e.isMobileBanking=a,t.open({templateUrl:d.url+"/html/linked_account/v1/load_fund_form.html",size:"sm",controller:"LoadFundModalController",resolve:{bank:function(){return e},isLinkedAccount:function(){return n}}})}}]),a.module("esewaPaymentApp").controller("LoadFundFailureModalController",["$scope","$rootScope","$localStorage","$modalInstance","message",function(e,t,a,n,i){e.username=a.profile.username,e.message=i,e.close=function(){n.dismiss()}}]),a.module("esewaPaymentApp").controller("LoadFundIntermediateController",["$rootScope","$stateParams","$state",function(e,t,a){e.clearMessage(),e.isLoggedIn()||a.go("login");var n=t;e.goToState("loadfund.linkedAccount",n)}]),a.module("esewaPaymentApp").controller("LoadFundModalController",["$scope","$modal","$modalInstance","$window","$http","bank","isLinkedAccount","LoadFundService","CDNUrl","StateConstant","$rootScope","AUTH_EVENTS","EsewaCommissionCalculationFactory","$interval",function(e,t,n,i,o,r,s,c,l,u,d,m,p,f){function h(e){t.open({templateUrl:"/user/fonepay/views/fone_pay_failure_modal.html",size:"md",controller:"LoadFundFailureModalController",resolve:{message:e}})}function g(t,a){e.message={isSuccess:t,message:a}}e.bank=r,e.isLinkedAccount=s,e.showRemarks=!1,e.commissionDetailService=r.unique_id?p:{},e.isConfirmationState=!1,e.showOtpVerification=!1,e.otpResponseObj={},e.otpInput="",e.isOtpExpired=!1,e.otpErrorMessage="",o.get(l.url+"/js/fonepay_amount_and_purpose_list.json").then(function(t){e.purposeList=t.data.purpose_list,e.amountList=t.data.amount_list}),e.close=function(){n.dismiss()},e.checkForRemarks=function(t){e.showRemarks="Other Utilities"===t},e.addAmount=function(t){e.loadFund.amount=(e.loadFund.amount||0)+t},e.$watch("loadFund.amount",function(t){if(r.unique_id&&t>0){var a={bank_code:r.swift_code,amount:e.loadFund.amount};c.validateAccountLinkCommission(a).then(function(t){var a;t.is_service_charge&&(e.paymentRequest=e.loadFund,a=e.loadFund.amount,c.getCommissionForBank(r.swift_code).then(function(t){e.commissionDetailService.setCashBackCharge(0,t.commissionResources),e.commissionDetailService.calculateForAmount(a)},function(e){g(!1,error.data.error_message||error.data.message)}))},function(e){g(!1,e.data.error_message||e.data.message)})}}),e.proceedLoadFund=function(){var t;if(r.unique_id)(t=_.pick(r,["unique_id","account_name"])).source_bank_swift_code=r.swift_code,t.amount=e.loadFund.amount,t.remarks=e.showRemarks?e.loadFund.remarks:null,c.loadFromLinkedAccount(t).then(function(e){d.$broadcast(m.getBalanceAndRewards),d.goToState(u.TRANSACTIONS,{txnId:e.transaction_code,moduleId:e.module_id})},function(e){h(e.data)}).finally(function(){e.close()});else{var n=a.copy(e.loadFund);n.bank_code=r.swift_code,n.is_mobile_banking=r.isMobileBanking,n.remarks=e.showRemarks?e.loadFund.remarks:null,c.loadFundRequest(n).then(function(e){d.showLoadingBar=!0,i.location.href=e.plain().url},function(e){d.showLoadingBar=!1,h(e.data)})}},e.sendOtp=function(){var t;(t=_.pick(r,["unique_id","account_name"])).source_bank_swift_code=r.swift_code,t.amount=e.loadFund.amount,t.remarks=e.showRemarks?e.loadFund.remarks:null,c.createLinkedAccountTxnRequest(t).then(function(t){e.otpResponseObj=t.plain(),e.otpResponseObj.otp_expiry_time=1*e.otpResponseObj.expiry_time_in_minutes*60;var a=f(function(){if(0===e.otpResponseObj.otp_expiry_time)return f.cancel(a),e.isOtpExpired=!0,void(e.otpErrorMessage="Otp expired. Please try again with a new request.");e.otpResponseObj.otp_expiry_time--},1e3);e.showOtpVerification=!0},function(t){e.close(),h(t.data)})},e.verifyOtp=function(){var t={txn_unique_id:e.otpResponseObj.txn_unique_id,unique_id:r.unique_id,otp:e.otpInput};c.verifyOtpAndPerformTxn(t).then(function(t){d.$broadcast(m.getBalanceAndRewards),d.goToState(u.TRANSACTIONS,{txnId:t.transaction_code,moduleId:t.module_id}),e.close()},function(t){e.otpErrorMessage=t.data.error_message||t.data.message||"Something went wrong, please try again later"})},e.resendOtp=function(){var t={unique_id:r.unique_id,txn_unique_id:e.otpResponseObj.txn_unique_id};c.resendOtp(t).then(function(t){e.otpResponseObj=t.plain(),e.otpResponseObj.otp_expiry_time=Math.ceil((new Date(e.otpResponseObj.otp_expiry_time).getTime()-(new Date).getTime())/1e3),g(!0,"OTP message resent.")},function(e){g(!1,e.data.error_message||e.data.message)})}}]),a.module("esewaPaymentApp").controller("LoadFundSuccessModalController",["$scope","$rootScope","$modalInstance","$localStorage","statement","AUTH_EVENTS",function(e,t,a,n,i,o){e.username=n.profile.username,t.$broadcast(o.getBalanceAndRewards),e.statement=i,e.close=function(){a.dismiss()}}]),a.module("esewaPaymentApp").controller("ShoppingMallResponseController",["$scope","$rootScope","$cookies","LoadFundService","$modal","CDNUrl","AUTH_EVENTS",function(e,t,a,n,i,o,r){function s(t){e.modalInstance=i.open({templateUrl:o.url+t,size:"md",scope:e})}e.showLoadingBarNibl=!0,n.shoppingMallPaymentRequest(a.get("requestStr")).then(function(a){e.showLoadingBarNibl=!1,e.transactionDetails=a,t.$broadcast(r.getBalanceAndRewards),s("/html/modal/load-fund/shopping_mall_transaction_detail.html")},function(t){e.showLoadingBarNibl=!1,e.errorMessage=t.data.error_message,s("/html/modal/load-fund/shopping_mall_transaction_fail.html")}),e.close=function(){e.modalInstance.close(),t.goToState("main.loadfund")}}]),a.module("esewaPaymentApp").service("LoadFundService",["Restangular",function(e){this.getFonePayBankList=function(){return e.all("/auth/get_load_fund_banks").customGET()},this.loadFundRequest=function(t){return e.one("/auth/load_fund").customPOST(t)},this.verifyLoadFundRequest=function(t){return e.one("/auth/load_fund/verification").customPOST(t)},this.getCounterDepositBanks=function(){return e.one("/auth/load_fund/counter_deposit").customGET()},this.loadFromCard=function(t){return e.one("/auth/card_load").customPOST(t)},this.loadFromCardStatus=function(t){return e.one("/auth/card_load/verification").customPOST(t)},this.loadFromCardCommission=function(t){return t?e.one("/auth/card_load/commission/"+t).withHttpConfig({selfHandleLoadingBar:!0}).get():e.one("/auth/card_load/commission").get()},this.loadFromLinkedAccount=function(t){return e.one("auth/account_link/load").customPOST(t)},this.createLinkedAccountTxnRequest=function(t){return e.one("auth/account_link/load/create").customPOST(t)},this.verifyOtpAndPerformTxn=function(t){return e.one("auth/account_link/load/v2").customPOST(t)},this.resendOtp=function(t){return e.one("auth/account_link/load/resend_otp").customPOST(t)},this.validateAccountLinkCommission=function(t){return e.one("auth/account_link/commission/validate").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.getCommissionForBank=function(t){return e.one("auth/account_link").one(t).one("commission").withHttpConfig({selfHandleLoadingBar:!0}).get()},this.getFreeLoadAmount=function(t,a){return a?e.one("/auth/card_load/service_charge/"+a).withHttpConfig({selfHandleLoadingBar:!0}).customPOST({amount:t}):e.one("/auth/card_load/service_charge").customPOST({amount:t})},this.shoppingMallInitialRequest=function(t){return e.one("/auth/load_fund/shopping_mall").customPOST(t)},this.shoppingMallPaymentRequest=function(t){return e.one("/auth/load_fund/shopping_mall/verification_request").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.getBankListToDomesticCardLoad=function(){return e.one("/auth/card_load/bank/details").withHttpConfig({selfHandleLoadingBar:!0}).get()},this.getCSLDCardLoadMethod=function(t,a){return e.one("/auth/cybersource_load/"+t+"/sign").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(a)},this.getCSDLLoadFundDoPayment=function(t){return e.one("/auth/cybersource_load/verification").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)}}]),a.module("esewaPaymentApp").controller("BankController",["$scope","$rootScope","$state","BankService","EsewaCommissionCalculationFactory","AUTH_EVENTS","NewTransactionDetail","$modal","DefaultMessageConstant","$window","$localStorage","$http","CDNUrl","$timeout","DirectDebitService","PaymentConstant",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g,y,S){function D(e){return h.url+e}function R(e){var t=!1;return a.forEach(e,function(e,n){a.isDefined(e.is_personal_account)&&e.is_personal_account&&(t=!0)}),t}function b(e){var t=[];return a.forEach(e,function(e,n){var i=!1;a.isDefined(e.is_personal_account)?(e.accountType=e.is_personal_account?"Free Account":"Favourite Accounts",i=!!e.is_personal_account):e.accountType="Banks",i?t.unshift(e):t.push(e)}),t}function A(){if(e.commissionDetailService.resetCommission(),e.paymentRequest.swift_code)for(var t in e.bankList)e.bankList[t].swift_code===e.paymentRequest.swift_code&&(e.productDetails.bank_display_name=e.bankList[t].bank_display_name)}function T(t){e.serviceChargeResponse=t.plain(),e.paymentRequest.selectedBankForWithdraw=e.paymentRequest.selectedBankForWithdraw||{},e.paymentRequest.selectedBankForWithdraw.max_amount&&(e.maxAmount=e.serviceChargeResponse.max_amount||e.getMaxAmount(e.paymentRequest.selectedBankForWithdraw.swift_code),e.paymentRequest.selectedBankForWithdraw.max_amount=e.maxAmount,e.minAmount=e.serviceChargeResponse.min_amount||e.minAmount(e.paymentRequest.selectedBankForWithdraw.swift_code),e.paymentRequest.selectedBankForWithdraw.min_amount=e.minAmount)}function v(t){e.commissionDetailService.setCashBackCharge(0,t.commissionResources),e.processAmountForAgents(t.tdsPercentage)}function w(){return p.user&&p.user.isAgentWithdraw?"withdraw.agentBankWithdraw.confirm":"withdraw.bankWithdraw.confirm"}function P(){return{swift_code:e.paymentRequest.swift_code,account_number:e.paymentRequest.destination_account_number,account_name:e.paymentRequest.account_holder_name,destination_bank_name:e.paymentRequest.selectedBankForWithdraw}}e.defaultPaymentLabelText=S.WALLET_LABEL,e.otherPaymentLabelText=S.OTHER_PAYMENT_LABEL,e.miscScope={confirmButtonText:e.defaultPaymentLabelText,selectedBankAccountDetails:{},totalPayableAmount:"",product:"Generic",paymentOptionType:S.WITHDRAW_DD_OPTION_TYPE},e.showRemarks=!1,e.getBankList=function(){r.getBankListForWithdraw().then(function(t){p.user;!function(t){g(function(){r.getUserSavedBankListForWithdraw().then(function(n){var o,r,s,c,l;e.userSavedBankList=function(e,t){var n=[];return a.forEach(t,function(t,a){for(var i=0;i<e.length;i++)t.swift_code===e[i].swift_code&&(t.bank_display_name=e[i].bank_display_name+" ",t.max_amount=e[i].max_amount,t.min_amount=e[i].min_amount,n.push(t))}),n}(t,n.plain()),s=e.userSavedBankList,c=R(s),l=i.isVerfiedPrimaryUser()||i.isPrimaryPoint(),!c&&l&&(o=e.userSavedBankList.length,r=R(e.userSavedBankList),u.open({templateUrl:D("/html/templates/bankinformation/add_bank_view_3.48.0.0.html"),size:"md",controller:"UserPersonalInformationController",resolve:{fromModal:function(){return!0},selectBank:function(){return o&&!r}}}))},function(e){!function(e){console.log(e)}(e),i.$emit("bankList","")}).finally(function(){e.userSavedBankList=b(e.userSavedBankList),e.userSavedBankList=function(t){var n=[];if(t&&t.length>0){var i=t.filter(function(e){return!0===e.is_linked_account}),o=t.filter(function(e){return!0===e.is_personal_account&&!e.is_linked_account});n=Object.assign(i.concat(o)),a.forEach(t,function(e){e.is_linked_account||e.is_personal_account||n.push(e)}),n=e.setDefaultUserSavedBankList(n)}return n}(e.userSavedBankList),e.netBankList=b(t),e.netBankList&&i.$emit("bankList",e.netBankList)})},200)}(t.plain())},function(e){i.message.error=e.hasOwnProperty("data")?e.data.error_message||e.data.message:d.SERVICE_NA}),e.getPurpose("WITHDRAW")},e.setRemarks=function(t){e.showRemarks=!1,"Others"===t?(e.paymentRequest.remarks="",e.showRemarks=!0):e.paymentRequest.remarks=t},e.getPurpose=function(t){r.getBankTransferPurpose("auth/"+t+"/purpose").then(function(t){e.purpose=t.plain()},function(e){a.isDefined(e.data.error_message)&&ecmsg.info(e.data.error_message)})},e.selectedUserBank=function(t){e.selectedBankForWithdraw=t,e.paymentRequest.selectedBankForWithdraw=t},e.setActiveUserSavedBank=function(t){return e.userSavedBankList.forEach(function(e){t.account_number===e.account_number?e.isSelected=!0:e.isSelected=!1}),e.userSavedBankList},e.setDefaultUserSavedBankList=function(e){return e.forEach(function(e){e.isSelected=!1}),e},e.disableSubmit=!1,a.isDefined(i.$storage.profile)||i.$storage.profile.isVerified||o.go("main.landing"),O(),e.paymentConfirmation=!1,e.commissionDetailService=s,e.productDetails={},e.bankCommission=function(){if(e.paymentRequest.swift_code){for(var t in e.bankList)e.bankList[t].swift_code===e.paymentRequest.swift_code&&(e.productDetails.bank_display_name=e.bankList[t].bank_display_name);r.getBankWithdrawCommission(e.paymentRequest.swift_code).then(function(t){e.commissionDetailService.setCashBackCharge(0,t.commissionResources)},function(e){i.message=d.SOMETHING_WENT_WRONG}),e.processAmount()}},e.commissionProcessorResource={swift_code:"",account_name:"",account_number:"",amount:""},e.agentBankCommission=function(){A(),e.paymentRequest.swift_code&&e.paymentRequest.account_holder_name&&e.paymentRequest.destination_account_number&&e.paymentRequest.amount&&(e.commissionProcessorResource={bank_code:e.paymentRequest.swift_code,account_holder_name:e.paymentRequest.account_holder_name,account_number:e.paymentRequest.destination_account_number,amount:e.paymentRequest.amount},r.checkAgentBankWithdrawCommission(e.commissionProcessorResource).then(function(t){T(t),e.serviceChargeResponse.is_service_charge?r.getBankWithdrawCommissionForAgent(e.commissionProcessorResource).then(function(e){v(e)},function(e){i.message=d.SOMETHING_WENT_WRONG}):e.processAmount()},function(){e.processAmount(),i.message=d.SOMETHING_WENT_WRONG}))},e.getBankCommissionFromBankDetail=function(){A(),e.paymentRequest.swift_code&&e.paymentRequest.account_holder_name&&e.paymentRequest.destination_account_number&&e.paymentRequest.amount?(e.commissionProcessorResource={bank_code:e.paymentRequest.swift_code,account_holder_name:e.paymentRequest.account_holder_name,account_number:e.paymentRequest.destination_account_number,amount:e.paymentRequest.amount},r.checkForBankWithdrawCommission(e.commissionProcessorResource).then(function(t){T(t),e.serviceChargeResponse.is_service_charge?r.getBankWithdrawCommissionNew(e.commissionProcessorResource).then(function(e){v(e)},function(e){i.message=d.SOMETHING_WENT_WRONG}):e.processAmount()},function(){i.message=d.SOMETHING_WENT_WRONG})):e.paymentRequest.swift_code&&e.paymentRequest.account_holder_name&&e.paymentRequest.mobile_number&&e.paymentRequest.amount&&(e.commissionProcessorResource={bank_code:e.paymentRequest.swift_code,account_holder_name:e.paymentRequest.account_holder_name,mobile_number:e.paymentRequest.mobile_number,amount:e.paymentRequest.amount},r.checkForBankWithdrawCommission(e.commissionProcessorResource).then(function(t){T(t),e.serviceChargeResponse.is_service_charge?r.getBankWithdrawCommissionNew(e.commissionProcessorResource).then(function(e){v(e)},function(e){i.message=d.SOMETHING_WENT_WRONG}):e.processAmount()},function(){i.message=d.SOMETHING_WENT_WRONG}))},e.processAmount=function(){var t,n,i;e.paymentRequest.selectedBankForWithdraw.swift_code&&(t=e.paymentRequest,n=e.userSavedBankList,i=!1,e.userSavedBankList.length&&a.forEach(n,function(e,n){a.isDefined(e.is_personal_account)&&e.is_personal_account&&a.isDefined(t.account_holder_name)&&t.account_holder_name.toUpperCase()===e.account_name.toUpperCase()&&t.destination_account_number===e.account_number&&t.swift_code===e.swift_code&&(i=!0)}),i?s.setOnlyAmount(e.paymentRequest.amount):(s.calculateForAmount(e.paymentRequest.amount),s.getTotalPayingAmount(),s.getCharge()),e.$$phase||e.$apply())},e.processAmountForAgents=function(t){e.paymentRequest.selectedBankForWithdraw.swift_code&&(e.serviceChargeResponse.chargeable_amount>0&&(s.calculateForAmount(e.serviceChargeResponse.chargeable_amount),s.setAmount(e.paymentRequest.amount),s.getCharge(),s.setCashBackChargeAndTds(t),s.getTds(),s.getTotalPayingAmountForAgent()),s.getTotalPayingAmountForAgent(),e.$$phase||e.$apply())},e.sendOption={},e.getMobileOrAccountNo=function(t){e.paymentRequest.destination_account_number=null,e.paymentRequest.mobile_number=null,"is_account_number"==t?(e.sendOption.acnoMobile="is_account_number",e.acnoMobile="is_account_number",e.loadAcNoAndName(e.paymentRequest.selectedBankForWithdraw)):(e.sendOption.acnoMobile="is_mobile_number",e.acnoMobile="is_mobile_number",e.isAcNameAndNumberDisabled=!1)},e.validateBankAccount=function(){i.message={};var t={bank_code:e.paymentRequest.swift_code,account_number:e.paymentRequest.destination_account_number,account_holder_name:e.paymentRequest.account_holder_name,mobile_number:e.paymentRequest.mobile_number};e.paymentRequest.destination_account_number?r.validateBankAccount(t).then(function(t){"Complete Matched"===t.message&&(t.message="Bank Account validated successfully"),I(t.message,t.code,e.paymentRequest)},function(t){var a=t.hasOwnProperty("data")?t.data.error_message||t.data.message:d.SERVICE_NA;I(a,!1,e.paymentRequest)}).finally(function(){e.isEligibleUser()&&e.validateDirectDebitService()}):e.paymentRequest.mobile_number&&r.validateMobileBankAccount(t).then(function(t){I(t.message,t.code,e.paymentRequest)},function(t){var a=t.hasOwnProperty("data")?t.data.error_message||t.data.message:d.SERVICE_NA;I(a,!1,e.paymentRequest)}).finally(function(){e.isEligibleUser()&&e.validateDirectDebitService()})},e.makeBankWithdraw=function(t,n){var s=a.isDefined(t);if(e.bankValidationSuccessMsg=!1,e.isUserSavedBank)!function(t,n){var s=a.isDefined(t),u={unique_id:e.selectedBankForWithdraw.unique_id,amount:e.paymentRequest.amount,remarks:e.paymentRequest.remarks,purpose:e.paymentRequest.purpose};a.isDefined(t)&&(u.properties={ddWithdrawBookingId:t},e.miscScope.booking_id=t),e.disableSubmit=!0,r.linkedBankWithdraw(u).then(function(e){o.go("merchant.transaction",{txnId:e.transaction_code,moduleId:e.module_id}),C(e),i.$broadcast(c.getBalanceAndRewards),l.selectedAccount=P()},function(o){E(),e.paymentConfirmation=!1,601===o.code&&s||a.isDefined(o.data)&&601==o.data.code&&s?(e.miscScope.transaction_code=n,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(o.data)&&(o=o.data),k(t,!0,o)):(i.showErrorSuccessMessage(o,!0,"PAYMENT_FAILED"),L())}).finally(function(){e.disableSubmit=!1,e.isUserSavedBank=!1,O()})}(t,n);else{e.disableSubmit=!0;var u=Object.assign({},e.paymentRequest);u.bank_code=u.swift_code,e.paymentRequest.mobile_number?u.is_mobile_number=!0:u.is_mobile_number=!1,a.isDefined(t)&&(u.properties={ddWithdrawBookingId:t},e.miscScope.booking_id=t),r.bankWithdraw(u).then(function(e){o.go("merchant.transaction",{txnId:e.transaction_code,moduleId:e.module_id}),C(e),i.$broadcast(c.getBalanceAndRewards),l.selectedAccount=P()},function(o){e.paymentConfirmation=!1,601===o.code&&s||a.isDefined(o.data)&&601==o.data.code&&s?(e.miscScope.transaction_code=n,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(o.data)&&(o=o.data),k(t,!0,o)):(i.showErrorSuccessMessage(o,!0,"PAYMENT_FAILED"),L())}).finally(function(){e.disableSubmit=!1,O()})}};var C=function(e){l.amount=e.amount,l.properties=e.properties,l.narration=e.narration,l.requestUniqueId=e.requestUniqueId,l.channel=e.channel,l.transaction_status=e.transaction_status,l.created=e.created,l.product_logo_url=e.product_logo_url,l.product_name=e.product_name,l.processed_by=e.processed_by};function k(t,a,n){e.$modalInstance=u.open({templateUrl:h.url+"/html/airline/withdraw_confirmation_modal_3.48.0.0.html",controller:"WithdrawConfirmationModalController",size:"lg",backdrop:"static",keyboard:!1,scope:e,resolve:{booking_id:function(){return t},isDirectLoadSuccess:function(){return a},errorResponse:function(){return n},stateToReturnOnWithdrawFail:function(){return{state:i.isAgent()?"withdraw.agentBankWithdraw":"withdraw.bankWithdraw"}}}})}function E(){m.scrollTo({top:0,behavior:"smooth"})}e.mpinVerification=function(t){t&&(e.mpinFn=t)},e.isBankSelected=function(){return a.isDefined(e.miscScope.selectedBankAccountDetails.swift_code)},e.validateDirectDebitService=function(){e.miscScope.totalPayableAmount=e.paymentRequest.amount,e.isDirectDebitEnabled=!1,e.miscScope.confirmButtonText=e.defaultPaymentLabelText;var t={amount:e.paymentRequest.amount,payment_option_type:S.WITHDRAW_DD_OPTION_TYPE,properties:{destinationBankCode:e.paymentRequest.swift_code,accountHolderName:e.paymentRequest.account_holder_name,destinationAccountNumber:e.paymentRequest.destination_account_number,isMobileNumber:"is_mobile_number"===e.sendOption.acnoMobile,mobileNumber:"is_mobile_number"===e.sendOption.acnoMobile?e.paymentRequest.mobile_number:null}};y.getProductPaymentOptions(t).then(function(t){var a=t.plain();e.miscScope.paymentOptionsResponse=a,Array.isArray(a)&&(e.isDirectDebitEnabled=a[1].enabled)})},e.credentialInput="",e.$on("onConfirmation",function(o,r){if(E(),e.paymentFailureMessage=[{id:1,isSelected:!1,labelText:"Keep in my eSewa Wallet"},{id:2,isSelected:!1,labelText:"Withdraw back to my bank account"}],e.credentialInput=r,e.isBankSelected()){var s,l=e.miscScope.selectedBankAccountDetails,u={source_bank_swift_code:l.swift_code,amount:e.miscScope.totalPayableAmount,unique_id:l.unique_id,req_unique_id:(s=i.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now(),i.$storage.profile.esewaId+"_"+s),payment_option_type:S.WITHDRAW_DD_OPTION_TYPE,properties:{destinationBankCode:e.paymentRequest.swift_code,destinationAccountNumber:e.paymentRequest.destination_account_number,accountHolderName:e.paymentRequest.account_holder_name,isMobileNumber:"is_mobile_number"===e.sendOption.acnoMobile,mobileNumber:"is_mobile_number"===e.sendOption.acnoMobile?e.paymentRequest.mobile_number:null}};y.performDirectLoad(u,e.credentialInput).then(function(t){var a=t.plain();e.credentialInput="",0===t.code?(i.$broadcast(c.getBalanceAndRewards),e.makeBankWithdraw(t.booking_id,t.load_transaction_id)):k(n,!1,a)},function(e){a.isDefined(e.data.error_message)?i.showErrorSuccessMessage(e,!0,"INVALID"):k(n,!1,e)})}}),e.showConfirmationView=function(){e.validateBankAccount()},e.isEligibleUser=function(){return i.isUser()||function(){if(p.user)return"ZONE"!==p.user.organizationType&&"ESEWA_CENTER"!==p.user.organizationType&&"SUPER_ZONE"!==p.user.organizationType;return!1}()},e.cancelPayment=function(){L(),O(),e.paymentConfirmation=!1,i.clearMessage(),e.invalidFormMessage="",e.trustedHtml="",e.showInformation=!1,o.go("^")};var I=function(t,a,n,i){u.open({templateUrl:D("/html/templates/user/merchant/payments/views/account_validation_dialog.html"),size:"md",controller:N,scope:e,resolve:{paymentRequest:function(){return n},message:function(){return t},successBtnText:function(){return-1===a?"":0===a?"PROCEED":"CONTINUE ON YOUR OWN RISK"},makeBankWithdraw:function(){return i}}})},N=["$scope","paymentRequest","successBtnText","message","AUTH_EVENTS","$rootScope","$modalInstance","makeBankWithdraw","$window","$filter","$localStorage",function(e,t,a,n,i,s,c,l,u,d,m){s.currentModal=c,e.cancel=function(){m.user&&m.user.isAgentWithdraw?o.go("withdraw.agentBankWithdraw"):o.go("withdraw.bankWithdraw"),c.dismiss(),r.setConfrimation(!1)},e.proceed=function(){u.scrollTo({top:0,behavior:"smooth"}),t.selectedBankForWithdraw=t.selectedBankForWithdraw.bank_display_name,t.accountValidationMessage=n,t.account_holder_name=d("reverse_camel_case")(t.account_holder_name.toLocaleLowerCase()),c.dismiss(),r.setConfrimation(!0),a&&(e.$parent.paymentConfirmation=!0,o.go(w()),e.stepLast=!0)},e.message=n,e.successBtnText=a,e.makeBankWithdraw=l}];function O(){e.paymentRequest={amount:"",remarks:"",account_holder_name:"",destination_account_number:""},e.selectedPurpose={},e.showRemarks=!1,e.$$phase||e.$apply()}function L(){e.selectedBankForWithdraw=n,e.paymentRequest.selectedBankForWithdraw=n,e.isAcNameAndNumberDisabled=!1,e.setDefaultUserSavedBankList(e.userSavedBankList)}e.reset=function(){O(),L(),e.hideInitialCofirmation=!0,i.clearMessage(),e.invalidFormMessage="",e.trustedHtml="",e.showInformation=!1,e.isUserSavedBank=!1},e.getAccountRegex=function(t){var a=_.filter(e.bankList,{swift_code:t})[0];return a?a.account_regex:"/^[a-zA-Z0-9-]{3,30}$/"},e.getMinAmount=function(t){var a=_.filter(e.bankList,{swift_code:t})[0];return a?a.min_amount:1},e.getMaxAmount=function(t){var a=_.filter(e.bankList,{swift_code:t})[0];return a?a.max_amount:1e5},e.getBankInstruction=function(t){var a=_.filter(e.bankList,{swift_code:t})[0];return a?a.instruction:""},e.loadAcNoAndName=function(t){t&&(e.isAcNameAndNumberDisabled=!1,a.isDefined(t.is_personal_account)&&a.isDefined(t.is_linked_account)?e.isUserSavedBank=!0:e.isUserSavedBank=!1,a.equals(t,{})||(a.isDefined(t.status)&&"ACTIVE"!==t.status&&(ecmsg.error("Service for the selected bank is not available at the moment"),L()),e.paymentRequest.swift_code=t.swift_code,e.paymentRequest.account_holder_name=t.account_name,e.paymentRequest.destination_account_number=t.account_number,e.paymentRequest.regex=t.regex,t.account_name&&(e.isAcNameAndNumberDisabled=!0,e.sendOption.acnoMobile="is_account_number",e.acnoMobile="is_account_number")))}}]),a.module("esewaPaymentApp").controller("EscrowController",["$scope","$http","MerchantPaymentService","$modal","$rootScope","CDNUrl","$sce","PaymentConstant",function(e,t,n,i,o,r,s,c){function l(e){return new Date(e).toISOString().substring(0,10)}e.showMangedFundTransferDisclaimer=!1,a.isDefined(e.miscScope)?e.miscScope.sendMoneyContent="sendMoney":e.miscScope={sendMoneyContent:"managedFundTransfer"},e.getDataAsPerApiUrl=function(t,a,i,o){n.getFtPurpose(t,i).then(function(t){e[a]=t.plain(),o&&o()},function(e){})},e.miscScope.setAmountValidation=function(t,a){e.paymentRequest.amount<e.miscScope.managedFundTransferDetailObj.minimumAmount?(t.amount.$setValidity("min",!1),"SECURED_TRANSFER"===a&&(e.miscScope.isManagedFundTransfer=!1)):t.amount.$setValidity("min",!0),e.paymentRequest.amount>e.miscScope.managedFundTransferDetailObj.maximumAmount?(t.amount.$setValidity("max",!1),"SECURED_TRANSFER"===a&&(e.miscScope.isManagedFundTransfer=!1)):t.amount.$setValidity("max",!0)},e.getProductDetails=function(t,a){n.getFtPurpose(t).then(function(t){e.miscScope.managedFundTransferDetailObj=t.plain(),"SECURED_TRANSFER"===e.miscScope.managedFundTransferDetailObj.productCode?(e.miscScope.sftObj=Object.assign({},t.plain()),e.productDetails.displayName=e.miscScope.sftObj.displayName,e.productDetails.name=e.miscScope.sftObj.name):(e.miscScope.baltxnObj=Object.assign({},t.plain()),e.productDetails.displayName=e.miscScope.baltxnObj.displayName,e.productDetails.name=e.miscScope.baltxnObj.name),e.miscScope.trustedPaymentDescription=s.trustAsHtml(t.shortDescription),e.miscScope.setAmountValidation(a,e.productDetails.productCode)},function(e){showErrorMsg(e)})},e.miscScope.setProductDescription=function(t){!0===e.miscScope.isManagedFundTransfer?e.getProductDetails("payment_menus/products/SECURED_TRANSFER",t):e.getProductDetails("payment_menus/products/BALTXN",t)},e.disableUseSecuredFundTransferCheckBox=function(){return Object.keys(scope.managedFundTransferPreference).length},e.showEnterEsewaIdAndAmountMessage=function(){!a.isDefined(e.paymentRequest)||""!==e.paymentRequest.properties.receiverName||""!==e.paymentRequest.amount&&0!==e.paymentRequest.amount||(e.miscScope.showEnterEsewaIdAndAmountMessage=!0,setTimeout(function(){e.miscScope.showEnterEsewaIdAndAmountMessage=!1,e.$$phase||e.$apply()},3e3))},e.securedTransferToggled=function(t,n){e.paymentForm=n,a.isDefined(t)&&!0===t.target.checked?e.managedFundTransferPreference.service_enabled?(e.miscScope.isManagedFundTransfer=!0,e.miscScope.isManagedFundTransferSetFromChild=!0):(e.miscScope.isManagedFundTransfer=!1,e.miscScope.isManagedFundTransferSetFromChild=!1):e.miscScope.isManagedFundTransfer=!1,e.miscScope.showEnterEsewaIdAndAmountMessage=!1,e.miscScope.isManagedFundTransfer?e.getManagedFundTransferPreference(n):e.openWarningAlert()},e.openWarningAlert=function(){e.miscScope.isManagedFundTransfer||i.open({templateUrl:r.url+"/html/escrow/escrow_warning_alert.html",controller:"EscrowModalController",backdrop:"static",size:"md",scope:e})},e.isFilterToggled=!1,e.minDate=moment(),e.dateObj={},e.dateObj.dateRange={},e.filterParams={status:"PENDING",from_date:"",to_date:"",request_type:"OUTGOING"},e.toggleFilter=function(){e.isFilterToggled=!e.isFilterToggled},e.setRequestType=function(t){e.filterParams.request_type=t||"OUTGOING",e.getManagedFundTransferStatement(e.filterParams.status)},e.clearErrorMsg=function(){o.message={}},n.getPendingTxnCounts().then(function(t){var a=t.find(e=>"SECURED_TRANSFER"===e.service_code);e.pendingEscrowCounts=a?a.count:0,o.$broadcast(c.ESCROW_PENDING_COUNT,{pendingCount:e.pendingEscrowCounts})}),e.getManagedFundTransferStatement=function(t,a){e.clearErrorMsg(),e.filterParams.from_date=l(e.dateObj.dateRange.fromDate),e.filterParams.to_date=l(e.dateObj.dateRange.toDate),e.filterParams.status=t,e.filterParams.page=0,e.filterParams.size=100,e.filterParams.esewa_id=a,n.getManagedFundTransferStatement(e.filterParams).then(function(t){e.statementList=t.plain()},function(t){e.statementList=[]})},e.initDate=function(){e.dateObj.dateRange.fromDate=moment().subtract(90,"days"),e.dateObj.dateRange.toDate=moment()},e.initDate(),e.getManagedFundTransferStatement("PENDING"),e.setProductDetails=function(t){e.miscScope.sendMoneyContent=t||"","managedFundTransfer"===t&&(e.productDetails.name="Secured Fund Transfer",e.paymentRequest.amount=0,e.paymentRequest.properties.remarks=""),e.miscScope.hidePaymentDescription=!0},e.openEscrowDisputeModal=function(t){e.clearErrorMsg(),e.disputeDetails={unique_id:t.unique_id,transfer_remarks:t.transfer_remarks},i.open({templateUrl:r.url+"/html/escrow/escrow_dispute_confirmation_dialog.html",controller:"EscrowModalController",backdrop:"static",size:"md",scope:e})},e.openEscrowReleaseModal=function(t){e.clearErrorMsg(),e.releaseDetails={unique_id:t.unique_id},i.open({templateUrl:r.url+"/html/escrow/escrow_release_confirmation_dialog.html",controller:"EscrowModalController",backdrop:"static",size:"md",scope:e})},e.openEscrowRequestModal=function(t){e.clearErrorMsg(),e.requestDetails={unique_id:t.unique_id,transfer_remarks:t.transfer_remarks},i.open({templateUrl:r.url+"/html/escrow/escrow_request_confirmation_dialog.html",controller:"EscrowModalController",backdrop:"static",size:"md",scope:e})}}]),a.module("esewaPaymentApp").controller("EscrowModalController",["$scope","$rootScope","MerchantPaymentService","ecmsg","$modalInstance","$state","StateConstant","$http",function(e,t,i,o,r,s,c,l){e.cancel=function(){r.dismiss()},t.currentModal=r,e.closeDialog=function(){e.disputeDetails={},e.releaseDetails={},r.dismiss()},e.fundRelease=function(){var a={unique_id:e.releaseDetails.unique_id};t.showloadingBar=!0,i.fundRelease(a).then(function(a){e.closeDialog(),e.getManagedFundTransferStatement("PENDING"),o.error(a.message),s.go(c.TRANSACTIONS,{txnId:a.transaction_code,moduleId:1}),t.showloadingBar=!1},function(a){t.showloadingBar=!1,e.closeDialog(),o.error(a.data.error_message)})},e.fundRequest=function(){var a={unique_id:e.requestDetails.unique_id,transfer_remarks:e.requestDetails.transfer_remarks};t.showloadingBar=!0,i.requestForAcknowledgement(a).then(function(a){e.closeDialog(),o.success(a.message,""),e.getManagedFundTransferStatement("PENDING"),t.showloadingBar=!1},function(a){t.showloadingBar=!1,e.closeDialog(),o.error(a.data.error_message)})},e.details={},e.details.document=[],e.fetchDisputeChargeMessage=function(){i.fetchDisputeChargeMessage(e.disputeDetails.unique_id).then(function(t){e.disputeChargeMessage=t.message},function(e){o.error(e.data.error_message)})},e.initiateDispute=function(){var i={unique_id:e.disputeDetails.unique_id,transfer_remarks:e.disputeDetails.transfer_remarks,issue_category_id:e.disputeDetails.issue_category_id,document_title:e.disputeDetails.document_title};t.showloadingBar=!0,l({method:"POST",url:"/api/web/auth/managed_ft/payments/dispute",headers:{"Content-Type":n},transformRequest:function(){var t=new FormData;for(var n in t.append("rejectionDto",new Blob([a.toJson(i)],{type:"application/json"})),e.details.document)t.append("issueImage",e.details.document[n]);return t},data:{rejectionDto:e.disputeDetails,issueImage:e.details.document!==n?e.file:null}}).then(function(a){o.success(a.data.message,""),r.dismiss(),e.getManagedFundTransferStatement("PENDING"),t.showloadingBar=!1},function(e){t.showloadingBar=!1,o.error(e.data.error_message),r.dismiss()})}}]),a.module("esewaPaymentApp").controller("EscrowPendingCountController",["$scope","$rootScope","MerchantPaymentService","PaymentConstant",function(e,t,a,n){e.pendingEscrowCounts=0,a.getPendingTxnCounts().then(function(t){var a=t.find(e=>"SECURED_TRANSFER"===e.service_code);e.pendingEscrowCounts=a?a.count:0}),t.$on(n.ESCROW_PENDING_COUNT,function(t,a){e.pendingEscrowCounts=a.pendingCount})}]),a.module("esewaPaymentApp").controller("MerchantPaymentController",["$scope","$rootScope","$state","$stateParams","MerchantPaymentService","ecmsg","$timeout","$http","EsewaCommissionCalculationFactory","AUTH_EVENTS","CDNUrl","NewTransactionDetail","$sce","$location","StateConstant","ValidationService","PropertyOrderFactory","WuContants","PaymentValidationService","DefaultMessageConstant","$filter","CommonService","$interval","PropertyConstant","$modal","$window","DirectDebitService","$localStorage","PaymentConstant","DateFormatter",function(e,i,o,r,s,c,l,u,d,m,p,f,h,g,y,S,D,R,b,A,T,v,w,P,C,k,E,I,N,O){e.initDate=function(){e.dateRange={startDate:k.moment().subtract(90,"days"),endDate:k.moment()}},e.initDate(),e.getUrl=function(e){return p.url+e},e.formatDatePattern=function(t){e.dateRangeFormat={fromDate:O.formatDate(t.fromDate?t.fromDate:e.dateRange.startDate),toDate:O.formatDate(t.toDate?t.toDate:e.dateRange.endDate)}},e.commissionDetailService=d,ie(),ne(),te();var L,F={};(L=r.product_code||"")!==P.airlineProductCode?L.startsWith("oyo_")||L.startsWith("OYO")?o.go("merchant.hotels.search"):L&&U(L):o.go("merchant.airlines"),e.mobileOperator={},r.product_code===P.topup&&(u.get(p.url+"/data/topup.json").success(function(e){q=e}),x("","Topup"),e.productDetails={displayName:"Direct Topup",name:"Direct Topup",shortDescription:"Please enter the phone number.NT Prepaid, NT Postpaid, NT Tollfree, NT Landline/ADSL, CDMA, Ncell Prepaid, Ncell Postpaid, UTL",logoPath:"/common/icons/payment/direct_topup.png"},oe(e.productDetails));var M=[];function B(){k.scrollTo({top:0,behavior:"smooth"})}u.get(p.url+"/data/directDebitEnabledProductList.json").then(function(e){M=e.data});var q=[];e.loadCashinNumber=function(){l(function(){e.cashinNumber=r.cashinNumber,e.paymentRequest.properties.receiverName=r.cashinNumber},10)},i.clearMessage(),e.setValueFor=function(t,n){e.isMap(t)&&("table"===n?a.copy(t,e.propertyTable):a.copy(t,e.propertyResponse))},e.getJsonDataAsPerFileName=function(t){v.getJsonDataFromCdn(t).then(function(a){e[t]=a.data,e.$$phase||e.$apply()})},e.getDataAsPerApiUrl=function(t,a,n,i){s.getFtPurpose(t,n).then(function(t){e[a]=t.plain(),i&&i(t.plain())},function(e){ee(e)})},e.setTopUpMobileNumber=function(){I.profile.esewaId.indexOf("@")<0&&(e.paymentRequest.properties.mobileNumber=I.profile.esewaId,e.getMobileOperator(I.profile.esewaId))},e.dynamicMerchantIntegration=function(t,a,n,o,r,c){i.message={};var l=Object.assign({},o),u=l.loadingElementId,d={url:t,requestType:a,data:_.omit(l,["loadingElementId"]),scriptPath:r||"",urlParams:c||{}};s.dynamicMerchantService(d,u).then(function(t){e[n]=t.plain()},function(e){i.handleMiniLoadingBar(u,!1),ee(e,"ERROR_ON_SERVING_REQUEST")})},e.commonHttpCall=function(t,a,n,o,r,s,c){i.message={};var l=Object.assign({},n),d=l.loadingElementId;u({url:t,method:a,data:_.omit(l,["loadingElementId"]),headers:{loadingElementId:d}}).then(function(t){e[o]=t.data,v.isOfTypeFunction(r)&&r(t.data)},function(e){c||i.showErrorSuccessMessage(e,!0),v.isOfTypeFunction(s)&&s(e)})};var $=[];function U(t){var a=t===P.topup,n=a?"Direct Topup":o.params.product_name;i.setDocumentTitle(n),a?W(t):(e.commissionDetailService.setRewardPoint(0),i.showMerchantFormLoading=!0,s.getProductDetails(t).then(function(t){"INACTIVE"==t.plain().status&&(i.showErrorSuccessMessage(t.plain().userRemarks,!0,"SERVICE_INACTIVE",!0),i.goToState(y.HOME_MAIN)),function(t){t?(e.productDetails=t,oe(e.productDetails),W(t.productCode),u.get(p.url+"/data/excludeListInPaymentReq.json").then(function(e){z=e.data}),u.get(p.url+"/data/hiddenPropertiesList.json").then(function(e){$=Array.from(new Set($.concat(e.data)))}),a=t.productCode,u.get(p.url+"/data/hidden_properties/"+a+"_hiddenPropertiesList.json").then(function(e){$=Array.from(new Set($.concat(e.data)))}),setTimeout(function(){t.id&&"ACTIVE"===t.status&&e.miscScope.showRecentTransactions&&x(t)},500)):e.productDetails={displayName:r.product_name,name:r.product_name};var a;"INACTIVE"!==t.status&&ae(r.product_code)}(t.plain())},function(e){c.error(ee(e,"ERROR_FETCHING_DATA",!0)),i.goToState(y.HOME_MAIN)}).finally(function(){i.showMerchantFormLoading=!1}))}function x(t,a){s.getRecentTransactionForProduct(t.id,a).then(function(t){e.miscScope.recentTransactions=t.plain()},function(e){console.log("error while getting recent transaction"+e)})}function W(t){e.htmlLinkForProduct=t===P.topup?p.url+"/html/TOPUP_3.50.0.0.html":p.url+"/html/payment/firstStep/"+e.productDetails.productType+"/"+t+".html"}function H(t,a,n){e.$modalInstance=C.open({templateUrl:p.url+"/html/airline/withdraw_confirmation_modal_3.48.0.0.html",controller:"WithdrawConfirmationModalController",size:"lg",backdrop:"static",keyboard:!1,scope:e,resolve:{booking_id:function(){return t},isDirectLoadSuccess:function(){return a},errorResponse:function(){return n},stateToReturnOnWithdrawFail:function(){return{state:y.MAKE_PAYMENT,params:o.params}}}})}function V(a){var n=i.$storage.profile.esewaId+"_"+t.performance&&t.performance.now&&t.performance.timing&&t.performance.timing.navigationStart?t.performance.now()+t.performance.timing.navigationStart:Date.now();e.uniqueId=i.$storage.profile.esewaId+"_"+n,e.paymentRequest.unique_id=a?e.uniqueId:r.product_code+"#"+n}function G(e){v.getHiddenStatDetailProps().success(function(t){Q(e,t),o.go(y.TRANSACTIONS,{txnId:e.transaction_code,moduleId:e.module_id})}),i.$broadcast(m.getBalanceAndRewards)}function j(e){c.error(ee(e,"PAYMENT_FAILED",!0)),o.reload()}e.isShowable=function(e){return!_.includes($,e)},e.isShowableProperties=function(e){return _.includes(["fullClientName"],e)},e.managedBalanceTransfer=function(){var t=Object.assign({},e.paymentRequest),n={purpose:t.properties.purpose,receiver_esewa_id:t.properties.receiverEsewaId,remarks:t.properties.remarks,amount:t.amount};s.initiateManagedFundTransfer(n).then(function(t){e.miscScope.initiateManagedFundTransferDetails=t.plain(),a.isDefined(t)&&(ne(),te(),e.showFundTransferModalConfirmation())},function(e){ee(e,"PAYMENT_FAILED")})},e.miscScope.setPaymentPropertiesForRecentTransaction=function(t){e.miscScope.ngModelKeysForRecentTxn&&e.miscScope.ngModelKeysForRecentTxn.forEach(function(a){v.isOfTypeObject(a)?Object.keys(a).forEach(function(n){if(v.isOfTypeObject(a[n]))a[n].forEach(function(a){if(v.isOfTypeObject(a)){var i=Object.keys(a),o=Object.values(a);i.forEach(function(a,i){if(a.indexOf(".")>0){var r=a.split(".");t.properties[o[i]]&&(e.paymentRequest[n][r[0]][r[1]]=t.properties[o[i]])}else t.properties[o[i]]&&(e.paymentRequest[n][a]=t.properties[o[i]])})}else t.properties[a]&&(e.paymentRequest[n][a]=t.properties[a])});else if(n.indexOf(".")>-1){let i=a[n].split("."),o=n.split(".");t[i[0]][i[1]]&&(e.paymentRequest[o[0]][o[1]]=t[i[0]][i[1]])}else t[n]&&(e.paymentRequest[n]=t[n])}):t.properties[key]&&(e.paymentRequest[key]=t.properties[key])}),k.trackLogEvent&&k.trackLogEvent({eventTitle:"Used Recent Payment for "+e.productDetails.name,eventType:"select_content"}),console.dir(e.paymentRequest)},e.showFundTransferModalConfirmation=function(){C.open({templateUrl:p.url+"/html/escrow/managed_fund_transfer_confirmation.html",controller:re,size:"lg",backdrop:"static",scope:e})},e.balanceTransfer=function(t){a.isDefined(t)&&(e.paymentRequest.properties.directDebitBookingId=t),ne(),s.fundTransfer(e.paymentRequest).then(function(e){G(e)},function(e){ee(e,"PAYMENT_FAILED")})},e.tayarMakePayment=function(t,o){u({method:"POST",url:"api/web/auth/tayar/make_payment",headers:{"Content-Type":n},transformRequest:function(){return e.formDataMakePaymentPayload}}).then(function(t){l(function(){i.showloadingBar=!1,v.isOfTypeFunction(e.miscScope.paymentSucessCallback)?e.miscScope.paymentSucessCallback(t):G(t.data)},100)},function(n){i.showloadingBar=!1,a.isDefined(t)&&(601===n.code||a.isDefined(n.data)&&601==n.data.code)?(e.miscScope.transaction_code=o,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(n.data)&&(n=n.data),H(t,!0,n)):j(n)})},e.usualMakePayment=function(t,n){s.makePayment(e.paymentRequest).then(function(t){l(function(){i.showloadingBar=!1,v.isOfTypeFunction(e.miscScope.paymentSucessCallback)?e.miscScope.paymentSucessCallback(t):G(t)},100)},function(o){i.showloadingBar=!1,a.isDefined(t)&&(601===o.code||a.isDefined(o.data)&&601==o.data.code)?(e.miscScope.transaction_code=n,e.miscScope.module_id=2,e.miscScope.transaction_version="V3",a.isDefined(o.data)&&(o=o.data),H(t,!0,o)):j(o)})},e.processPayment=function(t,n){a.isDefined(t)&&(e.paymentRequest.properties.directDebitBookingId=t,e.miscScope.booking_id=t),i.showloadingBar=!0,e.miscScope.isUsualMakePayment?e.usualMakePayment(t,n):e.tayarMakePayment(t,n)},e.makePayment=function(t,n){e.confirmPageMessage="",i.message={},function(){var t=[P.DISH_HOME_RECHARGE_CARD,P.NT_RECHARGE_CARD,P.BROADLINK_RECHARGE_CARD,P.SMART_CELL_RECHARGE_CARD,P.UTL_RECHARGE_CARD],a=[P.THE_LAST_RESORT];if(_.includes(t,e.paymentRequest.product_code)&&!b.validateRechargeCard(e.paymentRequest))return void(i.message.error=A.INVALID_AMOUNT);if(_.includes(a,e.paymentRequest.product_code)&&!b.validateAdventurePackage(e.paymentRequest))return void(i.message.error=A.INVALID_AMOUNT);if(e.paymentRequest.product_code===P.KASPERSKY&&!b.validateKaspersky(e.paymentRequest))i.message.error=A.INVALID_AMOUNT}(),e.invalidFormMessage="",e.trustedHtml="",i.disableSubmit=!0,function(){e.paymentRequest.productCode;for(var t in e.paymentRequest.properties)if(e.isMap(e.paymentRequest.properties[t]))delete e.paymentRequest.properties[t];else if(_.includes(e.showInTable,t)){var a=[];for(var n in a=e.paymentRequest.properties[t])if(!0===e.isMap(a[n])&&a[n]){var i={};for(var o in i=a[n])e.paymentRequest.properties[o+"_"+Object.keys(a).indexOf(n)]=i[o]}else e.paymentRequest.properties[n]=a[n];delete e.paymentRequest.properties[t]}else _.includes(z,t)&&delete e.paymentRequest.properties[t]}(),e.paymentRequest.product_code===P.merchantBalanceTransfer||"BALTXN_CASHOUT"===e.paymentRequest.product_code?e.miscScope.isManagedFundTransfer?(i.$broadcast(m.getBalanceAndRewards),l(function(){a.isDefined(i.userBalance)&&a.isDefined(e.paymentRequest.amount)&&e.paymentRequest.amount<=i.userBalance.balance&&e.managedBalanceTransfer()},100)):e.balanceTransfer(t):e.processPayment(t,n)},e.neaCounterListSize=50;var K={page:0,size:e.neaCounterListSize};function Y(t){s.getNeaCounter(t).then(function(t){e.counterList=e.counterList.concat(t)}),e.counterList=e.counterList.filter(function(t,a){return e.counterList.indexOf(t)==a})}e.counterList=[],e.fetchNeaCounterAsPerSearch=function(t){K.name=t,t.length>3&&!function(t){return e.counterList.some(function(e){return e.name.toLowerCase().match(t.toLowerCase())})}(t)&&Y(K)},e.getNeaCounterOnInit=function(){Y(K)},e.loadMore=function(){(K.page+1)*K.size<=e.counterList.length&&(K.page=K.page+1,Y(K))};var z=[];var Q=function(e,t){f.amount=e.amount,f.properties=e.properties,f.narration=e.narration,f.request_unique_id=e.request_unique_id,f.channel=e.channel,f.transaction_status=e.transaction_status,f.created=e.created,f.product_logo_url=e.product_logo_url,f.product_name=e.product_name,f.processed_by=e.processed_by,f.transaction_code=e.transaction_code,f.module_id=e.module_id,f.hiddenStatDetailProps=t};e.calculateCommission=function(e){ae(e)};var J=_.debounce(function(e,t,a){ae(e,t,a)});function X(t){e.response=t.plain(),a.isDefined(i.message.error)&&(i.message.error=""),e.response.message?"SAME_USER"!==e.response.status&&(e.trustedHtml=h.trustAsHtml(e.response.message),e.showInformation=!0,i.message={}):e.response.error_message?(e.trustedHtml=h.trustAsHtml(e.response.error_message),e.showInformation=!0):e.showInformation=!1,"ACTIVE"===e.response.status||"UNKNOWN_USER"===e.response.status?(e.receiverFullName=e.response.name,e.paymentConfirmation=!0):"SAME_USER"===e.response.status?(i.message.error=e.response.message,e.paymentConfirmation=!1):"BOTH_DR_CR_BLOCKED"===e.response.status?(i.showErrorSuccessMessage(e.response.message,!0,"BOTH_DR_CR_BLOCKED"),e.showInformation=!1):"BLOCKED"!==e.response.status&&"DEBIT_BLOCKED"!==e.response.status||(i.showErrorSuccessMessage(e.response.message,!0,"BLOCKED"),e.showInformation=!1),e.response.charge&&e.response.charge>0&&(e.paymentRequest.properties.charge=e.response.charge,e.paymentRequest.properties.isCustomerToAgent=!0,e.paymentRequest.unique_id=e.response.requestUniqueId,e.paymentRequest.amount=e.response.amount,e.chargeMessageTxt="You have requested for Fund Transfer to AGENT so you will be charged NPR. "+e.response.charge+" Please click 'Ok' to proceed OR 'Cancel' to abort."),a.isDefined(e.paymentRequest.properties.isCustomerToAgent)?a.isDefined(e.paymentRequest.properties.isCustomerToAgent)&&e.paymentRequest.properties.isCustomerToAgent&&(e.paymentRequest.properties.requestUniqueId=e.paymentRequest.unique_id):e.paymentRequest.properties.isCustomerToAgent||V()}function Z(t,n,o){i.showMerchantFormLoading=!0,e.paymentRequest.amount=0,i.clearMessage();var c=t.headers;r.product_code===P.FUN_VALLEY&&(c.arrivalDay=T("date")(c.arrivalDay,"dd/MM/yyyy")),s.getExtraProperties(e.paymentRequest.productCode,o,n,c).then(function(n){!function(t,n){var i=t.plain().details;for(var o in e.miscScope.secondStep=!e.miscScope.intermediateStep,i)if(!0===e.isMap(i[o])&&i[o]){n[o]={};var s=i[o];for(var c in s)n[o][c]=s[c]}else i[o]&&(n[o]=i[o]);e.paymentRequest.productCode===P.VIANET&&(i.bills||(e.noPayment=!0));e.transferProperties(),e.paymentRequest.productCode===P.wlinkLim&&e.worldlinkDirectPay();e.isNeaOnlineForm=e.paymentRequest.productCode===P.neaOnline,e.paymentRequest.properties=D.orderProperties(n),a.isDefined(e.paymentRequest.properties.totalDue)&&e.paymentRequest.product_code!==P.EPS_KHANEPANI&&(e.paymentRequest.amount=e.paymentRequest.properties.totalDue);r.product_code===P.FUN_VALLEY&&(e.altSecondStep=!0);r.product_code===P.CONNECT_PLUS&&(e.productDetails={displayName:e.paymentRequest.properties.instituteName,name:e.paymentRequest.properties.instituteName,logoPath:e.paymentRequest.properties.instituteLogo},e.addAlertMobileNo=!0,e.paymentRequest.properties.dueAmount<0?(e.addAmountField=!0,e.miscScope.extraMessageTxt="User already has Rs. "+-1*e.paymentRequest.properties.dueAmount+" in advance. Do you still want to pay as advance?"):0===i.dueAmount?e.addAmountField=!0:e.paymentRequest.amount=e.paymentRequest.properties.dueAmount);if(a.isDefined(e.paymentRequest.properties.statement)){var l=[];for(var u in l=e.paymentRequest.properties.statement)for(var d in u)for(var m in l[u])"date"===m&&(l[u][m]=T("date")(l[u][m],"dd/MM/yyyy"));e.paymentRequest.properties.detail=l,delete e.paymentRequest.properties.statement,a.isDefined(e.paymentRequest.properties.detail)&&(e.paymentRequest.properties.statementSize=e.paymentRequest.properties.detail.length)}a.isDefined(e.paymentRequest.properties.detail)&&(e.paymentRequest.properties.table=D.createTable(e.paymentRequest.properties.detail))}(n,t),e.paymentRequest.product_code!==P.TMS_BILL_PAYMENT&&e.paymentRequest.productCode!==P.TMS_BILL_PAYMENT||e.gotoIntermediateStep(),e.miscScope.secondStep&&delete e.productDetails.enquiry},function(e){ee(e,"USER_NOT_FOUND"),B()}).finally(function(){i.showMerchantFormLoading=!1})}function ee(e,t,n){var o=e&&a.isDefined(e.data.error_message||e.data.message||e.data.errorMessage)?e.data.error_message||e.data.message||e.data.errorMessage:function(e){return e?A[e]:null}(t);if(n)return o;i.message.error=o}function te(){e.paymentRequest={amount:0,unique_id:"",properties:{enquiry:""},product_code:r.product_code}}function ae(t,n,i){if(t&&t!==P.merchantBalanceTransfer){F=null;var o={amount:e.paymentRequest.amount,properties:function(t){var n=a.copy(t);for(var i in n)(e.isMap(n[i])||a.isArray(n[i]))&&delete n[i];return n}(e.paymentRequest.properties)||{}};s.getProductCommissionV3(t,o).then(function(a){a&&(a.cashBack=a.cashback?a.cashback:0,e.commissionDetailService.setCashBackCharge(1*a.cashback,a.commissionResources),e.commissionDetailService.calculateForAmount(1*e.paymentRequest.amount),F=a,a.rewardPointResource&&e.commissionDetailService.setRewardPointResource(a.rewardPointResource),F.hasReward&&function(t,a,n){n&&(a-=n);t&&t!==P.merchantBalanceTransfer&&(F&&F.rewardPointResource&&e.commissionDetailService.calculateRewardPoint(1*a),F&&!F.rewardPointResource&&s.getTxnRewardPoint(t,1*a).then(function(t){t?e.commissionDetailService.setRewardPoint(t):e.commissionDetailService.setRewardPoint(0)}))}(t,n,i))})}else e.commissionDetailService.setCashBackCharge(0,0)}function ne(){e.commissionDetail={cashBack:0,charge:0,commissionResources:{}}}function ie(){e.noPayment=!1,e.addAlertMobileNo=!1,e.addAmountField=!1,e.propertyResponse={},e.propertyTable={},e.tayarProperties={},e.paymentConfirmation=!1,e.defaultPaymentLabelText=N.WALLET_LABEL,e.otherPaymentLabelText=N.OTHER_PAYMENT_LABEL,e.formDataMakePaymentPayload=new FormData,e.miscScope={confirmButtonText:e.defaultPaymentLabelText,selectedBankAccountDetails:{},totalPayableAmount:"",product:"Generic",isUsualMakePayment:!0},e.isWithdrawToBank=!1,oe(e.productDetails)}function oe(t){t&&(e.miscScope.trustedPaymentDescription=h.trustAsHtml(t.shortDescription.toString()))}e.$watch("paymentRequest.amount",function(t){if(t>0){e.commissionDetailService.calculateForAmount(t,e.paymentRequest.properties.refundableAmount),w.cancel(e.txnRewardPointInterval);var a=e.paymentRequest.productCode||r.product_code;J(a,t,e.paymentRequest.properties.refundableAmount)}}),e.cancelPayment=function(){e.miscScope.confirmButtonText=e.defaultPaymentLabelText,o.go("merchant.makePayment",{product_code:o.params.product_code,product_name:o.params.product_name},{reload:"merchant.makePayment.confirm"===o.$current.name||o.$current.name})},e.checkBalance=function(t){return e.hideError=!1,a.isUndefined(e.paymentRequest.amount)?(e.hideError=!0,!0):!!(a.isDefined(t)&&e.paymentRequest.amount>=t.minimumAmount&&(e.paymentRequest.amount<=t.maximumAmount||0===t.maximumAmount)&&(n=e.paymentRequest.amount,e.totalPayingAmount=1*n+1*e.commissionDetailService.getCharge()-1*e.commissionDetailService.getCashBack(),a.isDefined(e.paymentRequest.amount)&&a.isDefined(i.userBalance)&&e.paymentRequest.amount>i.userBalance))||void 0;var n},e.validateForm=function(t){if(e.invalidFormMessage="",e.paymentRequest.amount&&a.isDefined(t)){if("BALTXN"===e.productDetails.productCode||"SECURED_TRANSFER"===e.productDetails.productCode)return!0;if(1*e.paymentRequest.amount>0!=!0)return e.invalidFormMessage=A.INVALID_AMOUNT,!1;if(e.paymentRequest.amount<t.minimumAmount||t.maximumAmount&&e.paymentRequest.amount>t.maximumAmount)return e.invalidFormMessage="Amount must be less than or equals to "+t.maximumAmount+" and more than or equals to "+t.minimumAmount,!1}return!0},i.$on(m.getProductCommission,function(){ae(r.product_code)}),e.doValidateFundTransfer=function(t){e.miscScope.isManagedFundTransfer?(e.miscScope.agreeManagedFundTermsCallback=function(a){B(),s.validateManagedFundTransfer(t).then(function(n){n.amount=t.amount,e.managedFundTransferValidateObj=n,X(n),a&&a()},function(e){i.showInformation=!1,ee(e,"ERROR_ON_SERVING_REQUEST")})},C.open({templateUrl:p.url+"/html/escrow/escrow_agree_terms_dialog.html",backdrop:"static",controller:"EscrowModalController",size:"md",scope:e})):s.validateFundTransfer(t).then(function(e){X(e)},function(e){i.showInformation=!1,ee(e,"ERROR_ON_SERVING_REQUEST")})},e.showFundTransferConfirmation=function(){if("Generic"===e.miscScope.product&&e.validateDirectDebitService(),B(),"INACTIVE"!==e.productDetails.status){if(!e.paymentRequest.amount||1*e.paymentRequest.amount>0!=!0)return!1;e.invalidFormMessage="",e.trustedHtml="",e.paymentRequest.properties.receiverName&&e.paymentRequest.product_code!==P.topup?e.paymentRequest.properties.receiverEsewaId=e.paymentRequest.properties.receiverName:e.paymentRequest.properties.receiverName&&e.paymentRequest.product_code===P.topup&&(e.paymentRequest.productCode===P.NAMASTE_TOPUP_VOLUME_BASED||e.paymentRequest.productCode===P.NAMASTE_TOPUP_UNLIMITED||e.paymentRequest.productCode===P.NAMASTE_LANDLINE?e.paymentRequest.properties.landLineNo=e.paymentRequest.properties.receiverName:e.paymentRequest.properties.mobileNumber=e.paymentRequest.properties.receiverName),e.paymentConfirmation=!0;e.paymentRequest.productCode?e.paymentRequest.productCode:r.product_code;if(r.product_code===P.merchantBalanceTransfer||"BALTXN_CASHOUT"===r.product_code){e.paymentConfirmation=!1;var t={receiver_name:e.paymentRequest.properties.receiverName,amount:e.paymentRequest.amount};e.doValidateFundTransfer(t)}for(var a in e.paymentRequest.properties){if(!e.isMap(e.paymentRequest.properties[a])){var n=e.paymentRequest.properties[a];e.paymentRequest.properties[a]=n}e.isMap(e.paymentRequest.properties[a])&&delete e.paymentRequest.properties[a],e.paymentRequest.properties[a]||delete e.paymentRequest.properties[a]}V(e.paymentRequest)}else c.error(e.productDetails.userRemarks)},e.fundTransfer=function(e,t,a,n){P.merchantBalanceTransfer;i.paymentDto={product_code:r.product_code,amount:t,properties:{receiverEsewaId:n},narration:a},s.fundTransfer(i.paymentDto).then(function(e){i.fundTransferDetails=e.plain(),i.message.success=A.SUCCESS_FUND_TRANSFER,i.paymentDto={},getAgentDetails(y.FUND_TRANSFER_DETAIL,{txnId:i.fundTransferDetails.transaction_code,moduleId:i.fundTransferDetails.module_id}),i.$broadcast(m.getBalanceAndRewards)},function(){i.showInformation=!1})},e.hideInitialCofirmation=!1,e.reset=function(){e.noPayment=!1,te(),ie(),r.product_code===P.DISH_HOME&&(e.paymentRequest.properties.dishhomeType="cas"),a.isDefined(e.paymentForm)&&e.paymentForm.$setUntouched(),e.loadCashinNumber(),a.isDefined(e.paymentRequest)&&"BALTXN"===e.paymentRequest.product_code&&(e.miscScope.sendMoneyContent="sendMoney",e.paymentRequest={amount:0,properties:{remarks:"",purpose:"",receiverName:""}}),"BALTXN"===r.product_code&&U(r.product_code)},e.getProductCodeForLandline=function(t){"ADSL(Volume based)"===t?(e.paymentRequest.productCode=P.NAMASTE_TOPUP_VOLUME_BASED,e.productDetails.name="Nt ADSL Topup - Volume Based"):"ADSL(Unlimited)"===t?(e.paymentRequest.productCode=P.NAMASTE_TOPUP_UNLIMITED,e.productDetails.name="Nt ADSL Topup - Unlimited"):"LANDLINE"===t&&(e.paymentRequest.productCode=P.NAMASTE_LANDLINE,e.productDetails.name="Nt Landline Payment"),e.landlineOperator=_.find(q,function(t){if(t.productCode===e.paymentRequest.productCode)return t}),e.amountList=e.landlineOperator.amounts,ae(e.paymentRequest.productCode)},e.$watch("paymentRequest.properties.mobileNumber",t=>{e.getMobileOperator(t)}),e.getMobileOperator=function(t){!t||t.length<8||S.checkPhoneValid(t)&&(e.mobileOperator=_.find(q,function(e){if(new RegExp(e.regex).test(t))return e}),e.mobileOperator?(e.landlineType=!1,"NP-RTP-SMARTCELL"===e.mobileOperator.productCode?(e.textAmount=!1,e.selectAmount=!0,e.amountList=e.mobileOperator.amounts):(e.textAmount=!0,e.selectAmount=!1,e.amountList=[]),!S.checkLandlineValid(t)||t.startsWith("98")||t.startsWith("97")||t.startsWith("96")||t.startsWith("166001")||(e.landlineOptions=["ADSL(Volume based)","ADSL(Unlimited)","LANDLINE"],e.landlineType=!0,e.textAmount=!0,e.selectAmount=!1),function(e){var t=_.find(q,function(e){return"NP-ES-TOLL-FREE-TOPUP"===e.productCode});return new RegExp(t.regex).test(e)}(t)&&(e.landlineType=!1),e.paymentRequest.productCode=e.mobileOperator.productCode,e.productDetails.shortDescription=h.trustAsHtml(e.mobileOperator.shortDescription),oe(e.productDetails),e.productDetails.displayName=e.mobileOperator.displayName,e.productDetails.name=e.mobileOperator.name,e.productDetails.logoPath=e.mobileOperator.logoPath,e.productDetails.id=e.mobileOperator.id,e.paymentRequest.productType=e.mobileOperator.productType,ae(e.paymentRequest.productCode)):e.mobileOperator={})},e.worldlinkDirectPay=function(){e.paymentRequest.properties.response&&(a.isDefined(e.paymentRequest.properties.response.hasDue)&&(e.paymentRequest.properties.response.hasDue?(e.paymentRequest.amount=e.paymentRequest.properties.response.discountedDueAmount,0===e.paymentRequest.amount&&(e.paymentRequest.amount=e.paymentRequest.properties.response.discountedPaymentAmount)):e.paymentRequest.properties.response.acceptAdvancePayment?e.paymentRequest.properties.response.renewOption?e.paymentRequest.amount=0:e.paymentRequest.amount=e.paymentRequest.properties.response.advancePaymentDiscounted:"VOL"===e.paymentRequest.properties.response.handler?e.paymentRequest.amount=0:(e.paymentRequest.amount=0,e.noPayment=!0)),a.isDefined(e.paymentRequest.properties.response.acceptAdvancePayment)&&(e.paymentRequest.properties.acceptAdvancePayment=e.paymentRequest.properties.response.acceptAdvancePayment))},e.transferProperties=function(){var t=e.paymentRequest,a=e.paymentRequest.properties;t.amount=a.amount||a.grandTotal||a.finalPayableAmount,t.customerId=a.CUSTOMER_ID,t.scNo=a.SCNO,t.counter=a.OFFICE_ID,t.billAmount=a.finalPayableAmount,e.noPayment=a.paidStatus||"2"===a.code,e.paymentRequest=t},e.gotoIntermediateStep=function(){e.miscScope.secondStep=!1,e.miscScope.intermediateStep=!0,e.miscScope.secondIntermediateStep=!1,e.productDetails.enquiry=!0,e.miscScope.hidePaymentDescription=!0,i.goToState("merchant.makePayment.intermediateStep")},e.gotoSecondIntermediateStep=function(){e.miscScope.secondStep=!1,e.miscScope.intermediateStep=!1,e.miscScope.secondIntermediateStep=!0,i.goToState("merchant.makePayment.secondIntermediateStep")},e.gotoSecondStep=function(){e.miscScope.secondStep=!0,e.miscScope.intermediateStep=!1,e.miscScope.secondIntermediateStep=!1,e.productDetails.enquiry=!1,i.goToState("merchant.makePayment.secondStep")},e.getDetailProperties=function(t,a,n){i.message.error="",e.paymentRequest.productCode=n||r.product_code,"INACTIVE"!==e.productDetails.status?Z(e.paymentRequest.properties,t,a):c.error(e.productDetails.userRemarks)},e.checkButtonDisabled=function(e,t,a,n,i,o){return e||t||a||n||i||o},e.isMap=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.showInTable=["detail"],e.loadSecondStepTemplate=function(){let t=e.paymentRequest.product_code||r.product_code;e.miscScope.secondStepTemplate=p.url+"/html/payment/secondStep/"+e.productDetails.productType+"/"+t+"_secondStep.html"},e.loadIntermediateStepTemplate=function(){let t=e.paymentRequest.product_code||r.product_code;e.miscScope.intermediateStepTemplate=p.url+"/html/payment/secondStep/"+e.productDetails.productType+"/"+t+"_intermediateStep.html"},e.loadSecondIntermediateStepTemplate=function(){let t=e.paymentRequest.product_code||r.product_code;e.miscScope.secondIntermediateStepTemplate=p.url+"/html/payment/secondStep/"+e.productDetails.productType+"/"+t+"_secondIntermediateStep.html"},e.getWuPurposeAndTransfer=function(){s.getRelationship().then(function(t){e.relationList=t}),s.getTransactionPurpose().then(function(t){e.transactionList=t})},e.getWuReceive=function(){s.getWuTransactionList().then(function(t){e.wuTransactions=t.plain(),0!==e.wuTransactions.length||(e.noData=!0)}).finally(function(){e.noData=!1})},e.wuTransactions=[],e.wuTransactionsDetails={},e.transactionList={},e.relationList={},e.confirmTransaction=!1,e.proceedTransaction=function(t){e.paymentConfirmation=!0,s.getWuTransaction(t).then(function(t){var n,i,o={date:t.date,description:t.description,actual_amount:t.actual_amount,expected_amount:t.expected_amount,transaction_id:t.transaction_id,mobile_number:t.mobile_number,sent_amount:t.sent_amount,originating_country:t.originating_country,attempts_left:t.attempts_left,receipt_code:t.receipt_code};e.wuTransactionsDetails=(n=e.wuTransactionsDetails,i=o,"object"!=typeof n||"object"!=typeof i?void 0:(a.forEach(i,function(e,t){n.key=e}),n)),e.confirmTransaction=!0},function(e){ee(e)})},e.wuPickup={},e.showConfirmation=!1,e.showTransactionQueued=!1,e.showAdditionalInformation=!1,e.showOnHold=!1,e.showFailedMessage=!1,e.showAlreadyPaidOut=!1,e.showMtcnNotFound=!1,e.invalidTransaction=!1,e.otherCase=!1,e.receivedSuccessfully=!1,e.success=!1,e.receiveFailed=!1,e.processPickUp=function(t){s.proceedPickUpWesternUnion(t).then(function(t){e.wuPickup=t.plain(),e.paymentConfirmation=!0,e.getViewByCode(e.wuPickup.code)},function(e){ee(e)})},e.processWuReceive=function(t){s.proceedWesternUnionReceive(t).then(function(t){e.wurReciveStatus=t.plain(),"COMPLETE"===e.wurReciveStatus?(o.go("main.wuReceive"),e.paymentConfirmation=!1,e.receivedSuccessfully=!0):e.receiveFailed=!0},function(e){i.message.error=A.SOMETHING_WENT_WRONG})},e.getViewByCode=function(t){t===R.LikelyToBeSuccessful?e.showConfirmation=!0:t===R.LikelyToBeQueued?e.showTransactionQueued=!0:t===R.AdditionalInformationRequired?e.showAdditionalInformation=!0:t===R.FailedPayout?e.showFailedMessage=!0:t===R.OnHold?e.showOnHold=!0:t===R.InvalidTransaction?e.invalidTransaction=!0:t===R.AlreadyPaidOut?e.showAlreadyPaidOut=!0:t===R.MtcnNotFound?e.showMtcnNotFound=!0:e.otherCase=!0},e.confirmPickUp=function(t){s.confrimWesternUnionPickup(t).then(function(t){e.pickupStatus=t.plain(),"COMPLETE"===e.pickupStatus.status?(e.success=!0,e.showConfirmation=!1):(e.showOnHold=!0,e.showConfirmation=!1)})},e.additinalValidate=function(t){s.validateAdditionalWesternUnionDetails(t).then(function(t){e.wuPickup=t.plain(),e.paymentConfirmation=!0,e.getViewByCode(e.wuPickup.code)})},e.cancelWuTransaction=function(){e.paymentConfirmation=!1,e.showConfirmation=!1,e.showTransactionQueued=!1,e.showAdditionalInformation=!1,e.showOnHold=!1,e.showFailedMessage=!1,e.showAlreadyPaidOut=!1,e.showMtcnNotFound=!1,e.invalidTransaction=!1,e.receivedSuccessfully=!1,e.success=!1,e.receiveFailed=!1},i.$on("$stateChangeStart",function(t,a,n,i,r,s){("merchant.makePayment.secondStep"!==o.$current.name&&"merchant.makePayment.intermediateStep"!==o.$current.name||"merchant.makePayment"!==a.name&&"merchant.makePayment.intermediateStep"!==a.name)&&("merchant.makePayment.confirm"!==o.$current.name||"merchant.makePayment.secondStep"!==a.name)||l(function(){e.cancelPayment()},0)}),e.openTermsAndCondition=function(){C.open({templateUrl:p.url+"/html/escrow/managed_fund_transfer_terms_and_conditions.html",controller:re,size:"md",backdrop:"static",scope:e})},e.managedFundTransferPreference={},e.miscScope.isManagedFundTransferSetFromChild=!1,e.getManagedFundTransferPreference=function(t){i.message={},e.paymentRequest!==n&&e.paymentRequest.properties.receiverName!==n&&""!==e.paymentRequest.properties.receiverName&&""!==e.paymentRequest.amount&&e.paymentRequest.amount>0&&(e.preferenceParams={receiver_name:e.paymentRequest.properties.receiverName,amount:e.paymentRequest.amount},s.getManagedFundTransferPreference(e.preferenceParams).then(function(n){e.managedFundTransferPreference=n.plain(),e.miscScope.isManagedFundTransfer=e.miscScope.isManagedFundTransferSetFromChild?e.miscScope.isManagedFundTransfer:e.managedFundTransferPreference.enable_managed_ft,a.isDefined(e.miscScope.managedFundTransferDetailObj)&&a.isDefined(e.miscScope.sftObj)&&e.miscScope.isManagedFundTransfer?(e.miscScope.managedFundTransferDetailObj=Object.assign({},e.miscScope.sftObj),e.productDetails=Object.assign({},e.miscScope.sftObj),e.updateFTData(t)):a.isDefined(e.miscScope.managedFundTransferDetailObj)&&a.isDefined(e.miscScope.baltxnObj)&&!e.miscScope.isManagedFundTransfer?(e.miscScope.managedFundTransferDetailObj=Object.assign({},e.miscScope.baltxnObj),e.productDetails=Object.assign({},e.miscScope.baltxnObj),e.updateFTData(t)):e.miscScope.setProductDescription(t)},function(e){i.message.error=e.data.error_message}))},e.updateFTData=function(t){e.miscScope.trustedPaymentDescription=h.trustAsHtml(e.productDetails.shortDescription),e.miscScope.setAmountValidation(t,e.productDetails.productCode)},e.getRecentFundTransferList=function(){s.getRecentFundTransferList({page:0,size:10}).then(function(t){e.recentFundTransferList=t.plain()},function(t){e.recentFundTransferList=[]})},e.mapRecentTransferDetail=function(t,a){e.paymentRequest.amount=t.amount,e.paymentRequest.properties.receiverName=t.outgoing?t.sender_esewa_id:t.receiver_esewa_id,e.paymentRequest.properties.purpose=t.purpose,e.paymentRequest.properties.remarks=t.transfer_remarks||t.remarks,e.miscScope.isManagedFundTransferSetFromChild=!1,e.getManagedFundTransferPreference(a)};var re=["$scope","$rootScope","$modalInstance","$state",function(e,t,a,n){e.cancel=function(){a.dismiss(),n.reload()},t.currentModal=a,e.viewList=function(){a.dismiss(),n.go("managed_fund_transfer")},e.closeTermsAndConditionsDialog=function(){a.dismiss()}}];e.validateDirectDebitService=function(){i.showloadingBar=!0,e.miscScope.totalPayableAmount=e.paymentRequest.amount,e.miscScope.productCode=e.paymentRequest.productCode||e.paymentRequest.product_code,e.isDirectDebitEnabled=!1,e.miscScope.confirmButtonText=e.defaultPaymentLabelText;var t={product_code:e.miscScope.productCode,amount:e.miscScope.totalPayableAmount};E.getProductPaymentOptions(t).then(function(t){var a=t.plain();e.miscScope.paymentOptionsResponse=a,Array.isArray(a)&&(e.isDirectDebitEnabled=a[1].enabled)}).finally(function(){i.showloadingBar=!1})},e.mpinVerification=function(t){t&&(e.mpinFn=t)},e.isBankSelected=function(){return!(!a.isDefined(e.miscScope.selectedBankAccountDetails)||!a.isDefined(e.miscScope.selectedBankAccountDetails.swift_code))},e.credentialInput="",e.$on("onConfirmation",function(t,o){var s;B(),e.paymentFailureMessage=[{id:1,isSelected:!1,labelText:"Keep in my eSewa Wallet"},{id:2,isSelected:!1,labelText:"Withdraw back to my bank account"}],delete e.miscScope.paymentOptionType,((s=e.paymentRequest.productCode||r.product_code)===P.merchantBalanceTransfer||"BALTXN_CASHOUT"===s)&&(e.miscScope.paymentOptionType="P2P"),e.credentialInput=o;var c,l=e.miscScope.selectedBankAccountDetails,u={product_code:e.paymentRequest.productCode||e.paymentRequest.product_code,source_bank_swift_code:l.swift_code,amount:e.paymentRequest.amount,unique_id:l.unique_id};c=u.product_code,_.includes(M,c)&&(u.properties={},u.properties.receiverEsewaId=e.paymentRequest.properties.receiverName||""),i.showloadingBar=!0,E.performDirectLoad(u,e.credentialInput).then(function(t){var a=t.plain();i.showloadingBar=!1,e.credentialInput="",0===a.code?(i.$broadcast(m.getBalanceAndRewards),e.makePayment(a.booking_id,t.load_transaction_id)):H(n,!1,a)},function(e){i.showloadingBar=!1,a.isDefined(e.data.error_message)?i.showErrorSuccessMessage(e,!0,"INVALID"):H(n,!1,e)})}),e.isLandlineType=function(){var t=new Set([P.NAMASTE_LANDLINE,P.NAMASTE_TOPUP_UNLIMITED,P.NAMASTE_TOPUP_VOLUME_BASED]),a=e.paymentRequest.productCode;return t.has(a)}}]),a.module("esewaPaymentApp").controller("MpinPasswordModalController",["$scope","$rootScope","$modalInstance","RegexConstant",function(e,t,a,n){e.credentialInput="",e.cancel=function(){a.dismiss()},t.currentModal=a,e.closeDialog=function(){a.dismiss()},e.isEmail=function(){return!!new RegExp(n.mobileNo).test(t.$storage.profile.esewaId)},e.onSubmit=function(){t.$broadcast("onConfirmation",e.credentialInput),e.closeDialog()}}]),a.module("esewaPaymentApp").controller("WithdrawBaseController",["$scope","$state","$rootScope",function(e,t,a){e.currentState=t.current.data.displayName,e.bankList=n,e.bankTransferSkeletonLoading=!0,a.$on("bankList",function(t,a){a?(e.bankList=a,e.bankTransferSkeletonLoading=!1):e.bankTransferSkeletonLoading=!1}),e.allowLinkBank=function(){return a.isVerfiedUser()||a.isOrg()}}]),a.module("esewaPaymentApp").controller("WithdrawConfirmationModalController",["$scope","$rootScope","$modalInstance","DirectDebitService","booking_id","StateConstant","$state","isDirectLoadSuccess","errorResponse","ecmsg","stateToReturnOnWithdrawFail","CDNUrl",function(e,t,n,i,o,r,s,c,l,u,d,m){e.showTransactionDetail=!1,e.isWithdrawToBank=!1,t.currentModal=n,e.isDirectLoadSuccess=c,e.errorResponse=l,e.paymentFailureImgUrl=m.url+"/images/payment_failure.svg",e.$parent&&e.$parent.paymentFailureMessage?e.paymentFailureMessage=e.$parent.paymentFailureMessage:e.paymentFailureMessage=[],e.isFailureMessageSet=function(){return e.paymentFailureMessage.length},e.closeDialog=function(){n.dismiss()},e.directDebitWithdraw=function(){t.message={},o!=e.booking_id&&(e.booking_id=o);var n={booking_id:e.booking_id};a.isDefined(e.$parent.miscScope.paymentOptionType)&&(n.payment_option_type=e.$parent.miscScope.paymentOptionType),t.showloadingBar=!0,i.withdraw(n).then(function(a){a.plain();t.showloadingBar=!1,e.closeDialog(),s.go(r.TRANSACTIONS,{txnId:a.transaction_code,moduleId:a.module_id})},function(a){t.showloadingBar=!1,e.closeDialog(),t.showErrorSuccessMessage(a,!0,"WITHDRAW_FAILED",!0),s.go(d.state,d.params,{reload:!0})})},e.changeSelectionToBankOrEsewa=function(t,a){e.$parent.paymentFailureMessage.forEach(function(n){t.id===n.id?(n.isSelected=a.target.checked,e.isWithdrawToBank=1!==t.id):n.isSelected=!1})},e.getConfirmationText=function(){return e.$parent.paymentFailureMessage.filter(function(e){return!0===e.isSelected}).length>0},e.confirmSelection=function(){if(e.isWithdrawToBank)e.directDebitWithdraw();else{e.showTransactionDetail=!0;var a={module_id:e.$parent.miscScope.module_id,transaction_version:e.$parent.miscScope.transaction_version};t.showloadingBar=!0,i.fetchLoadStatement(e.$parent.miscScope.transaction_code,a).then(function(a){e.transactionDetails=a.plain(),t.showloadingBar=!1},function(e){t.showloadingBar=!1,t.showErrorSuccessMessage(e,!0,"FETCH_FAILED")})}},e.redirectToHomePage=function(){switch(e.closeDialog(),delete e.$parent.miscScope.transaction_code,e.showTransactionDetail=!1,e.$parent.miscScope.product){case"Airline":s.go(r.AIRLINES_HOME);break;case"CableCar":s.go(r.CABLE_CAR_DETAIL);break;case"BusSewa":s.go(r.BUSSEWA_INQUIRY);break;case"Generic":e.$parent.$state.reload()}},e.redirectToStatementPage=function(){s.go(r.STATEMENTS)}}]),a.module("esewaPaymentApp").service("BankService",["Restangular",function(e){var t=e.one("auth").one("bank"),a=!1;this.setConfrimation=function(e){a=e},this.getConfrimation=function(){return a},this.esewaLoadBanks=function(t){return e.one("banks").one(t).get()},this.getBankListForWithdraw=function(){return t.one("withdraw").withHttpConfig({selfHandleLoadingBar:!0}).getList()},this.getUserSavedBankList=function(){return e.one("auth").one("bank_information").get()},this.getUserSavedBankListForWithdraw=function(){return e.one("auth").one("bank_information/withdraw").withHttpConfig({selfHandleLoadingBar:!0}).get()},this.getBankWithdrawCommission=function(e){return t.one("withdraw").one(e).one("commission").withHttpConfig({selfHandleLoadingBar:!0}).get()},this.checkAgentBankWithdrawCommission=function(e){return t.one("withdraw").one("agent/commission/validate").customPOST(e)},this.getBankWithdrawCommissionForAgent=function(e){return t.one("withdraw").one("commission/agent").customPOST(e)},this.checkForBankWithdrawCommission=function(e){return t.one("withdraw").one("/commission/validate").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(e)},this.getBankWithdrawCommissionNew=function(e){return t.one("withdraw").one("commission").customPOST(e)},this.bankWithdraw=function(e){return t.all("withdraw").customPOST(e)},this.linkedBankWithdraw=function(e){return t.all("withdraw").one("linked_account").customPOST(e)},this.validateBankAccount=function(e){return t.all("withdraw").all("validate").customPOST(e)},this.validateMobileBankAccount=function(e){return t.all("withdraw").all("validateMobileNumber").customPOST(e)},this.getBankTransferPurpose=function(t){return e.one(t).withHttpConfig({selfHandleLoadingBar:!0}).get()}}]),a.module("esewaPaymentApp").service("DirectDebitService",["Restangular","$base64",function(e,t){this.validateService=function(t,a){var n={amount:a};return e.all("auth").one("direct_debit").one("validate_service").one(t).one("amount/"+a).customPOST(n)},this.validateBalance=function(t,a){var n={amount:a};return e.all("auth").one("direct_debit").one("validate_balance").one(t).one("amount/"+a).customPOST(n)},this.performDirectLoad=function(a,i){var o={tpin:t.encode(i)};return e.all("auth").one("direct_debit").one("load_fund").customPOST(a,n,n,o)},this.withdraw=function(t){return e.all("auth").one("direct_debit").one("withdraw").customPOST(t)},this.getProductPaymentOptions=function(t){return e.all("auth").one("product").one("payment_options").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.fetchLoadStatement=function(t,a){return e.all("auth").one("transactions").one(t).get({module_id:a.module_id,transaction_version:a.transaction_version})}}]),a.module("esewaPaymentApp").service("MerchantPaymentService",["Restangular",function(e){this.makePayment=function(t){return t.productCode&&(t.product_code=t.productCode,delete t.productCode),e.all("auth").one("make_payment").customPOST(t)},this.fundTransfer=function(t){return e.all("auth").one("fund_transfer").customPOST(t)},this.getFtPurpose=function(t,a){return e.one(t).withHttpConfig({selfHandleLoadingBar:!0}).get(a)},this.getProductCommission=function(t){return e.one("auth").one("product").one(t).one("commission/v2").withHttpConfig({selfHandleLoadingBar:!0}).customGET()},this.getProductCommissionV3=function(t,a){return e.one("auth").one("product").one(t).one("commission/v3").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(a)},this.getProductDetails=function(t){return e.one("payment_menus").one("products").one(t).withHttpConfig({selfHandleLoadingBar:!0}).get()},this.validateFundTransfer=function(t){return e.all("auth").one("/fund_transfer/validate").customPOST(t)},this.getExtraProperties=function(t,a,n,i){return e.all("auth").one("payment").one(t).one("inquiry").one(a).withHttpConfig({selfHandleLoadingBar:!0}).customPOST(i,"",{request_id:n},"")},this.getConversionRate=function(){return e.one("conversion").customGET()},this.getWuTransactionList=function(){return e.one("auth").one("western_union_receive").one("receive").customGET()},this.getWuTransaction=function(t){return e.one("auth").one("western_union_receive/receive").one(t+"").customGET()},this.proceedWesternUnionReceive=function(t){return e.one("auth").one("western_union_receive/proceed").customPOST(t)},this.getRelationship=function(){return e.one("auth").one("western_union_receive/getRelationship").get()},this.getTransactionPurpose=function(){return e.one("auth").one("western_union_receive/getTransactionPurpose").get()},this.proceedPickUpWesternUnion=function(t){return e.one("auth").one("western_union_pickup/validate").customPOST(t)},this.confrimWesternUnionPickup=function(t){return e.one("auth").one("western_union_pickup/proceedPickup").customPOST(t)},this.validateAdditionalWesternUnionDetails=function(t){return e.one("auth").one("western_union_pickup/additional_info").customPOST(t)},this.getTxnRewardPoint=function(t,a){var n={txn_amount:a};return e.one("auth").one("product").one(t).one("txn_reward").withHttpConfig({selfHandleLoadingBar:!0}).customGET("",n)},this.dynamicMerchantService=function(t,a){return a?e.one("auth").one("mi").withHttpConfig({miniLoadingBarId:a}).customPOST(t):e.one("auth").one("mi").customPOST(t)},this.getNeaCounter=function(t){return e.one("nea_counter_cache").withHttpConfig({selfHandleLoadingBar:!0}).customGET("",t)},this.getManagedFundTransferStatement=function(t){return e.one("auth").one("managed_ft/list").customGET("",t)},this.getPendingTxnCounts=function(t){return e.one("auth").one("managed_ft/pending/count").get()},this.initiateManagedFundTransfer=function(t){return e.one("auth").one("managed_ft/payments/initiate").customPOST(t)},this.fundRelease=function(t){return e.one("auth").one("managed_ft/payments/transfer").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.initiateDispute=function(t){return e.one("auth").one("managed_ft/payments/dispute").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.validateManagedFundTransfer=function(t){return e.one("auth").one("managed_ft/validate").customPOST(t)},this.getManagedFundTransferPreference=function(t){return e.one("auth").one("managed_ft/preference").withHttpConfig({selfHandleLoadingBar:!0}).customPOST(t)},this.requestForAcknowledgement=function(t){return e.one("auth").one("managed_ft/notify_sender").customPOST(t)},this.getRecentFundTransferList=function(t){return e.one("auth").one("managed_ft/send_money/list").customGET("",t)},this.fetchDisputeChargeMessage=function(t){return e.one("auth").one("managed_ft/messages/SFT_DISPUTE_CHARGE_INFO?unique_id="+t).customGET()},this.getRecentTransactionForProduct=function(t,a){const n={product_type:a,product_id:t,size:10,page:0};return e.one("auth").one("/managed_ft/product_payments/list").withHttpConfig({selfHandleLoadingBar:!0}).customGET("",n)},this.getUserDetail=function(t){return e.one("auth").one("user/user_info?username="+t).customGET()}}]),a.module("esewaPaymentApp").service("PaymentValidationService",function(){this.validateRechargeCard=function(e){return e.amount===e.properties.cardFaceValue};var e=[{name:"Bungy or Swing Day Trip",price:"6300"},{name:"Bungy & Swing Day Trip",price:"8500"},{name:"Tandem Day Trip",price:"10700"},{name:"Canyoning Day Trip",price:"5500"},{name:"Rafting Day Trip",price:"3000"},{name:"Bungy & Canyoning Trip",price:"9500"},{name:"Go & See Day Trip",price:"1800"},{name:"Relax at the Resort (1 Night)",price:"4900"},{name:"Relax & Bungy or Swing (1 Night)",price:"9500"},{name:"Relax and Tandem (1 Night)",price:"16800"},{name:"Relax & Rafting (1 Night / 1 Day)",price:"7400"},{name:"Relax & Rafting & Bungy (1 night)",price:"12000"},{name:"Relax & Canyoning (1 Night / 1 Day)",price:"8200"},{name:"Relax & Canyoning (2 Nights / 2 Days)",price:"16700"},{name:"Relax & Canyoning & Bungy (1 Night)",price:"12000"},{name:"Bungy or Swing Only",price:"5200"},{name:"Extra Bungy or Swing",price:"2800"},{name:"Tandem Only",price:"8900"},{name:"Canyoning Only [Day 1]",price:"4200"},{name:"Canyoning Only [Day 2]",price:"8500"},{name:"Sauna",price:"550"},{name:"AP (3 Meals)",price:"3655"},{name:"MAP (2 Meals)",price:"3000"},{name:"BB (1 Meal)",price:"2100"}];this.validateAdventurePackage=function(t){var a=!1;return _.forEachRight(e,function(e){e.name===t.properties.packageType&&e.price*t.properties.noOfPerson===t.amount&&(console.log(e.price*t.properties.noOfPerson),a=!0)}),a},this.validateLoopNetwork=function(e){var t=!1,a=[];return"5 Mbps ( Fall back 512 kbps)"==e.properties.package&&(a=[{id:"6933",value:"1 month"},{id:"12865",value:"6 month"},{id:"20210",value:"1 year"}],_.forEachRight(a,function(a){a.value===e.properties.period&&a.id===e.amount&&(t=!0)})),"Basic (768 Kbps)"==e.properties.package&&(a=[{id:"6850.01",value:"1 month"},{id:"12187",value:"6 month"},{id:"18515",value:"1 year"},{id:"30832",value:"2 year"}],_.forEachRight(a,function(a){a.value===e.properties.period&&a.id===e.amount&&(t=!0)})),"Budget (512 Kbps)"==e.properties.package&&(a=[{id:"6511.01",value:"1 month"},{id:"10153",value:"6 month"},{id:"14447",value:"1 year"},{id:"22696",value:"2 year"}],_.forEachRight(a,function(a){a.value===e.properties.period&&a.id===e.amount&&(t=!0)})),"Gold"==e.properties.package&&(a=[{id:"7415.07",value:"1 month"},{id:"15577",value:"6 month"},{id:"25295",value:"1 year"},{id:"44392",value:"2 year"}],_.forEachRight(a,function(a){a.value===e.properties.period&&a.id===e.amount&&(t=!0)})),"Silver (1.5 Mbps)"==e.properties.package&&(a=[{id:"7076.01",value:"1 month"},{id:"13543",value:"6 month"},{id:"21227",value:"1 year"},{id:"36256",value:"2 year"}],_.forEachRight(a,function(a){a.value===e.properties.period&&a.id===e.amount&&(t=!0)})),t},this.validateKaspersky=function(e){if("Kaspersky Antivirus 1 Pc/1 User"===e.properties.productName){if("700"===e.amount)return!0}else if("Kaspersky Antivirus 3 Pc / 3 User"===e.properties.productName){if("1225"===e.amount)return!0}else if("Kaspersky Internet Security 1 Pc/1 User"===e.properties.productName){if("1225"===e.amount)return!0}else if("Kaspersky Internet Security 3 Pc/3 User"===e.properties.productName&&"2380"===e.amount)return!0;return!1}}),a.module("esewaPaymentApp").controller("RemittancePickupController",["$scope","$rootScope","$state","$stateParams","RemittancePickupService","CommonService","StateConstant","CDNUrl",function(e,t,a,n,i,o,r,s){function c(){e.requestBody={},e.tokenValidationResponse={},a.go("remittancePickup.inquiry",a.params)}e.requestBody={},e.remittancePickUpParam={remittancePickupName:n.remittancePickUpName||a.params.remittancePickUpName,remittancePickupClientCode:n.remittancePickupClientCode||a.params.remittancePickupClientCode,remittancePickupLogo:s.url+"/images/"+n.remittancePickUpName+"logos.png"},e.getJsonData=function(t,a){o.getJsonDataFromCdn(t).then(function(t){e[a]=t.data,e.$$phase||e.$apply()})},e.validateToken=function(n){var o={client_code:e.remittancePickUpParam.remittancePickupClientCode,mtcn:n.token};i.validateToken(o).then(function(t){e.tokenValidationResponse=function(e){var t={sender:{},receiver:{},paymentInfo:{}};for(var a in e)a.startsWith("sender")?t.sender[a]=e[a]:a.startsWith("receiver")?t.receiver[a]=e[a]:t.paymentInfo[a]=e[a];return t}(t.plain()),a.go("remittancePickup.remittanceDetail",a.params)},function(e){t.message.error=e.data.error_message})},e.proceedToConfirmation=function(){a.go("remittancePickup.confirmation",a.params)},e.unlockPayment=function(){i.unlockPayment(e.tokenValidationResponse.paymentInfo.payout_token_id).then(function(e){c()},function(e){t.message.error=e.data.error_message})},e.confirmPickupTransaction=function(){console.log("Request body in confirmation pickup : ",e.requestBody),delete e.requestBody.token,i.confirmTransaction(e.tokenValidationResponse.paymentInfo.payout_token_id,e.requestBody).then(function(e){a.go(r.TRANSACTIONS,{txnId:e.transaction_code,moduleId:e.module_id})},function(e){t.message.error=e.data.error_message})},e.initRemittancePickupConfirmation=function(){_.isEmpty(e.tokenValidationResponse)&&c()},e.initRemittancePickupDetail=function(){_.isEmpty(e.tokenValidationResponse)&&c()}}]),a.module("esewaPaymentApp").service("RemittancePickupService",["Restangular",function(e){var t=e.all("auth");this.validateToken=function(e){return t.one("remittance/validate/pickup/v2").customPOST(e)},this.unlockPayment=function(e){return t.one("remittance/unlock_payment").one(e).post()},this.confirmTransaction=function(e){return t.one("remittance/confirm_transaction/"+e).customPOST({},"","")}}]),a.module("esewaPaymentApp").controller("RemittanceWithdrawReportContoller",["$scope","$rootScope","$window","NgTableParams","$filter","RemittanceWithdrawReportService","$state",function(e,t,n,i,o,r,s){function c(){e.dataParameters={from_date:o("date")(e.dateRange.fromDate,"yyyy-MM-dd"),to_date:o("date")(e.dateRange.toDate,"yyyy-MM-dd"),page:e.pageNumber-1,amount:a.isDefined(e.report.amount)?e.report.amount:"",transaction_id:a.isDefined(e.report.transaction_id)?e.report.transaction_id:"",client_code:a.isDefined(e.report.client_code)?e.report.client_code:""}}e.pageNumber=1,e.dateRange=r.dateRangeHelper(),e.report={},e.report.client_code=s.params.clientCode,c(),e.reloadReportTable=function(){c(),e.remittanceReportTable.reload()},e.getExcel=function(){c(),r.downloadReport(e.dataParameters).then(function(e){n.open(e.split("redirect:")[1],"_blank")})},e.decreasePageNumberTransaction=function(t,a){e.showLoadingIcon=!0,e.pageNumber=r.getPageNumber(t,Number(a)),e.dataParameters.page=e.pageNumber-1,e.remittanceReportTable.reload()},e.remittanceReportTable=new i({page:1,count:25,sorting:{uploadedDate:"desc"}},{total:0,getData:function(a){r.getRemittanceReport(e.dataParameters).then(function(t){var n=t.plain();a.resolve(n),e.showNextButton=25===n.length},function(e){t.message.error=e.data.error_message})}})}]),a.module("esewaPaymentApp").service("RemittanceWithdrawReportService",["Restangular","$filter",function(e,t){var a=e.all("/auth");this.getRemittanceReport=function(e){return a.one("report").one("remittance").one("statements").get(e)},this.dateRangeHelper=function(){return this.fromDate=t("date")(new Date,"yyyy-MM-dd"),this.toDate=t("date")(new Date,"yyyy-MM-dd"),this},this.getPageNumber=function(e,t){return e&&Number(t)?t-1:Number(t)+1},this.downloadReport=function(e){return a.one("report").one("remittance").customGET("excel",e)}}]),a.module("esewaPaymentApp").controller("RedeemRewardAbstractController",["$scope","$rootScope","RedeemRewardPointService",function(e,t,a){e.globalRewardSchemeList=[],e.quickRedeemScheme=[],e.giftRedeemScheme=[],a.getRedeemRewardScheme().then(function(t){e.globalRewardSchemeList=t.plain();for(var a=0;a<e.globalRewardSchemeList.length;a++)"AUTOMATED"===e.globalRewardSchemeList[a].type?e.quickRedeemScheme.push(e.globalRewardSchemeList[a]):e.giftRedeemScheme.push(e.globalRewardSchemeList[a])},function(t){e.errorMessage=t.data.error_message})}]),a.module("esewaPaymentApp").controller("RedeemRewardHistoryController",["$scope","$filter","InfiniteScrollService",function(e,t,a){console.log("Reward History Controller started successfully........"),e.dateRange=new function(){this.fromDate=new Date,this.fromDate.setDate(this.fromDate.getDate()-5),this.toDate=new Date},e.redeemReward={},e.redeemReward.status="",e.reloadTable=function(){var n={from_date:t("date")(e.dateRange.fromDate,"yyyy-MM-dd"),to_date:t("date")(e.dateRange.toDate,"yyyy-MM-dd"),page:0,size:10,status:e.redeemReward.status};e.rewardStatement=new a("auth/reward_point/redeem/statement",n),e.rewardStatement.nextPage()},e.reloadTable()}]),a.module("esewaPaymentApp").controller("RedeemRewardModalController",["$scope","$rootScope","$window","DefaultMessageConstant","AUTH_EVENTS","$modalInstance","message","redeemDetail","RedeemRewardPointService",function(e,t,a,n,i,o,r,s,c){e.msg=r,e.redeemDetail=s,e.enableProccedBtn=!!e.redeemDetail.clickable,e.close=function(){o.dismiss()},e.proceedToRedeem=function(){c.initiateRedeemRequest(e.redeemDetail.id).then(function(e){t.showErrorSuccessMessage(e,!1),t.$broadcast(i.getBalanceAndRewards)},function(e){t.showErrorSuccessMessage(e,!0,"REDEEM_REQUEST_FAIL")}).finally(function(){a.scrollTo(0,0),o.dismiss()})}}]),a.module("esewaPaymentApp").controller("RedeemRewardSchemeController",["$scope","RedeemRewardPointService",function(e,t){}]),a.module("esewaPaymentApp").controller("RedeemRewardShowcaseController",["$scope","RedeemRewardPointService","CDNUrl","$modal",function(e,t,a,n){function i(e,t,i,o){n.open({templateUrl:a.url+e,controller:"RedeemRewardModalController",size:t,resolve:{message:function(){return i},redeemDetail:function(){return o}}})}e.triggerQuickRedeem=function(e){e.clickable?i("/html/modal/redeemRewardModal.html","md","Please confirm the following detail",e):i("/html/modal/redeemRewardModal.html","md","Your Reward point balance is less than the required Reward Points",e)},e.triggerGiftRedeem=function(e){e.isActive}}]),a.module("esewaPaymentApp").controller("RedeemRewardStatementController",["$scope","$filter","InfiniteScrollService",function(e,t,a){e.dateRange=new function(){this.fromDate=new Date,this.fromDate.setDate(this.fromDate.getDate()-5),this.toDate=new Date},e.redeemReward={},e.redeemReward.reward_event_type="",e.reloadTable=function(){var n={from_date:t("date")(e.dateRange.fromDate,"yyyy-MM-dd"),to_date:t("date")(e.dateRange.toDate,"yyyy-MM-dd"),page:0,size:10,reward_event_type:e.redeemReward.reward_event_type};e.rewardStatement=new a("auth/reward_point/statement",n),e.rewardStatement.nextPage()},e.reloadTable()}]),a.module("esewaPaymentApp").service("RedeemRewardPointService",["Restangular",function(e){var t=e.all("/auth");this.getRedeemRewardScheme=function(){return t.one("reward_point_scheme").get()},this.initiateRedeemRequest=function(e){return t.one("redeem").customPOST({},"reward",{scheme_id:e})}}]),a.module("esewaPaymentApp").controller("SahakariWithdrawController",["$scope","$rootScope","SahakariService","CDNUrl","$modal","EsewaCommissionCalculationFactory","$state",function(e,t,a,n,i,o,r){function s(t){e.instituteList=[],e.allFetchedInstitution.address_institution_map[t].forEach(function(t){e.instituteList.push(t)})}function c(){e.$modalInstance=i.open({templateUrl:n.url+"/html/sahakari/transaction_validation.html",scope:e})}e.paymentRequest={},e.provinceList=[],e.showConfirmationPage=!1,e.districtList=[],e.instituteList=[],e.serviceId="",e.errorMessage="",e.commissionDetailService=o,a.getProvince().then(function(a){e.provinceList=a.plain(),t.$emit("bankList","")},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")}),e.getDistrictWiseInstitution=function(t){for(var a in e.paymentRequest.beneficiary_name="",e.allFetchedInstitution.address_institution_map)e.allFetchedInstitution.address_institution_map.hasOwnProperty(a)&&t===a&&s(t)},e.fetchDistrictWithInstitution=function(n){var i={address_id:n};a.getDistrictWithInstitution(i).then(function(t){var a=t.plain();e.allFetchedInstitution=a,e.districtList=Object.keys(a.address_institution_map),0===e.districtList.length&&(e.paymentRequest.district="",e.paymentRequest.beneficiary_name="",e.instituteList=[],e.sahakariWithdrawForm.$setPristine())},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})},e.validation={success:!1,failed:!1},e.validateTransaction=function(t){var n={institution_id:t.beneficiary_name.id,institution_acc_no:t.institution_acc_no,reg_mobile_no:t.reg_mobile_no,amount:t.amount,currency:"NPR",beneficiary_name:t.account_holder_name,remarks:t.remarks};a.validateTransaction(n).then(function(t){e.validation.success=!0,e.validation.failed=!1,e.serviceId=t.service_info_id,c()},function(t){e.errorMessage=t.data.error_message?t.data.error_message:"Invalid Account Detail",e.validation.failed=!0,e.validation.success=!1,c()})},e.cancel=function(){e.$modalInstance.dismiss("cancel")},e.chargeValidation=function(){if(e.paymentRequest.amount&&e.paymentRequest.beneficiary_name.id){var n={amount:e.paymentRequest.amount,client_code:e.paymentRequest.beneficiary_name.id,service_code:"CWD",transaction_type:"CLIENT_WITHDRAW"};o.setAmount(e.paymentRequest.amount),a.validateCommission(n).then(function(t){var n,i,r=t.plain();r.serviceCharge&&(n=r.chargeable_amount,i={client_code:e.paymentRequest.beneficiary_name.id,service_code:"CWD"},a.fetchCommission(i).then(function(t){t.plain(),function(t,a){e.commissionDetailService.setCashBackCharge(0,t.commissionResources),o.calculateForAmount(a),o.getCharge(),o.getTotalPayingAmountForAgent()}(t,n)}))},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}},e.goToConfirm=function(){e.showConfirmationPage=!0,e.cancel()},e.cancelTransaction=function(){e.showConfirmationPage=!1},e.confirmTransaction=function(){a.confirmTransaction(e.paymentRequest.beneficiary_name.id,e.serviceId).then(function(e){r.go("merchant.transaction",{txnId:e.transaction_code,moduleId:e.module_id})},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")})}}]),a.module("esewaPaymentApp").service("SahakariService",["Restangular",function(e){var t=e.all("auth/cooperatives");this.getProvince=function(){return e.all("address").one("province").get()},this.getDistrictWithInstitution=function(e){return t.one("institutions").customPOST(e)},this.validateTransaction=function(e){return t.one("validate_transaction").customPOST(e)},this.confirmTransaction=function(e,a){var n={service_info_id:a};return t.one(e).one("make_payment").customPOST(n)},this.validateCommission=function(t){return e.all("auth").one("/client/validate_charge").customPOST(t)},this.fetchCommission=function(t){return e.all("auth").one("/client/commission").customPOST(t)}}]),a.module("esewaPaymentApp").controller("ServiceListController",["$scope","$state","StateConstant","CommonService","$stateParams","$filter","$rootScope",function(e,t,a,n,i,o,r){r.setDocumentTitle(o("reverse_camel_case")(i.service_type)),e.serviceType=i.service_type;var s={logoPath:"",id:Math.random(),showSkeleton:!0,productCode:"",name:""};e.services={title:"",showSkeleton:!0,productList:Array(10).fill(s)},n.getJsonDataFromCdn(i.service_type).then(function(t){e.services=t.data,e.billPaymentLoader=!!e.services},function(t){e.message=t})}]),a.module("esewaPaymentApp").constant("DefaultMessageConstant",{INSUFFICIENT_BALANCE:"Insufficient Balance. Please load your wallet and request again.",INVALID_AMOUNT:"Payment has already been done.",PAYMENT_FAILED:"Payment Failed. Please try again later.",ERROR_ON_SERVING_REQUEST:"Flights are not available with provided search parameters.",USER_NOT_FOUND:"Username not found",SOMETHING_WENT_WRONG:"Something went wrong. Please, try again later.",ERROR_FETCHING_DATA:"Error while fetching data.",SERVICE_NA:"Service not available.",SUCCESS_FUND_TRANSFER:"Fund transferred successfully.",TIME_EXCEED:"Time limit exceeded, please select seats again.",ERROR_FETCHING_ROUTE:"Could not fetch routes, please try again.",TICKET_BOOKING_FAILED:"Could not book ticket, please try again.",REFRESH_FAILED:"Could not refresh seat, please try again later",REDEEM_REQUEST_FAIL:"Could not process redeem request, please try again later",SERVICE_INACTIVE:"Service is currently inactive. Please try again later.",ACCOUNT_REMOVED:"Account removed successfully.",BOTH_DR_CR_BLOCKED:"Debit and Credit both are blocked for this user.",BLOCKED:"Account has been blocked for this user."}),a.module("esewaPaymentApp").constant("PaymentConstant",{WALLET_LABEL:"Pay Via eSewa",OTHER_PAYMENT_LABEL:"Pay Via Linked Account",DEFAULT_PAYMENT_LABEL:"esewa",LINKED_ACCOUNT_PAYMENT_LABEL:"linked account",MOBILE_BANKING_LABEL:"mobile banking",WITHDRAW_DD_OPTION_TYPE:"DD_BANK_WITHDRAW",ESCROW_PENDING_COUNT:"ESCROW_PENDING_COUNT"}),a.module("esewaPaymentApp").constant("PropertyConstant",{kycDocumentUploadMinSize:1,kycDocumentUploadMaxSize:10485760,kycDocumentCodeCtzn:"CTZN",kycDocumentCodeCtznBack:"CTZN_BACK",kycDocumentCodePhoto:"IMAGE",kycStatusSubmitVerification:"SUBMIT_VERIFICATION_REQUEST",kycStatusCancelVerification:"CANCEL_VERIFICATION_REQUEST",kycStatusApproved:"APPROVED",kycStatusRejected:"REJECTED",kycStatusAccepted:"ACCEPTED",kycStatusNoData:"NO_DATA",kycStatusPending:"PENDING",kycPersonalDetail:"PERSONAL_DETAIL",kycGeneralDetail:"GENERAL_DETAIL",kycIdentityDetail:"IDENTITY_DETAIL",initialSkip:"SKIP",initialSkipAndNeverSee:"SKIP_AND_NEVER_SEE_AGAIN",initialForceful:"FORCEFUL",notification:"NOTIFICATION",user:"USER",userNotification:"USER_NOTIFICATION",statusActive:"ACTIVE",default:"DEFAULT",merchantBalanceTransfer:"BALTXN",topup:"TOPUP",wlinkLim:"eSewa_worldlink",wlinkUlim:"eSewa_worldlink",lekhnath:"WATERMARK",INDRAPUR:"eSewa_indrapur",BALKOT:"BALKOTKHANEPANI",MANGADH:"eSewa_mangadh",pragatinagar:"khanepani_nawal",ntcPrepaidTopup:"NTNAM",ntcPostpaidTopup:"NTPOS",ncellTopup:"NCPP2",creditCard:"CCONE",neaOnline:"NEA ONLINE",airlineProductCode:"RMK",nmcToken:"nmcToken",KUKLTRBILL:"KUKLTRBILL",DAMAULI:"eSewa_damauli",PRITHIVI_NARAYAN:"eSewa_prithvi",NNC:"nnc",NAMS:"NAMS",SHIVALAYA:"SHIVALAYA",JUTPANI:"jutpani_water",SAGARMATHA_DIRECTPAY:"SAGARMATHA_DIRECTPAY",EPS_PAYMENT:"epshelp",EPS_TOKEN:"EPS-PAYMENT",BUDHABARE:"BUDHABARE",VIANET:"eSewa_Vianet",CONNECT_PLUS:"CONNECT_PLUS",DISH_HOME:"NP-RTP-DHOME",BELCHAUTARA:"BELCHAUTARA",ITAHARI:"itahari-khanepani",DADIKOT:"DADIKOT",TOKEN_PAYMENT:"eSewa_gham",FUN_VALLEY:"FUN-VALLEY",KANTIPUR:"KANTIPUR",khandbari:"khandbari_water",MERO_TV:"MEROTV",KAWASHOTI:"KAWASHOTI",LUBHU:"LUBHU",KATUNJE:"KATUNJE",PANCHANAGAR:"PANCHANAGAR",BANGANGA:"BANGANGA",BARDAGHAT:"BARDAGHAT",SHIVNAGAR:"SHIVNAGAR",SURKHET:"SURKHET",MURGIYA:"MURGIYA",SHANKARNAGAR:"SHANKARNAGAR",ANANDABAN:"ANANDABAN",BHANSI:"BHANSI",NET_TV:"NP-ES-DNETTV",SKY_TV:"NP-RTP-SKYTV",NP_RTP_DHOME_RECHARGE:"NP-RTP-DHOME-RECHARGE",MIDAS:"eSewa_midas",TU_TOKEN_PAYMENT:"NP-ES-GRADUATION-TU",AIRLINE_RESCHEDULE:"NP-ES-AIRLINES-RESCHEDULE",NP_ES_KHANEPANI:"NP-ES-KHANEPANI",ESEWA_WATERMARK:"esewa_watermark",ESEWA_H2O:"esewa_h2o",SKY_INTERNET:"NP-ES-SKY-INTERNET",SKY_WALLET:"NP-ES-SKY-WALLET",ARROWNET_ISP:"NP-ES-ARROWNET-ISP",TECHMIND_ISP:"NP-ES-TECHMIND-ISP",SIM_TV:"NP-RTP-SIMTV",EACADEMY:"eAcademy_payment",COAL:"NP-ES-COAL-TOKEN",CHAKRESHWOR_SCHOOL:"chakreshwor_eSewa",LITTLE_ANGEL:"LITTLE_ANGEL",ESEWA_ROSY:"ESEWA_ROSY",JYOTISMATI_SCHOOL:"JYOTISMATI_SCHOOL",ESEWA_PARIJAT:"eSewa_parijat",ESEWA_NORTH:"NP-ES-North",ESEWA_JAINDRA:"eSewa_jaindra",DISH_HOME_RECHARGE_CARD:"DISHHOME",NT_RECHARGE_CARD:"NTGSMRC",BROADLINK_RECHARGE_CARD:"BLRC",UTL_RECHARGE_CARD:"UTLRC",NEPAL_NURSING_COUNCIL_TOKEN:"nnc",NMC_TOKEN:"NMCAPI",NAMASTE_TOPUP_VOLUME_BASED:"NTADV",NAMASTE_TOPUP_UNLIMITED:"NTADS",NAMASTE_LANDLINE:"NTPST",THE_LAST_RESORT:"eSewa_lastresort",KASPERSKY:"Kaspersky",NIC_ASIA_MPATHSALA:"NP-ES-NIC-ASIA-MPATHSALA",ESEWA_GHAMPOWER:"eSewa_gham",TMS_BILL_PAYMENT:"NP-ES-TMSINAPP-PAYMENT"}),a.module("esewaPaymentApp").constant("WuContants",{LikelyToBeQueued:"2000",LikelyToBeSuccessful:"0",AdditionalInformationRequired:"J1002",FailedPayout:"J1000",OnHold:"U2313",InvalidTransaction:"J9999",AlreadyPaidOut:"J1005",MtcnNotFound:"R8774"}),a.module("esewaSharedApp").directive("ecBreadCrumb",["CDNUrl","$rootScope","$state",function(e,t,a){return{restrict:"E",templateUrl:e.url+"/html/remittance/esewa-remit/ec_breadcrumb.html",scope:{breadCrumbItems:"="},link:function(e,n){e.moveToState=function(e,a){e.isDisabled||t.goToState(e.state)},t.$on("$stateChangeSuccess",function(t,n){e.breadCrumbItems=e.breadCrumbItems.map(function(e){return e.state===a.current.name&&(e.isActiveState=!0),e})})}}}]),a.module("esewaSharedApp").directive("ecButtonContainer",["CDNUrl",function(e){return{restrict:"E",templateUrl:e.url+"/html/remittance/esewa-remit/ec_button_container.html",scope:{ecShowBackBtn:"=?",ecBackBtnText:"=?",ecProceedBtnText:"=?",ecBackBtnClick:"&?",ecProceedBtnClick:"&?",ecBackBtnDisabled:"=?",ecProceedBtnDisabled:"=?"},link:function(e,t){e.ecBackBtnDisabled=!!a.isDefined(e.ecBackBtnDisabled)&&e.ecBackBtnDisabled,e.ecProceedBtnDisabled=!!a.isDefined(e.ecProceedBtnDisabled)&&e.ecProceedBtnDisabled,e.ecProceedBtnText=a.isDefined(e.ecProceedBtnText)?e.ecProceedBtnText:"Continue",e.ecBackBtnText=a.isDefined(e.ecBackBtnText)?e.ecBackBtnText:"Back"}}}]),a.module("esewaSharedApp").directive("ecCommission",["CDNUrl","$rootScope","EsewaCommissionCalculationFactory","MerchantPaymentService",function(e,t,n,i){return{restrict:"E",templateUrl:e.url+"/html/remittance/esewa-remit/ec_commission.html",scope:{amount:"=",productCode:"=",totalAmountText:"@?",rewardPointText:"@?",esewaCashbackText:"@?",netPayText:"@?",serviceChargeText:"@?",commission:"=?",deductCashbackFromTotal:"=?"},link:function(e,o){function r(n,o){e.commissionDetails.setCashBackCharge(0,0),e.showCommissionloading=!0,i.getProductCommission(n,!0).then(function(t){!function(t,n){e.commissionDetails.setCashBackCharge(1*t.cashback,t.commissionResources),e.commissionDetails.calculateForAmount(1*n),t.rewardPointResource&&(e.commissionDetails.setRewardPointResource(t.rewardPointResource),e.commissionDetails.calculateRewardPoint(1*n));e.commission=a.copy(e.commissionDetails)}(t.plain(),o)},function(e){t.showErrorSuccessMessage(e,!0,"ERROR_ON_SERVING_REQUEST")}).finally(function(){e.showCommissionloading=!1})}e.totalAmountText=e.totalAmountText||"Total Amount",e.esewaCashbackText=e.esewaCashbackText||"eSewa Cashback",e.rewardPointText=e.rewardPointText||"eSewa Reward Point",e.netPayText=e.netPayText||"Paying Amount",e.serviceChargeText=e.serviceChargeText||"Service Charge",e.commissionDetails=n,e.deductCashbackFromTotal=e.deductCashbackFromTotal||!1,e.$watch("amount",function(t){e.amount>0&&e.productCode&&r(e.productCode,t)}),e.$watch("productCode",function(t){e.amount>0&&e.productCode&&r(t,e.amount)})}}}]),a.module("esewaPaymentApp").directive("scrollDetector",function(){return{restrict:"A",link:function(e,t,a){var n=t[0];t.bind("scroll",function(){n.scrollTop+n.offsetHeight>=n.scrollHeight&&e.$apply(a.scrollDetector)})}}}),a.module("esewaPaymentApp").factory("EsewaCommissionCalculationFactory",["$rootScope",function(e){var t=0,a=0,n={},i=0,o=0,r=0,s=0,c={},l=function(e,n){var o=0;_.forEach(e,function(e){"PAYER_TO_RECEIVER"===e.transferType||"PAYER_TO_ESEWA"===e.transferType?a=_.round(a+u(e,n),2):"ESEWA_CASHBACK"===e.transferType?o=_.round(o+u(e,n),2):"ESEWA_TO_PAYER"===e.transferType?t=_.round(t+u(e,n),2):"RECEIVER_TO_PAYER"===e.transferType&&(t=_.round(t+u(e,n),2))}),o=_.round(o*i/100,2),t+=o},u=function(e,t){switch(e.commissionType){case"FLAT_AMOUNT":return e.value;case"FLAT_PERCENTAGE":return _.round(t*e.value/100,2);case"RANGE_AMOUNT":return m(e.commissionRangeResources,t);case"RANGE_PERCENTAGE":var a=m(e.commissionRangeResources,t);return _.round(t*a/100,2);case"RANGE":return d(e.commissionRanges,t)}return 0},d=function(t,a){var n=0,i=0;return _.forEach(t,function(t){a>=t.low&&(0===t.high||a<=t.high)&&(n=t.value,t.cashbackDistributions?(i=e.isPoint()?t.cashbackDistributions.POINT.value:t.cashbackDistributions.CUSTOMER.value,n=n*i/100,t.percentage&&(n=_.round(a*n/100,2))):t.percentage&&(n=_.round(a*n/100,2)))}),n},m=function(e,t){var a=0;return _.forEach(e,function(e){t>=e.low&&(0===e.high||t<=e.high)&&(a=e.value)}),a};return{setCashBackCharge:function(e,s){t=a=o=r=0,n=s,i=e},setOnlyAmount:function(e){t=a=0,l({},e)},resetCommission:function(){t=a=o=r=0,n={}},calculateForAmount:function(e,i){o=e;t=a=0,l(n,i?e-i:e)},getCashBack:function(){return t},getCharge:function(){return a},getTds:function(){return r},getTotalPayingAmount:function(){return o+a-t},getTotalPayingAmountForAgent:function(){return o+a-t+r},setCashBackChargeAndTds:function(e){r=0,r=t*(e/100),t=t},setAmount:function(e){1},setRewardPoint:function(e){s=1*e},getRewardPoint:function(){return s},setRewardPointResource:function(e){c=e},calculateRewardPoint:function(e){s=0,"RANGE"===c.commission_type?_.forEach(c.reward_point_ranges,function(t){e>=t.low&&(0===t.high||e<=t.high)&&(s=t.percentage?_.round(e*t.value/100,2):t.value)}):s="FLAT_AMOUNT"===c.commission_type?c.value:_.round(e*c.value/100,2)}}}]),a.module("esewaPaymentApp").factory("CurrencyFormatterFactory",function(){}),a.module("esewaPaymentApp").factory("PaymentFormStaticUrlFactory",[function(){var e={};return{getPaymentFormUrlMap:function(t){return e},setPaymentUrlMap:function(t){e=t}}}]),a.module("esewaPaymentApp").factory("PropertyOrderFactory",[function(){var e=["name","customerId","contact","package"],t=["grandTotal","hidden","Message","USERNAME","finalPayableAmount"];return{orderProperties:function(n){return function(n){for(var i=n,o={},r=0;r<=e.length-1;r++)o[e[r]]=i[e[r]],delete i[e[r]];a.forEach(i,function(e,t){o[t]=e});for(var s=t.length-1;s>=0;s--){var c=t[s],l=o[c];delete o[c],l&&(o[c]=l)}return a.forEach(o,function(e,t){e?o[t]=e:delete o[t]}),o}(n)},createTable:function(e){var t=[],a=[],n=_.groupBy(e,"DUE_BILL_OF");for(var i in n){var o=n[i];for(var r in o){var s=o[r];if(0===t.length)for(var c in s)t.push(c)}}for(var l in n){var u=n[l];for(var d in u){var m=u[d],p=[];for(var f in m)p.push(m[f]);a.push(p)}}return{header:t,body:a}},orderOccupation:function(e){var t=a.copy(e);return _.remove(t,function(e){return"Other"===e.occupation_name}),a.forEach(e,function(e){"Other"===e.occupation_name&&t.push(e)}),t}}}]),a.module("esewaPaymentApp").filter("currency",function(){return function(e){return"NPR "+e}}),a.module("esewaPaymentApp").filter("dateToString",function(){return function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}}),a.module("esewaPaymentApp").filter("hotelTextFilter",function(){return function(e){if(a.isDefined(e))return(e=(e=e.replace("<b>Facilities</b>","")).replace("<strong>Facilities</strong>","")).replace("<strong>What's Nearby</strong><ul></ul>","")}}),a.module("esewaPaymentApp").filter("listArray",function(){return function(e,t){var a=t||",";return(e||[]).join(a+" ")}}),a.module("esewaPaymentApp").service("InfiniteScrollService",["Restangular",function(e){var t=function(e,t){for(var a in this.statement=[],this.busy=!1,this.complete=!1,this.emptyResult=!1,this.apiUrl=e,this.parameters={},t)t.hasOwnProperty(a)&&(this.parameters[a]=t[a]);this.nextPage()};return t.prototype.nextPage=function(){if(!this.busy&&!this.complete){this.busy=!0;var t=this,a=null;return(a=e.all(t.apiUrl).getList(t.parameters)).then(function(e){t.busy=!1,e.length<t.parameters.size&&(t.complete=!0,0===e.length&&0===t.parameters.page&&(t.emptyResult=!0)),e.length>0&&(t.statement=t.statement.concat(e)),t.parameters.page=t.parameters.page+1}.bind(this)),a}},t}]),a.module("esewaPaymentApp").controller("BalanceRewardCtrl",["$scope","$rootScope","BalanceService","RewardService","AUTH_EVENTS","$timeout",function(e,t,a,n,i,o){}]),a.module("esewaPaymentApp").controller("DateRangeController",["$scope",function(e){e.today=new Date;var t=function(e){e.preventDefault(),e.stopPropagation()};e.openToDate=function(a){t(a),e.toDateOpened=!0,e.fromDateOpened=!1},e.openFromDate=function(a){t(a),e.fromDateOpened=!0,e.toDateOpened=!1}}]),a.module("esewaPaymentApp").controller("PdfDownloadController",["$http","$scope","$window",function(e,t,n){new Date;t.getPdf=function(i,o,r,s){e({url:"api/web/auth/transactions/"+i+"/pdf?module_id="+o,method:"GET",responseType:"text",data:"",headers:{"Content-type":"text/plain",transaction_version:s}}).success(function(e){e&&n.open(e,"_blank")}).error(function(e){a.isDefined(e)?t.responseMessage=e.data:t.responseMessage="Error occurred while generating excel."})}}]),a.module("esewaPaymentApp").controller("StatementController",["$scope","$filter","$compile","$window","$state","StatementService","$timeout","$http","StatementScrollService","$rootScope","InformationService","ecmsg","INFORMATION","$sce","$modal","CommonService","NewTransactionDetail","CDNUrl","MerchantPaymentService",function(e,t,n,i,o,r,s,c,l,u,d,m,p,f,h,g,_,y,S){e.advanceSearch=!1,e.userId="",e.paginationOffset=1,e.product_id=1,e.dataAvailable=!1,e.showloadingBar=!1,u.clearMessage();new Date;var D=new Date("2017-10-13"),R=new Date("2017-10-14");function b(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),i=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[i,a,n].join("-")}e.statusList=["PENDING","COMPLETE","CANCELED","AMBIGUOUS","REVERTED"],e.channelList=[{name:"WEB",value:"WEB_USER"},{name:"SMS",value:"MSEWA"},{name:"APP",value:"GPRS"}],e.TxnTypeList=["DR","CR"],e.minFromDate="2009-09-09",e.todayDate=new Date,e.maxToDate=e.todayDate,e.params={status:"ALL",channel:"ALL",txnType:"ALL",prop_value:""},e.searched=!1,e.searchTxn=function(){e.searched=!0,e.reloadTable()},e.dateVariable={startDate:moment().subtract(7,"days"),endDate:moment()},e.isAdvanceSearchChanged=function(){return!("ALL"===e.params.txnType&&"ALL"===e.params.channel&&"ALL"===e.params.status)},e.reloadTable=function(){e.params.channel||(e.params.channel="ALL"),e.params.status||(e.params.status="ALL"),e.params.txnType||(e.params.txnType="ALL"),e.params.prop_value||(e.params.prop_value=""),e.userStatements=new l(b(e.dateVariable.startDate),b(e.dateVariable.endDate),e.product_id,e.params.channel,e.params.status,e.params.txnType,e.params.prop_value),e.userStatements.nextPage()},e.$watch("dateVariable",function(t,n){t<D&&(e.statementMessage="Please select date earlier from 13 October 2017 for older statement or later from 13 October 2017 for new statement",e.maxToDate=D,e.dateVariable.endDate=D,a.isDefined(u.userBalance)&&a.isDefined(u.userBalance.lastTransactionDate)&&null!==u.userBalance.lastTransactionDate&&u.userBalance.lastTransactionDate<15079185e5&&(e.dateVariable.startDate=15074865e5)),t>D&&(e.minToDate=R,e.maxToDate=e.todayDate,e.statementMessage="Please select date earlier from 13 October 2017 for older statement or later from 13 October 2017 for new statement",e.dateVariable.endDate=e.todayDate,a.isDefined(u.userBalance)&&(a.isDefined(u.userBalance.lastTransactionDate)&&null!==u.userBalance.lastTransactionDate&&(e.dateVariable.endDate=u.userBalance.lastTransactionDate),a.isDefined(u.userBalance.lastTransactionDate)&&null!==u.userBalance.lastTransactionDate&&(e.dateVariable.endDate=u.userBalance.lastTransactionDate))),e.trustedHtmlMessage=f.trustAsHtml(e.statementMessage)}),e.$watch("userBalance",function(t,a){t.balance!==a.balance&&e.resetTable()}),e.verifyDate=function(){e.dateVariable.startDate<D&&(e.statementMessage="Due to system upgrade we cannot provide all the statement at a time, Please select TO DATE lower than 13th October, 2017. For your statement before 13th October, 2017",e.maxToDate=D),e.trustedHtmlMessage=f.trustAsHtml(e.statementMessage)},e.resetTable=function(){e.dateVariable={startDate:moment().subtract(7,"days"),endDate:moment()},e.userStatements=new l(b(e.dateVariable.startDate),b(e.dateVariable.endDate),e.product_id,"ALL","ALL","ALL",""),e.userStatements.nextPage(),e.params={status:"ALL",channel:"ALL",txnType:"ALL",prop_value:""}},e.userStatements=new l(b(e.dateVariable.startDate),b(e.dateVariable.endDate),e.product_id,"ALL","ALL","ALL"),e.getExcel=function(){e.showloadingBar=!0,c({url:"/api/web/auth/transactions/excel",params:{status:e.params.status,channel:e.params.channel,from_date:b(e.dateVariable.startDate),to_date:b(e.dateVariable.endDate),product_id:0,type:e.params.txnType,module_id:e.params.module_id,prop_value:e.params.prop_value},method:"GET",responseType:"text",headers:{"Content-type":"text/plain"}}).success(function(e){i.open(e.split("redirect:")[1],"_blank")}).error(function(t){if(a.isDefined(t)){var n=String.fromCharCode.apply(null,new Uint8Array(t)),i=JSON.parse(n).message;m.error(i)}else e.responseMessage="Error occurred while generating excel."}).finally(function(){e.showloadingBar=!1})},e.showStatementDetail=function(e,t){o.go("user.statements.detail",{txnId:e,moduleId:t})},e.showAdvanceSearch=function(){e.params={status:"ALL",channel:"ALL",txnType:"ALL",prop_value:""},e.advanceSearch=!e.advanceSearch};p.userStatement;u.showInformation=!1;var A=[],T=function(){e.modalInstance=h.open({templateUrl:y.url+"/html/payment/transaction_details_3.51.0.0.html",size:"lg",controller:"TransactionDetailController",scope:e})};function v(e,t){_.transaction_code=e.transaction_code,_.module_id=e.module_id,_.transaction_version=e.transaction_version,_.hiddenStatDetailProps=t}e.showStatement=function(e){var t,a;A.length?(v(e,A),T()):(t=T,a=e,g.getHiddenStatDetailProps().success(function(e){v(a,e),"function"==typeof t&&t()}))},e.getClassByStatus=function(e){switch(e){case"PENDING":return"warning";case"TIMEOUT":case"CANCELED":return"danger";default:return""}}}]),a.module("esewaPaymentApp").controller("StatementDetailPopupController",["$rootScope","$scope","$modalInstance","StatementService","txnCode","AirlinePassengerDetailService","moduleId",function(e,t,n,i,o,r,s){t.transactionId=o,t.moduleId=s,e.currentModal=n,t.cancel=function(){e.currentModal.dismiss()},i.getTxnDetails(o,s).then(function(e){t.transactionDetails=e.plain(),t.transactionDetails.properties.outboundFlightNumber&&(t.ticketDetails=t.transactionDetails,t.passengerDto=r.getAirlinePassengerDetail(t.ticketDetails.properties),a.isDefined(t.ticketDetails.properties.inboundFlightNumber)&&(t.returnPassengerDto=r.getAirlineReturnPassengerDetail(t.ticketDetails.properties)),t.ticketDetails.transaction_code=t.transactionId,t.mobileNumber=t.ticketDetails.properties.buyerPhoneNumber,t.email=t.ticketDetails.properties.buyerEmail)},function(t){a.isDefined(t)?e.message=t.data.error_message:e.message="Error while fetching data."})}]),a.module("esewaPaymentApp").controller("TransactionDetailController",["$scope","StatementService","$stateParams","$http","$rootScope","NewTransactionDetail","AirlinePassengerDetailService","CDNUrl","CustomerTicketingService","$modal","UserActivityService",function(e,t,n,i,o,r,s,c,l,u,d){e.transactionDetails=r,e.transactionId=n.txnId||r.transaction_code,e.moduleId=n.moduleId||r.module_id,a.isDefined(r.properties)&&a.isDefined(r.properties.first_load_message)&&(e.first_load_message=r.properties.first_load_message);var m=a.copy(r.hiddenStatDetailProps);function p(){t.getTxnDetails(e.transactionId,e.moduleId,r.transaction_version).then(function(t){e.transactionDetails=t.plain(),e.ticketDetails=e.transactionDetails,e.ticketDetails.transaction_code=e.transactionId,e.ticketDetails.data&&e.ticketDetails.data.outboundFlight&&e.ticketDetails.data.outboundFlight.childFlights&&(e.outboundFlightDetails=[].concat.apply([],e.ticketDetails.data.outboundFlight.childFlights.map(function(e){return e.passengers.map(function(t){return a.extend({},e,{passenger:t})})}))),e.ticketDetails.data&&e.ticketDetails.data.inboundFlight&&e.ticketDetails.data.inboundFlight.childFlights&&(e.inboundFlightDetails=[].concat.apply([],e.ticketDetails.data.inboundFlight.childFlights.map(function(e){return e.passengers.map(function(t){return a.extend({},e,{passenger:t})})}))),e.mobileNumber=e.ticketDetails.data&&e.ticketDetails.data.buyerDetail.buyer_contact,e.email=e.ticketDetails.data&&e.ticketDetails.data.buyerDetail.buyer_email,e.transactionMessage={},i.get(c.url+"/data/trasactionStatusMessage.json").success(function(t){e.transactionMessage=t[e.transactionDetails.product_code]?t[e.transactionDetails.product_code][e.transactionDetails.transaction_status]:null}),i.get(c.url+"/data/hidden_properties/"+e.transactionDetails.product_code+"_hiddenPropertiesList.json").then(function(e){m=Array.from(new Set(m.concat(e.data)))})},function(e){a.isDefined(e)?o.message=e.data.error_message:o.message="Error while fetching data."})}function f(e,t){return _.pick(e,t)}function h(){r.selectedAccount=null,r.isWithdraw=!1}i.get(c.url+"/data/hiddenPropertiesList.json").then(function(e){m=Array.from(new Set(m.concat(e.data)))}),e.doesNotMatch=function(e){return!_.includes(m,e)},e.transactionDetails.requestUniqueId||p(),e.createIssue=function(t,n){l.createIssue(r,t,n).then(function(t){e.issueDetails=t.plain(),o.message="Issue has been created successfully"},function(e){a.isDefined(e)?o.message=e.data.error_message:o.message="Error while creating issue."})},e.openLinkAccountModal=function(e){var t=Object.assign(e.bank_details,e.account_details),a=f(t,["logo","bank_display_name","swift_code","in_app","send_otp","process"]),n=f(t,["swift_code","account_name","account_number","min_amount","max_amount","regex","in_app","send_otp"]);u.open({templateUrl:c.url+"/html/linked_account/add_linked_account_view_v2_3.48.1.0.html",controller:"AddLinkAccountModalController",size:"sm fade-in",backdrop:"static",resolve:{selectedBank:a,selectedBankDetails:n}}),h()},e.openChildTransactionDetail=function(t){e.transactionId=t,p()};var g,y,S=["$scope","$modalInstance","accountInfo","transactionDetails",function(e,t,a,n){o.currentModal=t,e.transactionDetails=n||{},e.close=function(){t.dismiss(),h()},e.linkAccountConfirmation=function(){t.dismiss(),e.openLinkAccountModal(a)}}];e.showConfirmation=function(t,a){u.open({templateUrl:c.url+"/html/templates/bankinformation/account_link_confirmation_3.42.0.0.html",controller:S,size:"md fade-in",backdrop:"static",windowClass:"modal",keyboard:!1,scope:e,resolve:{accountInfo:function(){return t},transactionDetails:function(){return a}}})},e.transactionDetails.selectedAccount&&(g=e.transactionDetails.selectedAccount,y={swift_code:g.swift_code,account_number:g.account_number,account_name:g.account_name},d.getLinkAccountStatus(y).then(function(t){var a=t.plain();!function(e){if(null!==e.account_details&&null!==e.bank_details){var t=e.account_details||{};return e.bank_details,t.is_personal_account&&!t.is_linked_account}}(a)?e.transactionDetails.selectedAccount=null:(r.isWithdraw=!0,e.showConfirmation(a,r))}))}]),a.module("esewaPaymentApp").service("BalanceService",["Restangular","$rootScope",function(e,t){this.getBalance=function(){var a=t.isOrg()?"user/balance":"auth/balance";return e.one(a).get()}}]),a.module("esewaPaymentApp").service("CustomerTicketingService",["Restangular",function(e){var t=e.all("auth").one("issues");this.getIssues=function(e){return t.get(e)},this.getIssueDetails=function(e,a){return t.one(a+"").customGET(e)},this.createIssue=function(e,a,n){var i={amount:e.amount,transaction_code:e.transaction_code,module_id:e.module_id,severity:a,description:n};return t.customPOST(i)}}]),a.module("esewaPaymentApp").service("DateService",function(){this.getFormattedDate=function(e){var t=new Date(e.fromDate);t.setHours(0,0,0,0);var a=new Date(e.toDate);return a.setHours(23,59,59,999),{fromDate:t.toISOString(),toDate:a.toISOString()}},this.getFormattedToDate=function(e){var t=new Date(e.toDate);return t.setHours(23,59,59,999),{toDate:t.toISOString()}},this.getFormattedFromDate=function(e){var t=new Date(e.fromDate);return t.setHours(0,0,0,0),{fromDate:t.toISOString()}},this.getFormattedDummyDate=function(){var e={fromDate:new Date(0),toDate:new Date};return this.getFormattedDate(e)}}),a.module("esewaPaymentApp").factory("NewTransactionDetail",function(){return{amount:void 0,properties:void 0,narration:void 0,requestUniqueId:void 0,channel:void 0,transaction_status:void 0,created:void 0,product_logo_url:void 0,product_name:void 0,processed_by:void 0,transaction_code:void 0,module_id:void 0,transaction_version:"",hiddenStatDetailProps:[],selectedAccount:void 0,isWithdraw:void 0,isDefined:function(){}}}),a.module("esewaPaymentApp").service("PaginationService",function(){this.getDefaultPagination=function(){return{page:0,size:15}},this.getPagination=function(e,t){return{page:e,size:t}}}),a.module("esewaPaymentApp").service("RewardService",["Restangular","$rootScope",function(e,t){this.getRewardPoints=function(){var a=t.isOrg()?"user/reward_point":"auth/reward_point";return e.one(a).get()}}]),a.module("esewaPaymentApp").factory("StatementParams",[function(){return{from_date:void 0,to_date:void 0,channel:void 0,status:void 0,size:void 0,page:void 0}}]),a.module("esewaPaymentApp").service("StatementScrollService",["Restangular","PaginationService",function(e,t){var a=function(e,t,a,n,i,o,r){this.statements=[],this.busy=!1,this.complete=!1,this.pageNumber=1,this.pageSize=15,this.emptyResult=!1,this.fromDate=e,this.toDate=t,this.product_id=a,this.channel=n,this.status=i,this.txnType=o,this.prop_value=r||"",this.nextPage()};return a.prototype.nextPage=function(){if(!this.busy&&!this.complete){this.busy=!0;var a,n,i,o,r,s,c,l=this,u=t.getPagination(l.pageNumber-1,l.pageSize),d=(a=this.fromDate,n=this.toDate,i=this.product_id,o=this.channel,r=this.status,s=this.txnType,c=this.prop_value,_.merge({from_date:a},{to_date:n},{product_id:i},{channel:o},{status:r},{type:s},{prop_value:c})),m=_.merge(d,u),p=null;return(p=e.all("auth").all("transactions").withHttpConfig({selfHandleLoadingBar:!0}).getList(m)).then(function(e){l.busy=!1,e.length<l.pageSize&&(l.complete=!0,0===e.length&&1===l.pageNumber&&(l.emptyResult=!0)),e.length>0&&(l.statements=l.statements.concat(e)),l.pageNumber=l.pageNumber+1}),p}},a}]),a.module("esewaPaymentApp").service("StatementService",["Restangular",function(e){var t=e.all("auth");this.getStatements=function(e){return t.one("transactions").get(e)},this.getStatementDetails=function(e,a){return t.one(a+"").one("statement").customGET(e)},this.getExcel=function(e,a,n,i){return t.one("transactions/excel").get(function(e,t,a,n,i,o){return _.merge({from_date:e},{to_date:t},{channel:a},{status:n})}(e,a,n,i))},this.getTxnDetails=function(e,a,n){return t.one("transactions").one(e+"").get({module_id:a,transaction_version:n||"V3"})}}])}(window.jQuery,window,window.angular);